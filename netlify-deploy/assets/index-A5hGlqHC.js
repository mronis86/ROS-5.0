(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const h of i)if(h.type==="childList")for(const d of h.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function r(i){const h={};return i.integrity&&(h.integrity=i.integrity),i.referrerPolicy&&(h.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?h.credentials="include":i.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function a(i){if(i.ep)return;i.ep=!0;const h=r(i);fetch(i.href,h)}})();function Hu(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}function Zm(u){if(Object.prototype.hasOwnProperty.call(u,"__esModule"))return u;var n=u.default;if(typeof n=="function"){var r=function a(){var i=!1;try{i=this instanceof a}catch{}return i?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};r.prototype=n.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(u).forEach(function(a){var i=Object.getOwnPropertyDescriptor(u,a);Object.defineProperty(r,a,i.get?i:{enumerable:!0,get:function(){return u[a]}})}),r}var pu={exports:{}},Ka={},vu={exports:{}},Me={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fh;function eg(){if(Fh)return Me;Fh=1;var u=Symbol.for("react.element"),n=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),h=Symbol.for("react.provider"),d=Symbol.for("react.context"),p=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),S=Symbol.for("react.lazy"),N=Symbol.iterator;function R(k){return k===null||typeof k!="object"?null:(k=N&&k[N]||k["@@iterator"],typeof k=="function"?k:null)}var L={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},F=Object.assign,B={};function I(k,U,ae){this.props=k,this.context=U,this.refs=B,this.updater=ae||L}I.prototype.isReactComponent={},I.prototype.setState=function(k,U){if(typeof k!="object"&&typeof k!="function"&&k!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,k,U,"setState")},I.prototype.forceUpdate=function(k){this.updater.enqueueForceUpdate(this,k,"forceUpdate")};function Z(){}Z.prototype=I.prototype;function Y(k,U,ae){this.props=k,this.context=U,this.refs=B,this.updater=ae||L}var H=Y.prototype=new Z;H.constructor=Y,F(H,I.prototype),H.isPureReactComponent=!0;var q=Array.isArray,J=Object.prototype.hasOwnProperty,P={current:null},V={key:!0,ref:!0,__self:!0,__source:!0};function te(k,U,ae){var he,De={},Pe=null,Ve=null;if(U!=null)for(he in U.ref!==void 0&&(Ve=U.ref),U.key!==void 0&&(Pe=""+U.key),U)J.call(U,he)&&!V.hasOwnProperty(he)&&(De[he]=U[he]);var Ae=arguments.length-2;if(Ae===1)De.children=ae;else if(1<Ae){for(var He=Array(Ae),kt=0;kt<Ae;kt++)He[kt]=arguments[kt+2];De.children=He}if(k&&k.defaultProps)for(he in Ae=k.defaultProps,Ae)De[he]===void 0&&(De[he]=Ae[he]);return{$$typeof:u,type:k,key:Pe,ref:Ve,props:De,_owner:P.current}}function C(k,U){return{$$typeof:u,type:k.type,key:U,ref:k.ref,props:k.props,_owner:k._owner}}function re(k){return typeof k=="object"&&k!==null&&k.$$typeof===u}function ue(k){var U={"=":"=0",":":"=2"};return"$"+k.replace(/[=:]/g,function(ae){return U[ae]})}var Ee=/\/+/g;function fe(k,U){return typeof k=="object"&&k!==null&&k.key!=null?ue(""+k.key):U.toString(36)}function me(k,U,ae,he,De){var Pe=typeof k;(Pe==="undefined"||Pe==="boolean")&&(k=null);var Ve=!1;if(k===null)Ve=!0;else switch(Pe){case"string":case"number":Ve=!0;break;case"object":switch(k.$$typeof){case u:case n:Ve=!0}}if(Ve)return Ve=k,De=De(Ve),k=he===""?"."+fe(Ve,0):he,q(De)?(ae="",k!=null&&(ae=k.replace(Ee,"$&/")+"/"),me(De,U,ae,"",function(kt){return kt})):De!=null&&(re(De)&&(De=C(De,ae+(!De.key||Ve&&Ve.key===De.key?"":(""+De.key).replace(Ee,"$&/")+"/")+k)),U.push(De)),1;if(Ve=0,he=he===""?".":he+":",q(k))for(var Ae=0;Ae<k.length;Ae++){Pe=k[Ae];var He=he+fe(Pe,Ae);Ve+=me(Pe,U,ae,He,De)}else if(He=R(k),typeof He=="function")for(k=He.call(k),Ae=0;!(Pe=k.next()).done;)Pe=Pe.value,He=he+fe(Pe,Ae++),Ve+=me(Pe,U,ae,He,De);else if(Pe==="object")throw U=String(k),Error("Objects are not valid as a React child (found: "+(U==="[object Object]"?"object with keys {"+Object.keys(k).join(", ")+"}":U)+"). If you meant to render a collection of children, use an array instead.");return Ve}function pe(k,U,ae){if(k==null)return k;var he=[],De=0;return me(k,he,"","",function(Pe){return U.call(ae,Pe,De++)}),he}function $e(k){if(k._status===-1){var U=k._result;U=U(),U.then(function(ae){(k._status===0||k._status===-1)&&(k._status=1,k._result=ae)},function(ae){(k._status===0||k._status===-1)&&(k._status=2,k._result=ae)}),k._status===-1&&(k._status=0,k._result=U)}if(k._status===1)return k._result.default;throw k._result}var ee={current:null},X={transition:null},$={ReactCurrentDispatcher:ee,ReactCurrentBatchConfig:X,ReactCurrentOwner:P};function M(){throw Error("act(...) is not supported in production builds of React.")}return Me.Children={map:pe,forEach:function(k,U,ae){pe(k,function(){U.apply(this,arguments)},ae)},count:function(k){var U=0;return pe(k,function(){U++}),U},toArray:function(k){return pe(k,function(U){return U})||[]},only:function(k){if(!re(k))throw Error("React.Children.only expected to receive a single React element child.");return k}},Me.Component=I,Me.Fragment=r,Me.Profiler=i,Me.PureComponent=Y,Me.StrictMode=a,Me.Suspense=y,Me.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$,Me.act=M,Me.cloneElement=function(k,U,ae){if(k==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+k+".");var he=F({},k.props),De=k.key,Pe=k.ref,Ve=k._owner;if(U!=null){if(U.ref!==void 0&&(Pe=U.ref,Ve=P.current),U.key!==void 0&&(De=""+U.key),k.type&&k.type.defaultProps)var Ae=k.type.defaultProps;for(He in U)J.call(U,He)&&!V.hasOwnProperty(He)&&(he[He]=U[He]===void 0&&Ae!==void 0?Ae[He]:U[He])}var He=arguments.length-2;if(He===1)he.children=ae;else if(1<He){Ae=Array(He);for(var kt=0;kt<He;kt++)Ae[kt]=arguments[kt+2];he.children=Ae}return{$$typeof:u,type:k.type,key:De,ref:Pe,props:he,_owner:Ve}},Me.createContext=function(k){return k={$$typeof:d,_currentValue:k,_currentValue2:k,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},k.Provider={$$typeof:h,_context:k},k.Consumer=k},Me.createElement=te,Me.createFactory=function(k){var U=te.bind(null,k);return U.type=k,U},Me.createRef=function(){return{current:null}},Me.forwardRef=function(k){return{$$typeof:p,render:k}},Me.isValidElement=re,Me.lazy=function(k){return{$$typeof:S,_payload:{_status:-1,_result:k},_init:$e}},Me.memo=function(k,U){return{$$typeof:x,type:k,compare:U===void 0?null:U}},Me.startTransition=function(k){var U=X.transition;X.transition={};try{k()}finally{X.transition=U}},Me.unstable_act=M,Me.useCallback=function(k,U){return ee.current.useCallback(k,U)},Me.useContext=function(k){return ee.current.useContext(k)},Me.useDebugValue=function(){},Me.useDeferredValue=function(k){return ee.current.useDeferredValue(k)},Me.useEffect=function(k,U){return ee.current.useEffect(k,U)},Me.useId=function(){return ee.current.useId()},Me.useImperativeHandle=function(k,U,ae){return ee.current.useImperativeHandle(k,U,ae)},Me.useInsertionEffect=function(k,U){return ee.current.useInsertionEffect(k,U)},Me.useLayoutEffect=function(k,U){return ee.current.useLayoutEffect(k,U)},Me.useMemo=function(k,U){return ee.current.useMemo(k,U)},Me.useReducer=function(k,U,ae){return ee.current.useReducer(k,U,ae)},Me.useRef=function(k){return ee.current.useRef(k)},Me.useState=function(k){return ee.current.useState(k)},Me.useSyncExternalStore=function(k,U,ae){return ee.current.useSyncExternalStore(k,U,ae)},Me.useTransition=function(){return ee.current.useTransition()},Me.version="18.3.1",Me}var Vh;function qu(){return Vh||(Vh=1,vu.exports=eg()),vu.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bh;function tg(){if(Bh)return Ka;Bh=1;var u=qu(),n=Symbol.for("react.element"),r=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,i=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,h={key:!0,ref:!0,__self:!0,__source:!0};function d(p,y,x){var S,N={},R=null,L=null;x!==void 0&&(R=""+x),y.key!==void 0&&(R=""+y.key),y.ref!==void 0&&(L=y.ref);for(S in y)a.call(y,S)&&!h.hasOwnProperty(S)&&(N[S]=y[S]);if(p&&p.defaultProps)for(S in y=p.defaultProps,y)N[S]===void 0&&(N[S]=y[S]);return{$$typeof:n,type:p,key:R,ref:L,props:N,_owner:i.current}}return Ka.Fragment=r,Ka.jsx=d,Ka.jsxs=d,Ka}var zh;function rg(){return zh||(zh=1,pu.exports=tg()),pu.exports}var o=rg(),_=qu();const Cl=Hu(_);var xl={},yu={exports:{}},lr={},xu={exports:{}},bu={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wh;function ng(){return Wh||(Wh=1,(function(u){function n(X,$){var M=X.length;X.push($);e:for(;0<M;){var k=M-1>>>1,U=X[k];if(0<i(U,$))X[k]=$,X[M]=U,M=k;else break e}}function r(X){return X.length===0?null:X[0]}function a(X){if(X.length===0)return null;var $=X[0],M=X.pop();if(M!==$){X[0]=M;e:for(var k=0,U=X.length,ae=U>>>1;k<ae;){var he=2*(k+1)-1,De=X[he],Pe=he+1,Ve=X[Pe];if(0>i(De,M))Pe<U&&0>i(Ve,De)?(X[k]=Ve,X[Pe]=M,k=Pe):(X[k]=De,X[he]=M,k=he);else if(Pe<U&&0>i(Ve,M))X[k]=Ve,X[Pe]=M,k=Pe;else break e}}return $}function i(X,$){var M=X.sortIndex-$.sortIndex;return M!==0?M:X.id-$.id}if(typeof performance=="object"&&typeof performance.now=="function"){var h=performance;u.unstable_now=function(){return h.now()}}else{var d=Date,p=d.now();u.unstable_now=function(){return d.now()-p}}var y=[],x=[],S=1,N=null,R=3,L=!1,F=!1,B=!1,I=typeof setTimeout=="function"?setTimeout:null,Z=typeof clearTimeout=="function"?clearTimeout:null,Y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function H(X){for(var $=r(x);$!==null;){if($.callback===null)a(x);else if($.startTime<=X)a(x),$.sortIndex=$.expirationTime,n(y,$);else break;$=r(x)}}function q(X){if(B=!1,H(X),!F)if(r(y)!==null)F=!0,$e(J);else{var $=r(x);$!==null&&ee(q,$.startTime-X)}}function J(X,$){F=!1,B&&(B=!1,Z(te),te=-1),L=!0;var M=R;try{for(H($),N=r(y);N!==null&&(!(N.expirationTime>$)||X&&!ue());){var k=N.callback;if(typeof k=="function"){N.callback=null,R=N.priorityLevel;var U=k(N.expirationTime<=$);$=u.unstable_now(),typeof U=="function"?N.callback=U:N===r(y)&&a(y),H($)}else a(y);N=r(y)}if(N!==null)var ae=!0;else{var he=r(x);he!==null&&ee(q,he.startTime-$),ae=!1}return ae}finally{N=null,R=M,L=!1}}var P=!1,V=null,te=-1,C=5,re=-1;function ue(){return!(u.unstable_now()-re<C)}function Ee(){if(V!==null){var X=u.unstable_now();re=X;var $=!0;try{$=V(!0,X)}finally{$?fe():(P=!1,V=null)}}else P=!1}var fe;if(typeof Y=="function")fe=function(){Y(Ee)};else if(typeof MessageChannel<"u"){var me=new MessageChannel,pe=me.port2;me.port1.onmessage=Ee,fe=function(){pe.postMessage(null)}}else fe=function(){I(Ee,0)};function $e(X){V=X,P||(P=!0,fe())}function ee(X,$){te=I(function(){X(u.unstable_now())},$)}u.unstable_IdlePriority=5,u.unstable_ImmediatePriority=1,u.unstable_LowPriority=4,u.unstable_NormalPriority=3,u.unstable_Profiling=null,u.unstable_UserBlockingPriority=2,u.unstable_cancelCallback=function(X){X.callback=null},u.unstable_continueExecution=function(){F||L||(F=!0,$e(J))},u.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<X?Math.floor(1e3/X):5},u.unstable_getCurrentPriorityLevel=function(){return R},u.unstable_getFirstCallbackNode=function(){return r(y)},u.unstable_next=function(X){switch(R){case 1:case 2:case 3:var $=3;break;default:$=R}var M=R;R=$;try{return X()}finally{R=M}},u.unstable_pauseExecution=function(){},u.unstable_requestPaint=function(){},u.unstable_runWithPriority=function(X,$){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var M=R;R=X;try{return $()}finally{R=M}},u.unstable_scheduleCallback=function(X,$,M){var k=u.unstable_now();switch(typeof M=="object"&&M!==null?(M=M.delay,M=typeof M=="number"&&0<M?k+M:k):M=k,X){case 1:var U=-1;break;case 2:U=250;break;case 5:U=1073741823;break;case 4:U=1e4;break;default:U=5e3}return U=M+U,X={id:S++,callback:$,priorityLevel:X,startTime:M,expirationTime:U,sortIndex:-1},M>k?(X.sortIndex=M,n(x,X),r(y)===null&&X===r(x)&&(B?(Z(te),te=-1):B=!0,ee(q,M-k))):(X.sortIndex=U,n(y,X),F||L||(F=!0,$e(J))),X},u.unstable_shouldYield=ue,u.unstable_wrapCallback=function(X){var $=R;return function(){var M=R;R=$;try{return X.apply(this,arguments)}finally{R=M}}}})(bu)),bu}var Hh;function sg(){return Hh||(Hh=1,xu.exports=ng()),xu.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qh;function og(){if(qh)return lr;qh=1;var u=qu(),n=sg();function r(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,s=1;s<arguments.length;s++)t+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,i={};function h(e,t){d(e,t),d(e+"Capture",t)}function d(e,t){for(i[e]=t,e=0;e<t.length;e++)a.add(t[e])}var p=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),y=Object.prototype.hasOwnProperty,x=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,S={},N={};function R(e){return y.call(N,e)?!0:y.call(S,e)?!1:x.test(e)?N[e]=!0:(S[e]=!0,!1)}function L(e,t,s,c){if(s!==null&&s.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return c?!1:s!==null?!s.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function F(e,t,s,c){if(t===null||typeof t>"u"||L(e,t,s,c))return!0;if(c)return!1;if(s!==null)switch(s.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function B(e,t,s,c,f,m,b){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=c,this.attributeNamespace=f,this.mustUseProperty=s,this.propertyName=e,this.type=t,this.sanitizeURL=m,this.removeEmptyString=b}var I={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){I[e]=new B(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];I[t]=new B(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){I[e]=new B(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){I[e]=new B(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){I[e]=new B(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){I[e]=new B(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){I[e]=new B(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){I[e]=new B(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){I[e]=new B(e,5,!1,e.toLowerCase(),null,!1,!1)});var Z=/[\-:]([a-z])/g;function Y(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Z,Y);I[t]=new B(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Z,Y);I[t]=new B(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Z,Y);I[t]=new B(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){I[e]=new B(e,1,!1,e.toLowerCase(),null,!1,!1)}),I.xlinkHref=new B("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){I[e]=new B(e,1,!1,e.toLowerCase(),null,!0,!0)});function H(e,t,s,c){var f=I.hasOwnProperty(t)?I[t]:null;(f!==null?f.type!==0:c||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(F(t,s,f,c)&&(s=null),c||f===null?R(t)&&(s===null?e.removeAttribute(t):e.setAttribute(t,""+s)):f.mustUseProperty?e[f.propertyName]=s===null?f.type===3?!1:"":s:(t=f.attributeName,c=f.attributeNamespace,s===null?e.removeAttribute(t):(f=f.type,s=f===3||f===4&&s===!0?"":""+s,c?e.setAttributeNS(c,t,s):e.setAttribute(t,s))))}var q=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,J=Symbol.for("react.element"),P=Symbol.for("react.portal"),V=Symbol.for("react.fragment"),te=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),re=Symbol.for("react.provider"),ue=Symbol.for("react.context"),Ee=Symbol.for("react.forward_ref"),fe=Symbol.for("react.suspense"),me=Symbol.for("react.suspense_list"),pe=Symbol.for("react.memo"),$e=Symbol.for("react.lazy"),ee=Symbol.for("react.offscreen"),X=Symbol.iterator;function $(e){return e===null||typeof e!="object"?null:(e=X&&e[X]||e["@@iterator"],typeof e=="function"?e:null)}var M=Object.assign,k;function U(e){if(k===void 0)try{throw Error()}catch(s){var t=s.stack.trim().match(/\n( *(at )?)/);k=t&&t[1]||""}return`
`+k+e}var ae=!1;function he(e,t){if(!e||ae)return"";ae=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(K){var c=K}Reflect.construct(e,[],t)}else{try{t.call()}catch(K){c=K}e.call(t.prototype)}else{try{throw Error()}catch(K){c=K}e()}}catch(K){if(K&&c&&typeof K.stack=="string"){for(var f=K.stack.split(`
`),m=c.stack.split(`
`),b=f.length-1,j=m.length-1;1<=b&&0<=j&&f[b]!==m[j];)j--;for(;1<=b&&0<=j;b--,j--)if(f[b]!==m[j]){if(b!==1||j!==1)do if(b--,j--,0>j||f[b]!==m[j]){var O=`
`+f[b].replace(" at new "," at ");return e.displayName&&O.includes("<anonymous>")&&(O=O.replace("<anonymous>",e.displayName)),O}while(1<=b&&0<=j);break}}}finally{ae=!1,Error.prepareStackTrace=s}return(e=e?e.displayName||e.name:"")?U(e):""}function De(e){switch(e.tag){case 5:return U(e.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return e=he(e.type,!1),e;case 11:return e=he(e.type.render,!1),e;case 1:return e=he(e.type,!0),e;default:return""}}function Pe(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case V:return"Fragment";case P:return"Portal";case C:return"Profiler";case te:return"StrictMode";case fe:return"Suspense";case me:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case ue:return(e.displayName||"Context")+".Consumer";case re:return(e._context.displayName||"Context")+".Provider";case Ee:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case pe:return t=e.displayName||null,t!==null?t:Pe(e.type)||"Memo";case $e:t=e._payload,e=e._init;try{return Pe(e(t))}catch{}}return null}function Ve(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Pe(t);case 8:return t===te?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Ae(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function He(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function kt(e){var t=He(e)?"checked":"value",s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),c=""+e[t];if(!e.hasOwnProperty(t)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var f=s.get,m=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return f.call(this)},set:function(b){c=""+b,m.call(this,b)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return c},setValue:function(b){c=""+b},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function an(e){e._valueTracker||(e._valueTracker=kt(e))}function ra(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var s=t.getValue(),c="";return e&&(c=He(e)?e.checked?"true":"false":e.value),e=c,e!==s?(t.setValue(e),!0):!1}function so(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function is(e,t){var s=t.checked;return M({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??e._wrapperState.initialChecked})}function ls(e,t){var s=t.defaultValue==null?"":t.defaultValue,c=t.checked!=null?t.checked:t.defaultChecked;s=Ae(t.value!=null?t.value:s),e._wrapperState={initialChecked:c,initialValue:s,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function cs(e,t){t=t.checked,t!=null&&H(e,"checked",t,!1)}function Jt(e,t){cs(e,t);var s=Ae(t.value),c=t.type;if(s!=null)c==="number"?(s===0&&e.value===""||e.value!=s)&&(e.value=""+s):e.value!==""+s&&(e.value=""+s);else if(c==="submit"||c==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Cn(e,t.type,s):t.hasOwnProperty("defaultValue")&&Cn(e,t.type,Ae(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function us(e,t,s){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var c=t.type;if(!(c!=="submit"&&c!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,s||t===e.value||(e.value=t),e.defaultValue=t}s=e.name,s!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,s!==""&&(e.name=s)}function Cn(e,t,s){(t!=="number"||so(e.ownerDocument)!==e)&&(s==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+s&&(e.defaultValue=""+s))}var Rr=Array.isArray;function Et(e,t,s,c){if(e=e.options,t){t={};for(var f=0;f<s.length;f++)t["$"+s[f]]=!0;for(s=0;s<e.length;s++)f=t.hasOwnProperty("$"+e[s].value),e[s].selected!==f&&(e[s].selected=f),f&&c&&(e[s].defaultSelected=!0)}else{for(s=""+Ae(s),t=null,f=0;f<e.length;f++){if(e[f].value===s){e[f].selected=!0,c&&(e[f].defaultSelected=!0);return}t!==null||e[f].disabled||(t=e[f])}t!==null&&(t.selected=!0)}}function ln(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(r(91));return M({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Nt(e,t){var s=t.value;if(s==null){if(s=t.children,t=t.defaultValue,s!=null){if(t!=null)throw Error(r(92));if(Rr(s)){if(1<s.length)throw Error(r(93));s=s[0]}t=s}t==null&&(t=""),s=t}e._wrapperState={initialValue:Ae(s)}}function yr(e,t){var s=Ae(t.value),c=Ae(t.defaultValue);s!=null&&(s=""+s,s!==e.value&&(e.value=s),t.defaultValue==null&&e.defaultValue!==s&&(e.defaultValue=s)),c!=null&&(e.defaultValue=""+c)}function ds(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function hs(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Qt(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?hs(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var cn,oi=(function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,s,c,f){MSApp.execUnsafeLocalFunction(function(){return e(t,s,c,f)})}:e})(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(cn=cn||document.createElement("div"),cn.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=cn.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Rn(e,t){if(t){var s=e.firstChild;if(s&&s===e.lastChild&&s.nodeType===3){s.nodeValue=t;return}}e.textContent=t}var On={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ai=["Webkit","ms","Moz","O"];Object.keys(On).forEach(function(e){ai.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),On[t]=On[e]})});function fs(e,t,s){return t==null||typeof t=="boolean"||t===""?"":s||typeof t!="number"||t===0||On.hasOwnProperty(e)&&On[e]?(""+t).trim():t+"px"}function ms(e,t){e=e.style;for(var s in t)if(t.hasOwnProperty(s)){var c=s.indexOf("--")===0,f=fs(s,t[s],c);s==="float"&&(s="cssFloat"),c?e.setProperty(s,f):e[s]=f}}var qr=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function In(e,t){if(t){if(qr[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(r(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(r(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(r(61))}if(t.style!=null&&typeof t.style!="object")throw Error(r(62))}}function jt(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Yt=null;function Oe(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var cr=null,zt=null,xr=null;function Ke(e){if(e=Ia(e)){if(typeof cr!="function")throw Error(r(280));var t=e.stateNode;t&&(t=Di(t),cr(e.stateNode,e.type,t))}}function ur(e){zt?xr?xr.push(e):xr=[e]:zt=e}function na(){if(zt){var e=zt,t=xr;if(xr=zt=null,Ke(e),t)for(e=0;e<t.length;e++)Ke(t[e])}}function br(e,t){return e(t)}function st(){}var wr=!1;function gs(e,t,s){if(wr)return e(t,s);wr=!0;try{return br(e,t,s)}finally{wr=!1,(zt!==null||xr!==null)&&(st(),na())}}function Pn(e,t){var s=e.stateNode;if(s===null)return null;var c=Di(s);if(c===null)return null;s=c[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(e=e.type,c=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!c;break e;default:e=!1}if(e)return null;if(s&&typeof s!="function")throw Error(r(231,t,typeof s));return s}var oo=!1;if(p)try{var ps={};Object.defineProperty(ps,"passive",{get:function(){oo=!0}}),window.addEventListener("test",ps,ps),window.removeEventListener("test",ps,ps)}catch{oo=!1}function nd(e,t,s,c,f,m,b,j,O){var K=Array.prototype.slice.call(arguments,3);try{t.apply(s,K)}catch(se){this.onError(se)}}var Kr=!1,sa=null,ao=!1,ke=null,Or={onError:function(e){Kr=!0,sa=e}};function Ye(e,t,s,c,f,m,b,j,O){Kr=!1,sa=null,nd.apply(Or,arguments)}function Tt(e,t,s,c,f,m,b,j,O){if(Ye.apply(this,arguments),Kr){if(Kr){var K=sa;Kr=!1,sa=null}else throw Error(r(198));ao||(ao=!0,ke=K)}}function Xt(e){var t=e,s=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(s=t.return),e=t.return;while(e)}return t.tag===3?s:null}function Ot(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function ii(e){if(Xt(e)!==e)throw Error(r(188))}function io(e){var t=e.alternate;if(!t){if(t=Xt(e),t===null)throw Error(r(188));return t!==e?null:e}for(var s=e,c=t;;){var f=s.return;if(f===null)break;var m=f.alternate;if(m===null){if(c=f.return,c!==null){s=c;continue}break}if(f.child===m.child){for(m=f.child;m;){if(m===s)return ii(f),e;if(m===c)return ii(f),t;m=m.sibling}throw Error(r(188))}if(s.return!==c.return)s=f,c=m;else{for(var b=!1,j=f.child;j;){if(j===s){b=!0,s=f,c=m;break}if(j===c){b=!0,c=f,s=m;break}j=j.sibling}if(!b){for(j=m.child;j;){if(j===s){b=!0,s=m,c=f;break}if(j===c){b=!0,c=m,s=f;break}j=j.sibling}if(!b)throw Error(r(189))}}if(s.alternate!==c)throw Error(r(190))}if(s.tag!==3)throw Error(r(188));return s.stateNode.current===s?e:t}function Al(e){return e=io(e),e!==null?$l(e):null}function $l(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=$l(e);if(t!==null)return t;e=e.sibling}return null}var Ml=n.unstable_scheduleCallback,Gr=n.unstable_cancelCallback,li=n.unstable_shouldYield,Ir=n.unstable_requestPaint,Be=n.unstable_now,Ul=n.unstable_getCurrentPriorityLevel,oa=n.unstable_ImmediatePriority,vs=n.unstable_UserBlockingPriority,Sr=n.unstable_NormalPriority,lo=n.unstable_LowPriority,aa=n.unstable_IdlePriority,ys=null,_r=null;function ia(e){if(_r&&typeof _r.onCommitFiberRoot=="function")try{_r.onCommitFiberRoot(ys,e,void 0,(e.current.flags&128)===128)}catch{}}var dr=Math.clz32?Math.clz32:la,ci=Math.log,co=Math.LN2;function la(e){return e>>>=0,e===0?32:31-(ci(e)/co|0)|0}var xs=64,bs=4194304;function uo(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Dn(e,t){var s=e.pendingLanes;if(s===0)return 0;var c=0,f=e.suspendedLanes,m=e.pingedLanes,b=s&268435455;if(b!==0){var j=b&~f;j!==0?c=uo(j):(m&=b,m!==0&&(c=uo(m)))}else b=s&~f,b!==0?c=uo(b):m!==0&&(c=uo(m));if(c===0)return 0;if(t!==0&&t!==c&&(t&f)===0&&(f=c&-c,m=t&-t,f>=m||f===16&&(m&4194240)!==0))return t;if((c&4)!==0&&(c|=s&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=c;0<t;)s=31-dr(t),f=1<<s,c|=e[s],t&=~f;return c}function Fl(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ho(e,t){for(var s=e.suspendedLanes,c=e.pingedLanes,f=e.expirationTimes,m=e.pendingLanes;0<m;){var b=31-dr(m),j=1<<b,O=f[b];O===-1?((j&s)===0||(j&c)!==0)&&(f[b]=Fl(j,t)):O<=t&&(e.expiredLanes|=j),m&=~j}}function Wt(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function ca(){var e=xs;return xs<<=1,(xs&4194240)===0&&(xs=64),e}function Pr(e){for(var t=[],s=0;31>s;s++)t.push(e);return t}function ws(e,t,s){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-dr(t),e[t]=s}function ua(e,t){var s=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var c=e.eventTimes;for(e=e.expirationTimes;0<s;){var f=31-dr(s),m=1<<f;t[f]=0,c[f]=-1,e[f]=-1,s&=~m}}function da(e,t){var s=e.entangledLanes|=t;for(e=e.entanglements;s;){var c=31-dr(s),f=1<<c;f&t|e[c]&t&&(e[c]|=t),s&=~f}}var ve=0;function It(e){return e&=-e,1<e?4<e?(e&268435455)!==0?16:536870912:4:1}var Ss,_s,Ue,ui,ks,ha=!1,Pt=[],Dr=null,Lr=null,Dt=null,Lt=new Map,Ln=new Map,Ht=[],di="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function An(e,t){switch(e){case"focusin":case"focusout":Dr=null;break;case"dragenter":case"dragleave":Lr=null;break;case"mouseover":case"mouseout":Dt=null;break;case"pointerover":case"pointerout":Lt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ln.delete(t.pointerId)}}function Es(e,t,s,c,f,m){return e===null||e.nativeEvent!==m?(e={blockedOn:t,domEventName:s,eventSystemFlags:c,nativeEvent:m,targetContainers:[f]},t!==null&&(t=Ia(t),t!==null&&_s(t)),e):(e.eventSystemFlags|=c,t=e.targetContainers,f!==null&&t.indexOf(f)===-1&&t.push(f),e)}function hi(e,t,s,c,f){switch(t){case"focusin":return Dr=Es(Dr,e,t,s,c,f),!0;case"dragenter":return Lr=Es(Lr,e,t,s,c,f),!0;case"mouseover":return Dt=Es(Dt,e,t,s,c,f),!0;case"pointerover":var m=f.pointerId;return Lt.set(m,Es(Lt.get(m)||null,e,t,s,c,f)),!0;case"gotpointercapture":return m=f.pointerId,Ln.set(m,Es(Ln.get(m)||null,e,t,s,c,f)),!0}return!1}function un(e){var t=Ms(e.target);if(t!==null){var s=Xt(t);if(s!==null){if(t=s.tag,t===13){if(t=Ot(s),t!==null){e.blockedOn=t,ks(e.priority,function(){Ue(s)});return}}else if(t===3&&s.stateNode.current.memoizedState.isDehydrated){e.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}e.blockedOn=null}function hr(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var s=Jr(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(s===null){s=e.nativeEvent;var c=new s.constructor(s.type,s);Yt=c,s.target.dispatchEvent(c),Yt=null}else return t=Ia(s),t!==null&&_s(t),e.blockedOn=s,!1;t.shift()}return!0}function Ns(e,t,s){hr(e)&&s.delete(t)}function Vl(){ha=!1,Dr!==null&&hr(Dr)&&(Dr=null),Lr!==null&&hr(Lr)&&(Lr=null),Dt!==null&&hr(Dt)&&(Dt=null),Lt.forEach(Ns),Ln.forEach(Ns)}function Zt(e,t){e.blockedOn===t&&(e.blockedOn=null,ha||(ha=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,Vl)))}function dn(e){function t(f){return Zt(f,e)}if(0<Pt.length){Zt(Pt[0],e);for(var s=1;s<Pt.length;s++){var c=Pt[s];c.blockedOn===e&&(c.blockedOn=null)}}for(Dr!==null&&Zt(Dr,e),Lr!==null&&Zt(Lr,e),Dt!==null&&Zt(Dt,e),Lt.forEach(t),Ln.forEach(t),s=0;s<Ht.length;s++)c=Ht[s],c.blockedOn===e&&(c.blockedOn=null);for(;0<Ht.length&&(s=Ht[0],s.blockedOn===null);)un(s),s.blockedOn===null&&Ht.shift()}var Ar=q.ReactCurrentBatchConfig,fo=!0;function Bl(e,t,s,c){var f=ve,m=Ar.transition;Ar.transition=null;try{ve=1,$n(e,t,s,c)}finally{ve=f,Ar.transition=m}}function fi(e,t,s,c){var f=ve,m=Ar.transition;Ar.transition=null;try{ve=4,$n(e,t,s,c)}finally{ve=f,Ar.transition=m}}function $n(e,t,s,c){if(fo){var f=Jr(e,t,s,c);if(f===null)Ca(e,t,c,$r,s),An(e,c);else if(hi(f,e,t,s,c))c.stopPropagation();else if(An(e,c),t&4&&-1<di.indexOf(e)){for(;f!==null;){var m=Ia(f);if(m!==null&&Ss(m),m=Jr(e,t,s,c),m===null&&Ca(e,t,c,$r,s),m===f)break;f=m}f!==null&&c.stopPropagation()}else Ca(e,t,c,null,s)}}var $r=null;function Jr(e,t,s,c){if($r=null,e=Oe(c),e=Ms(e),e!==null)if(t=Xt(e),t===null)e=null;else if(s=t.tag,s===13){if(e=Ot(t),e!==null)return e;e=null}else if(s===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return $r=e,null}function js(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ul()){case oa:return 1;case vs:return 4;case Sr:case lo:return 16;case aa:return 536870912;default:return 16}default:return 16}}var Qr=null,Mn=null,mo=null;function Ts(){if(mo)return mo;var e,t=Mn,s=t.length,c,f="value"in Qr?Qr.value:Qr.textContent,m=f.length;for(e=0;e<s&&t[e]===f[e];e++);var b=s-e;for(c=1;c<=b&&t[s-c]===f[m-c];c++);return mo=f.slice(e,1<c?1-c:void 0)}function Mr(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Qe(){return!0}function At(){return!1}function xt(e){function t(s,c,f,m,b){this._reactName=s,this._targetInst=f,this.type=c,this.nativeEvent=m,this.target=b,this.currentTarget=null;for(var j in e)e.hasOwnProperty(j)&&(s=e[j],this[j]=s?s(m):m[j]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?Qe:At,this.isPropagationStopped=At,this}return M(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=Qe)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=Qe)},persist:function(){},isPersistent:Qe}),t}var hn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ht=xt(hn),Cs=M({},hn,{view:0,detail:0}),fa=xt(Cs),Rs,ma,Un,go=M({},Cs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:$t,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Un&&(Un&&e.type==="mousemove"?(Rs=e.screenX-Un.screenX,ma=e.screenY-Un.screenY):ma=Rs=0,Un=e),Rs)},movementY:function(e){return"movementY"in e?e.movementY:ma}}),mi=xt(go),po=M({},go,{dataTransfer:0}),zl=xt(po),Wl=M({},Cs,{relatedTarget:0}),ga=xt(Wl),Hl=M({},hn,{animationName:0,elapsedTime:0,pseudoElement:0}),vo=xt(Hl),pa=M({},hn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),va=xt(pa),ql=M({},hn,{data:0}),gi=xt(ql),qe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ft={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function yo(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=pi[e])?!!t[e]:!1}function $t(){return yo}var vi=M({},Cs,{key:function(e){if(e.key){var t=qe[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Mr(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?ft[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:$t,charCode:function(e){return e.type==="keypress"?Mr(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Mr(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),yi=xt(vi),Je=M({},go,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),xi=xt(Je),Kl=M({},Cs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:$t}),Gl=xt(Kl),bi=M({},hn,{propertyName:0,elapsedTime:0,pseudoElement:0}),wi=xt(bi),Jl=M({},go,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Fn=xt(Jl),Ql=[9,13,27,32],ya=p&&"CompositionEvent"in window,Os=null;p&&"documentMode"in document&&(Os=document.documentMode);var fn=p&&"TextEvent"in window&&!Os,Si=p&&(!ya||Os&&8<Os&&11>=Os),_i=" ",xa=!1;function xo(e,t){switch(e){case"keyup":return Ql.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ba(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Vn=!1;function Yl(e,t){switch(e){case"compositionend":return ba(t);case"keypress":return t.which!==32?null:(xa=!0,_i);case"textInput":return e=t.data,e===_i&&xa?null:e;default:return null}}function Is(e,t){if(Vn)return e==="compositionend"||!ya&&xo(e,t)?(e=Ts(),mo=Mn=Qr=null,Vn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Si&&t.locale!=="ko"?null:t.data;default:return null}}var Xl={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ki(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Xl[e.type]:t==="textarea"}function Ei(e,t,s,c){ur(c),t=Oi(t,"onChange"),0<t.length&&(s=new ht("onChange","change",null,s,c),e.push({event:s,listeners:t}))}var Ps=null,Yr=null;function Ni(e){Ci(e,0)}function Ds(e){var t=_o(e);if(ra(t))return e}function Zl(e,t){if(e==="change")return t}var fr=!1;if(p){var wa;if(p){var Sa="oninput"in document;if(!Sa){var _a=document.createElement("div");_a.setAttribute("oninput","return;"),Sa=typeof _a.oninput=="function"}wa=Sa}else wa=!1;fr=wa&&(!document.documentMode||9<document.documentMode)}function bo(){Ps&&(Ps.detachEvent("onpropertychange",ji),Yr=Ps=null)}function ji(e){if(e.propertyName==="value"&&Ds(Yr)){var t=[];Ei(t,Yr,e,Oe(e)),gs(Ni,t)}}function ec(e,t,s){e==="focusin"?(bo(),Ps=t,Yr=s,Ps.attachEvent("onpropertychange",ji)):e==="focusout"&&bo()}function tc(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Ds(Yr)}function rc(e,t){if(e==="click")return Ds(t)}function nc(e,t){if(e==="input"||e==="change")return Ds(t)}function sc(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var er=typeof Object.is=="function"?Object.is:sc;function Ls(e,t){if(er(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var s=Object.keys(e),c=Object.keys(t);if(s.length!==c.length)return!1;for(c=0;c<s.length;c++){var f=s[c];if(!y.call(t,f)||!er(e[f],t[f]))return!1}return!0}function tt(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ka(e,t){var s=tt(e);e=0;for(var c;s;){if(s.nodeType===3){if(c=e+s.textContent.length,e<=t&&c>=t)return{node:s,offset:t-e};e=c}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=tt(s)}}function Bn(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Bn(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Ti(){for(var e=window,t=so();t instanceof e.HTMLIFrameElement;){try{var s=typeof t.contentWindow.location.href=="string"}catch{s=!1}if(s)e=t.contentWindow;else break;t=so(e.document)}return t}function Ea(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function oc(e){var t=Ti(),s=e.focusedElem,c=e.selectionRange;if(t!==s&&s&&s.ownerDocument&&Bn(s.ownerDocument.documentElement,s)){if(c!==null&&Ea(s)){if(t=c.start,e=c.end,e===void 0&&(e=t),"selectionStart"in s)s.selectionStart=t,s.selectionEnd=Math.min(e,s.value.length);else if(e=(t=s.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var f=s.textContent.length,m=Math.min(c.start,f);c=c.end===void 0?m:Math.min(c.end,f),!e.extend&&m>c&&(f=c,c=m,m=f),f=ka(s,m);var b=ka(s,c);f&&b&&(e.rangeCount!==1||e.anchorNode!==f.node||e.anchorOffset!==f.offset||e.focusNode!==b.node||e.focusOffset!==b.offset)&&(t=t.createRange(),t.setStart(f.node,f.offset),e.removeAllRanges(),m>c?(e.addRange(t),e.extend(b.node,b.offset)):(t.setEnd(b.node,b.offset),e.addRange(t)))}}for(t=[],e=s;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<t.length;s++)e=t[s],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var ac=p&&"documentMode"in document&&11>=document.documentMode,mn=null,Na=null,gn=null,tr=!1;function l(e,t,s){var c=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;tr||mn==null||mn!==so(c)||(c=mn,"selectionStart"in c&&Ea(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),gn&&Ls(gn,c)||(gn=c,c=Oi(Na,"onSelect"),0<c.length&&(t=new ht("onSelect","select",null,t,s),e.push({event:t,listeners:c}),t.target=mn)))}function g(e,t){var s={};return s[e.toLowerCase()]=t.toLowerCase(),s["Webkit"+e]="webkit"+t,s["Moz"+e]="moz"+t,s}var v={animationend:g("Animation","AnimationEnd"),animationiteration:g("Animation","AnimationIteration"),animationstart:g("Animation","AnimationStart"),transitionend:g("Transition","TransitionEnd")},w={},E={};p&&(E=document.createElement("div").style,"AnimationEvent"in window||(delete v.animationend.animation,delete v.animationiteration.animation,delete v.animationstart.animation),"TransitionEvent"in window||delete v.transitionend.transition);function T(e){if(w[e])return w[e];if(!v[e])return e;var t=v[e],s;for(s in t)if(t.hasOwnProperty(s)&&s in E)return w[e]=t[s];return e}var D=T("animationend"),G=T("animationiteration"),Q=T("animationstart"),de=T("transitionend"),ye=new Map,ie="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ge(e,t){ye.set(e,t),h(t,[e])}for(var Te=0;Te<ie.length;Te++){var Ge=ie[Te],rt=Ge.toLowerCase(),rr=Ge[0].toUpperCase()+Ge.slice(1);ge(rt,"on"+rr)}ge(D,"onAnimationEnd"),ge(G,"onAnimationIteration"),ge(Q,"onAnimationStart"),ge("dblclick","onDoubleClick"),ge("focusin","onFocus"),ge("focusout","onBlur"),ge(de,"onTransitionEnd"),d("onMouseEnter",["mouseout","mouseover"]),d("onMouseLeave",["mouseout","mouseover"]),d("onPointerEnter",["pointerout","pointerover"]),d("onPointerLeave",["pointerout","pointerover"]),h("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),h("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),h("onBeforeInput",["compositionend","keypress","textInput","paste"]),h("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),h("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),h("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Mt="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ja=new Set("cancel close invalid load scroll toggle".split(" ").concat(Mt));function As(e,t,s){var c=e.type||"unknown-event";e.currentTarget=s,Tt(c,t,void 0,e),e.currentTarget=null}function Ci(e,t){t=(t&4)!==0;for(var s=0;s<e.length;s++){var c=e[s],f=c.event;c=c.listeners;e:{var m=void 0;if(t)for(var b=c.length-1;0<=b;b--){var j=c[b],O=j.instance,K=j.currentTarget;if(j=j.listener,O!==m&&f.isPropagationStopped())break e;As(f,j,K),m=O}else for(b=0;b<c.length;b++){if(j=c[b],O=j.instance,K=j.currentTarget,j=j.listener,O!==m&&f.isPropagationStopped())break e;As(f,j,K),m=O}}}if(ao)throw e=ke,ao=!1,ke=null,e}function Xe(e,t){var s=t[hc];s===void 0&&(s=t[hc]=new Set);var c=e+"__bubble";s.has(c)||(Ri(t,e,2,!1),s.add(c))}function Ta(e,t,s){var c=0;t&&(c|=4),Ri(s,e,c,t)}var zn="_reactListening"+Math.random().toString(36).slice(2);function $s(e){if(!e[zn]){e[zn]=!0,a.forEach(function(s){s!=="selectionchange"&&(ja.has(s)||Ta(s,!1,e),Ta(s,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[zn]||(t[zn]=!0,Ta("selectionchange",!1,t))}}function Ri(e,t,s,c){switch(js(t)){case 1:var f=Bl;break;case 4:f=fi;break;default:f=$n}s=f.bind(null,t,s,e),f=void 0,!oo||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(f=!0),c?f!==void 0?e.addEventListener(t,s,{capture:!0,passive:f}):e.addEventListener(t,s,!0):f!==void 0?e.addEventListener(t,s,{passive:f}):e.addEventListener(t,s,!1)}function Ca(e,t,s,c,f){var m=c;if((t&1)===0&&(t&2)===0&&c!==null)e:for(;;){if(c===null)return;var b=c.tag;if(b===3||b===4){var j=c.stateNode.containerInfo;if(j===f||j.nodeType===8&&j.parentNode===f)break;if(b===4)for(b=c.return;b!==null;){var O=b.tag;if((O===3||O===4)&&(O=b.stateNode.containerInfo,O===f||O.nodeType===8&&O.parentNode===f))return;b=b.return}for(;j!==null;){if(b=Ms(j),b===null)return;if(O=b.tag,O===5||O===6){c=m=b;continue e}j=j.parentNode}}c=c.return}gs(function(){var K=m,se=Oe(s),le=[];e:{var ne=ye.get(e);if(ne!==void 0){var xe=ht,Se=e;switch(e){case"keypress":if(Mr(s)===0)break e;case"keydown":case"keyup":xe=yi;break;case"focusin":Se="focus",xe=ga;break;case"focusout":Se="blur",xe=ga;break;case"beforeblur":case"afterblur":xe=ga;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":xe=mi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":xe=zl;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":xe=Gl;break;case D:case G:case Q:xe=vo;break;case de:xe=wi;break;case"scroll":xe=fa;break;case"wheel":xe=Fn;break;case"copy":case"cut":case"paste":xe=va;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":xe=xi}var _e=(t&4)!==0,ut=!_e&&e==="scroll",z=_e?ne!==null?ne+"Capture":null:ne;_e=[];for(var A=K,W;A!==null;){W=A;var ce=W.stateNode;if(W.tag===5&&ce!==null&&(W=ce,z!==null&&(ce=Pn(A,z),ce!=null&&_e.push(Ra(A,ce,W)))),ut)break;A=A.return}0<_e.length&&(ne=new xe(ne,Se,null,s,se),le.push({event:ne,listeners:_e}))}}if((t&7)===0){e:{if(ne=e==="mouseover"||e==="pointerover",xe=e==="mouseout"||e==="pointerout",ne&&s!==Yt&&(Se=s.relatedTarget||s.fromElement)&&(Ms(Se)||Se[pn]))break e;if((xe||ne)&&(ne=se.window===se?se:(ne=se.ownerDocument)?ne.defaultView||ne.parentWindow:window,xe?(Se=s.relatedTarget||s.toElement,xe=K,Se=Se?Ms(Se):null,Se!==null&&(ut=Xt(Se),Se!==ut||Se.tag!==5&&Se.tag!==6)&&(Se=null)):(xe=null,Se=K),xe!==Se)){if(_e=mi,ce="onMouseLeave",z="onMouseEnter",A="mouse",(e==="pointerout"||e==="pointerover")&&(_e=xi,ce="onPointerLeave",z="onPointerEnter",A="pointer"),ut=xe==null?ne:_o(xe),W=Se==null?ne:_o(Se),ne=new _e(ce,A+"leave",xe,s,se),ne.target=ut,ne.relatedTarget=W,ce=null,Ms(se)===K&&(_e=new _e(z,A+"enter",Se,s,se),_e.target=W,_e.relatedTarget=ut,ce=_e),ut=ce,xe&&Se)t:{for(_e=xe,z=Se,A=0,W=_e;W;W=wo(W))A++;for(W=0,ce=z;ce;ce=wo(ce))W++;for(;0<A-W;)_e=wo(_e),A--;for(;0<W-A;)z=wo(z),W--;for(;A--;){if(_e===z||z!==null&&_e===z.alternate)break t;_e=wo(_e),z=wo(z)}_e=null}else _e=null;xe!==null&&sd(le,ne,xe,_e,!1),Se!==null&&ut!==null&&sd(le,ut,Se,_e,!0)}}e:{if(ne=K?_o(K):window,xe=ne.nodeName&&ne.nodeName.toLowerCase(),xe==="select"||xe==="input"&&ne.type==="file")var Ne=Zl;else if(ki(ne))if(fr)Ne=nc;else{Ne=tc;var Ce=ec}else(xe=ne.nodeName)&&xe.toLowerCase()==="input"&&(ne.type==="checkbox"||ne.type==="radio")&&(Ne=rc);if(Ne&&(Ne=Ne(e,K))){Ei(le,Ne,s,se);break e}Ce&&Ce(e,ne,K),e==="focusout"&&(Ce=ne._wrapperState)&&Ce.controlled&&ne.type==="number"&&Cn(ne,"number",ne.value)}switch(Ce=K?_o(K):window,e){case"focusin":(ki(Ce)||Ce.contentEditable==="true")&&(mn=Ce,Na=K,gn=null);break;case"focusout":gn=Na=mn=null;break;case"mousedown":tr=!0;break;case"contextmenu":case"mouseup":case"dragend":tr=!1,l(le,s,se);break;case"selectionchange":if(ac)break;case"keydown":case"keyup":l(le,s,se)}var Re;if(ya)e:{switch(e){case"compositionstart":var Ie="onCompositionStart";break e;case"compositionend":Ie="onCompositionEnd";break e;case"compositionupdate":Ie="onCompositionUpdate";break e}Ie=void 0}else Vn?xo(e,s)&&(Ie="onCompositionEnd"):e==="keydown"&&s.keyCode===229&&(Ie="onCompositionStart");Ie&&(Si&&s.locale!=="ko"&&(Vn||Ie!=="onCompositionStart"?Ie==="onCompositionEnd"&&Vn&&(Re=Ts()):(Qr=se,Mn="value"in Qr?Qr.value:Qr.textContent,Vn=!0)),Ce=Oi(K,Ie),0<Ce.length&&(Ie=new gi(Ie,e,null,s,se),le.push({event:Ie,listeners:Ce}),Re?Ie.data=Re:(Re=ba(s),Re!==null&&(Ie.data=Re)))),(Re=fn?Yl(e,s):Is(e,s))&&(K=Oi(K,"onBeforeInput"),0<K.length&&(se=new gi("onBeforeInput","beforeinput",null,s,se),le.push({event:se,listeners:K}),se.data=Re))}Ci(le,t)})}function Ra(e,t,s){return{instance:e,listener:t,currentTarget:s}}function Oi(e,t){for(var s=t+"Capture",c=[];e!==null;){var f=e,m=f.stateNode;f.tag===5&&m!==null&&(f=m,m=Pn(e,s),m!=null&&c.unshift(Ra(e,m,f)),m=Pn(e,t),m!=null&&c.push(Ra(e,m,f))),e=e.return}return c}function wo(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function sd(e,t,s,c,f){for(var m=t._reactName,b=[];s!==null&&s!==c;){var j=s,O=j.alternate,K=j.stateNode;if(O!==null&&O===c)break;j.tag===5&&K!==null&&(j=K,f?(O=Pn(s,m),O!=null&&b.unshift(Ra(s,O,j))):f||(O=Pn(s,m),O!=null&&b.push(Ra(s,O,j)))),s=s.return}b.length!==0&&e.push({event:t,listeners:b})}var dm=/\r\n?/g,hm=/\u0000|\uFFFD/g;function od(e){return(typeof e=="string"?e:""+e).replace(dm,`
`).replace(hm,"")}function Ii(e,t,s){if(t=od(t),od(e)!==t&&s)throw Error(r(425))}function Pi(){}var ic=null,lc=null;function cc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var uc=typeof setTimeout=="function"?setTimeout:void 0,fm=typeof clearTimeout=="function"?clearTimeout:void 0,ad=typeof Promise=="function"?Promise:void 0,mm=typeof queueMicrotask=="function"?queueMicrotask:typeof ad<"u"?function(e){return ad.resolve(null).then(e).catch(gm)}:uc;function gm(e){setTimeout(function(){throw e})}function dc(e,t){var s=t,c=0;do{var f=s.nextSibling;if(e.removeChild(s),f&&f.nodeType===8)if(s=f.data,s==="/$"){if(c===0){e.removeChild(f),dn(t);return}c--}else s!=="$"&&s!=="$?"&&s!=="$!"||c++;s=f}while(s);dn(t)}function Wn(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function id(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="$"||s==="$!"||s==="$?"){if(t===0)return e;t--}else s==="/$"&&t++}e=e.previousSibling}return null}var So=Math.random().toString(36).slice(2),Xr="__reactFiber$"+So,Oa="__reactProps$"+So,pn="__reactContainer$"+So,hc="__reactEvents$"+So,pm="__reactListeners$"+So,vm="__reactHandles$"+So;function Ms(e){var t=e[Xr];if(t)return t;for(var s=e.parentNode;s;){if(t=s[pn]||s[Xr]){if(s=t.alternate,t.child!==null||s!==null&&s.child!==null)for(e=id(e);e!==null;){if(s=e[Xr])return s;e=id(e)}return t}e=s,s=e.parentNode}return null}function Ia(e){return e=e[Xr]||e[pn],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function _o(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(r(33))}function Di(e){return e[Oa]||null}var fc=[],ko=-1;function Hn(e){return{current:e}}function nt(e){0>ko||(e.current=fc[ko],fc[ko]=null,ko--)}function Ze(e,t){ko++,fc[ko]=e.current,e.current=t}var qn={},Ut=Hn(qn),nr=Hn(!1),Us=qn;function Eo(e,t){var s=e.type.contextTypes;if(!s)return qn;var c=e.stateNode;if(c&&c.__reactInternalMemoizedUnmaskedChildContext===t)return c.__reactInternalMemoizedMaskedChildContext;var f={},m;for(m in s)f[m]=t[m];return c&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=f),f}function sr(e){return e=e.childContextTypes,e!=null}function Li(){nt(nr),nt(Ut)}function ld(e,t,s){if(Ut.current!==qn)throw Error(r(168));Ze(Ut,t),Ze(nr,s)}function cd(e,t,s){var c=e.stateNode;if(t=t.childContextTypes,typeof c.getChildContext!="function")return s;c=c.getChildContext();for(var f in c)if(!(f in t))throw Error(r(108,Ve(e)||"Unknown",f));return M({},s,c)}function Ai(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||qn,Us=Ut.current,Ze(Ut,e),Ze(nr,nr.current),!0}function ud(e,t,s){var c=e.stateNode;if(!c)throw Error(r(169));s?(e=cd(e,t,Us),c.__reactInternalMemoizedMergedChildContext=e,nt(nr),nt(Ut),Ze(Ut,e)):nt(nr),Ze(nr,s)}var vn=null,$i=!1,mc=!1;function dd(e){vn===null?vn=[e]:vn.push(e)}function ym(e){$i=!0,dd(e)}function Kn(){if(!mc&&vn!==null){mc=!0;var e=0,t=ve;try{var s=vn;for(ve=1;e<s.length;e++){var c=s[e];do c=c(!0);while(c!==null)}vn=null,$i=!1}catch(f){throw vn!==null&&(vn=vn.slice(e+1)),Ml(oa,Kn),f}finally{ve=t,mc=!1}}return null}var No=[],jo=0,Mi=null,Ui=0,kr=[],Er=0,Fs=null,yn=1,xn="";function Vs(e,t){No[jo++]=Ui,No[jo++]=Mi,Mi=e,Ui=t}function hd(e,t,s){kr[Er++]=yn,kr[Er++]=xn,kr[Er++]=Fs,Fs=e;var c=yn;e=xn;var f=32-dr(c)-1;c&=~(1<<f),s+=1;var m=32-dr(t)+f;if(30<m){var b=f-f%5;m=(c&(1<<b)-1).toString(32),c>>=b,f-=b,yn=1<<32-dr(t)+f|s<<f|c,xn=m+e}else yn=1<<m|s<<f|c,xn=e}function gc(e){e.return!==null&&(Vs(e,1),hd(e,1,0))}function pc(e){for(;e===Mi;)Mi=No[--jo],No[jo]=null,Ui=No[--jo],No[jo]=null;for(;e===Fs;)Fs=kr[--Er],kr[Er]=null,xn=kr[--Er],kr[Er]=null,yn=kr[--Er],kr[Er]=null}var mr=null,gr=null,ot=!1,Ur=null;function fd(e,t){var s=Cr(5,null,null,0);s.elementType="DELETED",s.stateNode=t,s.return=e,t=e.deletions,t===null?(e.deletions=[s],e.flags|=16):t.push(s)}function md(e,t){switch(e.tag){case 5:var s=e.type;return t=t.nodeType!==1||s.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,mr=e,gr=Wn(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,mr=e,gr=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(s=Fs!==null?{id:yn,overflow:xn}:null,e.memoizedState={dehydrated:t,treeContext:s,retryLane:1073741824},s=Cr(18,null,null,0),s.stateNode=t,s.return=e,e.child=s,mr=e,gr=null,!0):!1;default:return!1}}function vc(e){return(e.mode&1)!==0&&(e.flags&128)===0}function yc(e){if(ot){var t=gr;if(t){var s=t;if(!md(e,t)){if(vc(e))throw Error(r(418));t=Wn(s.nextSibling);var c=mr;t&&md(e,t)?fd(c,s):(e.flags=e.flags&-4097|2,ot=!1,mr=e)}}else{if(vc(e))throw Error(r(418));e.flags=e.flags&-4097|2,ot=!1,mr=e}}}function gd(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;mr=e}function Fi(e){if(e!==mr)return!1;if(!ot)return gd(e),ot=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!cc(e.type,e.memoizedProps)),t&&(t=gr)){if(vc(e))throw pd(),Error(r(418));for(;t;)fd(e,t),t=Wn(t.nextSibling)}if(gd(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(r(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="/$"){if(t===0){gr=Wn(e.nextSibling);break e}t--}else s!=="$"&&s!=="$!"&&s!=="$?"||t++}e=e.nextSibling}gr=null}}else gr=mr?Wn(e.stateNode.nextSibling):null;return!0}function pd(){for(var e=gr;e;)e=Wn(e.nextSibling)}function To(){gr=mr=null,ot=!1}function xc(e){Ur===null?Ur=[e]:Ur.push(e)}var xm=q.ReactCurrentBatchConfig;function Pa(e,t,s){if(e=s.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(r(309));var c=s.stateNode}if(!c)throw Error(r(147,e));var f=c,m=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===m?t.ref:(t=function(b){var j=f.refs;b===null?delete j[m]:j[m]=b},t._stringRef=m,t)}if(typeof e!="string")throw Error(r(284));if(!s._owner)throw Error(r(290,e))}return e}function Vi(e,t){throw e=Object.prototype.toString.call(t),Error(r(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function vd(e){var t=e._init;return t(e._payload)}function yd(e){function t(z,A){if(e){var W=z.deletions;W===null?(z.deletions=[A],z.flags|=16):W.push(A)}}function s(z,A){if(!e)return null;for(;A!==null;)t(z,A),A=A.sibling;return null}function c(z,A){for(z=new Map;A!==null;)A.key!==null?z.set(A.key,A):z.set(A.index,A),A=A.sibling;return z}function f(z,A){return z=ts(z,A),z.index=0,z.sibling=null,z}function m(z,A,W){return z.index=W,e?(W=z.alternate,W!==null?(W=W.index,W<A?(z.flags|=2,A):W):(z.flags|=2,A)):(z.flags|=1048576,A)}function b(z){return e&&z.alternate===null&&(z.flags|=2),z}function j(z,A,W,ce){return A===null||A.tag!==6?(A=uu(W,z.mode,ce),A.return=z,A):(A=f(A,W),A.return=z,A)}function O(z,A,W,ce){var Ne=W.type;return Ne===V?se(z,A,W.props.children,ce,W.key):A!==null&&(A.elementType===Ne||typeof Ne=="object"&&Ne!==null&&Ne.$$typeof===$e&&vd(Ne)===A.type)?(ce=f(A,W.props),ce.ref=Pa(z,A,W),ce.return=z,ce):(ce=dl(W.type,W.key,W.props,null,z.mode,ce),ce.ref=Pa(z,A,W),ce.return=z,ce)}function K(z,A,W,ce){return A===null||A.tag!==4||A.stateNode.containerInfo!==W.containerInfo||A.stateNode.implementation!==W.implementation?(A=du(W,z.mode,ce),A.return=z,A):(A=f(A,W.children||[]),A.return=z,A)}function se(z,A,W,ce,Ne){return A===null||A.tag!==7?(A=Js(W,z.mode,ce,Ne),A.return=z,A):(A=f(A,W),A.return=z,A)}function le(z,A,W){if(typeof A=="string"&&A!==""||typeof A=="number")return A=uu(""+A,z.mode,W),A.return=z,A;if(typeof A=="object"&&A!==null){switch(A.$$typeof){case J:return W=dl(A.type,A.key,A.props,null,z.mode,W),W.ref=Pa(z,null,A),W.return=z,W;case P:return A=du(A,z.mode,W),A.return=z,A;case $e:var ce=A._init;return le(z,ce(A._payload),W)}if(Rr(A)||$(A))return A=Js(A,z.mode,W,null),A.return=z,A;Vi(z,A)}return null}function ne(z,A,W,ce){var Ne=A!==null?A.key:null;if(typeof W=="string"&&W!==""||typeof W=="number")return Ne!==null?null:j(z,A,""+W,ce);if(typeof W=="object"&&W!==null){switch(W.$$typeof){case J:return W.key===Ne?O(z,A,W,ce):null;case P:return W.key===Ne?K(z,A,W,ce):null;case $e:return Ne=W._init,ne(z,A,Ne(W._payload),ce)}if(Rr(W)||$(W))return Ne!==null?null:se(z,A,W,ce,null);Vi(z,W)}return null}function xe(z,A,W,ce,Ne){if(typeof ce=="string"&&ce!==""||typeof ce=="number")return z=z.get(W)||null,j(A,z,""+ce,Ne);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case J:return z=z.get(ce.key===null?W:ce.key)||null,O(A,z,ce,Ne);case P:return z=z.get(ce.key===null?W:ce.key)||null,K(A,z,ce,Ne);case $e:var Ce=ce._init;return xe(z,A,W,Ce(ce._payload),Ne)}if(Rr(ce)||$(ce))return z=z.get(W)||null,se(A,z,ce,Ne,null);Vi(A,ce)}return null}function Se(z,A,W,ce){for(var Ne=null,Ce=null,Re=A,Ie=A=0,St=null;Re!==null&&Ie<W.length;Ie++){Re.index>Ie?(St=Re,Re=null):St=Re.sibling;var We=ne(z,Re,W[Ie],ce);if(We===null){Re===null&&(Re=St);break}e&&Re&&We.alternate===null&&t(z,Re),A=m(We,A,Ie),Ce===null?Ne=We:Ce.sibling=We,Ce=We,Re=St}if(Ie===W.length)return s(z,Re),ot&&Vs(z,Ie),Ne;if(Re===null){for(;Ie<W.length;Ie++)Re=le(z,W[Ie],ce),Re!==null&&(A=m(Re,A,Ie),Ce===null?Ne=Re:Ce.sibling=Re,Ce=Re);return ot&&Vs(z,Ie),Ne}for(Re=c(z,Re);Ie<W.length;Ie++)St=xe(Re,z,Ie,W[Ie],ce),St!==null&&(e&&St.alternate!==null&&Re.delete(St.key===null?Ie:St.key),A=m(St,A,Ie),Ce===null?Ne=St:Ce.sibling=St,Ce=St);return e&&Re.forEach(function(rs){return t(z,rs)}),ot&&Vs(z,Ie),Ne}function _e(z,A,W,ce){var Ne=$(W);if(typeof Ne!="function")throw Error(r(150));if(W=Ne.call(W),W==null)throw Error(r(151));for(var Ce=Ne=null,Re=A,Ie=A=0,St=null,We=W.next();Re!==null&&!We.done;Ie++,We=W.next()){Re.index>Ie?(St=Re,Re=null):St=Re.sibling;var rs=ne(z,Re,We.value,ce);if(rs===null){Re===null&&(Re=St);break}e&&Re&&rs.alternate===null&&t(z,Re),A=m(rs,A,Ie),Ce===null?Ne=rs:Ce.sibling=rs,Ce=rs,Re=St}if(We.done)return s(z,Re),ot&&Vs(z,Ie),Ne;if(Re===null){for(;!We.done;Ie++,We=W.next())We=le(z,We.value,ce),We!==null&&(A=m(We,A,Ie),Ce===null?Ne=We:Ce.sibling=We,Ce=We);return ot&&Vs(z,Ie),Ne}for(Re=c(z,Re);!We.done;Ie++,We=W.next())We=xe(Re,z,Ie,We.value,ce),We!==null&&(e&&We.alternate!==null&&Re.delete(We.key===null?Ie:We.key),A=m(We,A,Ie),Ce===null?Ne=We:Ce.sibling=We,Ce=We);return e&&Re.forEach(function(Xm){return t(z,Xm)}),ot&&Vs(z,Ie),Ne}function ut(z,A,W,ce){if(typeof W=="object"&&W!==null&&W.type===V&&W.key===null&&(W=W.props.children),typeof W=="object"&&W!==null){switch(W.$$typeof){case J:e:{for(var Ne=W.key,Ce=A;Ce!==null;){if(Ce.key===Ne){if(Ne=W.type,Ne===V){if(Ce.tag===7){s(z,Ce.sibling),A=f(Ce,W.props.children),A.return=z,z=A;break e}}else if(Ce.elementType===Ne||typeof Ne=="object"&&Ne!==null&&Ne.$$typeof===$e&&vd(Ne)===Ce.type){s(z,Ce.sibling),A=f(Ce,W.props),A.ref=Pa(z,Ce,W),A.return=z,z=A;break e}s(z,Ce);break}else t(z,Ce);Ce=Ce.sibling}W.type===V?(A=Js(W.props.children,z.mode,ce,W.key),A.return=z,z=A):(ce=dl(W.type,W.key,W.props,null,z.mode,ce),ce.ref=Pa(z,A,W),ce.return=z,z=ce)}return b(z);case P:e:{for(Ce=W.key;A!==null;){if(A.key===Ce)if(A.tag===4&&A.stateNode.containerInfo===W.containerInfo&&A.stateNode.implementation===W.implementation){s(z,A.sibling),A=f(A,W.children||[]),A.return=z,z=A;break e}else{s(z,A);break}else t(z,A);A=A.sibling}A=du(W,z.mode,ce),A.return=z,z=A}return b(z);case $e:return Ce=W._init,ut(z,A,Ce(W._payload),ce)}if(Rr(W))return Se(z,A,W,ce);if($(W))return _e(z,A,W,ce);Vi(z,W)}return typeof W=="string"&&W!==""||typeof W=="number"?(W=""+W,A!==null&&A.tag===6?(s(z,A.sibling),A=f(A,W),A.return=z,z=A):(s(z,A),A=uu(W,z.mode,ce),A.return=z,z=A),b(z)):s(z,A)}return ut}var Co=yd(!0),xd=yd(!1),Bi=Hn(null),zi=null,Ro=null,bc=null;function wc(){bc=Ro=zi=null}function Sc(e){var t=Bi.current;nt(Bi),e._currentValue=t}function _c(e,t,s){for(;e!==null;){var c=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,c!==null&&(c.childLanes|=t)):c!==null&&(c.childLanes&t)!==t&&(c.childLanes|=t),e===s)break;e=e.return}}function Oo(e,t){zi=e,bc=Ro=null,e=e.dependencies,e!==null&&e.firstContext!==null&&((e.lanes&t)!==0&&(or=!0),e.firstContext=null)}function Nr(e){var t=e._currentValue;if(bc!==e)if(e={context:e,memoizedValue:t,next:null},Ro===null){if(zi===null)throw Error(r(308));Ro=e,zi.dependencies={lanes:0,firstContext:e}}else Ro=Ro.next=e;return t}var Bs=null;function kc(e){Bs===null?Bs=[e]:Bs.push(e)}function bd(e,t,s,c){var f=t.interleaved;return f===null?(s.next=s,kc(t)):(s.next=f.next,f.next=s),t.interleaved=s,bn(e,c)}function bn(e,t){e.lanes|=t;var s=e.alternate;for(s!==null&&(s.lanes|=t),s=e,e=e.return;e!==null;)e.childLanes|=t,s=e.alternate,s!==null&&(s.childLanes|=t),s=e,e=e.return;return s.tag===3?s.stateNode:null}var Gn=!1;function Ec(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function wd(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function wn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Jn(e,t,s){var c=e.updateQueue;if(c===null)return null;if(c=c.shared,(ze&2)!==0){var f=c.pending;return f===null?t.next=t:(t.next=f.next,f.next=t),c.pending=t,bn(e,s)}return f=c.interleaved,f===null?(t.next=t,kc(c)):(t.next=f.next,f.next=t),c.interleaved=t,bn(e,s)}function Wi(e,t,s){if(t=t.updateQueue,t!==null&&(t=t.shared,(s&4194240)!==0)){var c=t.lanes;c&=e.pendingLanes,s|=c,t.lanes=s,da(e,s)}}function Sd(e,t){var s=e.updateQueue,c=e.alternate;if(c!==null&&(c=c.updateQueue,s===c)){var f=null,m=null;if(s=s.firstBaseUpdate,s!==null){do{var b={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};m===null?f=m=b:m=m.next=b,s=s.next}while(s!==null);m===null?f=m=t:m=m.next=t}else f=m=t;s={baseState:c.baseState,firstBaseUpdate:f,lastBaseUpdate:m,shared:c.shared,effects:c.effects},e.updateQueue=s;return}e=s.lastBaseUpdate,e===null?s.firstBaseUpdate=t:e.next=t,s.lastBaseUpdate=t}function Hi(e,t,s,c){var f=e.updateQueue;Gn=!1;var m=f.firstBaseUpdate,b=f.lastBaseUpdate,j=f.shared.pending;if(j!==null){f.shared.pending=null;var O=j,K=O.next;O.next=null,b===null?m=K:b.next=K,b=O;var se=e.alternate;se!==null&&(se=se.updateQueue,j=se.lastBaseUpdate,j!==b&&(j===null?se.firstBaseUpdate=K:j.next=K,se.lastBaseUpdate=O))}if(m!==null){var le=f.baseState;b=0,se=K=O=null,j=m;do{var ne=j.lane,xe=j.eventTime;if((c&ne)===ne){se!==null&&(se=se.next={eventTime:xe,lane:0,tag:j.tag,payload:j.payload,callback:j.callback,next:null});e:{var Se=e,_e=j;switch(ne=t,xe=s,_e.tag){case 1:if(Se=_e.payload,typeof Se=="function"){le=Se.call(xe,le,ne);break e}le=Se;break e;case 3:Se.flags=Se.flags&-65537|128;case 0:if(Se=_e.payload,ne=typeof Se=="function"?Se.call(xe,le,ne):Se,ne==null)break e;le=M({},le,ne);break e;case 2:Gn=!0}}j.callback!==null&&j.lane!==0&&(e.flags|=64,ne=f.effects,ne===null?f.effects=[j]:ne.push(j))}else xe={eventTime:xe,lane:ne,tag:j.tag,payload:j.payload,callback:j.callback,next:null},se===null?(K=se=xe,O=le):se=se.next=xe,b|=ne;if(j=j.next,j===null){if(j=f.shared.pending,j===null)break;ne=j,j=ne.next,ne.next=null,f.lastBaseUpdate=ne,f.shared.pending=null}}while(!0);if(se===null&&(O=le),f.baseState=O,f.firstBaseUpdate=K,f.lastBaseUpdate=se,t=f.shared.interleaved,t!==null){f=t;do b|=f.lane,f=f.next;while(f!==t)}else m===null&&(f.shared.lanes=0);Hs|=b,e.lanes=b,e.memoizedState=le}}function _d(e,t,s){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var c=e[t],f=c.callback;if(f!==null){if(c.callback=null,c=s,typeof f!="function")throw Error(r(191,f));f.call(c)}}}var Da={},Zr=Hn(Da),La=Hn(Da),Aa=Hn(Da);function zs(e){if(e===Da)throw Error(r(174));return e}function Nc(e,t){switch(Ze(Aa,t),Ze(La,e),Ze(Zr,Da),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Qt(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Qt(t,e)}nt(Zr),Ze(Zr,t)}function Io(){nt(Zr),nt(La),nt(Aa)}function kd(e){zs(Aa.current);var t=zs(Zr.current),s=Qt(t,e.type);t!==s&&(Ze(La,e),Ze(Zr,s))}function jc(e){La.current===e&&(nt(Zr),nt(La))}var at=Hn(0);function qi(e){for(var t=e;t!==null;){if(t.tag===13){var s=t.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Tc=[];function Cc(){for(var e=0;e<Tc.length;e++)Tc[e]._workInProgressVersionPrimary=null;Tc.length=0}var Ki=q.ReactCurrentDispatcher,Rc=q.ReactCurrentBatchConfig,Ws=0,it=null,mt=null,bt=null,Gi=!1,$a=!1,Ma=0,bm=0;function Ft(){throw Error(r(321))}function Oc(e,t){if(t===null)return!1;for(var s=0;s<t.length&&s<e.length;s++)if(!er(e[s],t[s]))return!1;return!0}function Ic(e,t,s,c,f,m){if(Ws=m,it=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Ki.current=e===null||e.memoizedState===null?km:Em,e=s(c,f),$a){m=0;do{if($a=!1,Ma=0,25<=m)throw Error(r(301));m+=1,bt=mt=null,t.updateQueue=null,Ki.current=Nm,e=s(c,f)}while($a)}if(Ki.current=Yi,t=mt!==null&&mt.next!==null,Ws=0,bt=mt=it=null,Gi=!1,t)throw Error(r(300));return e}function Pc(){var e=Ma!==0;return Ma=0,e}function en(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bt===null?it.memoizedState=bt=e:bt=bt.next=e,bt}function jr(){if(mt===null){var e=it.alternate;e=e!==null?e.memoizedState:null}else e=mt.next;var t=bt===null?it.memoizedState:bt.next;if(t!==null)bt=t,mt=e;else{if(e===null)throw Error(r(310));mt=e,e={memoizedState:mt.memoizedState,baseState:mt.baseState,baseQueue:mt.baseQueue,queue:mt.queue,next:null},bt===null?it.memoizedState=bt=e:bt=bt.next=e}return bt}function Ua(e,t){return typeof t=="function"?t(e):t}function Dc(e){var t=jr(),s=t.queue;if(s===null)throw Error(r(311));s.lastRenderedReducer=e;var c=mt,f=c.baseQueue,m=s.pending;if(m!==null){if(f!==null){var b=f.next;f.next=m.next,m.next=b}c.baseQueue=f=m,s.pending=null}if(f!==null){m=f.next,c=c.baseState;var j=b=null,O=null,K=m;do{var se=K.lane;if((Ws&se)===se)O!==null&&(O=O.next={lane:0,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null}),c=K.hasEagerState?K.eagerState:e(c,K.action);else{var le={lane:se,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null};O===null?(j=O=le,b=c):O=O.next=le,it.lanes|=se,Hs|=se}K=K.next}while(K!==null&&K!==m);O===null?b=c:O.next=j,er(c,t.memoizedState)||(or=!0),t.memoizedState=c,t.baseState=b,t.baseQueue=O,s.lastRenderedState=c}if(e=s.interleaved,e!==null){f=e;do m=f.lane,it.lanes|=m,Hs|=m,f=f.next;while(f!==e)}else f===null&&(s.lanes=0);return[t.memoizedState,s.dispatch]}function Lc(e){var t=jr(),s=t.queue;if(s===null)throw Error(r(311));s.lastRenderedReducer=e;var c=s.dispatch,f=s.pending,m=t.memoizedState;if(f!==null){s.pending=null;var b=f=f.next;do m=e(m,b.action),b=b.next;while(b!==f);er(m,t.memoizedState)||(or=!0),t.memoizedState=m,t.baseQueue===null&&(t.baseState=m),s.lastRenderedState=m}return[m,c]}function Ed(){}function Nd(e,t){var s=it,c=jr(),f=t(),m=!er(c.memoizedState,f);if(m&&(c.memoizedState=f,or=!0),c=c.queue,Ac(Cd.bind(null,s,c,e),[e]),c.getSnapshot!==t||m||bt!==null&&bt.memoizedState.tag&1){if(s.flags|=2048,Fa(9,Td.bind(null,s,c,f,t),void 0,null),wt===null)throw Error(r(349));(Ws&30)!==0||jd(s,t,f)}return f}function jd(e,t,s){e.flags|=16384,e={getSnapshot:t,value:s},t=it.updateQueue,t===null?(t={lastEffect:null,stores:null},it.updateQueue=t,t.stores=[e]):(s=t.stores,s===null?t.stores=[e]:s.push(e))}function Td(e,t,s,c){t.value=s,t.getSnapshot=c,Rd(t)&&Od(e)}function Cd(e,t,s){return s(function(){Rd(t)&&Od(e)})}function Rd(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!er(e,s)}catch{return!0}}function Od(e){var t=bn(e,1);t!==null&&zr(t,e,1,-1)}function Id(e){var t=en();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ua,lastRenderedState:e},t.queue=e,e=e.dispatch=_m.bind(null,it,e),[t.memoizedState,e]}function Fa(e,t,s,c){return e={tag:e,create:t,destroy:s,deps:c,next:null},t=it.updateQueue,t===null?(t={lastEffect:null,stores:null},it.updateQueue=t,t.lastEffect=e.next=e):(s=t.lastEffect,s===null?t.lastEffect=e.next=e:(c=s.next,s.next=e,e.next=c,t.lastEffect=e)),e}function Pd(){return jr().memoizedState}function Ji(e,t,s,c){var f=en();it.flags|=e,f.memoizedState=Fa(1|t,s,void 0,c===void 0?null:c)}function Qi(e,t,s,c){var f=jr();c=c===void 0?null:c;var m=void 0;if(mt!==null){var b=mt.memoizedState;if(m=b.destroy,c!==null&&Oc(c,b.deps)){f.memoizedState=Fa(t,s,m,c);return}}it.flags|=e,f.memoizedState=Fa(1|t,s,m,c)}function Dd(e,t){return Ji(8390656,8,e,t)}function Ac(e,t){return Qi(2048,8,e,t)}function Ld(e,t){return Qi(4,2,e,t)}function Ad(e,t){return Qi(4,4,e,t)}function $d(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Md(e,t,s){return s=s!=null?s.concat([e]):null,Qi(4,4,$d.bind(null,t,e),s)}function $c(){}function Ud(e,t){var s=jr();t=t===void 0?null:t;var c=s.memoizedState;return c!==null&&t!==null&&Oc(t,c[1])?c[0]:(s.memoizedState=[e,t],e)}function Fd(e,t){var s=jr();t=t===void 0?null:t;var c=s.memoizedState;return c!==null&&t!==null&&Oc(t,c[1])?c[0]:(e=e(),s.memoizedState=[e,t],e)}function Vd(e,t,s){return(Ws&21)===0?(e.baseState&&(e.baseState=!1,or=!0),e.memoizedState=s):(er(s,t)||(s=ca(),it.lanes|=s,Hs|=s,e.baseState=!0),t)}function wm(e,t){var s=ve;ve=s!==0&&4>s?s:4,e(!0);var c=Rc.transition;Rc.transition={};try{e(!1),t()}finally{ve=s,Rc.transition=c}}function Bd(){return jr().memoizedState}function Sm(e,t,s){var c=Zn(e);if(s={lane:c,action:s,hasEagerState:!1,eagerState:null,next:null},zd(e))Wd(t,s);else if(s=bd(e,t,s,c),s!==null){var f=Kt();zr(s,e,c,f),Hd(s,t,c)}}function _m(e,t,s){var c=Zn(e),f={lane:c,action:s,hasEagerState:!1,eagerState:null,next:null};if(zd(e))Wd(t,f);else{var m=e.alternate;if(e.lanes===0&&(m===null||m.lanes===0)&&(m=t.lastRenderedReducer,m!==null))try{var b=t.lastRenderedState,j=m(b,s);if(f.hasEagerState=!0,f.eagerState=j,er(j,b)){var O=t.interleaved;O===null?(f.next=f,kc(t)):(f.next=O.next,O.next=f),t.interleaved=f;return}}catch{}finally{}s=bd(e,t,f,c),s!==null&&(f=Kt(),zr(s,e,c,f),Hd(s,t,c))}}function zd(e){var t=e.alternate;return e===it||t!==null&&t===it}function Wd(e,t){$a=Gi=!0;var s=e.pending;s===null?t.next=t:(t.next=s.next,s.next=t),e.pending=t}function Hd(e,t,s){if((s&4194240)!==0){var c=t.lanes;c&=e.pendingLanes,s|=c,t.lanes=s,da(e,s)}}var Yi={readContext:Nr,useCallback:Ft,useContext:Ft,useEffect:Ft,useImperativeHandle:Ft,useInsertionEffect:Ft,useLayoutEffect:Ft,useMemo:Ft,useReducer:Ft,useRef:Ft,useState:Ft,useDebugValue:Ft,useDeferredValue:Ft,useTransition:Ft,useMutableSource:Ft,useSyncExternalStore:Ft,useId:Ft,unstable_isNewReconciler:!1},km={readContext:Nr,useCallback:function(e,t){return en().memoizedState=[e,t===void 0?null:t],e},useContext:Nr,useEffect:Dd,useImperativeHandle:function(e,t,s){return s=s!=null?s.concat([e]):null,Ji(4194308,4,$d.bind(null,t,e),s)},useLayoutEffect:function(e,t){return Ji(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ji(4,2,e,t)},useMemo:function(e,t){var s=en();return t=t===void 0?null:t,e=e(),s.memoizedState=[e,t],e},useReducer:function(e,t,s){var c=en();return t=s!==void 0?s(t):t,c.memoizedState=c.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},c.queue=e,e=e.dispatch=Sm.bind(null,it,e),[c.memoizedState,e]},useRef:function(e){var t=en();return e={current:e},t.memoizedState=e},useState:Id,useDebugValue:$c,useDeferredValue:function(e){return en().memoizedState=e},useTransition:function(){var e=Id(!1),t=e[0];return e=wm.bind(null,e[1]),en().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,s){var c=it,f=en();if(ot){if(s===void 0)throw Error(r(407));s=s()}else{if(s=t(),wt===null)throw Error(r(349));(Ws&30)!==0||jd(c,t,s)}f.memoizedState=s;var m={value:s,getSnapshot:t};return f.queue=m,Dd(Cd.bind(null,c,m,e),[e]),c.flags|=2048,Fa(9,Td.bind(null,c,m,s,t),void 0,null),s},useId:function(){var e=en(),t=wt.identifierPrefix;if(ot){var s=xn,c=yn;s=(c&~(1<<32-dr(c)-1)).toString(32)+s,t=":"+t+"R"+s,s=Ma++,0<s&&(t+="H"+s.toString(32)),t+=":"}else s=bm++,t=":"+t+"r"+s.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Em={readContext:Nr,useCallback:Ud,useContext:Nr,useEffect:Ac,useImperativeHandle:Md,useInsertionEffect:Ld,useLayoutEffect:Ad,useMemo:Fd,useReducer:Dc,useRef:Pd,useState:function(){return Dc(Ua)},useDebugValue:$c,useDeferredValue:function(e){var t=jr();return Vd(t,mt.memoizedState,e)},useTransition:function(){var e=Dc(Ua)[0],t=jr().memoizedState;return[e,t]},useMutableSource:Ed,useSyncExternalStore:Nd,useId:Bd,unstable_isNewReconciler:!1},Nm={readContext:Nr,useCallback:Ud,useContext:Nr,useEffect:Ac,useImperativeHandle:Md,useInsertionEffect:Ld,useLayoutEffect:Ad,useMemo:Fd,useReducer:Lc,useRef:Pd,useState:function(){return Lc(Ua)},useDebugValue:$c,useDeferredValue:function(e){var t=jr();return mt===null?t.memoizedState=e:Vd(t,mt.memoizedState,e)},useTransition:function(){var e=Lc(Ua)[0],t=jr().memoizedState;return[e,t]},useMutableSource:Ed,useSyncExternalStore:Nd,useId:Bd,unstable_isNewReconciler:!1};function Fr(e,t){if(e&&e.defaultProps){t=M({},t),e=e.defaultProps;for(var s in e)t[s]===void 0&&(t[s]=e[s]);return t}return t}function Mc(e,t,s,c){t=e.memoizedState,s=s(c,t),s=s==null?t:M({},t,s),e.memoizedState=s,e.lanes===0&&(e.updateQueue.baseState=s)}var Xi={isMounted:function(e){return(e=e._reactInternals)?Xt(e)===e:!1},enqueueSetState:function(e,t,s){e=e._reactInternals;var c=Kt(),f=Zn(e),m=wn(c,f);m.payload=t,s!=null&&(m.callback=s),t=Jn(e,m,f),t!==null&&(zr(t,e,f,c),Wi(t,e,f))},enqueueReplaceState:function(e,t,s){e=e._reactInternals;var c=Kt(),f=Zn(e),m=wn(c,f);m.tag=1,m.payload=t,s!=null&&(m.callback=s),t=Jn(e,m,f),t!==null&&(zr(t,e,f,c),Wi(t,e,f))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var s=Kt(),c=Zn(e),f=wn(s,c);f.tag=2,t!=null&&(f.callback=t),t=Jn(e,f,c),t!==null&&(zr(t,e,c,s),Wi(t,e,c))}};function qd(e,t,s,c,f,m,b){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(c,m,b):t.prototype&&t.prototype.isPureReactComponent?!Ls(s,c)||!Ls(f,m):!0}function Kd(e,t,s){var c=!1,f=qn,m=t.contextType;return typeof m=="object"&&m!==null?m=Nr(m):(f=sr(t)?Us:Ut.current,c=t.contextTypes,m=(c=c!=null)?Eo(e,f):qn),t=new t(s,m),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Xi,e.stateNode=t,t._reactInternals=e,c&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=f,e.__reactInternalMemoizedMaskedChildContext=m),t}function Gd(e,t,s,c){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(s,c),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(s,c),t.state!==e&&Xi.enqueueReplaceState(t,t.state,null)}function Uc(e,t,s,c){var f=e.stateNode;f.props=s,f.state=e.memoizedState,f.refs={},Ec(e);var m=t.contextType;typeof m=="object"&&m!==null?f.context=Nr(m):(m=sr(t)?Us:Ut.current,f.context=Eo(e,m)),f.state=e.memoizedState,m=t.getDerivedStateFromProps,typeof m=="function"&&(Mc(e,t,m,s),f.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof f.getSnapshotBeforeUpdate=="function"||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(t=f.state,typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount(),t!==f.state&&Xi.enqueueReplaceState(f,f.state,null),Hi(e,s,f,c),f.state=e.memoizedState),typeof f.componentDidMount=="function"&&(e.flags|=4194308)}function Po(e,t){try{var s="",c=t;do s+=De(c),c=c.return;while(c);var f=s}catch(m){f=`
Error generating stack: `+m.message+`
`+m.stack}return{value:e,source:t,stack:f,digest:null}}function Fc(e,t,s){return{value:e,source:null,stack:s??null,digest:t??null}}function Vc(e,t){try{console.error(t.value)}catch(s){setTimeout(function(){throw s})}}var jm=typeof WeakMap=="function"?WeakMap:Map;function Jd(e,t,s){s=wn(-1,s),s.tag=3,s.payload={element:null};var c=t.value;return s.callback=function(){ol||(ol=!0,ru=c),Vc(e,t)},s}function Qd(e,t,s){s=wn(-1,s),s.tag=3;var c=e.type.getDerivedStateFromError;if(typeof c=="function"){var f=t.value;s.payload=function(){return c(f)},s.callback=function(){Vc(e,t)}}var m=e.stateNode;return m!==null&&typeof m.componentDidCatch=="function"&&(s.callback=function(){Vc(e,t),typeof c!="function"&&(Yn===null?Yn=new Set([this]):Yn.add(this));var b=t.stack;this.componentDidCatch(t.value,{componentStack:b!==null?b:""})}),s}function Yd(e,t,s){var c=e.pingCache;if(c===null){c=e.pingCache=new jm;var f=new Set;c.set(t,f)}else f=c.get(t),f===void 0&&(f=new Set,c.set(t,f));f.has(s)||(f.add(s),e=Vm.bind(null,e,t,s),t.then(e,e))}function Xd(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Zd(e,t,s,c,f){return(e.mode&1)===0?(e===t?e.flags|=65536:(e.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(t=wn(-1,1),t.tag=2,Jn(s,t,1))),s.lanes|=1),e):(e.flags|=65536,e.lanes=f,e)}var Tm=q.ReactCurrentOwner,or=!1;function qt(e,t,s,c){t.child=e===null?xd(t,null,s,c):Co(t,e.child,s,c)}function eh(e,t,s,c,f){s=s.render;var m=t.ref;return Oo(t,f),c=Ic(e,t,s,c,m,f),s=Pc(),e!==null&&!or?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~f,Sn(e,t,f)):(ot&&s&&gc(t),t.flags|=1,qt(e,t,c,f),t.child)}function th(e,t,s,c,f){if(e===null){var m=s.type;return typeof m=="function"&&!cu(m)&&m.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(t.tag=15,t.type=m,rh(e,t,m,c,f)):(e=dl(s.type,null,c,t,t.mode,f),e.ref=t.ref,e.return=t,t.child=e)}if(m=e.child,(e.lanes&f)===0){var b=m.memoizedProps;if(s=s.compare,s=s!==null?s:Ls,s(b,c)&&e.ref===t.ref)return Sn(e,t,f)}return t.flags|=1,e=ts(m,c),e.ref=t.ref,e.return=t,t.child=e}function rh(e,t,s,c,f){if(e!==null){var m=e.memoizedProps;if(Ls(m,c)&&e.ref===t.ref)if(or=!1,t.pendingProps=c=m,(e.lanes&f)!==0)(e.flags&131072)!==0&&(or=!0);else return t.lanes=e.lanes,Sn(e,t,f)}return Bc(e,t,s,c,f)}function nh(e,t,s){var c=t.pendingProps,f=c.children,m=e!==null?e.memoizedState:null;if(c.mode==="hidden")if((t.mode&1)===0)t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ze(Lo,pr),pr|=s;else{if((s&1073741824)===0)return e=m!==null?m.baseLanes|s:s,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ze(Lo,pr),pr|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},c=m!==null?m.baseLanes:s,Ze(Lo,pr),pr|=c}else m!==null?(c=m.baseLanes|s,t.memoizedState=null):c=s,Ze(Lo,pr),pr|=c;return qt(e,t,f,s),t.child}function sh(e,t){var s=t.ref;(e===null&&s!==null||e!==null&&e.ref!==s)&&(t.flags|=512,t.flags|=2097152)}function Bc(e,t,s,c,f){var m=sr(s)?Us:Ut.current;return m=Eo(t,m),Oo(t,f),s=Ic(e,t,s,c,m,f),c=Pc(),e!==null&&!or?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~f,Sn(e,t,f)):(ot&&c&&gc(t),t.flags|=1,qt(e,t,s,f),t.child)}function oh(e,t,s,c,f){if(sr(s)){var m=!0;Ai(t)}else m=!1;if(Oo(t,f),t.stateNode===null)el(e,t),Kd(t,s,c),Uc(t,s,c,f),c=!0;else if(e===null){var b=t.stateNode,j=t.memoizedProps;b.props=j;var O=b.context,K=s.contextType;typeof K=="object"&&K!==null?K=Nr(K):(K=sr(s)?Us:Ut.current,K=Eo(t,K));var se=s.getDerivedStateFromProps,le=typeof se=="function"||typeof b.getSnapshotBeforeUpdate=="function";le||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(j!==c||O!==K)&&Gd(t,b,c,K),Gn=!1;var ne=t.memoizedState;b.state=ne,Hi(t,c,b,f),O=t.memoizedState,j!==c||ne!==O||nr.current||Gn?(typeof se=="function"&&(Mc(t,s,se,c),O=t.memoizedState),(j=Gn||qd(t,s,j,c,ne,O,K))?(le||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(t.flags|=4194308)):(typeof b.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=c,t.memoizedState=O),b.props=c,b.state=O,b.context=K,c=j):(typeof b.componentDidMount=="function"&&(t.flags|=4194308),c=!1)}else{b=t.stateNode,wd(e,t),j=t.memoizedProps,K=t.type===t.elementType?j:Fr(t.type,j),b.props=K,le=t.pendingProps,ne=b.context,O=s.contextType,typeof O=="object"&&O!==null?O=Nr(O):(O=sr(s)?Us:Ut.current,O=Eo(t,O));var xe=s.getDerivedStateFromProps;(se=typeof xe=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(j!==le||ne!==O)&&Gd(t,b,c,O),Gn=!1,ne=t.memoizedState,b.state=ne,Hi(t,c,b,f);var Se=t.memoizedState;j!==le||ne!==Se||nr.current||Gn?(typeof xe=="function"&&(Mc(t,s,xe,c),Se=t.memoizedState),(K=Gn||qd(t,s,K,c,ne,Se,O)||!1)?(se||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(c,Se,O),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(c,Se,O)),typeof b.componentDidUpdate=="function"&&(t.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof b.componentDidUpdate!="function"||j===e.memoizedProps&&ne===e.memoizedState||(t.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||j===e.memoizedProps&&ne===e.memoizedState||(t.flags|=1024),t.memoizedProps=c,t.memoizedState=Se),b.props=c,b.state=Se,b.context=O,c=K):(typeof b.componentDidUpdate!="function"||j===e.memoizedProps&&ne===e.memoizedState||(t.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||j===e.memoizedProps&&ne===e.memoizedState||(t.flags|=1024),c=!1)}return zc(e,t,s,c,m,f)}function zc(e,t,s,c,f,m){sh(e,t);var b=(t.flags&128)!==0;if(!c&&!b)return f&&ud(t,s,!1),Sn(e,t,m);c=t.stateNode,Tm.current=t;var j=b&&typeof s.getDerivedStateFromError!="function"?null:c.render();return t.flags|=1,e!==null&&b?(t.child=Co(t,e.child,null,m),t.child=Co(t,null,j,m)):qt(e,t,j,m),t.memoizedState=c.state,f&&ud(t,s,!0),t.child}function ah(e){var t=e.stateNode;t.pendingContext?ld(e,t.pendingContext,t.pendingContext!==t.context):t.context&&ld(e,t.context,!1),Nc(e,t.containerInfo)}function ih(e,t,s,c,f){return To(),xc(f),t.flags|=256,qt(e,t,s,c),t.child}var Wc={dehydrated:null,treeContext:null,retryLane:0};function Hc(e){return{baseLanes:e,cachePool:null,transitions:null}}function lh(e,t,s){var c=t.pendingProps,f=at.current,m=!1,b=(t.flags&128)!==0,j;if((j=b)||(j=e!==null&&e.memoizedState===null?!1:(f&2)!==0),j?(m=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(f|=1),Ze(at,f&1),e===null)return yc(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?((t.mode&1)===0?t.lanes=1:e.data==="$!"?t.lanes=8:t.lanes=1073741824,null):(b=c.children,e=c.fallback,m?(c=t.mode,m=t.child,b={mode:"hidden",children:b},(c&1)===0&&m!==null?(m.childLanes=0,m.pendingProps=b):m=hl(b,c,0,null),e=Js(e,c,s,null),m.return=t,e.return=t,m.sibling=e,t.child=m,t.child.memoizedState=Hc(s),t.memoizedState=Wc,e):qc(t,b));if(f=e.memoizedState,f!==null&&(j=f.dehydrated,j!==null))return Cm(e,t,b,c,j,f,s);if(m){m=c.fallback,b=t.mode,f=e.child,j=f.sibling;var O={mode:"hidden",children:c.children};return(b&1)===0&&t.child!==f?(c=t.child,c.childLanes=0,c.pendingProps=O,t.deletions=null):(c=ts(f,O),c.subtreeFlags=f.subtreeFlags&14680064),j!==null?m=ts(j,m):(m=Js(m,b,s,null),m.flags|=2),m.return=t,c.return=t,c.sibling=m,t.child=c,c=m,m=t.child,b=e.child.memoizedState,b=b===null?Hc(s):{baseLanes:b.baseLanes|s,cachePool:null,transitions:b.transitions},m.memoizedState=b,m.childLanes=e.childLanes&~s,t.memoizedState=Wc,c}return m=e.child,e=m.sibling,c=ts(m,{mode:"visible",children:c.children}),(t.mode&1)===0&&(c.lanes=s),c.return=t,c.sibling=null,e!==null&&(s=t.deletions,s===null?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=c,t.memoizedState=null,c}function qc(e,t){return t=hl({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Zi(e,t,s,c){return c!==null&&xc(c),Co(t,e.child,null,s),e=qc(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Cm(e,t,s,c,f,m,b){if(s)return t.flags&256?(t.flags&=-257,c=Fc(Error(r(422))),Zi(e,t,b,c)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(m=c.fallback,f=t.mode,c=hl({mode:"visible",children:c.children},f,0,null),m=Js(m,f,b,null),m.flags|=2,c.return=t,m.return=t,c.sibling=m,t.child=c,(t.mode&1)!==0&&Co(t,e.child,null,b),t.child.memoizedState=Hc(b),t.memoizedState=Wc,m);if((t.mode&1)===0)return Zi(e,t,b,null);if(f.data==="$!"){if(c=f.nextSibling&&f.nextSibling.dataset,c)var j=c.dgst;return c=j,m=Error(r(419)),c=Fc(m,c,void 0),Zi(e,t,b,c)}if(j=(b&e.childLanes)!==0,or||j){if(c=wt,c!==null){switch(b&-b){case 4:f=2;break;case 16:f=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:f=32;break;case 536870912:f=268435456;break;default:f=0}f=(f&(c.suspendedLanes|b))!==0?0:f,f!==0&&f!==m.retryLane&&(m.retryLane=f,bn(e,f),zr(c,e,f,-1))}return lu(),c=Fc(Error(r(421))),Zi(e,t,b,c)}return f.data==="$?"?(t.flags|=128,t.child=e.child,t=Bm.bind(null,e),f._reactRetry=t,null):(e=m.treeContext,gr=Wn(f.nextSibling),mr=t,ot=!0,Ur=null,e!==null&&(kr[Er++]=yn,kr[Er++]=xn,kr[Er++]=Fs,yn=e.id,xn=e.overflow,Fs=t),t=qc(t,c.children),t.flags|=4096,t)}function ch(e,t,s){e.lanes|=t;var c=e.alternate;c!==null&&(c.lanes|=t),_c(e.return,t,s)}function Kc(e,t,s,c,f){var m=e.memoizedState;m===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:c,tail:s,tailMode:f}:(m.isBackwards=t,m.rendering=null,m.renderingStartTime=0,m.last=c,m.tail=s,m.tailMode=f)}function uh(e,t,s){var c=t.pendingProps,f=c.revealOrder,m=c.tail;if(qt(e,t,c.children,s),c=at.current,(c&2)!==0)c=c&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&ch(e,s,t);else if(e.tag===19)ch(e,s,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}c&=1}if(Ze(at,c),(t.mode&1)===0)t.memoizedState=null;else switch(f){case"forwards":for(s=t.child,f=null;s!==null;)e=s.alternate,e!==null&&qi(e)===null&&(f=s),s=s.sibling;s=f,s===null?(f=t.child,t.child=null):(f=s.sibling,s.sibling=null),Kc(t,!1,f,s,m);break;case"backwards":for(s=null,f=t.child,t.child=null;f!==null;){if(e=f.alternate,e!==null&&qi(e)===null){t.child=f;break}e=f.sibling,f.sibling=s,s=f,f=e}Kc(t,!0,s,null,m);break;case"together":Kc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function el(e,t){(t.mode&1)===0&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Sn(e,t,s){if(e!==null&&(t.dependencies=e.dependencies),Hs|=t.lanes,(s&t.childLanes)===0)return null;if(e!==null&&t.child!==e.child)throw Error(r(153));if(t.child!==null){for(e=t.child,s=ts(e,e.pendingProps),t.child=s,s.return=t;e.sibling!==null;)e=e.sibling,s=s.sibling=ts(e,e.pendingProps),s.return=t;s.sibling=null}return t.child}function Rm(e,t,s){switch(t.tag){case 3:ah(t),To();break;case 5:kd(t);break;case 1:sr(t.type)&&Ai(t);break;case 4:Nc(t,t.stateNode.containerInfo);break;case 10:var c=t.type._context,f=t.memoizedProps.value;Ze(Bi,c._currentValue),c._currentValue=f;break;case 13:if(c=t.memoizedState,c!==null)return c.dehydrated!==null?(Ze(at,at.current&1),t.flags|=128,null):(s&t.child.childLanes)!==0?lh(e,t,s):(Ze(at,at.current&1),e=Sn(e,t,s),e!==null?e.sibling:null);Ze(at,at.current&1);break;case 19:if(c=(s&t.childLanes)!==0,(e.flags&128)!==0){if(c)return uh(e,t,s);t.flags|=128}if(f=t.memoizedState,f!==null&&(f.rendering=null,f.tail=null,f.lastEffect=null),Ze(at,at.current),c)break;return null;case 22:case 23:return t.lanes=0,nh(e,t,s)}return Sn(e,t,s)}var dh,Gc,hh,fh;dh=function(e,t){for(var s=t.child;s!==null;){if(s.tag===5||s.tag===6)e.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return;s=s.return}s.sibling.return=s.return,s=s.sibling}},Gc=function(){},hh=function(e,t,s,c){var f=e.memoizedProps;if(f!==c){e=t.stateNode,zs(Zr.current);var m=null;switch(s){case"input":f=is(e,f),c=is(e,c),m=[];break;case"select":f=M({},f,{value:void 0}),c=M({},c,{value:void 0}),m=[];break;case"textarea":f=ln(e,f),c=ln(e,c),m=[];break;default:typeof f.onClick!="function"&&typeof c.onClick=="function"&&(e.onclick=Pi)}In(s,c);var b;s=null;for(K in f)if(!c.hasOwnProperty(K)&&f.hasOwnProperty(K)&&f[K]!=null)if(K==="style"){var j=f[K];for(b in j)j.hasOwnProperty(b)&&(s||(s={}),s[b]="")}else K!=="dangerouslySetInnerHTML"&&K!=="children"&&K!=="suppressContentEditableWarning"&&K!=="suppressHydrationWarning"&&K!=="autoFocus"&&(i.hasOwnProperty(K)?m||(m=[]):(m=m||[]).push(K,null));for(K in c){var O=c[K];if(j=f?.[K],c.hasOwnProperty(K)&&O!==j&&(O!=null||j!=null))if(K==="style")if(j){for(b in j)!j.hasOwnProperty(b)||O&&O.hasOwnProperty(b)||(s||(s={}),s[b]="");for(b in O)O.hasOwnProperty(b)&&j[b]!==O[b]&&(s||(s={}),s[b]=O[b])}else s||(m||(m=[]),m.push(K,s)),s=O;else K==="dangerouslySetInnerHTML"?(O=O?O.__html:void 0,j=j?j.__html:void 0,O!=null&&j!==O&&(m=m||[]).push(K,O)):K==="children"?typeof O!="string"&&typeof O!="number"||(m=m||[]).push(K,""+O):K!=="suppressContentEditableWarning"&&K!=="suppressHydrationWarning"&&(i.hasOwnProperty(K)?(O!=null&&K==="onScroll"&&Xe("scroll",e),m||j===O||(m=[])):(m=m||[]).push(K,O))}s&&(m=m||[]).push("style",s);var K=m;(t.updateQueue=K)&&(t.flags|=4)}},fh=function(e,t,s,c){s!==c&&(t.flags|=4)};function Va(e,t){if(!ot)switch(e.tailMode){case"hidden":t=e.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:c.sibling=null}}function Vt(e){var t=e.alternate!==null&&e.alternate.child===e.child,s=0,c=0;if(t)for(var f=e.child;f!==null;)s|=f.lanes|f.childLanes,c|=f.subtreeFlags&14680064,c|=f.flags&14680064,f.return=e,f=f.sibling;else for(f=e.child;f!==null;)s|=f.lanes|f.childLanes,c|=f.subtreeFlags,c|=f.flags,f.return=e,f=f.sibling;return e.subtreeFlags|=c,e.childLanes=s,t}function Om(e,t,s){var c=t.pendingProps;switch(pc(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Vt(t),null;case 1:return sr(t.type)&&Li(),Vt(t),null;case 3:return c=t.stateNode,Io(),nt(nr),nt(Ut),Cc(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(e===null||e.child===null)&&(Fi(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,Ur!==null&&(ou(Ur),Ur=null))),Gc(e,t),Vt(t),null;case 5:jc(t);var f=zs(Aa.current);if(s=t.type,e!==null&&t.stateNode!=null)hh(e,t,s,c,f),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!c){if(t.stateNode===null)throw Error(r(166));return Vt(t),null}if(e=zs(Zr.current),Fi(t)){c=t.stateNode,s=t.type;var m=t.memoizedProps;switch(c[Xr]=t,c[Oa]=m,e=(t.mode&1)!==0,s){case"dialog":Xe("cancel",c),Xe("close",c);break;case"iframe":case"object":case"embed":Xe("load",c);break;case"video":case"audio":for(f=0;f<Mt.length;f++)Xe(Mt[f],c);break;case"source":Xe("error",c);break;case"img":case"image":case"link":Xe("error",c),Xe("load",c);break;case"details":Xe("toggle",c);break;case"input":ls(c,m),Xe("invalid",c);break;case"select":c._wrapperState={wasMultiple:!!m.multiple},Xe("invalid",c);break;case"textarea":Nt(c,m),Xe("invalid",c)}In(s,m),f=null;for(var b in m)if(m.hasOwnProperty(b)){var j=m[b];b==="children"?typeof j=="string"?c.textContent!==j&&(m.suppressHydrationWarning!==!0&&Ii(c.textContent,j,e),f=["children",j]):typeof j=="number"&&c.textContent!==""+j&&(m.suppressHydrationWarning!==!0&&Ii(c.textContent,j,e),f=["children",""+j]):i.hasOwnProperty(b)&&j!=null&&b==="onScroll"&&Xe("scroll",c)}switch(s){case"input":an(c),us(c,m,!0);break;case"textarea":an(c),ds(c);break;case"select":case"option":break;default:typeof m.onClick=="function"&&(c.onclick=Pi)}c=f,t.updateQueue=c,c!==null&&(t.flags|=4)}else{b=f.nodeType===9?f:f.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=hs(s)),e==="http://www.w3.org/1999/xhtml"?s==="script"?(e=b.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof c.is=="string"?e=b.createElement(s,{is:c.is}):(e=b.createElement(s),s==="select"&&(b=e,c.multiple?b.multiple=!0:c.size&&(b.size=c.size))):e=b.createElementNS(e,s),e[Xr]=t,e[Oa]=c,dh(e,t,!1,!1),t.stateNode=e;e:{switch(b=jt(s,c),s){case"dialog":Xe("cancel",e),Xe("close",e),f=c;break;case"iframe":case"object":case"embed":Xe("load",e),f=c;break;case"video":case"audio":for(f=0;f<Mt.length;f++)Xe(Mt[f],e);f=c;break;case"source":Xe("error",e),f=c;break;case"img":case"image":case"link":Xe("error",e),Xe("load",e),f=c;break;case"details":Xe("toggle",e),f=c;break;case"input":ls(e,c),f=is(e,c),Xe("invalid",e);break;case"option":f=c;break;case"select":e._wrapperState={wasMultiple:!!c.multiple},f=M({},c,{value:void 0}),Xe("invalid",e);break;case"textarea":Nt(e,c),f=ln(e,c),Xe("invalid",e);break;default:f=c}In(s,f),j=f;for(m in j)if(j.hasOwnProperty(m)){var O=j[m];m==="style"?ms(e,O):m==="dangerouslySetInnerHTML"?(O=O?O.__html:void 0,O!=null&&oi(e,O)):m==="children"?typeof O=="string"?(s!=="textarea"||O!=="")&&Rn(e,O):typeof O=="number"&&Rn(e,""+O):m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&m!=="autoFocus"&&(i.hasOwnProperty(m)?O!=null&&m==="onScroll"&&Xe("scroll",e):O!=null&&H(e,m,O,b))}switch(s){case"input":an(e),us(e,c,!1);break;case"textarea":an(e),ds(e);break;case"option":c.value!=null&&e.setAttribute("value",""+Ae(c.value));break;case"select":e.multiple=!!c.multiple,m=c.value,m!=null?Et(e,!!c.multiple,m,!1):c.defaultValue!=null&&Et(e,!!c.multiple,c.defaultValue,!0);break;default:typeof f.onClick=="function"&&(e.onclick=Pi)}switch(s){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}}c&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Vt(t),null;case 6:if(e&&t.stateNode!=null)fh(e,t,e.memoizedProps,c);else{if(typeof c!="string"&&t.stateNode===null)throw Error(r(166));if(s=zs(Aa.current),zs(Zr.current),Fi(t)){if(c=t.stateNode,s=t.memoizedProps,c[Xr]=t,(m=c.nodeValue!==s)&&(e=mr,e!==null))switch(e.tag){case 3:Ii(c.nodeValue,s,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Ii(c.nodeValue,s,(e.mode&1)!==0)}m&&(t.flags|=4)}else c=(s.nodeType===9?s:s.ownerDocument).createTextNode(c),c[Xr]=t,t.stateNode=c}return Vt(t),null;case 13:if(nt(at),c=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(ot&&gr!==null&&(t.mode&1)!==0&&(t.flags&128)===0)pd(),To(),t.flags|=98560,m=!1;else if(m=Fi(t),c!==null&&c.dehydrated!==null){if(e===null){if(!m)throw Error(r(318));if(m=t.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(r(317));m[Xr]=t}else To(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Vt(t),m=!1}else Ur!==null&&(ou(Ur),Ur=null),m=!0;if(!m)return t.flags&65536?t:null}return(t.flags&128)!==0?(t.lanes=s,t):(c=c!==null,c!==(e!==null&&e.memoizedState!==null)&&c&&(t.child.flags|=8192,(t.mode&1)!==0&&(e===null||(at.current&1)!==0?gt===0&&(gt=3):lu())),t.updateQueue!==null&&(t.flags|=4),Vt(t),null);case 4:return Io(),Gc(e,t),e===null&&$s(t.stateNode.containerInfo),Vt(t),null;case 10:return Sc(t.type._context),Vt(t),null;case 17:return sr(t.type)&&Li(),Vt(t),null;case 19:if(nt(at),m=t.memoizedState,m===null)return Vt(t),null;if(c=(t.flags&128)!==0,b=m.rendering,b===null)if(c)Va(m,!1);else{if(gt!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(b=qi(e),b!==null){for(t.flags|=128,Va(m,!1),c=b.updateQueue,c!==null&&(t.updateQueue=c,t.flags|=4),t.subtreeFlags=0,c=s,s=t.child;s!==null;)m=s,e=c,m.flags&=14680066,b=m.alternate,b===null?(m.childLanes=0,m.lanes=e,m.child=null,m.subtreeFlags=0,m.memoizedProps=null,m.memoizedState=null,m.updateQueue=null,m.dependencies=null,m.stateNode=null):(m.childLanes=b.childLanes,m.lanes=b.lanes,m.child=b.child,m.subtreeFlags=0,m.deletions=null,m.memoizedProps=b.memoizedProps,m.memoizedState=b.memoizedState,m.updateQueue=b.updateQueue,m.type=b.type,e=b.dependencies,m.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),s=s.sibling;return Ze(at,at.current&1|2),t.child}e=e.sibling}m.tail!==null&&Be()>Ao&&(t.flags|=128,c=!0,Va(m,!1),t.lanes=4194304)}else{if(!c)if(e=qi(b),e!==null){if(t.flags|=128,c=!0,s=e.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),Va(m,!0),m.tail===null&&m.tailMode==="hidden"&&!b.alternate&&!ot)return Vt(t),null}else 2*Be()-m.renderingStartTime>Ao&&s!==1073741824&&(t.flags|=128,c=!0,Va(m,!1),t.lanes=4194304);m.isBackwards?(b.sibling=t.child,t.child=b):(s=m.last,s!==null?s.sibling=b:t.child=b,m.last=b)}return m.tail!==null?(t=m.tail,m.rendering=t,m.tail=t.sibling,m.renderingStartTime=Be(),t.sibling=null,s=at.current,Ze(at,c?s&1|2:s&1),t):(Vt(t),null);case 22:case 23:return iu(),c=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==c&&(t.flags|=8192),c&&(t.mode&1)!==0?(pr&1073741824)!==0&&(Vt(t),t.subtreeFlags&6&&(t.flags|=8192)):Vt(t),null;case 24:return null;case 25:return null}throw Error(r(156,t.tag))}function Im(e,t){switch(pc(t),t.tag){case 1:return sr(t.type)&&Li(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Io(),nt(nr),nt(Ut),Cc(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 5:return jc(t),null;case 13:if(nt(at),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(r(340));To()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return nt(at),null;case 4:return Io(),null;case 10:return Sc(t.type._context),null;case 22:case 23:return iu(),null;case 24:return null;default:return null}}var tl=!1,Bt=!1,Pm=typeof WeakSet=="function"?WeakSet:Set,we=null;function Do(e,t){var s=e.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(c){ct(e,t,c)}else s.current=null}function Jc(e,t,s){try{s()}catch(c){ct(e,t,c)}}var mh=!1;function Dm(e,t){if(ic=fo,e=Ti(),Ea(e)){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{s=(s=e.ownerDocument)&&s.defaultView||window;var c=s.getSelection&&s.getSelection();if(c&&c.rangeCount!==0){s=c.anchorNode;var f=c.anchorOffset,m=c.focusNode;c=c.focusOffset;try{s.nodeType,m.nodeType}catch{s=null;break e}var b=0,j=-1,O=-1,K=0,se=0,le=e,ne=null;t:for(;;){for(var xe;le!==s||f!==0&&le.nodeType!==3||(j=b+f),le!==m||c!==0&&le.nodeType!==3||(O=b+c),le.nodeType===3&&(b+=le.nodeValue.length),(xe=le.firstChild)!==null;)ne=le,le=xe;for(;;){if(le===e)break t;if(ne===s&&++K===f&&(j=b),ne===m&&++se===c&&(O=b),(xe=le.nextSibling)!==null)break;le=ne,ne=le.parentNode}le=xe}s=j===-1||O===-1?null:{start:j,end:O}}else s=null}s=s||{start:0,end:0}}else s=null;for(lc={focusedElem:e,selectionRange:s},fo=!1,we=t;we!==null;)if(t=we,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,we=e;else for(;we!==null;){t=we;try{var Se=t.alternate;if((t.flags&1024)!==0)switch(t.tag){case 0:case 11:case 15:break;case 1:if(Se!==null){var _e=Se.memoizedProps,ut=Se.memoizedState,z=t.stateNode,A=z.getSnapshotBeforeUpdate(t.elementType===t.type?_e:Fr(t.type,_e),ut);z.__reactInternalSnapshotBeforeUpdate=A}break;case 3:var W=t.stateNode.containerInfo;W.nodeType===1?W.textContent="":W.nodeType===9&&W.documentElement&&W.removeChild(W.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(ce){ct(t,t.return,ce)}if(e=t.sibling,e!==null){e.return=t.return,we=e;break}we=t.return}return Se=mh,mh=!1,Se}function Ba(e,t,s){var c=t.updateQueue;if(c=c!==null?c.lastEffect:null,c!==null){var f=c=c.next;do{if((f.tag&e)===e){var m=f.destroy;f.destroy=void 0,m!==void 0&&Jc(t,s,m)}f=f.next}while(f!==c)}}function rl(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var s=t=t.next;do{if((s.tag&e)===e){var c=s.create;s.destroy=c()}s=s.next}while(s!==t)}}function Qc(e){var t=e.ref;if(t!==null){var s=e.stateNode;switch(e.tag){case 5:e=s;break;default:e=s}typeof t=="function"?t(e):t.current=e}}function gh(e){var t=e.alternate;t!==null&&(e.alternate=null,gh(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Xr],delete t[Oa],delete t[hc],delete t[pm],delete t[vm])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ph(e){return e.tag===5||e.tag===3||e.tag===4}function vh(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||ph(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Yc(e,t,s){var c=e.tag;if(c===5||c===6)e=e.stateNode,t?s.nodeType===8?s.parentNode.insertBefore(e,t):s.insertBefore(e,t):(s.nodeType===8?(t=s.parentNode,t.insertBefore(e,s)):(t=s,t.appendChild(e)),s=s._reactRootContainer,s!=null||t.onclick!==null||(t.onclick=Pi));else if(c!==4&&(e=e.child,e!==null))for(Yc(e,t,s),e=e.sibling;e!==null;)Yc(e,t,s),e=e.sibling}function Xc(e,t,s){var c=e.tag;if(c===5||c===6)e=e.stateNode,t?s.insertBefore(e,t):s.appendChild(e);else if(c!==4&&(e=e.child,e!==null))for(Xc(e,t,s),e=e.sibling;e!==null;)Xc(e,t,s),e=e.sibling}var Ct=null,Vr=!1;function Qn(e,t,s){for(s=s.child;s!==null;)yh(e,t,s),s=s.sibling}function yh(e,t,s){if(_r&&typeof _r.onCommitFiberUnmount=="function")try{_r.onCommitFiberUnmount(ys,s)}catch{}switch(s.tag){case 5:Bt||Do(s,t);case 6:var c=Ct,f=Vr;Ct=null,Qn(e,t,s),Ct=c,Vr=f,Ct!==null&&(Vr?(e=Ct,s=s.stateNode,e.nodeType===8?e.parentNode.removeChild(s):e.removeChild(s)):Ct.removeChild(s.stateNode));break;case 18:Ct!==null&&(Vr?(e=Ct,s=s.stateNode,e.nodeType===8?dc(e.parentNode,s):e.nodeType===1&&dc(e,s),dn(e)):dc(Ct,s.stateNode));break;case 4:c=Ct,f=Vr,Ct=s.stateNode.containerInfo,Vr=!0,Qn(e,t,s),Ct=c,Vr=f;break;case 0:case 11:case 14:case 15:if(!Bt&&(c=s.updateQueue,c!==null&&(c=c.lastEffect,c!==null))){f=c=c.next;do{var m=f,b=m.destroy;m=m.tag,b!==void 0&&((m&2)!==0||(m&4)!==0)&&Jc(s,t,b),f=f.next}while(f!==c)}Qn(e,t,s);break;case 1:if(!Bt&&(Do(s,t),c=s.stateNode,typeof c.componentWillUnmount=="function"))try{c.props=s.memoizedProps,c.state=s.memoizedState,c.componentWillUnmount()}catch(j){ct(s,t,j)}Qn(e,t,s);break;case 21:Qn(e,t,s);break;case 22:s.mode&1?(Bt=(c=Bt)||s.memoizedState!==null,Qn(e,t,s),Bt=c):Qn(e,t,s);break;default:Qn(e,t,s)}}function xh(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var s=e.stateNode;s===null&&(s=e.stateNode=new Pm),t.forEach(function(c){var f=zm.bind(null,e,c);s.has(c)||(s.add(c),c.then(f,f))})}}function Br(e,t){var s=t.deletions;if(s!==null)for(var c=0;c<s.length;c++){var f=s[c];try{var m=e,b=t,j=b;e:for(;j!==null;){switch(j.tag){case 5:Ct=j.stateNode,Vr=!1;break e;case 3:Ct=j.stateNode.containerInfo,Vr=!0;break e;case 4:Ct=j.stateNode.containerInfo,Vr=!0;break e}j=j.return}if(Ct===null)throw Error(r(160));yh(m,b,f),Ct=null,Vr=!1;var O=f.alternate;O!==null&&(O.return=null),f.return=null}catch(K){ct(f,t,K)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)bh(t,e),t=t.sibling}function bh(e,t){var s=e.alternate,c=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Br(t,e),tn(e),c&4){try{Ba(3,e,e.return),rl(3,e)}catch(_e){ct(e,e.return,_e)}try{Ba(5,e,e.return)}catch(_e){ct(e,e.return,_e)}}break;case 1:Br(t,e),tn(e),c&512&&s!==null&&Do(s,s.return);break;case 5:if(Br(t,e),tn(e),c&512&&s!==null&&Do(s,s.return),e.flags&32){var f=e.stateNode;try{Rn(f,"")}catch(_e){ct(e,e.return,_e)}}if(c&4&&(f=e.stateNode,f!=null)){var m=e.memoizedProps,b=s!==null?s.memoizedProps:m,j=e.type,O=e.updateQueue;if(e.updateQueue=null,O!==null)try{j==="input"&&m.type==="radio"&&m.name!=null&&cs(f,m),jt(j,b);var K=jt(j,m);for(b=0;b<O.length;b+=2){var se=O[b],le=O[b+1];se==="style"?ms(f,le):se==="dangerouslySetInnerHTML"?oi(f,le):se==="children"?Rn(f,le):H(f,se,le,K)}switch(j){case"input":Jt(f,m);break;case"textarea":yr(f,m);break;case"select":var ne=f._wrapperState.wasMultiple;f._wrapperState.wasMultiple=!!m.multiple;var xe=m.value;xe!=null?Et(f,!!m.multiple,xe,!1):ne!==!!m.multiple&&(m.defaultValue!=null?Et(f,!!m.multiple,m.defaultValue,!0):Et(f,!!m.multiple,m.multiple?[]:"",!1))}f[Oa]=m}catch(_e){ct(e,e.return,_e)}}break;case 6:if(Br(t,e),tn(e),c&4){if(e.stateNode===null)throw Error(r(162));f=e.stateNode,m=e.memoizedProps;try{f.nodeValue=m}catch(_e){ct(e,e.return,_e)}}break;case 3:if(Br(t,e),tn(e),c&4&&s!==null&&s.memoizedState.isDehydrated)try{dn(t.containerInfo)}catch(_e){ct(e,e.return,_e)}break;case 4:Br(t,e),tn(e);break;case 13:Br(t,e),tn(e),f=e.child,f.flags&8192&&(m=f.memoizedState!==null,f.stateNode.isHidden=m,!m||f.alternate!==null&&f.alternate.memoizedState!==null||(tu=Be())),c&4&&xh(e);break;case 22:if(se=s!==null&&s.memoizedState!==null,e.mode&1?(Bt=(K=Bt)||se,Br(t,e),Bt=K):Br(t,e),tn(e),c&8192){if(K=e.memoizedState!==null,(e.stateNode.isHidden=K)&&!se&&(e.mode&1)!==0)for(we=e,se=e.child;se!==null;){for(le=we=se;we!==null;){switch(ne=we,xe=ne.child,ne.tag){case 0:case 11:case 14:case 15:Ba(4,ne,ne.return);break;case 1:Do(ne,ne.return);var Se=ne.stateNode;if(typeof Se.componentWillUnmount=="function"){c=ne,s=ne.return;try{t=c,Se.props=t.memoizedProps,Se.state=t.memoizedState,Se.componentWillUnmount()}catch(_e){ct(c,s,_e)}}break;case 5:Do(ne,ne.return);break;case 22:if(ne.memoizedState!==null){_h(le);continue}}xe!==null?(xe.return=ne,we=xe):_h(le)}se=se.sibling}e:for(se=null,le=e;;){if(le.tag===5){if(se===null){se=le;try{f=le.stateNode,K?(m=f.style,typeof m.setProperty=="function"?m.setProperty("display","none","important"):m.display="none"):(j=le.stateNode,O=le.memoizedProps.style,b=O!=null&&O.hasOwnProperty("display")?O.display:null,j.style.display=fs("display",b))}catch(_e){ct(e,e.return,_e)}}}else if(le.tag===6){if(se===null)try{le.stateNode.nodeValue=K?"":le.memoizedProps}catch(_e){ct(e,e.return,_e)}}else if((le.tag!==22&&le.tag!==23||le.memoizedState===null||le===e)&&le.child!==null){le.child.return=le,le=le.child;continue}if(le===e)break e;for(;le.sibling===null;){if(le.return===null||le.return===e)break e;se===le&&(se=null),le=le.return}se===le&&(se=null),le.sibling.return=le.return,le=le.sibling}}break;case 19:Br(t,e),tn(e),c&4&&xh(e);break;case 21:break;default:Br(t,e),tn(e)}}function tn(e){var t=e.flags;if(t&2){try{e:{for(var s=e.return;s!==null;){if(ph(s)){var c=s;break e}s=s.return}throw Error(r(160))}switch(c.tag){case 5:var f=c.stateNode;c.flags&32&&(Rn(f,""),c.flags&=-33);var m=vh(e);Xc(e,m,f);break;case 3:case 4:var b=c.stateNode.containerInfo,j=vh(e);Yc(e,j,b);break;default:throw Error(r(161))}}catch(O){ct(e,e.return,O)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Lm(e,t,s){we=e,wh(e)}function wh(e,t,s){for(var c=(e.mode&1)!==0;we!==null;){var f=we,m=f.child;if(f.tag===22&&c){var b=f.memoizedState!==null||tl;if(!b){var j=f.alternate,O=j!==null&&j.memoizedState!==null||Bt;j=tl;var K=Bt;if(tl=b,(Bt=O)&&!K)for(we=f;we!==null;)b=we,O=b.child,b.tag===22&&b.memoizedState!==null?kh(f):O!==null?(O.return=b,we=O):kh(f);for(;m!==null;)we=m,wh(m),m=m.sibling;we=f,tl=j,Bt=K}Sh(e)}else(f.subtreeFlags&8772)!==0&&m!==null?(m.return=f,we=m):Sh(e)}}function Sh(e){for(;we!==null;){var t=we;if((t.flags&8772)!==0){var s=t.alternate;try{if((t.flags&8772)!==0)switch(t.tag){case 0:case 11:case 15:Bt||rl(5,t);break;case 1:var c=t.stateNode;if(t.flags&4&&!Bt)if(s===null)c.componentDidMount();else{var f=t.elementType===t.type?s.memoizedProps:Fr(t.type,s.memoizedProps);c.componentDidUpdate(f,s.memoizedState,c.__reactInternalSnapshotBeforeUpdate)}var m=t.updateQueue;m!==null&&_d(t,m,c);break;case 3:var b=t.updateQueue;if(b!==null){if(s=null,t.child!==null)switch(t.child.tag){case 5:s=t.child.stateNode;break;case 1:s=t.child.stateNode}_d(t,b,s)}break;case 5:var j=t.stateNode;if(s===null&&t.flags&4){s=j;var O=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":O.autoFocus&&s.focus();break;case"img":O.src&&(s.src=O.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var K=t.alternate;if(K!==null){var se=K.memoizedState;if(se!==null){var le=se.dehydrated;le!==null&&dn(le)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}Bt||t.flags&512&&Qc(t)}catch(ne){ct(t,t.return,ne)}}if(t===e){we=null;break}if(s=t.sibling,s!==null){s.return=t.return,we=s;break}we=t.return}}function _h(e){for(;we!==null;){var t=we;if(t===e){we=null;break}var s=t.sibling;if(s!==null){s.return=t.return,we=s;break}we=t.return}}function kh(e){for(;we!==null;){var t=we;try{switch(t.tag){case 0:case 11:case 15:var s=t.return;try{rl(4,t)}catch(O){ct(t,s,O)}break;case 1:var c=t.stateNode;if(typeof c.componentDidMount=="function"){var f=t.return;try{c.componentDidMount()}catch(O){ct(t,f,O)}}var m=t.return;try{Qc(t)}catch(O){ct(t,m,O)}break;case 5:var b=t.return;try{Qc(t)}catch(O){ct(t,b,O)}}}catch(O){ct(t,t.return,O)}if(t===e){we=null;break}var j=t.sibling;if(j!==null){j.return=t.return,we=j;break}we=t.return}}var Am=Math.ceil,nl=q.ReactCurrentDispatcher,Zc=q.ReactCurrentOwner,Tr=q.ReactCurrentBatchConfig,ze=0,wt=null,dt=null,Rt=0,pr=0,Lo=Hn(0),gt=0,za=null,Hs=0,sl=0,eu=0,Wa=null,ar=null,tu=0,Ao=1/0,_n=null,ol=!1,ru=null,Yn=null,al=!1,Xn=null,il=0,Ha=0,nu=null,ll=-1,cl=0;function Kt(){return(ze&6)!==0?Be():ll!==-1?ll:ll=Be()}function Zn(e){return(e.mode&1)===0?1:(ze&2)!==0&&Rt!==0?Rt&-Rt:xm.transition!==null?(cl===0&&(cl=ca()),cl):(e=ve,e!==0||(e=window.event,e=e===void 0?16:js(e.type)),e)}function zr(e,t,s,c){if(50<Ha)throw Ha=0,nu=null,Error(r(185));ws(e,s,c),((ze&2)===0||e!==wt)&&(e===wt&&((ze&2)===0&&(sl|=s),gt===4&&es(e,Rt)),ir(e,c),s===1&&ze===0&&(t.mode&1)===0&&(Ao=Be()+500,$i&&Kn()))}function ir(e,t){var s=e.callbackNode;ho(e,t);var c=Dn(e,e===wt?Rt:0);if(c===0)s!==null&&Gr(s),e.callbackNode=null,e.callbackPriority=0;else if(t=c&-c,e.callbackPriority!==t){if(s!=null&&Gr(s),t===1)e.tag===0?ym(Nh.bind(null,e)):dd(Nh.bind(null,e)),mm(function(){(ze&6)===0&&Kn()}),s=null;else{switch(It(c)){case 1:s=oa;break;case 4:s=vs;break;case 16:s=Sr;break;case 536870912:s=aa;break;default:s=Sr}s=Dh(s,Eh.bind(null,e))}e.callbackPriority=t,e.callbackNode=s}}function Eh(e,t){if(ll=-1,cl=0,(ze&6)!==0)throw Error(r(327));var s=e.callbackNode;if($o()&&e.callbackNode!==s)return null;var c=Dn(e,e===wt?Rt:0);if(c===0)return null;if((c&30)!==0||(c&e.expiredLanes)!==0||t)t=ul(e,c);else{t=c;var f=ze;ze|=2;var m=Th();(wt!==e||Rt!==t)&&(_n=null,Ao=Be()+500,Ks(e,t));do try{Um();break}catch(j){jh(e,j)}while(!0);wc(),nl.current=m,ze=f,dt!==null?t=0:(wt=null,Rt=0,t=gt)}if(t!==0){if(t===2&&(f=Wt(e),f!==0&&(c=f,t=su(e,f))),t===1)throw s=za,Ks(e,0),es(e,c),ir(e,Be()),s;if(t===6)es(e,c);else{if(f=e.current.alternate,(c&30)===0&&!$m(f)&&(t=ul(e,c),t===2&&(m=Wt(e),m!==0&&(c=m,t=su(e,m))),t===1))throw s=za,Ks(e,0),es(e,c),ir(e,Be()),s;switch(e.finishedWork=f,e.finishedLanes=c,t){case 0:case 1:throw Error(r(345));case 2:Gs(e,ar,_n);break;case 3:if(es(e,c),(c&130023424)===c&&(t=tu+500-Be(),10<t)){if(Dn(e,0)!==0)break;if(f=e.suspendedLanes,(f&c)!==c){Kt(),e.pingedLanes|=e.suspendedLanes&f;break}e.timeoutHandle=uc(Gs.bind(null,e,ar,_n),t);break}Gs(e,ar,_n);break;case 4:if(es(e,c),(c&4194240)===c)break;for(t=e.eventTimes,f=-1;0<c;){var b=31-dr(c);m=1<<b,b=t[b],b>f&&(f=b),c&=~m}if(c=f,c=Be()-c,c=(120>c?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*Am(c/1960))-c,10<c){e.timeoutHandle=uc(Gs.bind(null,e,ar,_n),c);break}Gs(e,ar,_n);break;case 5:Gs(e,ar,_n);break;default:throw Error(r(329))}}}return ir(e,Be()),e.callbackNode===s?Eh.bind(null,e):null}function su(e,t){var s=Wa;return e.current.memoizedState.isDehydrated&&(Ks(e,t).flags|=256),e=ul(e,t),e!==2&&(t=ar,ar=s,t!==null&&ou(t)),e}function ou(e){ar===null?ar=e:ar.push.apply(ar,e)}function $m(e){for(var t=e;;){if(t.flags&16384){var s=t.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var c=0;c<s.length;c++){var f=s[c],m=f.getSnapshot;f=f.value;try{if(!er(m(),f))return!1}catch{return!1}}}if(s=t.child,t.subtreeFlags&16384&&s!==null)s.return=t,t=s;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function es(e,t){for(t&=~eu,t&=~sl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var s=31-dr(t),c=1<<s;e[s]=-1,t&=~c}}function Nh(e){if((ze&6)!==0)throw Error(r(327));$o();var t=Dn(e,0);if((t&1)===0)return ir(e,Be()),null;var s=ul(e,t);if(e.tag!==0&&s===2){var c=Wt(e);c!==0&&(t=c,s=su(e,c))}if(s===1)throw s=za,Ks(e,0),es(e,t),ir(e,Be()),s;if(s===6)throw Error(r(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Gs(e,ar,_n),ir(e,Be()),null}function au(e,t){var s=ze;ze|=1;try{return e(t)}finally{ze=s,ze===0&&(Ao=Be()+500,$i&&Kn())}}function qs(e){Xn!==null&&Xn.tag===0&&(ze&6)===0&&$o();var t=ze;ze|=1;var s=Tr.transition,c=ve;try{if(Tr.transition=null,ve=1,e)return e()}finally{ve=c,Tr.transition=s,ze=t,(ze&6)===0&&Kn()}}function iu(){pr=Lo.current,nt(Lo)}function Ks(e,t){e.finishedWork=null,e.finishedLanes=0;var s=e.timeoutHandle;if(s!==-1&&(e.timeoutHandle=-1,fm(s)),dt!==null)for(s=dt.return;s!==null;){var c=s;switch(pc(c),c.tag){case 1:c=c.type.childContextTypes,c!=null&&Li();break;case 3:Io(),nt(nr),nt(Ut),Cc();break;case 5:jc(c);break;case 4:Io();break;case 13:nt(at);break;case 19:nt(at);break;case 10:Sc(c.type._context);break;case 22:case 23:iu()}s=s.return}if(wt=e,dt=e=ts(e.current,null),Rt=pr=t,gt=0,za=null,eu=sl=Hs=0,ar=Wa=null,Bs!==null){for(t=0;t<Bs.length;t++)if(s=Bs[t],c=s.interleaved,c!==null){s.interleaved=null;var f=c.next,m=s.pending;if(m!==null){var b=m.next;m.next=f,c.next=b}s.pending=c}Bs=null}return e}function jh(e,t){do{var s=dt;try{if(wc(),Ki.current=Yi,Gi){for(var c=it.memoizedState;c!==null;){var f=c.queue;f!==null&&(f.pending=null),c=c.next}Gi=!1}if(Ws=0,bt=mt=it=null,$a=!1,Ma=0,Zc.current=null,s===null||s.return===null){gt=1,za=t,dt=null;break}e:{var m=e,b=s.return,j=s,O=t;if(t=Rt,j.flags|=32768,O!==null&&typeof O=="object"&&typeof O.then=="function"){var K=O,se=j,le=se.tag;if((se.mode&1)===0&&(le===0||le===11||le===15)){var ne=se.alternate;ne?(se.updateQueue=ne.updateQueue,se.memoizedState=ne.memoizedState,se.lanes=ne.lanes):(se.updateQueue=null,se.memoizedState=null)}var xe=Xd(b);if(xe!==null){xe.flags&=-257,Zd(xe,b,j,m,t),xe.mode&1&&Yd(m,K,t),t=xe,O=K;var Se=t.updateQueue;if(Se===null){var _e=new Set;_e.add(O),t.updateQueue=_e}else Se.add(O);break e}else{if((t&1)===0){Yd(m,K,t),lu();break e}O=Error(r(426))}}else if(ot&&j.mode&1){var ut=Xd(b);if(ut!==null){(ut.flags&65536)===0&&(ut.flags|=256),Zd(ut,b,j,m,t),xc(Po(O,j));break e}}m=O=Po(O,j),gt!==4&&(gt=2),Wa===null?Wa=[m]:Wa.push(m),m=b;do{switch(m.tag){case 3:m.flags|=65536,t&=-t,m.lanes|=t;var z=Jd(m,O,t);Sd(m,z);break e;case 1:j=O;var A=m.type,W=m.stateNode;if((m.flags&128)===0&&(typeof A.getDerivedStateFromError=="function"||W!==null&&typeof W.componentDidCatch=="function"&&(Yn===null||!Yn.has(W)))){m.flags|=65536,t&=-t,m.lanes|=t;var ce=Qd(m,j,t);Sd(m,ce);break e}}m=m.return}while(m!==null)}Rh(s)}catch(Ne){t=Ne,dt===s&&s!==null&&(dt=s=s.return);continue}break}while(!0)}function Th(){var e=nl.current;return nl.current=Yi,e===null?Yi:e}function lu(){(gt===0||gt===3||gt===2)&&(gt=4),wt===null||(Hs&268435455)===0&&(sl&268435455)===0||es(wt,Rt)}function ul(e,t){var s=ze;ze|=2;var c=Th();(wt!==e||Rt!==t)&&(_n=null,Ks(e,t));do try{Mm();break}catch(f){jh(e,f)}while(!0);if(wc(),ze=s,nl.current=c,dt!==null)throw Error(r(261));return wt=null,Rt=0,gt}function Mm(){for(;dt!==null;)Ch(dt)}function Um(){for(;dt!==null&&!li();)Ch(dt)}function Ch(e){var t=Ph(e.alternate,e,pr);e.memoizedProps=e.pendingProps,t===null?Rh(e):dt=t,Zc.current=null}function Rh(e){var t=e;do{var s=t.alternate;if(e=t.return,(t.flags&32768)===0){if(s=Om(s,t,pr),s!==null){dt=s;return}}else{if(s=Im(s,t),s!==null){s.flags&=32767,dt=s;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{gt=6,dt=null;return}}if(t=t.sibling,t!==null){dt=t;return}dt=t=e}while(t!==null);gt===0&&(gt=5)}function Gs(e,t,s){var c=ve,f=Tr.transition;try{Tr.transition=null,ve=1,Fm(e,t,s,c)}finally{Tr.transition=f,ve=c}return null}function Fm(e,t,s,c){do $o();while(Xn!==null);if((ze&6)!==0)throw Error(r(327));s=e.finishedWork;var f=e.finishedLanes;if(s===null)return null;if(e.finishedWork=null,e.finishedLanes=0,s===e.current)throw Error(r(177));e.callbackNode=null,e.callbackPriority=0;var m=s.lanes|s.childLanes;if(ua(e,m),e===wt&&(dt=wt=null,Rt=0),(s.subtreeFlags&2064)===0&&(s.flags&2064)===0||al||(al=!0,Dh(Sr,function(){return $o(),null})),m=(s.flags&15990)!==0,(s.subtreeFlags&15990)!==0||m){m=Tr.transition,Tr.transition=null;var b=ve;ve=1;var j=ze;ze|=4,Zc.current=null,Dm(e,s),bh(s,e),oc(lc),fo=!!ic,lc=ic=null,e.current=s,Lm(s),Ir(),ze=j,ve=b,Tr.transition=m}else e.current=s;if(al&&(al=!1,Xn=e,il=f),m=e.pendingLanes,m===0&&(Yn=null),ia(s.stateNode),ir(e,Be()),t!==null)for(c=e.onRecoverableError,s=0;s<t.length;s++)f=t[s],c(f.value,{componentStack:f.stack,digest:f.digest});if(ol)throw ol=!1,e=ru,ru=null,e;return(il&1)!==0&&e.tag!==0&&$o(),m=e.pendingLanes,(m&1)!==0?e===nu?Ha++:(Ha=0,nu=e):Ha=0,Kn(),null}function $o(){if(Xn!==null){var e=It(il),t=Tr.transition,s=ve;try{if(Tr.transition=null,ve=16>e?16:e,Xn===null)var c=!1;else{if(e=Xn,Xn=null,il=0,(ze&6)!==0)throw Error(r(331));var f=ze;for(ze|=4,we=e.current;we!==null;){var m=we,b=m.child;if((we.flags&16)!==0){var j=m.deletions;if(j!==null){for(var O=0;O<j.length;O++){var K=j[O];for(we=K;we!==null;){var se=we;switch(se.tag){case 0:case 11:case 15:Ba(8,se,m)}var le=se.child;if(le!==null)le.return=se,we=le;else for(;we!==null;){se=we;var ne=se.sibling,xe=se.return;if(gh(se),se===K){we=null;break}if(ne!==null){ne.return=xe,we=ne;break}we=xe}}}var Se=m.alternate;if(Se!==null){var _e=Se.child;if(_e!==null){Se.child=null;do{var ut=_e.sibling;_e.sibling=null,_e=ut}while(_e!==null)}}we=m}}if((m.subtreeFlags&2064)!==0&&b!==null)b.return=m,we=b;else e:for(;we!==null;){if(m=we,(m.flags&2048)!==0)switch(m.tag){case 0:case 11:case 15:Ba(9,m,m.return)}var z=m.sibling;if(z!==null){z.return=m.return,we=z;break e}we=m.return}}var A=e.current;for(we=A;we!==null;){b=we;var W=b.child;if((b.subtreeFlags&2064)!==0&&W!==null)W.return=b,we=W;else e:for(b=A;we!==null;){if(j=we,(j.flags&2048)!==0)try{switch(j.tag){case 0:case 11:case 15:rl(9,j)}}catch(Ne){ct(j,j.return,Ne)}if(j===b){we=null;break e}var ce=j.sibling;if(ce!==null){ce.return=j.return,we=ce;break e}we=j.return}}if(ze=f,Kn(),_r&&typeof _r.onPostCommitFiberRoot=="function")try{_r.onPostCommitFiberRoot(ys,e)}catch{}c=!0}return c}finally{ve=s,Tr.transition=t}}return!1}function Oh(e,t,s){t=Po(s,t),t=Jd(e,t,1),e=Jn(e,t,1),t=Kt(),e!==null&&(ws(e,1,t),ir(e,t))}function ct(e,t,s){if(e.tag===3)Oh(e,e,s);else for(;t!==null;){if(t.tag===3){Oh(t,e,s);break}else if(t.tag===1){var c=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(Yn===null||!Yn.has(c))){e=Po(s,e),e=Qd(t,e,1),t=Jn(t,e,1),e=Kt(),t!==null&&(ws(t,1,e),ir(t,e));break}}t=t.return}}function Vm(e,t,s){var c=e.pingCache;c!==null&&c.delete(t),t=Kt(),e.pingedLanes|=e.suspendedLanes&s,wt===e&&(Rt&s)===s&&(gt===4||gt===3&&(Rt&130023424)===Rt&&500>Be()-tu?Ks(e,0):eu|=s),ir(e,t)}function Ih(e,t){t===0&&((e.mode&1)===0?t=1:(t=bs,bs<<=1,(bs&130023424)===0&&(bs=4194304)));var s=Kt();e=bn(e,t),e!==null&&(ws(e,t,s),ir(e,s))}function Bm(e){var t=e.memoizedState,s=0;t!==null&&(s=t.retryLane),Ih(e,s)}function zm(e,t){var s=0;switch(e.tag){case 13:var c=e.stateNode,f=e.memoizedState;f!==null&&(s=f.retryLane);break;case 19:c=e.stateNode;break;default:throw Error(r(314))}c!==null&&c.delete(t),Ih(e,s)}var Ph;Ph=function(e,t,s){if(e!==null)if(e.memoizedProps!==t.pendingProps||nr.current)or=!0;else{if((e.lanes&s)===0&&(t.flags&128)===0)return or=!1,Rm(e,t,s);or=(e.flags&131072)!==0}else or=!1,ot&&(t.flags&1048576)!==0&&hd(t,Ui,t.index);switch(t.lanes=0,t.tag){case 2:var c=t.type;el(e,t),e=t.pendingProps;var f=Eo(t,Ut.current);Oo(t,s),f=Ic(null,t,c,e,f,s);var m=Pc();return t.flags|=1,typeof f=="object"&&f!==null&&typeof f.render=="function"&&f.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,sr(c)?(m=!0,Ai(t)):m=!1,t.memoizedState=f.state!==null&&f.state!==void 0?f.state:null,Ec(t),f.updater=Xi,t.stateNode=f,f._reactInternals=t,Uc(t,c,e,s),t=zc(null,t,c,!0,m,s)):(t.tag=0,ot&&m&&gc(t),qt(null,t,f,s),t=t.child),t;case 16:c=t.elementType;e:{switch(el(e,t),e=t.pendingProps,f=c._init,c=f(c._payload),t.type=c,f=t.tag=Hm(c),e=Fr(c,e),f){case 0:t=Bc(null,t,c,e,s);break e;case 1:t=oh(null,t,c,e,s);break e;case 11:t=eh(null,t,c,e,s);break e;case 14:t=th(null,t,c,Fr(c.type,e),s);break e}throw Error(r(306,c,""))}return t;case 0:return c=t.type,f=t.pendingProps,f=t.elementType===c?f:Fr(c,f),Bc(e,t,c,f,s);case 1:return c=t.type,f=t.pendingProps,f=t.elementType===c?f:Fr(c,f),oh(e,t,c,f,s);case 3:e:{if(ah(t),e===null)throw Error(r(387));c=t.pendingProps,m=t.memoizedState,f=m.element,wd(e,t),Hi(t,c,null,s);var b=t.memoizedState;if(c=b.element,m.isDehydrated)if(m={element:c,isDehydrated:!1,cache:b.cache,pendingSuspenseBoundaries:b.pendingSuspenseBoundaries,transitions:b.transitions},t.updateQueue.baseState=m,t.memoizedState=m,t.flags&256){f=Po(Error(r(423)),t),t=ih(e,t,c,s,f);break e}else if(c!==f){f=Po(Error(r(424)),t),t=ih(e,t,c,s,f);break e}else for(gr=Wn(t.stateNode.containerInfo.firstChild),mr=t,ot=!0,Ur=null,s=xd(t,null,c,s),t.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(To(),c===f){t=Sn(e,t,s);break e}qt(e,t,c,s)}t=t.child}return t;case 5:return kd(t),e===null&&yc(t),c=t.type,f=t.pendingProps,m=e!==null?e.memoizedProps:null,b=f.children,cc(c,f)?b=null:m!==null&&cc(c,m)&&(t.flags|=32),sh(e,t),qt(e,t,b,s),t.child;case 6:return e===null&&yc(t),null;case 13:return lh(e,t,s);case 4:return Nc(t,t.stateNode.containerInfo),c=t.pendingProps,e===null?t.child=Co(t,null,c,s):qt(e,t,c,s),t.child;case 11:return c=t.type,f=t.pendingProps,f=t.elementType===c?f:Fr(c,f),eh(e,t,c,f,s);case 7:return qt(e,t,t.pendingProps,s),t.child;case 8:return qt(e,t,t.pendingProps.children,s),t.child;case 12:return qt(e,t,t.pendingProps.children,s),t.child;case 10:e:{if(c=t.type._context,f=t.pendingProps,m=t.memoizedProps,b=f.value,Ze(Bi,c._currentValue),c._currentValue=b,m!==null)if(er(m.value,b)){if(m.children===f.children&&!nr.current){t=Sn(e,t,s);break e}}else for(m=t.child,m!==null&&(m.return=t);m!==null;){var j=m.dependencies;if(j!==null){b=m.child;for(var O=j.firstContext;O!==null;){if(O.context===c){if(m.tag===1){O=wn(-1,s&-s),O.tag=2;var K=m.updateQueue;if(K!==null){K=K.shared;var se=K.pending;se===null?O.next=O:(O.next=se.next,se.next=O),K.pending=O}}m.lanes|=s,O=m.alternate,O!==null&&(O.lanes|=s),_c(m.return,s,t),j.lanes|=s;break}O=O.next}}else if(m.tag===10)b=m.type===t.type?null:m.child;else if(m.tag===18){if(b=m.return,b===null)throw Error(r(341));b.lanes|=s,j=b.alternate,j!==null&&(j.lanes|=s),_c(b,s,t),b=m.sibling}else b=m.child;if(b!==null)b.return=m;else for(b=m;b!==null;){if(b===t){b=null;break}if(m=b.sibling,m!==null){m.return=b.return,b=m;break}b=b.return}m=b}qt(e,t,f.children,s),t=t.child}return t;case 9:return f=t.type,c=t.pendingProps.children,Oo(t,s),f=Nr(f),c=c(f),t.flags|=1,qt(e,t,c,s),t.child;case 14:return c=t.type,f=Fr(c,t.pendingProps),f=Fr(c.type,f),th(e,t,c,f,s);case 15:return rh(e,t,t.type,t.pendingProps,s);case 17:return c=t.type,f=t.pendingProps,f=t.elementType===c?f:Fr(c,f),el(e,t),t.tag=1,sr(c)?(e=!0,Ai(t)):e=!1,Oo(t,s),Kd(t,c,f),Uc(t,c,f,s),zc(null,t,c,!0,e,s);case 19:return uh(e,t,s);case 22:return nh(e,t,s)}throw Error(r(156,t.tag))};function Dh(e,t){return Ml(e,t)}function Wm(e,t,s,c){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Cr(e,t,s,c){return new Wm(e,t,s,c)}function cu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Hm(e){if(typeof e=="function")return cu(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Ee)return 11;if(e===pe)return 14}return 2}function ts(e,t){var s=e.alternate;return s===null?(s=Cr(e.tag,t,e.key,e.mode),s.elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=t,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=e.flags&14680064,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,t=e.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s}function dl(e,t,s,c,f,m){var b=2;if(c=e,typeof e=="function")cu(e)&&(b=1);else if(typeof e=="string")b=5;else e:switch(e){case V:return Js(s.children,f,m,t);case te:b=8,f|=8;break;case C:return e=Cr(12,s,t,f|2),e.elementType=C,e.lanes=m,e;case fe:return e=Cr(13,s,t,f),e.elementType=fe,e.lanes=m,e;case me:return e=Cr(19,s,t,f),e.elementType=me,e.lanes=m,e;case ee:return hl(s,f,m,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case re:b=10;break e;case ue:b=9;break e;case Ee:b=11;break e;case pe:b=14;break e;case $e:b=16,c=null;break e}throw Error(r(130,e==null?e:typeof e,""))}return t=Cr(b,s,t,f),t.elementType=e,t.type=c,t.lanes=m,t}function Js(e,t,s,c){return e=Cr(7,e,c,t),e.lanes=s,e}function hl(e,t,s,c){return e=Cr(22,e,c,t),e.elementType=ee,e.lanes=s,e.stateNode={isHidden:!1},e}function uu(e,t,s){return e=Cr(6,e,null,t),e.lanes=s,e}function du(e,t,s){return t=Cr(4,e.children!==null?e.children:[],e.key,t),t.lanes=s,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function qm(e,t,s,c,f){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Pr(0),this.expirationTimes=Pr(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Pr(0),this.identifierPrefix=c,this.onRecoverableError=f,this.mutableSourceEagerHydrationData=null}function hu(e,t,s,c,f,m,b,j,O){return e=new qm(e,t,s,j,O),t===1?(t=1,m===!0&&(t|=8)):t=0,m=Cr(3,null,null,t),e.current=m,m.stateNode=e,m.memoizedState={element:c,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ec(m),e}function Km(e,t,s){var c=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:P,key:c==null?null:""+c,children:e,containerInfo:t,implementation:s}}function Lh(e){if(!e)return qn;e=e._reactInternals;e:{if(Xt(e)!==e||e.tag!==1)throw Error(r(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(sr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(r(171))}if(e.tag===1){var s=e.type;if(sr(s))return cd(e,s,t)}return t}function Ah(e,t,s,c,f,m,b,j,O){return e=hu(s,c,!0,e,f,m,b,j,O),e.context=Lh(null),s=e.current,c=Kt(),f=Zn(s),m=wn(c,f),m.callback=t??null,Jn(s,m,f),e.current.lanes=f,ws(e,f,c),ir(e,c),e}function fl(e,t,s,c){var f=t.current,m=Kt(),b=Zn(f);return s=Lh(s),t.context===null?t.context=s:t.pendingContext=s,t=wn(m,b),t.payload={element:e},c=c===void 0?null:c,c!==null&&(t.callback=c),e=Jn(f,t,b),e!==null&&(zr(e,f,b,m),Wi(e,f,b)),b}function ml(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function $h(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var s=e.retryLane;e.retryLane=s!==0&&s<t?s:t}}function fu(e,t){$h(e,t),(e=e.alternate)&&$h(e,t)}function Gm(){return null}var Mh=typeof reportError=="function"?reportError:function(e){console.error(e)};function mu(e){this._internalRoot=e}gl.prototype.render=mu.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(r(409));fl(e,t,null,null)},gl.prototype.unmount=mu.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;qs(function(){fl(null,e,null,null)}),t[pn]=null}};function gl(e){this._internalRoot=e}gl.prototype.unstable_scheduleHydration=function(e){if(e){var t=ui();e={blockedOn:null,target:e,priority:t};for(var s=0;s<Ht.length&&t!==0&&t<Ht[s].priority;s++);Ht.splice(s,0,e),s===0&&un(e)}};function gu(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function pl(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Uh(){}function Jm(e,t,s,c,f){if(f){if(typeof c=="function"){var m=c;c=function(){var K=ml(b);m.call(K)}}var b=Ah(t,c,e,0,null,!1,!1,"",Uh);return e._reactRootContainer=b,e[pn]=b.current,$s(e.nodeType===8?e.parentNode:e),qs(),b}for(;f=e.lastChild;)e.removeChild(f);if(typeof c=="function"){var j=c;c=function(){var K=ml(O);j.call(K)}}var O=hu(e,0,!1,null,null,!1,!1,"",Uh);return e._reactRootContainer=O,e[pn]=O.current,$s(e.nodeType===8?e.parentNode:e),qs(function(){fl(t,O,s,c)}),O}function vl(e,t,s,c,f){var m=s._reactRootContainer;if(m){var b=m;if(typeof f=="function"){var j=f;f=function(){var O=ml(b);j.call(O)}}fl(t,b,e,f)}else b=Jm(s,t,e,f,c);return ml(b)}Ss=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var s=uo(t.pendingLanes);s!==0&&(da(t,s|1),ir(t,Be()),(ze&6)===0&&(Ao=Be()+500,Kn()))}break;case 13:qs(function(){var c=bn(e,1);if(c!==null){var f=Kt();zr(c,e,1,f)}}),fu(e,1)}},_s=function(e){if(e.tag===13){var t=bn(e,134217728);if(t!==null){var s=Kt();zr(t,e,134217728,s)}fu(e,134217728)}},Ue=function(e){if(e.tag===13){var t=Zn(e),s=bn(e,t);if(s!==null){var c=Kt();zr(s,e,t,c)}fu(e,t)}},ui=function(){return ve},ks=function(e,t){var s=ve;try{return ve=e,t()}finally{ve=s}},cr=function(e,t,s){switch(t){case"input":if(Jt(e,s),t=s.name,s.type==="radio"&&t!=null){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<s.length;t++){var c=s[t];if(c!==e&&c.form===e.form){var f=Di(c);if(!f)throw Error(r(90));ra(c),Jt(c,f)}}}break;case"textarea":yr(e,s);break;case"select":t=s.value,t!=null&&Et(e,!!s.multiple,t,!1)}},br=au,st=qs;var Qm={usingClientEntryPoint:!1,Events:[Ia,_o,Di,ur,na,au]},qa={findFiberByHostInstance:Ms,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ym={bundleType:qa.bundleType,version:qa.version,rendererPackageName:qa.rendererPackageName,rendererConfig:qa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:q.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Al(e),e===null?null:e.stateNode},findFiberByHostInstance:qa.findFiberByHostInstance||Gm,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var yl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yl.isDisabled&&yl.supportsFiber)try{ys=yl.inject(Ym),_r=yl}catch{}}return lr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Qm,lr.createPortal=function(e,t){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!gu(t))throw Error(r(200));return Km(e,t,null,s)},lr.createRoot=function(e,t){if(!gu(e))throw Error(r(299));var s=!1,c="",f=Mh;return t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(c=t.identifierPrefix),t.onRecoverableError!==void 0&&(f=t.onRecoverableError)),t=hu(e,1,!1,null,null,s,!1,c,f),e[pn]=t.current,$s(e.nodeType===8?e.parentNode:e),new mu(t)},lr.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(r(188)):(e=Object.keys(e).join(","),Error(r(268,e)));return e=Al(t),e=e===null?null:e.stateNode,e},lr.flushSync=function(e){return qs(e)},lr.hydrate=function(e,t,s){if(!pl(t))throw Error(r(200));return vl(null,e,t,!0,s)},lr.hydrateRoot=function(e,t,s){if(!gu(e))throw Error(r(405));var c=s!=null&&s.hydratedSources||null,f=!1,m="",b=Mh;if(s!=null&&(s.unstable_strictMode===!0&&(f=!0),s.identifierPrefix!==void 0&&(m=s.identifierPrefix),s.onRecoverableError!==void 0&&(b=s.onRecoverableError)),t=Ah(t,null,e,1,s??null,f,!1,m,b),e[pn]=t.current,$s(e),c)for(e=0;e<c.length;e++)s=c[e],f=s._getVersion,f=f(s._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[s,f]:t.mutableSourceEagerHydrationData.push(s,f);return new gl(t)},lr.render=function(e,t,s){if(!pl(t))throw Error(r(200));return vl(null,e,t,!1,s)},lr.unmountComponentAtNode=function(e){if(!pl(e))throw Error(r(40));return e._reactRootContainer?(qs(function(){vl(null,null,e,!1,function(){e._reactRootContainer=null,e[pn]=null})}),!0):!1},lr.unstable_batchedUpdates=au,lr.unstable_renderSubtreeIntoContainer=function(e,t,s,c){if(!pl(s))throw Error(r(200));if(e==null||e._reactInternals===void 0)throw Error(r(38));return vl(e,t,s,!1,c)},lr.version="18.3.1-next-f1338f8080-20240426",lr}var Kh;function ag(){if(Kh)return yu.exports;Kh=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(n){console.error(n)}}return u(),yu.exports=og(),yu.exports}var Gh;function ig(){if(Gh)return xl;Gh=1;var u=ag();return xl.createRoot=u.createRoot,xl.hydrateRoot=u.hydrateRoot,xl}var lg=ig();const cg=Hu(lg);/**
 * react-router v7.8.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Jh="popstate";function ug(u={}){function n(a,i){let{pathname:h,search:d,hash:p}=a.location;return Ou("",{pathname:h,search:d,hash:p},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(a,i){return typeof i=="string"?i:Za(i)}return hg(n,r,null,u)}function lt(u,n){if(u===!1||u===null||typeof u>"u")throw new Error(n)}function sn(u,n){if(!u){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function dg(){return Math.random().toString(36).substring(2,10)}function Qh(u,n){return{usr:u.state,key:u.key,idx:n}}function Ou(u,n,r=null,a){return{pathname:typeof u=="string"?u:u.pathname,search:"",hash:"",...typeof n=="string"?Yo(n):n,state:r,key:n&&n.key||a||dg()}}function Za({pathname:u="/",search:n="",hash:r=""}){return n&&n!=="?"&&(u+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(u+=r.charAt(0)==="#"?r:"#"+r),u}function Yo(u){let n={};if(u){let r=u.indexOf("#");r>=0&&(n.hash=u.substring(r),u=u.substring(0,r));let a=u.indexOf("?");a>=0&&(n.search=u.substring(a),u=u.substring(0,a)),u&&(n.pathname=u)}return n}function hg(u,n,r,a={}){let{window:i=document.defaultView,v5Compat:h=!1}=a,d=i.history,p="POP",y=null,x=S();x==null&&(x=0,d.replaceState({...d.state,idx:x},""));function S(){return(d.state||{idx:null}).idx}function N(){p="POP";let I=S(),Z=I==null?null:I-x;x=I,y&&y({action:p,location:B.location,delta:Z})}function R(I,Z){p="PUSH";let Y=Ou(B.location,I,Z);x=S()+1;let H=Qh(Y,x),q=B.createHref(Y);try{d.pushState(H,"",q)}catch(J){if(J instanceof DOMException&&J.name==="DataCloneError")throw J;i.location.assign(q)}h&&y&&y({action:p,location:B.location,delta:1})}function L(I,Z){p="REPLACE";let Y=Ou(B.location,I,Z);x=S();let H=Qh(Y,x),q=B.createHref(Y);d.replaceState(H,"",q),h&&y&&y({action:p,location:B.location,delta:0})}function F(I){return fg(I)}let B={get action(){return p},get location(){return u(i,d)},listen(I){if(y)throw new Error("A history only accepts one active listener");return i.addEventListener(Jh,N),y=I,()=>{i.removeEventListener(Jh,N),y=null}},createHref(I){return n(i,I)},createURL:F,encodeLocation(I){let Z=F(I);return{pathname:Z.pathname,search:Z.search,hash:Z.hash}},push:R,replace:L,go(I){return d.go(I)}};return B}function fg(u,n=!1){let r="http://localhost";typeof window<"u"&&(r=window.location.origin!=="null"?window.location.origin:window.location.href),lt(r,"No window.location.(origin|href) available to create URL");let a=typeof u=="string"?u:Za(u);return a=a.replace(/ $/,"%20"),!n&&a.startsWith("//")&&(a=r+a),new URL(a,r)}function Nf(u,n,r="/"){return mg(u,n,r,!1)}function mg(u,n,r,a){let i=typeof n=="string"?Yo(n):n,h=jn(i.pathname||"/",r);if(h==null)return null;let d=jf(u);gg(d);let p=null;for(let y=0;p==null&&y<d.length;++y){let x=Ng(h);p=kg(d[y],x,a)}return p}function jf(u,n=[],r=[],a="",i=!1){let h=(d,p,y=i,x)=>{let S={relativePath:x===void 0?d.path||"":x,caseSensitive:d.caseSensitive===!0,childrenIndex:p,route:d};if(S.relativePath.startsWith("/")){if(!S.relativePath.startsWith(a)&&y)return;lt(S.relativePath.startsWith(a),`Absolute route path "${S.relativePath}" nested under path "${a}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),S.relativePath=S.relativePath.slice(a.length)}let N=Nn([a,S.relativePath]),R=r.concat(S);d.children&&d.children.length>0&&(lt(d.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${N}".`),jf(d.children,n,R,N,y)),!(d.path==null&&!d.index)&&n.push({path:N,score:Sg(N,d.index),routesMeta:R})};return u.forEach((d,p)=>{if(d.path===""||!d.path?.includes("?"))h(d,p);else for(let y of Tf(d.path))h(d,p,!0,y)}),n}function Tf(u){let n=u.split("/");if(n.length===0)return[];let[r,...a]=n,i=r.endsWith("?"),h=r.replace(/\?$/,"");if(a.length===0)return i?[h,""]:[h];let d=Tf(a.join("/")),p=[];return p.push(...d.map(y=>y===""?h:[h,y].join("/"))),i&&p.push(...d),p.map(y=>u.startsWith("/")&&y===""?"/":y)}function gg(u){u.sort((n,r)=>n.score!==r.score?r.score-n.score:_g(n.routesMeta.map(a=>a.childrenIndex),r.routesMeta.map(a=>a.childrenIndex)))}var pg=/^:[\w-]+$/,vg=3,yg=2,xg=1,bg=10,wg=-2,Yh=u=>u==="*";function Sg(u,n){let r=u.split("/"),a=r.length;return r.some(Yh)&&(a+=wg),n&&(a+=yg),r.filter(i=>!Yh(i)).reduce((i,h)=>i+(pg.test(h)?vg:h===""?xg:bg),a)}function _g(u,n){return u.length===n.length&&u.slice(0,-1).every((a,i)=>a===n[i])?u[u.length-1]-n[n.length-1]:0}function kg(u,n,r=!1){let{routesMeta:a}=u,i={},h="/",d=[];for(let p=0;p<a.length;++p){let y=a[p],x=p===a.length-1,S=h==="/"?n:n.slice(h.length)||"/",N=Rl({path:y.relativePath,caseSensitive:y.caseSensitive,end:x},S),R=y.route;if(!N&&x&&r&&!a[a.length-1].route.index&&(N=Rl({path:y.relativePath,caseSensitive:y.caseSensitive,end:!1},S)),!N)return null;Object.assign(i,N.params),d.push({params:i,pathname:Nn([h,N.pathname]),pathnameBase:Rg(Nn([h,N.pathnameBase])),route:R}),N.pathnameBase!=="/"&&(h=Nn([h,N.pathnameBase]))}return d}function Rl(u,n){typeof u=="string"&&(u={path:u,caseSensitive:!1,end:!0});let[r,a]=Eg(u.path,u.caseSensitive,u.end),i=n.match(r);if(!i)return null;let h=i[0],d=h.replace(/(.)\/+$/,"$1"),p=i.slice(1);return{params:a.reduce((x,{paramName:S,isOptional:N},R)=>{if(S==="*"){let F=p[R]||"";d=h.slice(0,h.length-F.length).replace(/(.)\/+$/,"$1")}const L=p[R];return N&&!L?x[S]=void 0:x[S]=(L||"").replace(/%2F/g,"/"),x},{}),pathname:h,pathnameBase:d,pattern:u}}function Eg(u,n=!1,r=!0){sn(u==="*"||!u.endsWith("*")||u.endsWith("/*"),`Route path "${u}" will be treated as if it were "${u.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${u.replace(/\*$/,"/*")}".`);let a=[],i="^"+u.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(d,p,y)=>(a.push({paramName:p,isOptional:y!=null}),y?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return u.endsWith("*")?(a.push({paramName:"*"}),i+=u==="*"||u==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":u!==""&&u!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,n?void 0:"i"),a]}function Ng(u){try{return u.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return sn(!1,`The URL path "${u}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${n}).`),u}}function jn(u,n){if(n==="/")return u;if(!u.toLowerCase().startsWith(n.toLowerCase()))return null;let r=n.endsWith("/")?n.length-1:n.length,a=u.charAt(r);return a&&a!=="/"?null:u.slice(r)||"/"}function jg(u,n="/"){let{pathname:r,search:a="",hash:i=""}=typeof u=="string"?Yo(u):u;return{pathname:r?r.startsWith("/")?r:Tg(r,n):n,search:Og(a),hash:Ig(i)}}function Tg(u,n){let r=n.replace(/\/+$/,"").split("/");return u.split("/").forEach(i=>{i===".."?r.length>1&&r.pop():i!=="."&&r.push(i)}),r.length>1?r.join("/"):"/"}function wu(u,n,r,a){return`Cannot include a '${u}' character in a manually specified \`to.${n}\` field [${JSON.stringify(a)}].  Please separate it out to the \`to.${r}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Cg(u){return u.filter((n,r)=>r===0||n.route.path&&n.route.path.length>0)}function Cf(u){let n=Cg(u);return n.map((r,a)=>a===n.length-1?r.pathname:r.pathnameBase)}function Rf(u,n,r,a=!1){let i;typeof u=="string"?i=Yo(u):(i={...u},lt(!i.pathname||!i.pathname.includes("?"),wu("?","pathname","search",i)),lt(!i.pathname||!i.pathname.includes("#"),wu("#","pathname","hash",i)),lt(!i.search||!i.search.includes("#"),wu("#","search","hash",i)));let h=u===""||i.pathname==="",d=h?"/":i.pathname,p;if(d==null)p=r;else{let N=n.length-1;if(!a&&d.startsWith("..")){let R=d.split("/");for(;R[0]==="..";)R.shift(),N-=1;i.pathname=R.join("/")}p=N>=0?n[N]:"/"}let y=jg(i,p),x=d&&d!=="/"&&d.endsWith("/"),S=(h||d===".")&&r.endsWith("/");return!y.pathname.endsWith("/")&&(x||S)&&(y.pathname+="/"),y}var Nn=u=>u.join("/").replace(/\/\/+/g,"/"),Rg=u=>u.replace(/\/+$/,"").replace(/^\/*/,"/"),Og=u=>!u||u==="?"?"":u.startsWith("?")?u:"?"+u,Ig=u=>!u||u==="#"?"":u.startsWith("#")?u:"#"+u;function Pg(u){return u!=null&&typeof u.status=="number"&&typeof u.statusText=="string"&&typeof u.internal=="boolean"&&"data"in u}var Of=["POST","PUT","PATCH","DELETE"];new Set(Of);var Dg=["GET",...Of];new Set(Dg);var Xo=_.createContext(null);Xo.displayName="DataRouter";var Pl=_.createContext(null);Pl.displayName="DataRouterState";_.createContext(!1);var If=_.createContext({isTransitioning:!1});If.displayName="ViewTransition";var Lg=_.createContext(new Map);Lg.displayName="Fetchers";var Ag=_.createContext(null);Ag.displayName="Await";var on=_.createContext(null);on.displayName="Navigation";var ti=_.createContext(null);ti.displayName="Location";var Tn=_.createContext({outlet:null,matches:[],isDataRoute:!1});Tn.displayName="Route";var Ku=_.createContext(null);Ku.displayName="RouteError";function $g(u,{relative:n}={}){lt(ri(),"useHref() may be used only in the context of a <Router> component.");let{basename:r,navigator:a}=_.useContext(on),{hash:i,pathname:h,search:d}=ni(u,{relative:n}),p=h;return r!=="/"&&(p=h==="/"?r:Nn([r,h])),a.createHref({pathname:p,search:d,hash:i})}function ri(){return _.useContext(ti)!=null}function vr(){return lt(ri(),"useLocation() may be used only in the context of a <Router> component."),_.useContext(ti).location}var Pf="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Df(u){_.useContext(on).static||_.useLayoutEffect(u)}function Zo(){let{isDataRoute:u}=_.useContext(Tn);return u?Qg():Mg()}function Mg(){lt(ri(),"useNavigate() may be used only in the context of a <Router> component.");let u=_.useContext(Xo),{basename:n,navigator:r}=_.useContext(on),{matches:a}=_.useContext(Tn),{pathname:i}=vr(),h=JSON.stringify(Cf(a)),d=_.useRef(!1);return Df(()=>{d.current=!0}),_.useCallback((y,x={})=>{if(sn(d.current,Pf),!d.current)return;if(typeof y=="number"){r.go(y);return}let S=Rf(y,JSON.parse(h),i,x.relative==="path");u==null&&n!=="/"&&(S.pathname=S.pathname==="/"?n:Nn([n,S.pathname])),(x.replace?r.replace:r.push)(S,x.state,x)},[n,r,h,i,u])}_.createContext(null);function ni(u,{relative:n}={}){let{matches:r}=_.useContext(Tn),{pathname:a}=vr(),i=JSON.stringify(Cf(r));return _.useMemo(()=>Rf(u,JSON.parse(i),a,n==="path"),[u,i,a,n])}function Ug(u,n){return Lf(u,n)}function Lf(u,n,r,a,i){lt(ri(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:h}=_.useContext(on),{matches:d}=_.useContext(Tn),p=d[d.length-1],y=p?p.params:{},x=p?p.pathname:"/",S=p?p.pathnameBase:"/",N=p&&p.route;{let Y=N&&N.path||"";Af(x,!N||Y.endsWith("*")||Y.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${x}" (under <Route path="${Y}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Y}"> to <Route path="${Y==="/"?"*":`${Y}/*`}">.`)}let R=vr(),L;if(n){let Y=typeof n=="string"?Yo(n):n;lt(S==="/"||Y.pathname?.startsWith(S),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${S}" but pathname "${Y.pathname}" was given in the \`location\` prop.`),L=Y}else L=R;let F=L.pathname||"/",B=F;if(S!=="/"){let Y=S.replace(/^\//,"").split("/");B="/"+F.replace(/^\//,"").split("/").slice(Y.length).join("/")}let I=Nf(u,{pathname:B});sn(N||I!=null,`No routes matched location "${L.pathname}${L.search}${L.hash}" `),sn(I==null||I[I.length-1].route.element!==void 0||I[I.length-1].route.Component!==void 0||I[I.length-1].route.lazy!==void 0,`Matched leaf route at location "${L.pathname}${L.search}${L.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let Z=Wg(I&&I.map(Y=>Object.assign({},Y,{params:Object.assign({},y,Y.params),pathname:Nn([S,h.encodeLocation?h.encodeLocation(Y.pathname).pathname:Y.pathname]),pathnameBase:Y.pathnameBase==="/"?S:Nn([S,h.encodeLocation?h.encodeLocation(Y.pathnameBase).pathname:Y.pathnameBase])})),d,r,a,i);return n&&Z?_.createElement(ti.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...L},navigationType:"POP"}},Z):Z}function Fg(){let u=Jg(),n=Pg(u)?`${u.status} ${u.statusText}`:u instanceof Error?u.message:JSON.stringify(u),r=u instanceof Error?u.stack:null,a="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:a},h={padding:"2px 4px",backgroundColor:a},d=null;return console.error("Error handled by React Router default ErrorBoundary:",u),d=_.createElement(_.Fragment,null,_.createElement("p",null,"💿 Hey developer 👋"),_.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",_.createElement("code",{style:h},"ErrorBoundary")," or"," ",_.createElement("code",{style:h},"errorElement")," prop on your route.")),_.createElement(_.Fragment,null,_.createElement("h2",null,"Unexpected Application Error!"),_.createElement("h3",{style:{fontStyle:"italic"}},n),r?_.createElement("pre",{style:i},r):null,d)}var Vg=_.createElement(Fg,null),Bg=class extends _.Component{constructor(u){super(u),this.state={location:u.location,revalidation:u.revalidation,error:u.error}}static getDerivedStateFromError(u){return{error:u}}static getDerivedStateFromProps(u,n){return n.location!==u.location||n.revalidation!=="idle"&&u.revalidation==="idle"?{error:u.error,location:u.location,revalidation:u.revalidation}:{error:u.error!==void 0?u.error:n.error,location:n.location,revalidation:u.revalidation||n.revalidation}}componentDidCatch(u,n){this.props.unstable_onError?this.props.unstable_onError(u,n):console.error("React Router caught the following error during render",u)}render(){return this.state.error!==void 0?_.createElement(Tn.Provider,{value:this.props.routeContext},_.createElement(Ku.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function zg({routeContext:u,match:n,children:r}){let a=_.useContext(Xo);return a&&a.static&&a.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=n.route.id),_.createElement(Tn.Provider,{value:u},r)}function Wg(u,n=[],r=null,a=null,i=null){if(u==null){if(!r)return null;if(r.errors)u=r.matches;else if(n.length===0&&!r.initialized&&r.matches.length>0)u=r.matches;else return null}let h=u,d=r?.errors;if(d!=null){let x=h.findIndex(S=>S.route.id&&d?.[S.route.id]!==void 0);lt(x>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(d).join(",")}`),h=h.slice(0,Math.min(h.length,x+1))}let p=!1,y=-1;if(r)for(let x=0;x<h.length;x++){let S=h[x];if((S.route.HydrateFallback||S.route.hydrateFallbackElement)&&(y=x),S.route.id){let{loaderData:N,errors:R}=r,L=S.route.loader&&!N.hasOwnProperty(S.route.id)&&(!R||R[S.route.id]===void 0);if(S.route.lazy||L){p=!0,y>=0?h=h.slice(0,y+1):h=[h[0]];break}}}return h.reduceRight((x,S,N)=>{let R,L=!1,F=null,B=null;r&&(R=d&&S.route.id?d[S.route.id]:void 0,F=S.route.errorElement||Vg,p&&(y<0&&N===0?(Af("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),L=!0,B=null):y===N&&(L=!0,B=S.route.hydrateFallbackElement||null)));let I=n.concat(h.slice(0,N+1)),Z=()=>{let Y;return R?Y=F:L?Y=B:S.route.Component?Y=_.createElement(S.route.Component,null):S.route.element?Y=S.route.element:Y=x,_.createElement(zg,{match:S,routeContext:{outlet:x,matches:I,isDataRoute:r!=null},children:Y})};return r&&(S.route.ErrorBoundary||S.route.errorElement||N===0)?_.createElement(Bg,{location:r.location,revalidation:r.revalidation,component:F,error:R,children:Z(),routeContext:{outlet:null,matches:I,isDataRoute:!0},unstable_onError:a}):Z()},null)}function Gu(u){return`${u} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Hg(u){let n=_.useContext(Xo);return lt(n,Gu(u)),n}function qg(u){let n=_.useContext(Pl);return lt(n,Gu(u)),n}function Kg(u){let n=_.useContext(Tn);return lt(n,Gu(u)),n}function Ju(u){let n=Kg(u),r=n.matches[n.matches.length-1];return lt(r.route.id,`${u} can only be used on routes that contain a unique "id"`),r.route.id}function Gg(){return Ju("useRouteId")}function Jg(){let u=_.useContext(Ku),n=qg("useRouteError"),r=Ju("useRouteError");return u!==void 0?u:n.errors?.[r]}function Qg(){let{router:u}=Hg("useNavigate"),n=Ju("useNavigate"),r=_.useRef(!1);return Df(()=>{r.current=!0}),_.useCallback(async(i,h={})=>{sn(r.current,Pf),r.current&&(typeof i=="number"?u.navigate(i):await u.navigate(i,{fromRouteId:n,...h}))},[u,n])}var Xh={};function Af(u,n,r){!n&&!Xh[u]&&(Xh[u]=!0,sn(!1,r))}_.memo(Yg);function Yg({routes:u,future:n,state:r,unstable_onError:a}){return Lf(u,void 0,r,a,n)}function Zs(u){lt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Xg({basename:u="/",children:n=null,location:r,navigationType:a="POP",navigator:i,static:h=!1}){lt(!ri(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let d=u.replace(/^\/*/,"/"),p=_.useMemo(()=>({basename:d,navigator:i,static:h,future:{}}),[d,i,h]);typeof r=="string"&&(r=Yo(r));let{pathname:y="/",search:x="",hash:S="",state:N=null,key:R="default"}=r,L=_.useMemo(()=>{let F=jn(y,d);return F==null?null:{location:{pathname:F,search:x,hash:S,state:N,key:R},navigationType:a}},[d,y,x,S,N,R,a]);return sn(L!=null,`<Router basename="${d}"> is not able to match the URL "${y}${x}${S}" because it does not start with the basename, so the <Router> won't render anything.`),L==null?null:_.createElement(on.Provider,{value:p},_.createElement(ti.Provider,{children:n,value:L}))}function Zg({children:u,location:n}){return Ug(Iu(u),n)}function Iu(u,n=[]){let r=[];return _.Children.forEach(u,(a,i)=>{if(!_.isValidElement(a))return;let h=[...n,i];if(a.type===_.Fragment){r.push.apply(r,Iu(a.props.children,h));return}lt(a.type===Zs,`[${typeof a.type=="string"?a.type:a.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),lt(!a.props.index||!a.props.children,"An index route cannot have child routes.");let d={id:a.props.id||h.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,hydrateFallbackElement:a.props.hydrateFallbackElement,HydrateFallback:a.props.HydrateFallback,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.hasErrorBoundary===!0||a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(d.children=Iu(a.props.children,h)),r.push(d)}),r}var jl="get",Tl="application/x-www-form-urlencoded";function Dl(u){return u!=null&&typeof u.tagName=="string"}function ep(u){return Dl(u)&&u.tagName.toLowerCase()==="button"}function tp(u){return Dl(u)&&u.tagName.toLowerCase()==="form"}function rp(u){return Dl(u)&&u.tagName.toLowerCase()==="input"}function np(u){return!!(u.metaKey||u.altKey||u.ctrlKey||u.shiftKey)}function sp(u,n){return u.button===0&&(!n||n==="_self")&&!np(u)}var bl=null;function op(){if(bl===null)try{new FormData(document.createElement("form"),0),bl=!1}catch{bl=!0}return bl}var ap=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Su(u){return u!=null&&!ap.has(u)?(sn(!1,`"${u}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Tl}"`),null):u}function ip(u,n){let r,a,i,h,d;if(tp(u)){let p=u.getAttribute("action");a=p?jn(p,n):null,r=u.getAttribute("method")||jl,i=Su(u.getAttribute("enctype"))||Tl,h=new FormData(u)}else if(ep(u)||rp(u)&&(u.type==="submit"||u.type==="image")){let p=u.form;if(p==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let y=u.getAttribute("formaction")||p.getAttribute("action");if(a=y?jn(y,n):null,r=u.getAttribute("formmethod")||p.getAttribute("method")||jl,i=Su(u.getAttribute("formenctype"))||Su(p.getAttribute("enctype"))||Tl,h=new FormData(p,u),!op()){let{name:x,type:S,value:N}=u;if(S==="image"){let R=x?`${x}.`:"";h.append(`${R}x`,"0"),h.append(`${R}y`,"0")}else x&&h.append(x,N)}}else{if(Dl(u))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');r=jl,a=null,i=Tl,d=u}return h&&i==="text/plain"&&(d=h,h=void 0),{action:a,method:r.toLowerCase(),encType:i,formData:h,body:d}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Qu(u,n){if(u===!1||u===null||typeof u>"u")throw new Error(n)}function lp(u,n,r){let a=typeof u=="string"?new URL(u,typeof window>"u"?"server://singlefetch/":window.location.origin):u;return a.pathname==="/"?a.pathname=`_root.${r}`:n&&jn(a.pathname,n)==="/"?a.pathname=`${n.replace(/\/$/,"")}/_root.${r}`:a.pathname=`${a.pathname.replace(/\/$/,"")}.${r}`,a}async function cp(u,n){if(u.id in n)return n[u.id];try{let r=await import(u.module);return n[u.id]=r,r}catch(r){return console.error(`Error loading route module \`${u.module}\`, reloading page...`),console.error(r),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function up(u){return u==null?!1:u.href==null?u.rel==="preload"&&typeof u.imageSrcSet=="string"&&typeof u.imageSizes=="string":typeof u.rel=="string"&&typeof u.href=="string"}async function dp(u,n,r){let a=await Promise.all(u.map(async i=>{let h=n.routes[i.route.id];if(h){let d=await cp(h,r);return d.links?d.links():[]}return[]}));return gp(a.flat(1).filter(up).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function Zh(u,n,r,a,i,h){let d=(y,x)=>r[x]?y.route.id!==r[x].route.id:!0,p=(y,x)=>r[x].pathname!==y.pathname||r[x].route.path?.endsWith("*")&&r[x].params["*"]!==y.params["*"];return h==="assets"?n.filter((y,x)=>d(y,x)||p(y,x)):h==="data"?n.filter((y,x)=>{let S=a.routes[y.route.id];if(!S||!S.hasLoader)return!1;if(d(y,x)||p(y,x))return!0;if(y.route.shouldRevalidate){let N=y.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:r[0]?.params||{},nextUrl:new URL(u,window.origin),nextParams:y.params,defaultShouldRevalidate:!0});if(typeof N=="boolean")return N}return!0}):[]}function hp(u,n,{includeHydrateFallback:r}={}){return fp(u.map(a=>{let i=n.routes[a.route.id];if(!i)return[];let h=[i.module];return i.clientActionModule&&(h=h.concat(i.clientActionModule)),i.clientLoaderModule&&(h=h.concat(i.clientLoaderModule)),r&&i.hydrateFallbackModule&&(h=h.concat(i.hydrateFallbackModule)),i.imports&&(h=h.concat(i.imports)),h}).flat(1))}function fp(u){return[...new Set(u)]}function mp(u){let n={},r=Object.keys(u).sort();for(let a of r)n[a]=u[a];return n}function gp(u,n){let r=new Set;return new Set(n),u.reduce((a,i)=>{let h=JSON.stringify(mp(i));return r.has(h)||(r.add(h),a.push({key:h,link:i})),a},[])}function $f(){let u=_.useContext(Xo);return Qu(u,"You must render this element inside a <DataRouterContext.Provider> element"),u}function pp(){let u=_.useContext(Pl);return Qu(u,"You must render this element inside a <DataRouterStateContext.Provider> element"),u}var Yu=_.createContext(void 0);Yu.displayName="FrameworkContext";function Mf(){let u=_.useContext(Yu);return Qu(u,"You must render this element inside a <HydratedRouter> element"),u}function vp(u,n){let r=_.useContext(Yu),[a,i]=_.useState(!1),[h,d]=_.useState(!1),{onFocus:p,onBlur:y,onMouseEnter:x,onMouseLeave:S,onTouchStart:N}=n,R=_.useRef(null);_.useEffect(()=>{if(u==="render"&&d(!0),u==="viewport"){let B=Z=>{Z.forEach(Y=>{d(Y.isIntersecting)})},I=new IntersectionObserver(B,{threshold:.5});return R.current&&I.observe(R.current),()=>{I.disconnect()}}},[u]),_.useEffect(()=>{if(a){let B=setTimeout(()=>{d(!0)},100);return()=>{clearTimeout(B)}}},[a]);let L=()=>{i(!0)},F=()=>{i(!1),d(!1)};return r?u!=="intent"?[h,R,{}]:[h,R,{onFocus:Ga(p,L),onBlur:Ga(y,F),onMouseEnter:Ga(x,L),onMouseLeave:Ga(S,F),onTouchStart:Ga(N,L)}]:[!1,R,{}]}function Ga(u,n){return r=>{u&&u(r),r.defaultPrevented||n(r)}}function yp({page:u,...n}){let{router:r}=$f(),a=_.useMemo(()=>Nf(r.routes,u,r.basename),[r.routes,u,r.basename]);return a?_.createElement(bp,{page:u,matches:a,...n}):null}function xp(u){let{manifest:n,routeModules:r}=Mf(),[a,i]=_.useState([]);return _.useEffect(()=>{let h=!1;return dp(u,n,r).then(d=>{h||i(d)}),()=>{h=!0}},[u,n,r]),a}function bp({page:u,matches:n,...r}){let a=vr(),{manifest:i,routeModules:h}=Mf(),{basename:d}=$f(),{loaderData:p,matches:y}=pp(),x=_.useMemo(()=>Zh(u,n,y,i,a,"data"),[u,n,y,i,a]),S=_.useMemo(()=>Zh(u,n,y,i,a,"assets"),[u,n,y,i,a]),N=_.useMemo(()=>{if(u===a.pathname+a.search+a.hash)return[];let F=new Set,B=!1;if(n.forEach(Z=>{let Y=i.routes[Z.route.id];!Y||!Y.hasLoader||(!x.some(H=>H.route.id===Z.route.id)&&Z.route.id in p&&h[Z.route.id]?.shouldRevalidate||Y.hasClientLoader?B=!0:F.add(Z.route.id))}),F.size===0)return[];let I=lp(u,d,"data");return B&&F.size>0&&I.searchParams.set("_routes",n.filter(Z=>F.has(Z.route.id)).map(Z=>Z.route.id).join(",")),[I.pathname+I.search]},[d,p,a,i,x,n,u,h]),R=_.useMemo(()=>hp(S,i),[S,i]),L=xp(S);return _.createElement(_.Fragment,null,N.map(F=>_.createElement("link",{key:F,rel:"prefetch",as:"fetch",href:F,...r})),R.map(F=>_.createElement("link",{key:F,rel:"modulepreload",href:F,...r})),L.map(({key:F,link:B})=>_.createElement("link",{key:F,nonce:r.nonce,...B})))}function wp(...u){return n=>{u.forEach(r=>{typeof r=="function"?r(n):r!=null&&(r.current=n)})}}var Uf=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Uf&&(window.__reactRouterVersion="7.8.2")}catch{}function Sp({basename:u,children:n,window:r}){let a=_.useRef();a.current==null&&(a.current=ug({window:r,v5Compat:!0}));let i=a.current,[h,d]=_.useState({action:i.action,location:i.location}),p=_.useCallback(y=>{_.startTransition(()=>d(y))},[d]);return _.useLayoutEffect(()=>i.listen(p),[i,p]),_.createElement(Xg,{basename:u,children:n,location:h.location,navigationType:h.action,navigator:i})}var Ff=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Vf=_.forwardRef(function({onClick:n,discover:r="render",prefetch:a="none",relative:i,reloadDocument:h,replace:d,state:p,target:y,to:x,preventScrollReset:S,viewTransition:N,...R},L){let{basename:F}=_.useContext(on),B=typeof x=="string"&&Ff.test(x),I,Z=!1;if(typeof x=="string"&&B&&(I=x,Uf))try{let C=new URL(window.location.href),re=x.startsWith("//")?new URL(C.protocol+x):new URL(x),ue=jn(re.pathname,F);re.origin===C.origin&&ue!=null?x=ue+re.search+re.hash:Z=!0}catch{sn(!1,`<Link to="${x}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let Y=$g(x,{relative:i}),[H,q,J]=vp(a,R),P=Np(x,{replace:d,state:p,target:y,preventScrollReset:S,relative:i,viewTransition:N});function V(C){n&&n(C),C.defaultPrevented||P(C)}let te=_.createElement("a",{...R,...J,href:I||Y,onClick:Z||h?n:V,ref:wp(L,q),target:y,"data-discover":!B&&r==="render"?"true":void 0});return H&&!B?_.createElement(_.Fragment,null,te,_.createElement(yp,{page:Y})):te});Vf.displayName="Link";var _p=_.forwardRef(function({"aria-current":n="page",caseSensitive:r=!1,className:a="",end:i=!1,style:h,to:d,viewTransition:p,children:y,...x},S){let N=ni(d,{relative:x.relative}),R=vr(),L=_.useContext(Pl),{navigator:F,basename:B}=_.useContext(on),I=L!=null&&Op(N)&&p===!0,Z=F.encodeLocation?F.encodeLocation(N).pathname:N.pathname,Y=R.pathname,H=L&&L.navigation&&L.navigation.location?L.navigation.location.pathname:null;r||(Y=Y.toLowerCase(),H=H?H.toLowerCase():null,Z=Z.toLowerCase()),H&&B&&(H=jn(H,B)||H);const q=Z!=="/"&&Z.endsWith("/")?Z.length-1:Z.length;let J=Y===Z||!i&&Y.startsWith(Z)&&Y.charAt(q)==="/",P=H!=null&&(H===Z||!i&&H.startsWith(Z)&&H.charAt(Z.length)==="/"),V={isActive:J,isPending:P,isTransitioning:I},te=J?n:void 0,C;typeof a=="function"?C=a(V):C=[a,J?"active":null,P?"pending":null,I?"transitioning":null].filter(Boolean).join(" ");let re=typeof h=="function"?h(V):h;return _.createElement(Vf,{...x,"aria-current":te,className:C,ref:S,style:re,to:d,viewTransition:p},typeof y=="function"?y(V):y)});_p.displayName="NavLink";var kp=_.forwardRef(({discover:u="render",fetcherKey:n,navigate:r,reloadDocument:a,replace:i,state:h,method:d=jl,action:p,onSubmit:y,relative:x,preventScrollReset:S,viewTransition:N,...R},L)=>{let F=Cp(),B=Rp(p,{relative:x}),I=d.toLowerCase()==="get"?"get":"post",Z=typeof p=="string"&&Ff.test(p),Y=H=>{if(y&&y(H),H.defaultPrevented)return;H.preventDefault();let q=H.nativeEvent.submitter,J=q?.getAttribute("formmethod")||d;F(q||H.currentTarget,{fetcherKey:n,method:J,navigate:r,replace:i,state:h,relative:x,preventScrollReset:S,viewTransition:N})};return _.createElement("form",{ref:L,method:I,action:B,onSubmit:a?y:Y,...R,"data-discover":!Z&&u==="render"?"true":void 0})});kp.displayName="Form";function Ep(u){return`${u} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Bf(u){let n=_.useContext(Xo);return lt(n,Ep(u)),n}function Np(u,{target:n,replace:r,state:a,preventScrollReset:i,relative:h,viewTransition:d}={}){let p=Zo(),y=vr(),x=ni(u,{relative:h});return _.useCallback(S=>{if(sp(S,n)){S.preventDefault();let N=r!==void 0?r:Za(y)===Za(x);p(u,{replace:N,state:a,preventScrollReset:i,relative:h,viewTransition:d})}},[y,p,x,r,a,n,u,i,h,d])}var jp=0,Tp=()=>`__${String(++jp)}__`;function Cp(){let{router:u}=Bf("useSubmit"),{basename:n}=_.useContext(on),r=Gg();return _.useCallback(async(a,i={})=>{let{action:h,method:d,encType:p,formData:y,body:x}=ip(a,n);if(i.navigate===!1){let S=i.fetcherKey||Tp();await u.fetch(S,r,i.action||h,{preventScrollReset:i.preventScrollReset,formData:y,body:x,formMethod:i.method||d,formEncType:i.encType||p,flushSync:i.flushSync})}else await u.navigate(i.action||h,{preventScrollReset:i.preventScrollReset,formData:y,body:x,formMethod:i.method||d,formEncType:i.encType||p,replace:i.replace,state:i.state,fromRouteId:r,flushSync:i.flushSync,viewTransition:i.viewTransition})},[u,n,r])}function Rp(u,{relative:n}={}){let{basename:r}=_.useContext(on),a=_.useContext(Tn);lt(a,"useFormAction must be used inside a RouteContext");let[i]=a.matches.slice(-1),h={...ni(u||".",{relative:n})},d=vr();if(u==null){h.search=d.search;let p=new URLSearchParams(h.search),y=p.getAll("index");if(y.some(S=>S==="")){p.delete("index"),y.filter(N=>N).forEach(N=>p.append("index",N));let S=p.toString();h.search=S?`?${S}`:""}}return(!u||u===".")&&i.route.index&&(h.search=h.search?h.search.replace(/^\?/,"?index&"):"?index"),r!=="/"&&(h.pathname=h.pathname==="/"?r:Nn([r,h.pathname])),Za(h)}function Op(u,{relative:n}={}){let r=_.useContext(If);lt(r!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:a}=Bf("useViewTransitionState"),i=ni(u,{relative:n});if(!r.isTransitioning)return!1;let h=jn(r.currentLocation.pathname,a)||r.currentLocation.pathname,d=jn(r.nextLocation.pathname,a)||r.nextLocation.pathname;return Rl(i.pathname,d)!=null||Rl(i.pathname,h)!=null}const Ip="modulepreload",Pp=function(u){return"/"+u},ef={},ea=function(n,r,a){let i=Promise.resolve();if(r&&r.length>0){let x=function(S){return Promise.all(S.map(N=>Promise.resolve(N).then(R=>({status:"fulfilled",value:R}),R=>({status:"rejected",reason:R}))))};var d=x;document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),y=p?.nonce||p?.getAttribute("nonce");i=x(r.map(S=>{if(S=Pp(S),S in ef)return;ef[S]=!0;const N=S.endsWith(".css"),R=N?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${S}"]${R}`))return;const L=document.createElement("link");if(L.rel=N?"stylesheet":Ip,N||(L.as="script"),L.crossOrigin="",L.href=S,y&&L.setAttribute("nonce",y),document.head.appendChild(L),N)return new Promise((F,B)=>{L.addEventListener("load",F),L.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${S}`)))})}))}function h(p){const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=p,window.dispatchEvent(y),!y.defaultPrevented)throw p}return i.then(p=>{for(const y of p||[])y.status==="rejected"&&h(y.reason);return n().catch(h)})},Dp=u=>{let n;return u?n=u:typeof fetch>"u"?n=(...r)=>ea(async()=>{const{default:a}=await Promise.resolve().then(()=>ta);return{default:a}},[]).then(({default:a})=>a(...r)):n=fetch,(...r)=>n(...r)};class Xu extends Error{constructor(n,r="FunctionsError",a){super(n),this.name=r,this.context=a}}class Lp extends Xu{constructor(n){super("Failed to send a request to the Edge Function","FunctionsFetchError",n)}}class tf extends Xu{constructor(n){super("Relay Error invoking the Edge Function","FunctionsRelayError",n)}}class rf extends Xu{constructor(n){super("Edge Function returned a non-2xx status code","FunctionsHttpError",n)}}var Pu;(function(u){u.Any="any",u.ApNortheast1="ap-northeast-1",u.ApNortheast2="ap-northeast-2",u.ApSouth1="ap-south-1",u.ApSoutheast1="ap-southeast-1",u.ApSoutheast2="ap-southeast-2",u.CaCentral1="ca-central-1",u.EuCentral1="eu-central-1",u.EuWest1="eu-west-1",u.EuWest2="eu-west-2",u.EuWest3="eu-west-3",u.SaEast1="sa-east-1",u.UsEast1="us-east-1",u.UsWest1="us-west-1",u.UsWest2="us-west-2"})(Pu||(Pu={}));var Ap=function(u,n,r,a){function i(h){return h instanceof r?h:new r(function(d){d(h)})}return new(r||(r=Promise))(function(h,d){function p(S){try{x(a.next(S))}catch(N){d(N)}}function y(S){try{x(a.throw(S))}catch(N){d(N)}}function x(S){S.done?h(S.value):i(S.value).then(p,y)}x((a=a.apply(u,n||[])).next())})};class $p{constructor(n,{headers:r={},customFetch:a,region:i=Pu.Any}={}){this.url=n,this.headers=r,this.region=i,this.fetch=Dp(a)}setAuth(n){this.headers.Authorization=`Bearer ${n}`}invoke(n,r={}){var a;return Ap(this,void 0,void 0,function*(){try{const{headers:i,method:h,body:d}=r;let p={},{region:y}=r;y||(y=this.region);const x=new URL(`${this.url}/${n}`);y&&y!=="any"&&(p["x-region"]=y,x.searchParams.set("forceFunctionRegion",y));let S;d&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&d instanceof Blob||d instanceof ArrayBuffer?(p["Content-Type"]="application/octet-stream",S=d):typeof d=="string"?(p["Content-Type"]="text/plain",S=d):typeof FormData<"u"&&d instanceof FormData?S=d:(p["Content-Type"]="application/json",S=JSON.stringify(d)));const N=yield this.fetch(x.toString(),{method:h||"POST",headers:Object.assign(Object.assign(Object.assign({},p),this.headers),i),body:S}).catch(B=>{throw new Lp(B)}),R=N.headers.get("x-relay-error");if(R&&R==="true")throw new tf(N);if(!N.ok)throw new rf(N);let L=((a=N.headers.get("Content-Type"))!==null&&a!==void 0?a:"text/plain").split(";")[0].trim(),F;return L==="application/json"?F=yield N.json():L==="application/octet-stream"?F=yield N.blob():L==="text/event-stream"?F=N:L==="multipart/form-data"?F=yield N.formData():F=yield N.text(),{data:F,error:null,response:N}}catch(i){return{data:null,error:i,response:i instanceof rf||i instanceof tf?i.context:void 0}}})}}var _t={},Mo={},Uo={},Fo={},Vo={},Bo={},Mp=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Qo=Mp();const Up=Qo.fetch,zf=Qo.fetch.bind(Qo),Wf=Qo.Headers,Fp=Qo.Request,Vp=Qo.Response,ta=Object.freeze(Object.defineProperty({__proto__:null,Headers:Wf,Request:Fp,Response:Vp,default:zf,fetch:Up},Symbol.toStringTag,{value:"Module"})),Bp=Zm(ta);var wl={},nf;function Hf(){if(nf)return wl;nf=1,Object.defineProperty(wl,"__esModule",{value:!0});class u extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}}return wl.default=u,wl}var sf;function qf(){if(sf)return Bo;sf=1;var u=Bo&&Bo.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Bo,"__esModule",{value:!0});const n=u(Bp),r=u(Hf());class a{constructor(h){var d,p;this.shouldThrowOnError=!1,this.method=h.method,this.url=h.url,this.headers=new Headers(h.headers),this.schema=h.schema,this.body=h.body,this.shouldThrowOnError=(d=h.shouldThrowOnError)!==null&&d!==void 0?d:!1,this.signal=h.signal,this.isMaybeSingle=(p=h.isMaybeSingle)!==null&&p!==void 0?p:!1,h.fetch?this.fetch=h.fetch:typeof fetch>"u"?this.fetch=n.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(h,d){return this.headers=new Headers(this.headers),this.headers.set(h,d),this}then(h,d){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const p=this.fetch;let y=p(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async x=>{var S,N,R,L;let F=null,B=null,I=null,Z=x.status,Y=x.statusText;if(x.ok){if(this.method!=="HEAD"){const P=await x.text();P===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((S=this.headers.get("Accept"))===null||S===void 0)&&S.includes("application/vnd.pgrst.plan+text"))?B=P:B=JSON.parse(P))}const q=(N=this.headers.get("Prefer"))===null||N===void 0?void 0:N.match(/count=(exact|planned|estimated)/),J=(R=x.headers.get("content-range"))===null||R===void 0?void 0:R.split("/");q&&J&&J.length>1&&(I=parseInt(J[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(B)&&(B.length>1?(F={code:"PGRST116",details:`Results contain ${B.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},B=null,I=null,Z=406,Y="Not Acceptable"):B.length===1?B=B[0]:B=null)}else{const q=await x.text();try{F=JSON.parse(q),Array.isArray(F)&&x.status===404&&(B=[],F=null,Z=200,Y="OK")}catch{x.status===404&&q===""?(Z=204,Y="No Content"):F={message:q}}if(F&&this.isMaybeSingle&&(!((L=F?.details)===null||L===void 0)&&L.includes("0 rows"))&&(F=null,Z=200,Y="OK"),F&&this.shouldThrowOnError)throw new r.default(F)}return{error:F,data:B,count:I,status:Z,statusText:Y}});return this.shouldThrowOnError||(y=y.catch(x=>{var S,N,R;return{error:{message:`${(S=x?.name)!==null&&S!==void 0?S:"FetchError"}: ${x?.message}`,details:`${(N=x?.stack)!==null&&N!==void 0?N:""}`,hint:"",code:`${(R=x?.code)!==null&&R!==void 0?R:""}`},data:null,count:null,status:0,statusText:""}})),y.then(h,d)}returns(){return this}overrideTypes(){return this}}return Bo.default=a,Bo}var of;function Kf(){if(of)return Vo;of=1;var u=Vo&&Vo.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Vo,"__esModule",{value:!0});const n=u(qf());class r extends n.default{select(i){let h=!1;const d=(i??"*").split("").map(p=>/\s/.test(p)&&!h?"":(p==='"'&&(h=!h),p)).join("");return this.url.searchParams.set("select",d),this.headers.append("Prefer","return=representation"),this}order(i,{ascending:h=!0,nullsFirst:d,foreignTable:p,referencedTable:y=p}={}){const x=y?`${y}.order`:"order",S=this.url.searchParams.get(x);return this.url.searchParams.set(x,`${S?`${S},`:""}${i}.${h?"asc":"desc"}${d===void 0?"":d?".nullsfirst":".nullslast"}`),this}limit(i,{foreignTable:h,referencedTable:d=h}={}){const p=typeof d>"u"?"limit":`${d}.limit`;return this.url.searchParams.set(p,`${i}`),this}range(i,h,{foreignTable:d,referencedTable:p=d}={}){const y=typeof p>"u"?"offset":`${p}.offset`,x=typeof p>"u"?"limit":`${p}.limit`;return this.url.searchParams.set(y,`${i}`),this.url.searchParams.set(x,`${h-i+1}`),this}abortSignal(i){return this.signal=i,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:i=!1,verbose:h=!1,settings:d=!1,buffers:p=!1,wal:y=!1,format:x="text"}={}){var S;const N=[i?"analyze":null,h?"verbose":null,d?"settings":null,p?"buffers":null,y?"wal":null].filter(Boolean).join("|"),R=(S=this.headers.get("Accept"))!==null&&S!==void 0?S:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${x}; for="${R}"; options=${N};`),x==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(i){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${i}`),this}}return Vo.default=r,Vo}var af;function Zu(){if(af)return Fo;af=1;var u=Fo&&Fo.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Fo,"__esModule",{value:!0});const n=u(Kf());class r extends n.default{eq(i,h){return this.url.searchParams.append(i,`eq.${h}`),this}neq(i,h){return this.url.searchParams.append(i,`neq.${h}`),this}gt(i,h){return this.url.searchParams.append(i,`gt.${h}`),this}gte(i,h){return this.url.searchParams.append(i,`gte.${h}`),this}lt(i,h){return this.url.searchParams.append(i,`lt.${h}`),this}lte(i,h){return this.url.searchParams.append(i,`lte.${h}`),this}like(i,h){return this.url.searchParams.append(i,`like.${h}`),this}likeAllOf(i,h){return this.url.searchParams.append(i,`like(all).{${h.join(",")}}`),this}likeAnyOf(i,h){return this.url.searchParams.append(i,`like(any).{${h.join(",")}}`),this}ilike(i,h){return this.url.searchParams.append(i,`ilike.${h}`),this}ilikeAllOf(i,h){return this.url.searchParams.append(i,`ilike(all).{${h.join(",")}}`),this}ilikeAnyOf(i,h){return this.url.searchParams.append(i,`ilike(any).{${h.join(",")}}`),this}is(i,h){return this.url.searchParams.append(i,`is.${h}`),this}in(i,h){const d=Array.from(new Set(h)).map(p=>typeof p=="string"&&new RegExp("[,()]").test(p)?`"${p}"`:`${p}`).join(",");return this.url.searchParams.append(i,`in.(${d})`),this}contains(i,h){return typeof h=="string"?this.url.searchParams.append(i,`cs.${h}`):Array.isArray(h)?this.url.searchParams.append(i,`cs.{${h.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(h)}`),this}containedBy(i,h){return typeof h=="string"?this.url.searchParams.append(i,`cd.${h}`):Array.isArray(h)?this.url.searchParams.append(i,`cd.{${h.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(h)}`),this}rangeGt(i,h){return this.url.searchParams.append(i,`sr.${h}`),this}rangeGte(i,h){return this.url.searchParams.append(i,`nxl.${h}`),this}rangeLt(i,h){return this.url.searchParams.append(i,`sl.${h}`),this}rangeLte(i,h){return this.url.searchParams.append(i,`nxr.${h}`),this}rangeAdjacent(i,h){return this.url.searchParams.append(i,`adj.${h}`),this}overlaps(i,h){return typeof h=="string"?this.url.searchParams.append(i,`ov.${h}`):this.url.searchParams.append(i,`ov.{${h.join(",")}}`),this}textSearch(i,h,{config:d,type:p}={}){let y="";p==="plain"?y="pl":p==="phrase"?y="ph":p==="websearch"&&(y="w");const x=d===void 0?"":`(${d})`;return this.url.searchParams.append(i,`${y}fts${x}.${h}`),this}match(i){return Object.entries(i).forEach(([h,d])=>{this.url.searchParams.append(h,`eq.${d}`)}),this}not(i,h,d){return this.url.searchParams.append(i,`not.${h}.${d}`),this}or(i,{foreignTable:h,referencedTable:d=h}={}){const p=d?`${d}.or`:"or";return this.url.searchParams.append(p,`(${i})`),this}filter(i,h,d){return this.url.searchParams.append(i,`${h}.${d}`),this}}return Fo.default=r,Fo}var lf;function Gf(){if(lf)return Uo;lf=1;var u=Uo&&Uo.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Uo,"__esModule",{value:!0});const n=u(Zu());class r{constructor(i,{headers:h={},schema:d,fetch:p}){this.url=i,this.headers=new Headers(h),this.schema=d,this.fetch=p}select(i,{head:h=!1,count:d}={}){const p=h?"HEAD":"GET";let y=!1;const x=(i??"*").split("").map(S=>/\s/.test(S)&&!y?"":(S==='"'&&(y=!y),S)).join("");return this.url.searchParams.set("select",x),d&&this.headers.append("Prefer",`count=${d}`),new n.default({method:p,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(i,{count:h,defaultToNull:d=!0}={}){var p;const y="POST";if(h&&this.headers.append("Prefer",`count=${h}`),d||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const x=i.reduce((S,N)=>S.concat(Object.keys(N)),[]);if(x.length>0){const S=[...new Set(x)].map(N=>`"${N}"`);this.url.searchParams.set("columns",S.join(","))}}return new n.default({method:y,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(p=this.fetch)!==null&&p!==void 0?p:fetch})}upsert(i,{onConflict:h,ignoreDuplicates:d=!1,count:p,defaultToNull:y=!0}={}){var x;const S="POST";if(this.headers.append("Prefer",`resolution=${d?"ignore":"merge"}-duplicates`),h!==void 0&&this.url.searchParams.set("on_conflict",h),p&&this.headers.append("Prefer",`count=${p}`),y||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const N=i.reduce((R,L)=>R.concat(Object.keys(L)),[]);if(N.length>0){const R=[...new Set(N)].map(L=>`"${L}"`);this.url.searchParams.set("columns",R.join(","))}}return new n.default({method:S,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(x=this.fetch)!==null&&x!==void 0?x:fetch})}update(i,{count:h}={}){var d;const p="PATCH";return h&&this.headers.append("Prefer",`count=${h}`),new n.default({method:p,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}delete({count:i}={}){var h;const d="DELETE";return i&&this.headers.append("Prefer",`count=${i}`),new n.default({method:d,url:this.url,headers:this.headers,schema:this.schema,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}}return Uo.default=r,Uo}var cf;function zp(){if(cf)return Mo;cf=1;var u=Mo&&Mo.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Mo,"__esModule",{value:!0});const n=u(Gf()),r=u(Zu());class a{constructor(h,{headers:d={},schema:p,fetch:y}={}){this.url=h,this.headers=new Headers(d),this.schemaName=p,this.fetch=y}from(h){const d=new URL(`${this.url}/${h}`);return new n.default(d,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(h){return new a(this.url,{headers:this.headers,schema:h,fetch:this.fetch})}rpc(h,d={},{head:p=!1,get:y=!1,count:x}={}){var S;let N;const R=new URL(`${this.url}/rpc/${h}`);let L;p||y?(N=p?"HEAD":"GET",Object.entries(d).filter(([B,I])=>I!==void 0).map(([B,I])=>[B,Array.isArray(I)?`{${I.join(",")}}`:`${I}`]).forEach(([B,I])=>{R.searchParams.append(B,I)})):(N="POST",L=d);const F=new Headers(this.headers);return x&&F.set("Prefer",`count=${x}`),new r.default({method:N,url:R,headers:F,schema:this.schemaName,body:L,fetch:(S=this.fetch)!==null&&S!==void 0?S:fetch})}}return Mo.default=a,Mo}var uf;function Wp(){if(uf)return _t;uf=1;var u=_t&&_t.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(_t,"__esModule",{value:!0}),_t.PostgrestError=_t.PostgrestBuilder=_t.PostgrestTransformBuilder=_t.PostgrestFilterBuilder=_t.PostgrestQueryBuilder=_t.PostgrestClient=void 0;const n=u(zp());_t.PostgrestClient=n.default;const r=u(Gf());_t.PostgrestQueryBuilder=r.default;const a=u(Zu());_t.PostgrestFilterBuilder=a.default;const i=u(Kf());_t.PostgrestTransformBuilder=i.default;const h=u(qf());_t.PostgrestBuilder=h.default;const d=u(Hf());return _t.PostgrestError=d.default,_t.default={PostgrestClient:n.default,PostgrestQueryBuilder:r.default,PostgrestFilterBuilder:a.default,PostgrestTransformBuilder:i.default,PostgrestBuilder:h.default,PostgrestError:d.default},_t}var Hp=Wp();const qp=Hu(Hp),{PostgrestClient:Kp,PostgrestQueryBuilder:Zv,PostgrestFilterBuilder:ey,PostgrestTransformBuilder:ty,PostgrestBuilder:ry,PostgrestError:ny}=qp;class Gp{static detectEnvironment(){var n;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((n=navigator.userAgent)===null||n===void 0)&&n.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const r=parseInt(process.versions.node.split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const n=this.detectEnvironment();if(n.constructor)return n.constructor;let r=n.error||"WebSocket not supported in this environment.";throw n.workaround&&(r+=`

Suggested solution: ${n.workaround}`),new Error(r)}static createWebSocket(n,r){const a=this.getWebSocketConstructor();return new a(n,r)}static isWebSocketSupported(){try{const n=this.detectEnvironment();return n.type==="native"||n.type==="ws"}catch{return!1}}}const Jp="2.15.4",Qp=`realtime-js/${Jp}`,Yp="1.0.0",Du=1e4,Xp=1e3,Zp=100;var Qa;(function(u){u[u.connecting=0]="connecting",u[u.open=1]="open",u[u.closing=2]="closing",u[u.closed=3]="closed"})(Qa||(Qa={}));var vt;(function(u){u.closed="closed",u.errored="errored",u.joined="joined",u.joining="joining",u.leaving="leaving"})(vt||(vt={}));var Hr;(function(u){u.close="phx_close",u.error="phx_error",u.join="phx_join",u.reply="phx_reply",u.leave="phx_leave",u.access_token="access_token"})(Hr||(Hr={}));var Lu;(function(u){u.websocket="websocket"})(Lu||(Lu={}));var to;(function(u){u.Connecting="connecting",u.Open="open",u.Closing="closing",u.Closed="closed"})(to||(to={}));class e0{constructor(){this.HEADER_LENGTH=1}decode(n,r){return n.constructor===ArrayBuffer?r(this._binaryDecode(n)):r(typeof n=="string"?JSON.parse(n):{})}_binaryDecode(n){const r=new DataView(n),a=new TextDecoder;return this._decodeBroadcast(n,r,a)}_decodeBroadcast(n,r,a){const i=r.getUint8(1),h=r.getUint8(2);let d=this.HEADER_LENGTH+2;const p=a.decode(n.slice(d,d+i));d=d+i;const y=a.decode(n.slice(d,d+h));d=d+h;const x=JSON.parse(a.decode(n.slice(d,n.byteLength)));return{ref:null,topic:p,event:y,payload:x}}}class Jf{constructor(n,r){this.callback=n,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=n,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var et;(function(u){u.abstime="abstime",u.bool="bool",u.date="date",u.daterange="daterange",u.float4="float4",u.float8="float8",u.int2="int2",u.int4="int4",u.int4range="int4range",u.int8="int8",u.int8range="int8range",u.json="json",u.jsonb="jsonb",u.money="money",u.numeric="numeric",u.oid="oid",u.reltime="reltime",u.text="text",u.time="time",u.timestamp="timestamp",u.timestamptz="timestamptz",u.timetz="timetz",u.tsrange="tsrange",u.tstzrange="tstzrange"})(et||(et={}));const df=(u,n,r={})=>{var a;const i=(a=r.skipTypes)!==null&&a!==void 0?a:[];return Object.keys(n).reduce((h,d)=>(h[d]=t0(d,u,n,i),h),{})},t0=(u,n,r,a)=>{const i=n.find(p=>p.name===u),h=i?.type,d=r[u];return h&&!a.includes(h)?Qf(h,d):Au(d)},Qf=(u,n)=>{if(u.charAt(0)==="_"){const r=u.slice(1,u.length);return o0(n,r)}switch(u){case et.bool:return r0(n);case et.float4:case et.float8:case et.int2:case et.int4:case et.int8:case et.numeric:case et.oid:return n0(n);case et.json:case et.jsonb:return s0(n);case et.timestamp:return a0(n);case et.abstime:case et.date:case et.daterange:case et.int4range:case et.int8range:case et.money:case et.reltime:case et.text:case et.time:case et.timestamptz:case et.timetz:case et.tsrange:case et.tstzrange:return Au(n);default:return Au(n)}},Au=u=>u,r0=u=>{switch(u){case"t":return!0;case"f":return!1;default:return u}},n0=u=>{if(typeof u=="string"){const n=parseFloat(u);if(!Number.isNaN(n))return n}return u},s0=u=>{if(typeof u=="string")try{return JSON.parse(u)}catch(n){return console.log(`JSON parse error: ${n}`),u}return u},o0=(u,n)=>{if(typeof u!="string")return u;const r=u.length-1,a=u[r];if(u[0]==="{"&&a==="}"){let h;const d=u.slice(1,r);try{h=JSON.parse("["+d+"]")}catch{h=d?d.split(","):[]}return h.map(p=>Qf(n,p))}return u},a0=u=>typeof u=="string"?u.replace(" ","T"):u,Yf=u=>{let n=u;return n=n.replace(/^ws/i,"http"),n=n.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),n.replace(/\/+$/,"")+"/api/broadcast"};class _u{constructor(n,r,a={},i=Du){this.channel=n,this.event=r,this.payload=a,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(n){this.timeout=n,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(n){this.payload=Object.assign(Object.assign({},this.payload),n)}receive(n,r){var a;return this._hasReceived(n)&&r((a=this.receivedResp)===null||a===void 0?void 0:a.response),this.recHooks.push({status:n,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const n=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},n),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(n,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:n,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:n,response:r}){this.recHooks.filter(a=>a.status===n).forEach(a=>a.callback(r))}_hasReceived(n){return this.receivedResp&&this.receivedResp.status===n}}var hf;(function(u){u.SYNC="sync",u.JOIN="join",u.LEAVE="leave"})(hf||(hf={}));class Ya{constructor(n,r){this.channel=n,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const a=r?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(a.state,{},i=>{const{onJoin:h,onLeave:d,onSync:p}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ya.syncState(this.state,i,h,d),this.pendingDiffs.forEach(y=>{this.state=Ya.syncDiff(this.state,y,h,d)}),this.pendingDiffs=[],p()}),this.channel._on(a.diff,{},i=>{const{onJoin:h,onLeave:d,onSync:p}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=Ya.syncDiff(this.state,i,h,d),p())}),this.onJoin((i,h,d)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:h,newPresences:d})}),this.onLeave((i,h,d)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:h,leftPresences:d})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(n,r,a,i){const h=this.cloneDeep(n),d=this.transformState(r),p={},y={};return this.map(h,(x,S)=>{d[x]||(y[x]=S)}),this.map(d,(x,S)=>{const N=h[x];if(N){const R=S.map(I=>I.presence_ref),L=N.map(I=>I.presence_ref),F=S.filter(I=>L.indexOf(I.presence_ref)<0),B=N.filter(I=>R.indexOf(I.presence_ref)<0);F.length>0&&(p[x]=F),B.length>0&&(y[x]=B)}else p[x]=S}),this.syncDiff(h,{joins:p,leaves:y},a,i)}static syncDiff(n,r,a,i){const{joins:h,leaves:d}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return a||(a=()=>{}),i||(i=()=>{}),this.map(h,(p,y)=>{var x;const S=(x=n[p])!==null&&x!==void 0?x:[];if(n[p]=this.cloneDeep(y),S.length>0){const N=n[p].map(L=>L.presence_ref),R=S.filter(L=>N.indexOf(L.presence_ref)<0);n[p].unshift(...R)}a(p,S,y)}),this.map(d,(p,y)=>{let x=n[p];if(!x)return;const S=y.map(N=>N.presence_ref);x=x.filter(N=>S.indexOf(N.presence_ref)<0),n[p]=x,i(p,x,y),x.length===0&&delete n[p]}),n}static map(n,r){return Object.getOwnPropertyNames(n).map(a=>r(a,n[a]))}static transformState(n){return n=this.cloneDeep(n),Object.getOwnPropertyNames(n).reduce((r,a)=>{const i=n[a];return"metas"in i?r[a]=i.metas.map(h=>(h.presence_ref=h.phx_ref,delete h.phx_ref,delete h.phx_ref_prev,h)):r[a]=i,r},{})}static cloneDeep(n){return JSON.parse(JSON.stringify(n))}onJoin(n){this.caller.onJoin=n}onLeave(n){this.caller.onLeave=n}onSync(n){this.caller.onSync=n}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ff;(function(u){u.ALL="*",u.INSERT="INSERT",u.UPDATE="UPDATE",u.DELETE="DELETE"})(ff||(ff={}));var Xa;(function(u){u.BROADCAST="broadcast",u.PRESENCE="presence",u.POSTGRES_CHANGES="postgres_changes",u.SYSTEM="system"})(Xa||(Xa={}));var En;(function(u){u.SUBSCRIBED="SUBSCRIBED",u.TIMED_OUT="TIMED_OUT",u.CLOSED="CLOSED",u.CHANNEL_ERROR="CHANNEL_ERROR"})(En||(En={}));class ed{constructor(n,r={config:{}},a){this.topic=n,this.params=r,this.socket=a,this.bindings={},this.state=vt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=n.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new _u(this,Hr.join,this.params,this.timeout),this.rejoinTimer=new Jf(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=vt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=vt.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=vt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=vt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=vt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Hr.reply,{},(i,h)=>{this._trigger(this._replyEventName(h),i)}),this.presence=new Ya(this),this.broadcastEndpointURL=Yf(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(n,r=this.timeout){var a,i,h;if(this.socket.isConnected()||this.socket.connect(),this.state==vt.closed){const{config:{broadcast:d,presence:p,private:y}}=this.params,x=(i=(a=this.bindings.postgres_changes)===null||a===void 0?void 0:a.map(L=>L.filter))!==null&&i!==void 0?i:[],S=!!this.bindings[Xa.PRESENCE]&&this.bindings[Xa.PRESENCE].length>0||((h=this.params.config.presence)===null||h===void 0?void 0:h.enabled)===!0,N={},R={broadcast:d,presence:Object.assign(Object.assign({},p),{enabled:S}),postgres_changes:x,private:y};this.socket.accessTokenValue&&(N.access_token=this.socket.accessTokenValue),this._onError(L=>n?.(En.CHANNEL_ERROR,L)),this._onClose(()=>n?.(En.CLOSED)),this.updateJoinPayload(Object.assign({config:R},N)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:L})=>{var F;if(this.socket.setAuth(),L===void 0){n?.(En.SUBSCRIBED);return}else{const B=this.bindings.postgres_changes,I=(F=B?.length)!==null&&F!==void 0?F:0,Z=[];for(let Y=0;Y<I;Y++){const H=B[Y],{filter:{event:q,schema:J,table:P,filter:V}}=H,te=L&&L[Y];if(te&&te.event===q&&te.schema===J&&te.table===P&&te.filter===V)Z.push(Object.assign(Object.assign({},H),{id:te.id}));else{this.unsubscribe(),this.state=vt.errored,n?.(En.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=Z,n&&n(En.SUBSCRIBED);return}}).receive("error",L=>{this.state=vt.errored,n?.(En.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(L).join(", ")||"error")))}).receive("timeout",()=>{n?.(En.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(n,r={}){return await this.send({type:"presence",event:"track",payload:n},r.timeout||this.timeout)}async untrack(n={}){return await this.send({type:"presence",event:"untrack"},n)}on(n,r,a){return this.state===vt.joined&&n===Xa.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(n,r,a)}async send(n,r={}){var a,i;if(!this._canPush()&&n.type==="broadcast"){const{event:h,payload:d}=n,y={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:h,payload:d,private:this.private}]})};try{const x=await this._fetchWithTimeout(this.broadcastEndpointURL,y,(a=r.timeout)!==null&&a!==void 0?a:this.timeout);return await((i=x.body)===null||i===void 0?void 0:i.cancel()),x.ok?"ok":"error"}catch(x){return x.name==="AbortError"?"timed out":"error"}}else return new Promise(h=>{var d,p,y;const x=this._push(n.type,n,r.timeout||this.timeout);n.type==="broadcast"&&!(!((y=(p=(d=this.params)===null||d===void 0?void 0:d.config)===null||p===void 0?void 0:p.broadcast)===null||y===void 0)&&y.ack)&&h("ok"),x.receive("ok",()=>h("ok")),x.receive("error",()=>h("error")),x.receive("timeout",()=>h("timed out"))})}updateJoinPayload(n){this.joinPush.updatePayload(n)}unsubscribe(n=this.timeout){this.state=vt.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Hr.close,"leave",this._joinRef())};this.joinPush.destroy();let a=null;return new Promise(i=>{a=new _u(this,Hr.leave,{},n),a.receive("ok",()=>{r(),i("ok")}).receive("timeout",()=>{r(),i("timed out")}).receive("error",()=>{i("error")}),a.send(),this._canPush()||a.trigger("ok",{})}).finally(()=>{a?.destroy()})}teardown(){this.pushBuffer.forEach(n=>n.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=vt.closed,this.bindings={}}async _fetchWithTimeout(n,r,a){const i=new AbortController,h=setTimeout(()=>i.abort(),a),d=await this.socket.fetch(n,Object.assign(Object.assign({},r),{signal:i.signal}));return clearTimeout(h),d}_push(n,r,a=this.timeout){if(!this.joinedOnce)throw`tried to push '${n}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new _u(this,n,r,a);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(n){if(n.startTimeout(),this.pushBuffer.push(n),this.pushBuffer.length>Zp){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(n,r,a){return r}_isMember(n){return this.topic===n}_joinRef(){return this.joinPush.ref}_trigger(n,r,a){var i,h;const d=n.toLocaleLowerCase(),{close:p,error:y,leave:x,join:S}=Hr;if(a&&[p,y,x,S].indexOf(d)>=0&&a!==this._joinRef())return;let R=this._onMessage(d,r,a);if(r&&!R)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(d)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(L=>{var F,B,I;return((F=L.filter)===null||F===void 0?void 0:F.event)==="*"||((I=(B=L.filter)===null||B===void 0?void 0:B.event)===null||I===void 0?void 0:I.toLocaleLowerCase())===d}).map(L=>L.callback(R,a)):(h=this.bindings[d])===null||h===void 0||h.filter(L=>{var F,B,I,Z,Y,H;if(["broadcast","presence","postgres_changes"].includes(d))if("id"in L){const q=L.id,J=(F=L.filter)===null||F===void 0?void 0:F.event;return q&&((B=r.ids)===null||B===void 0?void 0:B.includes(q))&&(J==="*"||J?.toLocaleLowerCase()===((I=r.data)===null||I===void 0?void 0:I.type.toLocaleLowerCase()))}else{const q=(Y=(Z=L?.filter)===null||Z===void 0?void 0:Z.event)===null||Y===void 0?void 0:Y.toLocaleLowerCase();return q==="*"||q===((H=r?.event)===null||H===void 0?void 0:H.toLocaleLowerCase())}else return L.type.toLocaleLowerCase()===d}).map(L=>{if(typeof R=="object"&&"ids"in R){const F=R.data,{schema:B,table:I,commit_timestamp:Z,type:Y,errors:H}=F;R=Object.assign(Object.assign({},{schema:B,table:I,commit_timestamp:Z,eventType:Y,new:{},old:{},errors:H}),this._getPayloadRecords(F))}L.callback(R,a)})}_isClosed(){return this.state===vt.closed}_isJoined(){return this.state===vt.joined}_isJoining(){return this.state===vt.joining}_isLeaving(){return this.state===vt.leaving}_replyEventName(n){return`chan_reply_${n}`}_on(n,r,a){const i=n.toLocaleLowerCase(),h={type:i,filter:r,callback:a};return this.bindings[i]?this.bindings[i].push(h):this.bindings[i]=[h],this}_off(n,r){const a=n.toLocaleLowerCase();return this.bindings[a]&&(this.bindings[a]=this.bindings[a].filter(i=>{var h;return!(((h=i.type)===null||h===void 0?void 0:h.toLocaleLowerCase())===a&&ed.isEqual(i.filter,r))})),this}static isEqual(n,r){if(Object.keys(n).length!==Object.keys(r).length)return!1;for(const a in n)if(n[a]!==r[a])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(n){this._on(Hr.close,{},n)}_onError(n){this._on(Hr.error,{},r=>n(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(n=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=vt.joining,this.joinPush.resend(n))}_getPayloadRecords(n){const r={new:{},old:{}};return(n.type==="INSERT"||n.type==="UPDATE")&&(r.new=df(n.columns,n.record)),(n.type==="UPDATE"||n.type==="DELETE")&&(r.old=df(n.columns,n.old_record)),r}}const ku=()=>{},Sl={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},i0=[1e3,2e3,5e3,1e4],l0=1e4,c0=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class u0{constructor(n,r){var a;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Du,this.transport=null,this.heartbeatIntervalMs=Sl.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=ku,this.ref=0,this.reconnectTimer=null,this.logger=ku,this.conn=null,this.sendBuffer=[],this.serializer=new e0,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=i=>{let h;return i?h=i:typeof fetch>"u"?h=(...d)=>ea(async()=>{const{default:p}=await Promise.resolve().then(()=>ta);return{default:p}},void 0).then(({default:p})=>p(...d)).catch(p=>{throw new Error(`Failed to load @supabase/node-fetch: ${p.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):h=fetch,(...d)=>h(...d)},!(!((a=r?.params)===null||a===void 0)&&a.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${n}/${Lu.websocket}`,this.httpEndpoint=Yf(n),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Gp.createWebSocket(this.endpointURL())}catch(n){this._setConnectionState("disconnected");const r=n.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Yp}))}disconnect(n,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const a=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(a),this._setConnectionState("disconnected")},n?this.conn.close(n,r??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(n){const r=await n.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const n=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),n}log(n,r,a){this.logger(n,r,a)}connectionState(){switch(this.conn&&this.conn.readyState){case Qa.connecting:return to.Connecting;case Qa.open:return to.Open;case Qa.closing:return to.Closing;default:return to.Closed}}isConnected(){return this.connectionState()===to.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(n,r={config:{}}){const a=`realtime:${n}`,i=this.getChannels().find(h=>h.topic===a);if(i)return i;{const h=new ed(`realtime:${n}`,r,this);return this.channels.push(h),h}}push(n){const{topic:r,event:a,payload:i,ref:h}=n,d=()=>{this.encode(n,p=>{var y;(y=this.conn)===null||y===void 0||y.send(p)})};this.log("push",`${r} ${a} (${h})`,i),this.isConnected()?d():this.sendBuffer.push(d)}async setAuth(n=null){this._authPromise=this._performAuth(n);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var n;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(n=this.conn)===null||n===void 0||n.close(Xp,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},Sl.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(n){this.heartbeatCallback=n}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(n=>n()),this.sendBuffer=[])}_makeRef(){let n=this.ref+1;return n===this.ref?this.ref=0:this.ref=n,this.ref.toString()}_leaveOpenTopic(n){let r=this.channels.find(a=>a.topic===n&&(a._isJoined()||a._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${n}"`),r.unsubscribe())}_remove(n){this.channels=this.channels.filter(r=>r.topic!==n.topic)}_onConnMessage(n){this.decode(n.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply")try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error")}catch(x){this.log("error","error in heartbeat callback",x)}r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:a,event:i,payload:h,ref:d}=r,p=d?`(${d})`:"",y=h.status||"";this.log("receive",`${y} ${a} ${i} ${p}`.trim(),h),this.channels.filter(x=>x._isMember(a)).forEach(x=>x._trigger(i,h,d)),this._triggerStateCallbacks("message",r)})}_clearTimer(n){var r;n==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):n==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=n=>this._onConnError(n),this.conn.onmessage=n=>this._onConnMessage(n),this.conn.onclose=n=>this._onConnClose(n))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(n=>n.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const n=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(n),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(n){var r;this._setConnectionState("disconnected"),this.log("transport","close",n),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",n)}_onConnError(n){this._setConnectionState("disconnected"),this.log("transport",`${n}`),this._triggerChanError(),this._triggerStateCallbacks("error",n)}_triggerChanError(){this.channels.forEach(n=>n._trigger(Hr.error))}_appendParams(n,r){if(Object.keys(r).length===0)return n;const a=n.match(/\?/)?"&":"?",i=new URLSearchParams(r);return`${n}${a}${i}`}_workerObjectUrl(n){let r;if(n)r=n;else{const a=new Blob([c0],{type:"application/javascript"});r=URL.createObjectURL(a)}return r}_setConnectionState(n,r=!1){this._connectionState=n,n==="connecting"?this._wasManualDisconnect=!1:n==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(n=null){let r;n?r=n:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(a=>{const i={access_token:r,version:Qp};r&&a.updateJoinPayload(i),a.joinedOnce&&a._isJoined()&&a._push(Hr.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(n="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${n}`,r)})}_triggerStateCallbacks(n,r){try{this.stateChangeCallbacks[n].forEach(a=>{try{a(r)}catch(i){this.log("error",`error in ${n} callback`,i)}})}catch(a){this.log("error",`error triggering ${n} callbacks`,a)}}_setupReconnectionTimer(){this.reconnectTimer=new Jf(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Sl.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(n){var r,a,i,h,d,p,y,x,S;if(this.transport=(r=n?.transport)!==null&&r!==void 0?r:null,this.timeout=(a=n?.timeout)!==null&&a!==void 0?a:Du,this.heartbeatIntervalMs=(i=n?.heartbeatIntervalMs)!==null&&i!==void 0?i:Sl.HEARTBEAT_INTERVAL,this.worker=(h=n?.worker)!==null&&h!==void 0?h:!1,this.accessToken=(d=n?.accessToken)!==null&&d!==void 0?d:null,this.heartbeatCallback=(p=n?.heartbeatCallback)!==null&&p!==void 0?p:ku,n?.params&&(this.params=n.params),n?.logger&&(this.logger=n.logger),(n?.logLevel||n?.log_level)&&(this.logLevel=n.logLevel||n.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(y=n?.reconnectAfterMs)!==null&&y!==void 0?y:(N=>i0[N-1]||l0),this.encode=(x=n?.encode)!==null&&x!==void 0?x:((N,R)=>R(JSON.stringify(N))),this.decode=(S=n?.decode)!==null&&S!==void 0?S:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=n?.workerUrl}}}class td extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}}function yt(u){return typeof u=="object"&&u!==null&&"__isStorageError"in u}class d0 extends td{constructor(n,r,a){super(n),this.name="StorageApiError",this.status=r,this.statusCode=a}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class $u extends td{constructor(n,r){super(n),this.name="StorageUnknownError",this.originalError=r}}var h0=function(u,n,r,a){function i(h){return h instanceof r?h:new r(function(d){d(h)})}return new(r||(r=Promise))(function(h,d){function p(S){try{x(a.next(S))}catch(N){d(N)}}function y(S){try{x(a.throw(S))}catch(N){d(N)}}function x(S){S.done?h(S.value):i(S.value).then(p,y)}x((a=a.apply(u,n||[])).next())})};const Xf=u=>{let n;return u?n=u:typeof fetch>"u"?n=(...r)=>ea(async()=>{const{default:a}=await Promise.resolve().then(()=>ta);return{default:a}},void 0).then(({default:a})=>a(...r)):n=fetch,(...r)=>n(...r)},f0=()=>h0(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield ea(()=>Promise.resolve().then(()=>ta),void 0)).Response:Response}),Mu=u=>{if(Array.isArray(u))return u.map(r=>Mu(r));if(typeof u=="function"||u!==Object(u))return u;const n={};return Object.entries(u).forEach(([r,a])=>{const i=r.replace(/([-_][a-z])/gi,h=>h.toUpperCase().replace(/[-_]/g,""));n[i]=Mu(a)}),n},m0=u=>{if(typeof u!="object"||u===null)return!1;const n=Object.getPrototypeOf(u);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(Symbol.toStringTag in u)&&!(Symbol.iterator in u)};var ro=function(u,n,r,a){function i(h){return h instanceof r?h:new r(function(d){d(h)})}return new(r||(r=Promise))(function(h,d){function p(S){try{x(a.next(S))}catch(N){d(N)}}function y(S){try{x(a.throw(S))}catch(N){d(N)}}function x(S){S.done?h(S.value):i(S.value).then(p,y)}x((a=a.apply(u,n||[])).next())})};const Eu=u=>u.msg||u.message||u.error_description||u.error||JSON.stringify(u),g0=(u,n,r)=>ro(void 0,void 0,void 0,function*(){const a=yield f0();u instanceof a&&!r?.noResolveJson?u.json().then(i=>{const h=u.status||500,d=i?.statusCode||h+"";n(new d0(Eu(i),h,d))}).catch(i=>{n(new $u(Eu(i),i))}):n(new $u(Eu(u),u))}),p0=(u,n,r,a)=>{const i={method:u,headers:n?.headers||{}};return u==="GET"||!a?i:(m0(a)?(i.headers=Object.assign({"Content-Type":"application/json"},n?.headers),i.body=JSON.stringify(a)):i.body=a,n?.duplex&&(i.duplex=n.duplex),Object.assign(Object.assign({},i),r))};function si(u,n,r,a,i,h){return ro(this,void 0,void 0,function*(){return new Promise((d,p)=>{u(r,p0(n,a,i,h)).then(y=>{if(!y.ok)throw y;return a?.noResolveJson?y:y.json()}).then(y=>d(y)).catch(y=>g0(y,p,a))})})}function Ol(u,n,r,a){return ro(this,void 0,void 0,function*(){return si(u,"GET",n,r,a)})}function nn(u,n,r,a,i){return ro(this,void 0,void 0,function*(){return si(u,"POST",n,a,i,r)})}function Uu(u,n,r,a,i){return ro(this,void 0,void 0,function*(){return si(u,"PUT",n,a,i,r)})}function v0(u,n,r,a){return ro(this,void 0,void 0,function*(){return si(u,"HEAD",n,Object.assign(Object.assign({},r),{noResolveJson:!0}),a)})}function Zf(u,n,r,a,i){return ro(this,void 0,void 0,function*(){return si(u,"DELETE",n,a,i,r)})}var Gt=function(u,n,r,a){function i(h){return h instanceof r?h:new r(function(d){d(h)})}return new(r||(r=Promise))(function(h,d){function p(S){try{x(a.next(S))}catch(N){d(N)}}function y(S){try{x(a.throw(S))}catch(N){d(N)}}function x(S){S.done?h(S.value):i(S.value).then(p,y)}x((a=a.apply(u,n||[])).next())})};const y0={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},mf={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class x0{constructor(n,r={},a,i){this.url=n,this.headers=r,this.bucketId=a,this.fetch=Xf(i)}uploadOrUpdate(n,r,a,i){return Gt(this,void 0,void 0,function*(){try{let h;const d=Object.assign(Object.assign({},mf),i);let p=Object.assign(Object.assign({},this.headers),n==="POST"&&{"x-upsert":String(d.upsert)});const y=d.metadata;typeof Blob<"u"&&a instanceof Blob?(h=new FormData,h.append("cacheControl",d.cacheControl),y&&h.append("metadata",this.encodeMetadata(y)),h.append("",a)):typeof FormData<"u"&&a instanceof FormData?(h=a,h.append("cacheControl",d.cacheControl),y&&h.append("metadata",this.encodeMetadata(y))):(h=a,p["cache-control"]=`max-age=${d.cacheControl}`,p["content-type"]=d.contentType,y&&(p["x-metadata"]=this.toBase64(this.encodeMetadata(y)))),i?.headers&&(p=Object.assign(Object.assign({},p),i.headers));const x=this._removeEmptyFolders(r),S=this._getFinalPath(x),N=yield(n=="PUT"?Uu:nn)(this.fetch,`${this.url}/object/${S}`,h,Object.assign({headers:p},d?.duplex?{duplex:d.duplex}:{}));return{data:{path:x,id:N.Id,fullPath:N.Key},error:null}}catch(h){if(yt(h))return{data:null,error:h};throw h}})}upload(n,r,a){return Gt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",n,r,a)})}uploadToSignedUrl(n,r,a,i){return Gt(this,void 0,void 0,function*(){const h=this._removeEmptyFolders(n),d=this._getFinalPath(h),p=new URL(this.url+`/object/upload/sign/${d}`);p.searchParams.set("token",r);try{let y;const x=Object.assign({upsert:mf.upsert},i),S=Object.assign(Object.assign({},this.headers),{"x-upsert":String(x.upsert)});typeof Blob<"u"&&a instanceof Blob?(y=new FormData,y.append("cacheControl",x.cacheControl),y.append("",a)):typeof FormData<"u"&&a instanceof FormData?(y=a,y.append("cacheControl",x.cacheControl)):(y=a,S["cache-control"]=`max-age=${x.cacheControl}`,S["content-type"]=x.contentType);const N=yield Uu(this.fetch,p.toString(),y,{headers:S});return{data:{path:h,fullPath:N.Key},error:null}}catch(y){if(yt(y))return{data:null,error:y};throw y}})}createSignedUploadUrl(n,r){return Gt(this,void 0,void 0,function*(){try{let a=this._getFinalPath(n);const i=Object.assign({},this.headers);r?.upsert&&(i["x-upsert"]="true");const h=yield nn(this.fetch,`${this.url}/object/upload/sign/${a}`,{},{headers:i}),d=new URL(this.url+h.url),p=d.searchParams.get("token");if(!p)throw new td("No token returned by API");return{data:{signedUrl:d.toString(),path:n,token:p},error:null}}catch(a){if(yt(a))return{data:null,error:a};throw a}})}update(n,r,a){return Gt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",n,r,a)})}move(n,r,a){return Gt(this,void 0,void 0,function*(){try{return{data:yield nn(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:n,destinationKey:r,destinationBucket:a?.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(yt(i))return{data:null,error:i};throw i}})}copy(n,r,a){return Gt(this,void 0,void 0,function*(){try{return{data:{path:(yield nn(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:n,destinationKey:r,destinationBucket:a?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(yt(i))return{data:null,error:i};throw i}})}createSignedUrl(n,r,a){return Gt(this,void 0,void 0,function*(){try{let i=this._getFinalPath(n),h=yield nn(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:r},a?.transform?{transform:a.transform}:{}),{headers:this.headers});const d=a?.download?`&download=${a.download===!0?"":a.download}`:"";return h={signedUrl:encodeURI(`${this.url}${h.signedURL}${d}`)},{data:h,error:null}}catch(i){if(yt(i))return{data:null,error:i};throw i}})}createSignedUrls(n,r,a){return Gt(this,void 0,void 0,function*(){try{const i=yield nn(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:n},{headers:this.headers}),h=a?.download?`&download=${a.download===!0?"":a.download}`:"";return{data:i.map(d=>Object.assign(Object.assign({},d),{signedUrl:d.signedURL?encodeURI(`${this.url}${d.signedURL}${h}`):null})),error:null}}catch(i){if(yt(i))return{data:null,error:i};throw i}})}download(n,r){return Gt(this,void 0,void 0,function*(){const i=typeof r?.transform<"u"?"render/image/authenticated":"object",h=this.transformOptsToQueryString(r?.transform||{}),d=h?`?${h}`:"";try{const p=this._getFinalPath(n);return{data:yield(yield Ol(this.fetch,`${this.url}/${i}/${p}${d}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(p){if(yt(p))return{data:null,error:p};throw p}})}info(n){return Gt(this,void 0,void 0,function*(){const r=this._getFinalPath(n);try{const a=yield Ol(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:Mu(a),error:null}}catch(a){if(yt(a))return{data:null,error:a};throw a}})}exists(n){return Gt(this,void 0,void 0,function*(){const r=this._getFinalPath(n);try{return yield v0(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(a){if(yt(a)&&a instanceof $u){const i=a.originalError;if([400,404].includes(i?.status))return{data:!1,error:a}}throw a}})}getPublicUrl(n,r){const a=this._getFinalPath(n),i=[],h=r?.download?`download=${r.download===!0?"":r.download}`:"";h!==""&&i.push(h);const p=typeof r?.transform<"u"?"render/image":"object",y=this.transformOptsToQueryString(r?.transform||{});y!==""&&i.push(y);let x=i.join("&");return x!==""&&(x=`?${x}`),{data:{publicUrl:encodeURI(`${this.url}/${p}/public/${a}${x}`)}}}remove(n){return Gt(this,void 0,void 0,function*(){try{return{data:yield Zf(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:n},{headers:this.headers}),error:null}}catch(r){if(yt(r))return{data:null,error:r};throw r}})}list(n,r,a){return Gt(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},y0),r),{prefix:n||""});return{data:yield nn(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},a),error:null}}catch(i){if(yt(i))return{data:null,error:i};throw i}})}listV2(n,r){return Gt(this,void 0,void 0,function*(){try{const a=Object.assign({},n);return{data:yield nn(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,a,{headers:this.headers},r),error:null}}catch(a){if(yt(a))return{data:null,error:a};throw a}})}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const r=[];return n.width&&r.push(`width=${n.width}`),n.height&&r.push(`height=${n.height}`),n.resize&&r.push(`resize=${n.resize}`),n.format&&r.push(`format=${n.format}`),n.quality&&r.push(`quality=${n.quality}`),r.join("&")}}const b0="2.11.1",w0={"X-Client-Info":`storage-js/${b0}`};var zo=function(u,n,r,a){function i(h){return h instanceof r?h:new r(function(d){d(h)})}return new(r||(r=Promise))(function(h,d){function p(S){try{x(a.next(S))}catch(N){d(N)}}function y(S){try{x(a.throw(S))}catch(N){d(N)}}function x(S){S.done?h(S.value):i(S.value).then(p,y)}x((a=a.apply(u,n||[])).next())})};class S0{constructor(n,r={},a,i){const h=new URL(n);i?.useNewHostname&&/supabase\.(co|in|red)$/.test(h.hostname)&&!h.hostname.includes("storage.supabase.")&&(h.hostname=h.hostname.replace("supabase.","storage.supabase.")),this.url=h.href,this.headers=Object.assign(Object.assign({},w0),r),this.fetch=Xf(a)}listBuckets(){return zo(this,void 0,void 0,function*(){try{return{data:yield Ol(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(n){if(yt(n))return{data:null,error:n};throw n}})}getBucket(n){return zo(this,void 0,void 0,function*(){try{return{data:yield Ol(this.fetch,`${this.url}/bucket/${n}`,{headers:this.headers}),error:null}}catch(r){if(yt(r))return{data:null,error:r};throw r}})}createBucket(n,r={public:!1}){return zo(this,void 0,void 0,function*(){try{return{data:yield nn(this.fetch,`${this.url}/bucket`,{id:n,name:n,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(yt(a))return{data:null,error:a};throw a}})}updateBucket(n,r){return zo(this,void 0,void 0,function*(){try{return{data:yield Uu(this.fetch,`${this.url}/bucket/${n}`,{id:n,name:n,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(yt(a))return{data:null,error:a};throw a}})}emptyBucket(n){return zo(this,void 0,void 0,function*(){try{return{data:yield nn(this.fetch,`${this.url}/bucket/${n}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(yt(r))return{data:null,error:r};throw r}})}deleteBucket(n){return zo(this,void 0,void 0,function*(){try{return{data:yield Zf(this.fetch,`${this.url}/bucket/${n}`,{},{headers:this.headers}),error:null}}catch(r){if(yt(r))return{data:null,error:r};throw r}})}}class _0 extends S0{constructor(n,r={},a,i){super(n,r,a,i)}from(n){return new x0(this.url,this.headers,n,this.fetch)}}const k0="2.57.0";let Ja="";typeof Deno<"u"?Ja="deno":typeof document<"u"?Ja="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ja="react-native":Ja="node";const E0={"X-Client-Info":`supabase-js-${Ja}/${k0}`},N0={headers:E0},j0={schema:"public"},T0={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},C0={};var R0=function(u,n,r,a){function i(h){return h instanceof r?h:new r(function(d){d(h)})}return new(r||(r=Promise))(function(h,d){function p(S){try{x(a.next(S))}catch(N){d(N)}}function y(S){try{x(a.throw(S))}catch(N){d(N)}}function x(S){S.done?h(S.value):i(S.value).then(p,y)}x((a=a.apply(u,n||[])).next())})};const O0=u=>{let n;return u?n=u:typeof fetch>"u"?n=zf:n=fetch,(...r)=>n(...r)},I0=()=>typeof Headers>"u"?Wf:Headers,P0=(u,n,r)=>{const a=O0(r),i=I0();return(h,d)=>R0(void 0,void 0,void 0,function*(){var p;const y=(p=yield n())!==null&&p!==void 0?p:u;let x=new i(d?.headers);return x.has("apikey")||x.set("apikey",u),x.has("Authorization")||x.set("Authorization",`Bearer ${y}`),a(h,Object.assign(Object.assign({},d),{headers:x}))})};var D0=function(u,n,r,a){function i(h){return h instanceof r?h:new r(function(d){d(h)})}return new(r||(r=Promise))(function(h,d){function p(S){try{x(a.next(S))}catch(N){d(N)}}function y(S){try{x(a.throw(S))}catch(N){d(N)}}function x(S){S.done?h(S.value):i(S.value).then(p,y)}x((a=a.apply(u,n||[])).next())})};function L0(u){return u.endsWith("/")?u:u+"/"}function A0(u,n){var r,a;const{db:i,auth:h,realtime:d,global:p}=u,{db:y,auth:x,realtime:S,global:N}=n,R={db:Object.assign(Object.assign({},y),i),auth:Object.assign(Object.assign({},x),h),realtime:Object.assign(Object.assign({},S),d),storage:{},global:Object.assign(Object.assign(Object.assign({},N),p),{headers:Object.assign(Object.assign({},(r=N?.headers)!==null&&r!==void 0?r:{}),(a=p?.headers)!==null&&a!==void 0?a:{})}),accessToken:()=>D0(this,void 0,void 0,function*(){return""})};return u.accessToken?R.accessToken=u.accessToken:delete R.accessToken,R}const em="2.71.1",Go=30*1e3,Fu=3,Nu=Fu*Go,$0="http://localhost:9999",M0="supabase.auth.token",U0={"X-Client-Info":`gotrue-js/${em}`},Vu="X-Supabase-Api-Version",tm={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},F0=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,V0=600*1e3;class rd extends Error{constructor(n,r,a){super(n),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=a}}function Le(u){return typeof u=="object"&&u!==null&&"__isAuthError"in u}class B0 extends rd{constructor(n,r,a){super(n,r,a),this.name="AuthApiError",this.status=r,this.code=a}}function z0(u){return Le(u)&&u.name==="AuthApiError"}class rm extends rd{constructor(n,r){super(n),this.name="AuthUnknownError",this.originalError=r}}class as extends rd{constructor(n,r,a,i){super(n,a,i),this.name=r,this.status=a}}class ss extends as{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function W0(u){return Le(u)&&u.name==="AuthSessionMissingError"}class _l extends as{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class kl extends as{constructor(n){super(n,"AuthInvalidCredentialsError",400,void 0)}}class El extends as{constructor(n,r=null){super(n,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function H0(u){return Le(u)&&u.name==="AuthImplicitGrantRedirectError"}class gf extends as{constructor(n,r=null){super(n,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Bu extends as{constructor(n,r){super(n,"AuthRetryableFetchError",r,void 0)}}function ju(u){return Le(u)&&u.name==="AuthRetryableFetchError"}class pf extends as{constructor(n,r,a){super(n,"AuthWeakPasswordError",r,"weak_password"),this.reasons=a}}class zu extends as{constructor(n){super(n,"AuthInvalidJwtError",400,"invalid_jwt")}}const Il="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),vf=` 	
\r=`.split(""),q0=(()=>{const u=new Array(128);for(let n=0;n<u.length;n+=1)u[n]=-1;for(let n=0;n<vf.length;n+=1)u[vf[n].charCodeAt(0)]=-2;for(let n=0;n<Il.length;n+=1)u[Il[n].charCodeAt(0)]=n;return u})();function yf(u,n,r){if(u!==null)for(n.queue=n.queue<<8|u,n.queuedBits+=8;n.queuedBits>=6;){const a=n.queue>>n.queuedBits-6&63;r(Il[a]),n.queuedBits-=6}else if(n.queuedBits>0)for(n.queue=n.queue<<6-n.queuedBits,n.queuedBits=6;n.queuedBits>=6;){const a=n.queue>>n.queuedBits-6&63;r(Il[a]),n.queuedBits-=6}}function nm(u,n,r){const a=q0[u];if(a>-1)for(n.queue=n.queue<<6|a,n.queuedBits+=6;n.queuedBits>=8;)r(n.queue>>n.queuedBits-8&255),n.queuedBits-=8;else{if(a===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(u)}"`)}}function xf(u){const n=[],r=d=>{n.push(String.fromCodePoint(d))},a={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},h=d=>{J0(d,a,r)};for(let d=0;d<u.length;d+=1)nm(u.charCodeAt(d),i,h);return n.join("")}function K0(u,n){if(u<=127){n(u);return}else if(u<=2047){n(192|u>>6),n(128|u&63);return}else if(u<=65535){n(224|u>>12),n(128|u>>6&63),n(128|u&63);return}else if(u<=1114111){n(240|u>>18),n(128|u>>12&63),n(128|u>>6&63),n(128|u&63);return}throw new Error(`Unrecognized Unicode codepoint: ${u.toString(16)}`)}function G0(u,n){for(let r=0;r<u.length;r+=1){let a=u.charCodeAt(r);if(a>55295&&a<=56319){const i=(a-55296)*1024&65535;a=(u.charCodeAt(r+1)-56320&65535|i)+65536,r+=1}K0(a,n)}}function J0(u,n,r){if(n.utf8seq===0){if(u<=127){r(u);return}for(let a=1;a<6;a+=1)if((u>>7-a&1)===0){n.utf8seq=a;break}if(n.utf8seq===2)n.codepoint=u&31;else if(n.utf8seq===3)n.codepoint=u&15;else if(n.utf8seq===4)n.codepoint=u&7;else throw new Error("Invalid UTF-8 sequence");n.utf8seq-=1}else if(n.utf8seq>0){if(u<=127)throw new Error("Invalid UTF-8 sequence");n.codepoint=n.codepoint<<6|u&63,n.utf8seq-=1,n.utf8seq===0&&r(n.codepoint)}}function Q0(u){const n=[],r={queue:0,queuedBits:0},a=i=>{n.push(i)};for(let i=0;i<u.length;i+=1)nm(u.charCodeAt(i),r,a);return new Uint8Array(n)}function Y0(u){const n=[];return G0(u,r=>n.push(r)),new Uint8Array(n)}function X0(u){const n=[],r={queue:0,queuedBits:0},a=i=>{n.push(i)};return u.forEach(i=>yf(i,r,a)),yf(null,r,a),n.join("")}function Z0(u){return Math.round(Date.now()/1e3)+u}function ev(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){const n=Math.random()*16|0;return(u=="x"?n:n&3|8).toString(16)})}const Wr=()=>typeof window<"u"&&typeof document<"u",Qs={tested:!1,writable:!1},sm=()=>{if(!Wr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Qs.tested)return Qs.writable;const u=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(u,u),globalThis.localStorage.removeItem(u),Qs.tested=!0,Qs.writable=!0}catch{Qs.tested=!0,Qs.writable=!1}return Qs.writable};function tv(u){const n={},r=new URL(u);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((i,h)=>{n[h]=i})}catch{}return r.searchParams.forEach((a,i)=>{n[i]=a}),n}const om=u=>{let n;return u?n=u:typeof fetch>"u"?n=(...r)=>ea(async()=>{const{default:a}=await Promise.resolve().then(()=>ta);return{default:a}},void 0).then(({default:a})=>a(...r)):n=fetch,(...r)=>n(...r)},rv=u=>typeof u=="object"&&u!==null&&"status"in u&&"ok"in u&&"json"in u&&typeof u.json=="function",Jo=async(u,n,r)=>{await u.setItem(n,JSON.stringify(r))},Ys=async(u,n)=>{const r=await u.getItem(n);if(!r)return null;try{return JSON.parse(r)}catch{return r}},ns=async(u,n)=>{await u.removeItem(n)};class Ll{constructor(){this.promise=new Ll.promiseConstructor((n,r)=>{this.resolve=n,this.reject=r})}}Ll.promiseConstructor=Promise;function Tu(u){const n=u.split(".");if(n.length!==3)throw new zu("Invalid JWT structure");for(let a=0;a<n.length;a++)if(!F0.test(n[a]))throw new zu("JWT not in base64url format");return{header:JSON.parse(xf(n[0])),payload:JSON.parse(xf(n[1])),signature:Q0(n[2]),raw:{header:n[0],payload:n[1]}}}async function nv(u){return await new Promise(n=>{setTimeout(()=>n(null),u)})}function sv(u,n){return new Promise((a,i)=>{(async()=>{for(let h=0;h<1/0;h++)try{const d=await u(h);if(!n(h,null,d)){a(d);return}}catch(d){if(!n(h,d)){i(d);return}}})()})}function ov(u){return("0"+u.toString(16)).substr(-2)}function av(){const n=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",a=r.length;let i="";for(let h=0;h<56;h++)i+=r.charAt(Math.floor(Math.random()*a));return i}return crypto.getRandomValues(n),Array.from(n,ov).join("")}async function iv(u){const r=new TextEncoder().encode(u),a=await crypto.subtle.digest("SHA-256",r),i=new Uint8Array(a);return Array.from(i).map(h=>String.fromCharCode(h)).join("")}async function lv(u){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),u;const r=await iv(u);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Wo(u,n,r=!1){const a=av();let i=a;r&&(i+="/PASSWORD_RECOVERY"),await Jo(u,`${n}-code-verifier`,i);const h=await lv(a);return[h,a===h?"plain":"s256"]}const cv=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function uv(u){const n=u.headers.get(Vu);if(!n||!n.match(cv))return null;try{return new Date(`${n}T00:00:00.0Z`)}catch{return null}}function dv(u){if(!u)throw new Error("Missing exp claim");const n=Math.floor(Date.now()/1e3);if(u<=n)throw new Error("JWT has expired")}function hv(u){switch(u){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const fv=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ho(u){if(!fv.test(u))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Cu(){const u={};return new Proxy(u,{get:(n,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const a=r.toString();if(a==="Symbol(Symbol.toPrimitive)"||a==="Symbol(Symbol.toStringTag)"||a==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(n,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(n,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function bf(u){return JSON.parse(JSON.stringify(u))}var mv=function(u,n){var r={};for(var a in u)Object.prototype.hasOwnProperty.call(u,a)&&n.indexOf(a)<0&&(r[a]=u[a]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,a=Object.getOwnPropertySymbols(u);i<a.length;i++)n.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(u,a[i])&&(r[a[i]]=u[a[i]]);return r};const eo=u=>u.msg||u.message||u.error_description||u.error||JSON.stringify(u),gv=[502,503,504];async function wf(u){var n;if(!rv(u))throw new Bu(eo(u),0);if(gv.includes(u.status))throw new Bu(eo(u),u.status);let r;try{r=await u.json()}catch(h){throw new rm(eo(h),h)}let a;const i=uv(u);if(i&&i.getTime()>=tm["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?a=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(a=r.error_code),a){if(a==="weak_password")throw new pf(eo(r),u.status,((n=r.weak_password)===null||n===void 0?void 0:n.reasons)||[]);if(a==="session_not_found")throw new ss}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((h,d)=>h&&typeof d=="string",!0))throw new pf(eo(r),u.status,r.weak_password.reasons);throw new B0(eo(r),u.status||500,a)}const pv=(u,n,r,a)=>{const i={method:u,headers:n?.headers||{}};return u==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},n?.headers),i.body=JSON.stringify(a),Object.assign(Object.assign({},i),r))};async function Fe(u,n,r,a){var i;const h=Object.assign({},a?.headers);h[Vu]||(h[Vu]=tm["2024-01-01"].name),a?.jwt&&(h.Authorization=`Bearer ${a.jwt}`);const d=(i=a?.query)!==null&&i!==void 0?i:{};a?.redirectTo&&(d.redirect_to=a.redirectTo);const p=Object.keys(d).length?"?"+new URLSearchParams(d).toString():"",y=await vv(u,n,r+p,{headers:h,noResolveJson:a?.noResolveJson},{},a?.body);return a?.xform?a?.xform(y):{data:Object.assign({},y),error:null}}async function vv(u,n,r,a,i,h){const d=pv(n,a,i,h);let p;try{p=await u(r,Object.assign({},d))}catch(y){throw console.error(y),new Bu(eo(y),0)}if(p.ok||await wf(p),a?.noResolveJson)return p;try{return await p.json()}catch(y){await wf(y)}}function kn(u){var n;let r=null;wv(u)&&(r=Object.assign({},u),u.expires_at||(r.expires_at=Z0(u.expires_in)));const a=(n=u.user)!==null&&n!==void 0?n:u;return{data:{session:r,user:a},error:null}}function Sf(u){const n=kn(u);return!n.error&&u.weak_password&&typeof u.weak_password=="object"&&Array.isArray(u.weak_password.reasons)&&u.weak_password.reasons.length&&u.weak_password.message&&typeof u.weak_password.message=="string"&&u.weak_password.reasons.reduce((r,a)=>r&&typeof a=="string",!0)&&(n.data.weak_password=u.weak_password),n}function os(u){var n;return{data:{user:(n=u.user)!==null&&n!==void 0?n:u},error:null}}function yv(u){return{data:u,error:null}}function xv(u){const{action_link:n,email_otp:r,hashed_token:a,redirect_to:i,verification_type:h}=u,d=mv(u,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),p={action_link:n,email_otp:r,hashed_token:a,redirect_to:i,verification_type:h},y=Object.assign({},d);return{data:{properties:p,user:y},error:null}}function bv(u){return u}function wv(u){return u.access_token&&u.refresh_token&&u.expires_in}const Ru=["global","local","others"];var Sv=function(u,n){var r={};for(var a in u)Object.prototype.hasOwnProperty.call(u,a)&&n.indexOf(a)<0&&(r[a]=u[a]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,a=Object.getOwnPropertySymbols(u);i<a.length;i++)n.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(u,a[i])&&(r[a[i]]=u[a[i]]);return r};class _v{constructor({url:n="",headers:r={},fetch:a}){this.url=n,this.headers=r,this.fetch=om(a),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(n,r=Ru[0]){if(Ru.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Ru.join(", ")}`);try{return await Fe(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:n,noResolveJson:!0}),{data:null,error:null}}catch(a){if(Le(a))return{data:null,error:a};throw a}}async inviteUserByEmail(n,r={}){try{return await Fe(this.fetch,"POST",`${this.url}/invite`,{body:{email:n,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:os})}catch(a){if(Le(a))return{data:{user:null},error:a};throw a}}async generateLink(n){try{const{options:r}=n,a=Sv(n,["options"]),i=Object.assign(Object.assign({},a),r);return"newEmail"in a&&(i.new_email=a?.newEmail,delete i.newEmail),await Fe(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:xv,redirectTo:r?.redirectTo})}catch(r){if(Le(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(n){try{return await Fe(this.fetch,"POST",`${this.url}/admin/users`,{body:n,headers:this.headers,xform:os})}catch(r){if(Le(r))return{data:{user:null},error:r};throw r}}async listUsers(n){var r,a,i,h,d,p,y;try{const x={nextPage:null,lastPage:0,total:0},S=await Fe(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(r=n?.page)===null||r===void 0?void 0:r.toString())!==null&&a!==void 0?a:"",per_page:(h=(i=n?.perPage)===null||i===void 0?void 0:i.toString())!==null&&h!==void 0?h:""},xform:bv});if(S.error)throw S.error;const N=await S.json(),R=(d=S.headers.get("x-total-count"))!==null&&d!==void 0?d:0,L=(y=(p=S.headers.get("link"))===null||p===void 0?void 0:p.split(","))!==null&&y!==void 0?y:[];return L.length>0&&(L.forEach(F=>{const B=parseInt(F.split(";")[0].split("=")[1].substring(0,1)),I=JSON.parse(F.split(";")[1].split("=")[1]);x[`${I}Page`]=B}),x.total=parseInt(R)),{data:Object.assign(Object.assign({},N),x),error:null}}catch(x){if(Le(x))return{data:{users:[]},error:x};throw x}}async getUserById(n){Ho(n);try{return await Fe(this.fetch,"GET",`${this.url}/admin/users/${n}`,{headers:this.headers,xform:os})}catch(r){if(Le(r))return{data:{user:null},error:r};throw r}}async updateUserById(n,r){Ho(n);try{return await Fe(this.fetch,"PUT",`${this.url}/admin/users/${n}`,{body:r,headers:this.headers,xform:os})}catch(a){if(Le(a))return{data:{user:null},error:a};throw a}}async deleteUser(n,r=!1){Ho(n);try{return await Fe(this.fetch,"DELETE",`${this.url}/admin/users/${n}`,{headers:this.headers,body:{should_soft_delete:r},xform:os})}catch(a){if(Le(a))return{data:{user:null},error:a};throw a}}async _listFactors(n){Ho(n.userId);try{const{data:r,error:a}=await Fe(this.fetch,"GET",`${this.url}/admin/users/${n.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:r,error:a}}catch(r){if(Le(r))return{data:null,error:r};throw r}}async _deleteFactor(n){Ho(n.userId),Ho(n.id);try{return{data:await Fe(this.fetch,"DELETE",`${this.url}/admin/users/${n.userId}/factors/${n.id}`,{headers:this.headers}),error:null}}catch(r){if(Le(r))return{data:null,error:r};throw r}}}function _f(u={}){return{getItem:n=>u[n]||null,setItem:(n,r)=>{u[n]=r},removeItem:n=>{delete u[n]}}}function kv(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const qo={debug:!!(globalThis&&sm()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class am extends Error{constructor(n){super(n),this.isAcquireTimeout=!0}}class Ev extends am{}async function Nv(u,n,r){qo.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",u,n);const a=new globalThis.AbortController;return n>0&&setTimeout(()=>{a.abort(),qo.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",u)},n),await Promise.resolve().then(()=>globalThis.navigator.locks.request(u,n===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:a.signal},async i=>{if(i){qo.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",u,i.name);try{return await r()}finally{qo.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",u,i.name)}}else{if(n===0)throw qo.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",u),new Ev(`Acquiring an exclusive Navigator LockManager lock "${u}" immediately failed`);if(qo.debug)try{const h=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(h,null,"  "))}catch(h){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",h)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}kv();const jv={url:$0,storageKey:M0,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:U0,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function kf(u,n,r){return await r()}const Ko={};class ei{constructor(n){var r,a;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ei.nextInstanceID,ei.nextInstanceID+=1,this.instanceID>0&&Wr()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},jv),n);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new _v({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=om(i.fetch),this.lock=i.lock||kf,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:Wr()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=Nv:this.lock=kf,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:sm()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=_f(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=_f(this.memoryStorage)),Wr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(h){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",h)}(a=this.broadcastChannel)===null||a===void 0||a.addEventListener("message",async h=>{this._debug("received broadcast notification from other tab or client",h),await this._notifyAllSubscribers(h.data.event,h.data.session,!1)})}this.initialize()}get jwks(){var n,r;return(r=(n=Ko[this.storageKey])===null||n===void 0?void 0:n.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(n){Ko[this.storageKey]=Object.assign(Object.assign({},Ko[this.storageKey]),{jwks:n})}get jwks_cached_at(){var n,r;return(r=(n=Ko[this.storageKey])===null||n===void 0?void 0:n.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(n){Ko[this.storageKey]=Object.assign(Object.assign({},Ko[this.storageKey]),{cachedAt:n})}_debug(...n){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${em}) ${new Date().toISOString()}`,...n),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var n;try{const r=tv(window.location.href);let a="none";if(this._isImplicitGrantCallback(r)?a="implicit":await this._isPKCECallback(r)&&(a="pkce"),Wr()&&this.detectSessionInUrl&&a!=="none"){const{data:i,error:h}=await this._getSessionFromURL(r,a);if(h){if(this._debug("#_initialize()","error detecting session from URL",h),H0(h)){const y=(n=h.details)===null||n===void 0?void 0:n.code;if(y==="identity_already_exists"||y==="identity_not_found"||y==="single_identity_not_deletable")return{error:h}}return await this._removeSession(),{error:h}}const{session:d,redirectType:p}=i;return this._debug("#_initialize()","detected session in URL",d,"redirect type",p),await this._saveSession(d),setTimeout(async()=>{p==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",d):await this._notifyAllSubscribers("SIGNED_IN",d)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return Le(r)?{error:r}:{error:new rm("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(n){var r,a,i;try{const h=await Fe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(a=(r=n?.options)===null||r===void 0?void 0:r.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:(i=n?.options)===null||i===void 0?void 0:i.captchaToken}},xform:kn}),{data:d,error:p}=h;if(p||!d)return{data:{user:null,session:null},error:p};const y=d.session,x=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",y)),{data:{user:x,session:y},error:null}}catch(h){if(Le(h))return{data:{user:null,session:null},error:h};throw h}}async signUp(n){var r,a,i;try{let h;if("email"in n){const{email:S,password:N,options:R}=n;let L=null,F=null;this.flowType==="pkce"&&([L,F]=await Wo(this.storage,this.storageKey)),h=await Fe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:R?.emailRedirectTo,body:{email:S,password:N,data:(r=R?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:R?.captchaToken},code_challenge:L,code_challenge_method:F},xform:kn})}else if("phone"in n){const{phone:S,password:N,options:R}=n;h=await Fe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:S,password:N,data:(a=R?.data)!==null&&a!==void 0?a:{},channel:(i=R?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:R?.captchaToken}},xform:kn})}else throw new kl("You must provide either an email or phone number and a password");const{data:d,error:p}=h;if(p||!d)return{data:{user:null,session:null},error:p};const y=d.session,x=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",y)),{data:{user:x,session:y},error:null}}catch(h){if(Le(h))return{data:{user:null,session:null},error:h};throw h}}async signInWithPassword(n){try{let r;if("email"in n){const{email:h,password:d,options:p}=n;r=await Fe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:h,password:d,gotrue_meta_security:{captcha_token:p?.captchaToken}},xform:Sf})}else if("phone"in n){const{phone:h,password:d,options:p}=n;r=await Fe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:h,password:d,gotrue_meta_security:{captcha_token:p?.captchaToken}},xform:Sf})}else throw new kl("You must provide either an email or phone number and a password");const{data:a,error:i}=r;return i?{data:{user:null,session:null},error:i}:!a||!a.session||!a.user?{data:{user:null,session:null},error:new _l}:(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:Object.assign({user:a.user,session:a.session},a.weak_password?{weakPassword:a.weak_password}:null),error:i})}catch(r){if(Le(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(n){var r,a,i,h;return await this._handleProviderSignIn(n.provider,{redirectTo:(r=n.options)===null||r===void 0?void 0:r.redirectTo,scopes:(a=n.options)===null||a===void 0?void 0:a.scopes,queryParams:(i=n.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(h=n.options)===null||h===void 0?void 0:h.skipBrowserRedirect})}async exchangeCodeForSession(n){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(n))}async signInWithWeb3(n){const{chain:r}=n;if(r==="solana")return await this.signInWithSolana(n);throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}async signInWithSolana(n){var r,a,i,h,d,p,y,x,S,N,R,L;let F,B;if("message"in n)F=n.message,B=n.signature;else{const{chain:I,wallet:Z,statement:Y,options:H}=n;let q;if(Wr())if(typeof Z=="object")q=Z;else{const P=window;if("solana"in P&&typeof P.solana=="object"&&("signIn"in P.solana&&typeof P.solana.signIn=="function"||"signMessage"in P.solana&&typeof P.solana.signMessage=="function"))q=P.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof Z!="object"||!H?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");q=Z}const J=new URL((r=H?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in q&&q.signIn){const P=await q.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},H?.signInWithSolana),{version:"1",domain:J.host,uri:J.href}),Y?{statement:Y}:null));let V;if(Array.isArray(P)&&P[0]&&typeof P[0]=="object")V=P[0];else if(P&&typeof P=="object"&&"signedMessage"in P&&"signature"in P)V=P;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in V&&"signature"in V&&(typeof V.signedMessage=="string"||V.signedMessage instanceof Uint8Array)&&V.signature instanceof Uint8Array)F=typeof V.signedMessage=="string"?V.signedMessage:new TextDecoder().decode(V.signedMessage),B=V.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in q)||typeof q.signMessage!="function"||!("publicKey"in q)||typeof q!="object"||!q.publicKey||!("toBase58"in q.publicKey)||typeof q.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");F=[`${J.host} wants you to sign in with your Solana account:`,q.publicKey.toBase58(),...Y?["",Y,""]:[""],"Version: 1",`URI: ${J.href}`,`Issued At: ${(i=(a=H?.signInWithSolana)===null||a===void 0?void 0:a.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((h=H?.signInWithSolana)===null||h===void 0)&&h.notBefore?[`Not Before: ${H.signInWithSolana.notBefore}`]:[],...!((d=H?.signInWithSolana)===null||d===void 0)&&d.expirationTime?[`Expiration Time: ${H.signInWithSolana.expirationTime}`]:[],...!((p=H?.signInWithSolana)===null||p===void 0)&&p.chainId?[`Chain ID: ${H.signInWithSolana.chainId}`]:[],...!((y=H?.signInWithSolana)===null||y===void 0)&&y.nonce?[`Nonce: ${H.signInWithSolana.nonce}`]:[],...!((x=H?.signInWithSolana)===null||x===void 0)&&x.requestId?[`Request ID: ${H.signInWithSolana.requestId}`]:[],...!((N=(S=H?.signInWithSolana)===null||S===void 0?void 0:S.resources)===null||N===void 0)&&N.length?["Resources",...H.signInWithSolana.resources.map(V=>`- ${V}`)]:[]].join(`
`);const P=await q.signMessage(new TextEncoder().encode(F),"utf8");if(!P||!(P instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");B=P}}try{const{data:I,error:Z}=await Fe(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:F,signature:X0(B)},!((R=n.options)===null||R===void 0)&&R.captchaToken?{gotrue_meta_security:{captcha_token:(L=n.options)===null||L===void 0?void 0:L.captchaToken}}:null),xform:kn});if(Z)throw Z;return!I||!I.session||!I.user?{data:{user:null,session:null},error:new _l}:(I.session&&(await this._saveSession(I.session),await this._notifyAllSubscribers("SIGNED_IN",I.session)),{data:Object.assign({},I),error:Z})}catch(I){if(Le(I))return{data:{user:null,session:null},error:I};throw I}}async _exchangeCodeForSession(n){const r=await Ys(this.storage,`${this.storageKey}-code-verifier`),[a,i]=(r??"").split("/");try{const{data:h,error:d}=await Fe(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:n,code_verifier:a},xform:kn});if(await ns(this.storage,`${this.storageKey}-code-verifier`),d)throw d;return!h||!h.session||!h.user?{data:{user:null,session:null,redirectType:null},error:new _l}:(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),{data:Object.assign(Object.assign({},h),{redirectType:i??null}),error:d})}catch(h){if(Le(h))return{data:{user:null,session:null,redirectType:null},error:h};throw h}}async signInWithIdToken(n){try{const{options:r,provider:a,token:i,access_token:h,nonce:d}=n,p=await Fe(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:a,id_token:i,access_token:h,nonce:d,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:kn}),{data:y,error:x}=p;return x?{data:{user:null,session:null},error:x}:!y||!y.session||!y.user?{data:{user:null,session:null},error:new _l}:(y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),{data:y,error:x})}catch(r){if(Le(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(n){var r,a,i,h,d;try{if("email"in n){const{email:p,options:y}=n;let x=null,S=null;this.flowType==="pkce"&&([x,S]=await Wo(this.storage,this.storageKey));const{error:N}=await Fe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:p,data:(r=y?.data)!==null&&r!==void 0?r:{},create_user:(a=y?.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:y?.captchaToken},code_challenge:x,code_challenge_method:S},redirectTo:y?.emailRedirectTo});return{data:{user:null,session:null},error:N}}if("phone"in n){const{phone:p,options:y}=n,{data:x,error:S}=await Fe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:p,data:(i=y?.data)!==null&&i!==void 0?i:{},create_user:(h=y?.shouldCreateUser)!==null&&h!==void 0?h:!0,gotrue_meta_security:{captcha_token:y?.captchaToken},channel:(d=y?.channel)!==null&&d!==void 0?d:"sms"}});return{data:{user:null,session:null,messageId:x?.message_id},error:S}}throw new kl("You must provide either an email or phone number.")}catch(p){if(Le(p))return{data:{user:null,session:null},error:p};throw p}}async verifyOtp(n){var r,a;try{let i,h;"options"in n&&(i=(r=n.options)===null||r===void 0?void 0:r.redirectTo,h=(a=n.options)===null||a===void 0?void 0:a.captchaToken);const{data:d,error:p}=await Fe(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},n),{gotrue_meta_security:{captcha_token:h}}),redirectTo:i,xform:kn});if(p)throw p;if(!d)throw new Error("An error occurred on token verification.");const y=d.session,x=d.user;return y?.access_token&&(await this._saveSession(y),await this._notifyAllSubscribers(n.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",y)),{data:{user:x,session:y},error:null}}catch(i){if(Le(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(n){var r,a,i;try{let h=null,d=null;return this.flowType==="pkce"&&([h,d]=await Wo(this.storage,this.storageKey)),await Fe(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in n?{provider_id:n.providerId}:null),"domain"in n?{domain:n.domain}:null),{redirect_to:(a=(r=n.options)===null||r===void 0?void 0:r.redirectTo)!==null&&a!==void 0?a:void 0}),!((i=n?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:n.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:h,code_challenge_method:d}),headers:this.headers,xform:yv})}catch(h){if(Le(h))return{data:null,error:h};throw h}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async n=>{const{data:{session:r},error:a}=n;if(a)throw a;if(!r)throw new ss;const{error:i}=await Fe(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:i}})}catch(n){if(Le(n))return{data:{user:null,session:null},error:n};throw n}}async resend(n){try{const r=`${this.url}/resend`;if("email"in n){const{email:a,type:i,options:h}=n,{error:d}=await Fe(this.fetch,"POST",r,{headers:this.headers,body:{email:a,type:i,gotrue_meta_security:{captcha_token:h?.captchaToken}},redirectTo:h?.emailRedirectTo});return{data:{user:null,session:null},error:d}}else if("phone"in n){const{phone:a,type:i,options:h}=n,{data:d,error:p}=await Fe(this.fetch,"POST",r,{headers:this.headers,body:{phone:a,type:i,gotrue_meta_security:{captcha_token:h?.captchaToken}}});return{data:{user:null,session:null,messageId:d?.message_id},error:p}}throw new kl("You must provide either an email or phone number and a type")}catch(r){if(Le(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(n,r){this._debug("#_acquireLock","begin",n);try{if(this.lockAcquired){const a=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await a,await r()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,n,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const a=r();for(this.pendingInLock.push((async()=>{try{await a}catch{}})()),await a;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await a}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(n){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await n(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let n=null;const r=await Ys(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?n=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!n)return{data:{session:null},error:null};const a=n.expires_at?n.expires_at*1e3-Date.now()<Nu:!1;if(this._debug("#__loadSession()",`session has${a?"":" not"} expired`,"expires_at",n.expires_at),!a){if(this.userStorage){const d=await Ys(this.userStorage,this.storageKey+"-user");d?.user?n.user=d.user:n.user=Cu()}if(this.storage.isServer&&n.user){let d=this.suppressGetSessionWarning;n=new Proxy(n,{get:(y,x,S)=>(!d&&x==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),d=!0,this.suppressGetSessionWarning=!0),Reflect.get(y,x,S))})}return{data:{session:n},error:null}}const{session:i,error:h}=await this._callRefreshToken(n.refresh_token);return h?{data:{session:null},error:h}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(n){return n?await this._getUser(n):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(n){try{return n?await Fe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:n,xform:os}):await this._useSession(async r=>{var a,i,h;const{data:d,error:p}=r;if(p)throw p;return!(!((a=d.session)===null||a===void 0)&&a.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ss}:await Fe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(h=(i=d.session)===null||i===void 0?void 0:i.access_token)!==null&&h!==void 0?h:void 0,xform:os})})}catch(r){if(Le(r))return W0(r)&&(await this._removeSession(),await ns(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(n,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(n,r))}async _updateUser(n,r={}){try{return await this._useSession(async a=>{const{data:i,error:h}=a;if(h)throw h;if(!i.session)throw new ss;const d=i.session;let p=null,y=null;this.flowType==="pkce"&&n.email!=null&&([p,y]=await Wo(this.storage,this.storageKey));const{data:x,error:S}=await Fe(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},n),{code_challenge:p,code_challenge_method:y}),jwt:d.access_token,xform:os});if(S)throw S;return d.user=x.user,await this._saveSession(d),await this._notifyAllSubscribers("USER_UPDATED",d),{data:{user:d.user},error:null}})}catch(a){if(Le(a))return{data:{user:null},error:a};throw a}}async setSession(n){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(n))}async _setSession(n){try{if(!n.access_token||!n.refresh_token)throw new ss;const r=Date.now()/1e3;let a=r,i=!0,h=null;const{payload:d}=Tu(n.access_token);if(d.exp&&(a=d.exp,i=a<=r),i){const{session:p,error:y}=await this._callRefreshToken(n.refresh_token);if(y)return{data:{user:null,session:null},error:y};if(!p)return{data:{user:null,session:null},error:null};h=p}else{const{data:p,error:y}=await this._getUser(n.access_token);if(y)throw y;h={access_token:n.access_token,refresh_token:n.refresh_token,user:p.user,token_type:"bearer",expires_in:a-r,expires_at:a},await this._saveSession(h),await this._notifyAllSubscribers("SIGNED_IN",h)}return{data:{user:h.user,session:h},error:null}}catch(r){if(Le(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(n){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(n))}async _refreshSession(n){try{return await this._useSession(async r=>{var a;if(!n){const{data:d,error:p}=r;if(p)throw p;n=(a=d.session)!==null&&a!==void 0?a:void 0}if(!n?.refresh_token)throw new ss;const{session:i,error:h}=await this._callRefreshToken(n.refresh_token);return h?{data:{user:null,session:null},error:h}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(Le(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(n,r){try{if(!Wr())throw new El("No browser detected.");if(n.error||n.error_description||n.error_code)throw new El(n.error_description||"Error in URL with unspecified error_description",{error:n.error||"unspecified_error",code:n.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new gf("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new El("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!n.code)throw new gf("No code detected.");const{data:Y,error:H}=await this._exchangeCodeForSession(n.code);if(H)throw H;const q=new URL(window.location.href);return q.searchParams.delete("code"),window.history.replaceState(window.history.state,"",q.toString()),{data:{session:Y.session,redirectType:null},error:null}}const{provider_token:a,provider_refresh_token:i,access_token:h,refresh_token:d,expires_in:p,expires_at:y,token_type:x}=n;if(!h||!p||!d||!x)throw new El("No session defined in URL");const S=Math.round(Date.now()/1e3),N=parseInt(p);let R=S+N;y&&(R=parseInt(y));const L=R-S;L*1e3<=Go&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${L}s, should have been closer to ${N}s`);const F=R-N;S-F>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",F,R,S):S-F<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",F,R,S);const{data:B,error:I}=await this._getUser(h);if(I)throw I;const Z={provider_token:a,provider_refresh_token:i,access_token:h,expires_in:N,expires_at:R,refresh_token:d,token_type:x,user:B.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:Z,redirectType:n.type},error:null}}catch(a){if(Le(a))return{data:{session:null,redirectType:null},error:a};throw a}}_isImplicitGrantCallback(n){return!!(n.access_token||n.error_description)}async _isPKCECallback(n){const r=await Ys(this.storage,`${this.storageKey}-code-verifier`);return!!(n.code&&r)}async signOut(n={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(n))}async _signOut({scope:n}={scope:"global"}){return await this._useSession(async r=>{var a;const{data:i,error:h}=r;if(h)return{error:h};const d=(a=i.session)===null||a===void 0?void 0:a.access_token;if(d){const{error:p}=await this.admin.signOut(d,n);if(p&&!(z0(p)&&(p.status===404||p.status===401||p.status===403)))return{error:p}}return n!=="others"&&(await this._removeSession(),await ns(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(n){const r=ev(),a={id:r,callback:n,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,a),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:a}}}async _emitInitialSession(n){return await this._useSession(async r=>{var a,i;try{const{data:{session:h},error:d}=r;if(d)throw d;await((a=this.stateChangeEmitters.get(n))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",h)),this._debug("INITIAL_SESSION","callback id",n,"session",h)}catch(h){await((i=this.stateChangeEmitters.get(n))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",n,"error",h),console.error(h)}})}async resetPasswordForEmail(n,r={}){let a=null,i=null;this.flowType==="pkce"&&([a,i]=await Wo(this.storage,this.storageKey,!0));try{return await Fe(this.fetch,"POST",`${this.url}/recover`,{body:{email:n,code_challenge:a,code_challenge_method:i,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(h){if(Le(h))return{data:null,error:h};throw h}}async getUserIdentities(){var n;try{const{data:r,error:a}=await this.getUser();if(a)throw a;return{data:{identities:(n=r.user.identities)!==null&&n!==void 0?n:[]},error:null}}catch(r){if(Le(r))return{data:null,error:r};throw r}}async linkIdentity(n){var r;try{const{data:a,error:i}=await this._useSession(async h=>{var d,p,y,x,S;const{data:N,error:R}=h;if(R)throw R;const L=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,n.provider,{redirectTo:(d=n.options)===null||d===void 0?void 0:d.redirectTo,scopes:(p=n.options)===null||p===void 0?void 0:p.scopes,queryParams:(y=n.options)===null||y===void 0?void 0:y.queryParams,skipBrowserRedirect:!0});return await Fe(this.fetch,"GET",L,{headers:this.headers,jwt:(S=(x=N.session)===null||x===void 0?void 0:x.access_token)!==null&&S!==void 0?S:void 0})});if(i)throw i;return Wr()&&!(!((r=n.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(a?.url),{data:{provider:n.provider,url:a?.url},error:null}}catch(a){if(Le(a))return{data:{provider:n.provider,url:null},error:a};throw a}}async unlinkIdentity(n){try{return await this._useSession(async r=>{var a,i;const{data:h,error:d}=r;if(d)throw d;return await Fe(this.fetch,"DELETE",`${this.url}/user/identities/${n.identity_id}`,{headers:this.headers,jwt:(i=(a=h.session)===null||a===void 0?void 0:a.access_token)!==null&&i!==void 0?i:void 0})})}catch(r){if(Le(r))return{data:null,error:r};throw r}}async _refreshAccessToken(n){const r=`#_refreshAccessToken(${n.substring(0,5)}...)`;this._debug(r,"begin");try{const a=Date.now();return await sv(async i=>(i>0&&await nv(200*Math.pow(2,i-1)),this._debug(r,"refreshing attempt",i),await Fe(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:n},headers:this.headers,xform:kn})),(i,h)=>{const d=200*Math.pow(2,i);return h&&ju(h)&&Date.now()+d-a<Go})}catch(a){if(this._debug(r,"error",a),Le(a))return{data:{session:null,user:null},error:a};throw a}finally{this._debug(r,"end")}}_isValidSession(n){return typeof n=="object"&&n!==null&&"access_token"in n&&"refresh_token"in n&&"expires_at"in n}async _handleProviderSignIn(n,r){const a=await this._getUrlForProvider(`${this.url}/authorize`,n,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",n,"options",r,"url",a),Wr()&&!r.skipBrowserRedirect&&window.location.assign(a),{data:{provider:n,url:a},error:null}}async _recoverAndRefresh(){var n,r;const a="#_recoverAndRefresh()";this._debug(a,"begin");try{const i=await Ys(this.storage,this.storageKey);if(i&&this.userStorage){let d=await Ys(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!d&&(d={user:i.user},await Jo(this.userStorage,this.storageKey+"-user",d)),i.user=(n=d?.user)!==null&&n!==void 0?n:Cu()}else if(i&&!i.user&&!i.user){const d=await Ys(this.storage,this.storageKey+"-user");d&&d?.user?(i.user=d.user,await ns(this.storage,this.storageKey+"-user"),await Jo(this.storage,this.storageKey,i)):i.user=Cu()}if(this._debug(a,"session from storage",i),!this._isValidSession(i)){this._debug(a,"session is not valid"),i!==null&&await this._removeSession();return}const h=((r=i.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<Nu;if(this._debug(a,`session has${h?"":" not"} expired with margin of ${Nu}s`),h){if(this.autoRefreshToken&&i.refresh_token){const{error:d}=await this._callRefreshToken(i.refresh_token);d&&(console.error(d),ju(d)||(this._debug(a,"refresh failed with a non-retryable error, removing the session",d),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:d,error:p}=await this._getUser(i.access_token);!p&&d?.user?(i.user=d.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(a,"could not get user data, skipping SIGNED_IN notification")}catch(d){console.error("Error getting user data:",d),this._debug(a,"error getting user data, skipping SIGNED_IN notification",d)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(a,"error",i),console.error(i);return}finally{this._debug(a,"end")}}async _callRefreshToken(n){var r,a;if(!n)throw new ss;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${n.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Ll;const{data:h,error:d}=await this._refreshAccessToken(n);if(d)throw d;if(!h.session)throw new ss;await this._saveSession(h.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",h.session);const p={session:h.session,error:null};return this.refreshingDeferred.resolve(p),p}catch(h){if(this._debug(i,"error",h),Le(h)){const d={session:null,error:h};return ju(h)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(d),d}throw(a=this.refreshingDeferred)===null||a===void 0||a.reject(h),h}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(n,r,a=!0){const i=`#_notifyAllSubscribers(${n})`;this._debug(i,"begin",r,`broadcast = ${a}`);try{this.broadcastChannel&&a&&this.broadcastChannel.postMessage({event:n,session:r});const h=[],d=Array.from(this.stateChangeEmitters.values()).map(async p=>{try{await p.callback(n,r)}catch(y){h.push(y)}});if(await Promise.all(d),h.length>0){for(let p=0;p<h.length;p+=1)console.error(h[p]);throw h[0]}}finally{this._debug(i,"end")}}async _saveSession(n){this._debug("#_saveSession()",n),this.suppressGetSessionWarning=!0;const r=Object.assign({},n),a=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!a&&r.user&&await Jo(this.userStorage,this.storageKey+"-user",{user:r.user});const i=Object.assign({},r);delete i.user;const h=bf(i);await Jo(this.storage,this.storageKey,h)}else{const i=bf(r);await Jo(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),await ns(this.storage,this.storageKey),await ns(this.storage,this.storageKey+"-code-verifier"),await ns(this.storage,this.storageKey+"-user"),this.userStorage&&await ns(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const n=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{n&&Wr()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",n)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const n=setInterval(()=>this._autoRefreshTokenTick(),Go);this.autoRefreshTicker=n,n&&typeof n=="object"&&typeof n.unref=="function"?n.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(n),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const n=this.autoRefreshTicker;this.autoRefreshTicker=null,n&&clearInterval(n)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const n=Date.now();try{return await this._useSession(async r=>{const{data:{session:a}}=r;if(!a||!a.refresh_token||!a.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((a.expires_at*1e3-n)/Go);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Go}ms, refresh threshold is ${Fu} ticks`),i<=Fu&&await this._callRefreshToken(a.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(n){if(n.isAcquireTimeout||n instanceof am)this._debug("auto refresh token tick lock not available");else throw n}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Wr()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(n){console.error("_handleVisibilityChange",n)}}async _onVisibilityChanged(n){const r=`#_onVisibilityChanged(${n})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),n||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(n,r,a){const i=[`provider=${encodeURIComponent(r)}`];if(a?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(a.redirectTo)}`),a?.scopes&&i.push(`scopes=${encodeURIComponent(a.scopes)}`),this.flowType==="pkce"){const[h,d]=await Wo(this.storage,this.storageKey),p=new URLSearchParams({code_challenge:`${encodeURIComponent(h)}`,code_challenge_method:`${encodeURIComponent(d)}`});i.push(p.toString())}if(a?.queryParams){const h=new URLSearchParams(a.queryParams);i.push(h.toString())}return a?.skipBrowserRedirect&&i.push(`skip_http_redirect=${a.skipBrowserRedirect}`),`${n}?${i.join("&")}`}async _unenroll(n){try{return await this._useSession(async r=>{var a;const{data:i,error:h}=r;return h?{data:null,error:h}:await Fe(this.fetch,"DELETE",`${this.url}/factors/${n.factorId}`,{headers:this.headers,jwt:(a=i?.session)===null||a===void 0?void 0:a.access_token})})}catch(r){if(Le(r))return{data:null,error:r};throw r}}async _enroll(n){try{return await this._useSession(async r=>{var a,i;const{data:h,error:d}=r;if(d)return{data:null,error:d};const p=Object.assign({friendly_name:n.friendlyName,factor_type:n.factorType},n.factorType==="phone"?{phone:n.phone}:{issuer:n.issuer}),{data:y,error:x}=await Fe(this.fetch,"POST",`${this.url}/factors`,{body:p,headers:this.headers,jwt:(a=h?.session)===null||a===void 0?void 0:a.access_token});return x?{data:null,error:x}:(n.factorType==="totp"&&(!((i=y?.totp)===null||i===void 0)&&i.qr_code)&&(y.totp.qr_code=`data:image/svg+xml;utf-8,${y.totp.qr_code}`),{data:y,error:null})})}catch(r){if(Le(r))return{data:null,error:r};throw r}}async _verify(n){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var a;const{data:i,error:h}=r;if(h)return{data:null,error:h};const{data:d,error:p}=await Fe(this.fetch,"POST",`${this.url}/factors/${n.factorId}/verify`,{body:{code:n.code,challenge_id:n.challengeId},headers:this.headers,jwt:(a=i?.session)===null||a===void 0?void 0:a.access_token});return p?{data:null,error:p}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+d.expires_in},d)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",d),{data:d,error:p})})}catch(r){if(Le(r))return{data:null,error:r};throw r}})}async _challenge(n){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var a;const{data:i,error:h}=r;return h?{data:null,error:h}:await Fe(this.fetch,"POST",`${this.url}/factors/${n.factorId}/challenge`,{body:{channel:n.channel},headers:this.headers,jwt:(a=i?.session)===null||a===void 0?void 0:a.access_token})})}catch(r){if(Le(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(n){const{data:r,error:a}=await this._challenge({factorId:n.factorId});return a?{data:null,error:a}:await this._verify({factorId:n.factorId,challengeId:r.id,code:n.code})}async _listFactors(){const{data:{user:n},error:r}=await this.getUser();if(r)return{data:null,error:r};const a=n?.factors||[],i=a.filter(d=>d.factor_type==="totp"&&d.status==="verified"),h=a.filter(d=>d.factor_type==="phone"&&d.status==="verified");return{data:{all:a,totp:i,phone:h},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async n=>{var r,a;const{data:{session:i},error:h}=n;if(h)return{data:null,error:h};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:d}=Tu(i.access_token);let p=null;d.aal&&(p=d.aal);let y=p;((a=(r=i.user.factors)===null||r===void 0?void 0:r.filter(N=>N.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(y="aal2");const S=d.amr||[];return{data:{currentLevel:p,nextLevel:y,currentAuthenticationMethods:S},error:null}}))}async fetchJwk(n,r={keys:[]}){let a=r.keys.find(p=>p.kid===n);if(a)return a;const i=Date.now();if(a=this.jwks.keys.find(p=>p.kid===n),a&&this.jwks_cached_at+V0>i)return a;const{data:h,error:d}=await Fe(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(d)throw d;return!h.keys||h.keys.length===0||(this.jwks=h,this.jwks_cached_at=i,a=h.keys.find(p=>p.kid===n),!a)?null:a}async getClaims(n,r={}){try{let a=n;if(!a){const{data:L,error:F}=await this.getSession();if(F||!L.session)return{data:null,error:F};a=L.session.access_token}const{header:i,payload:h,signature:d,raw:{header:p,payload:y}}=Tu(a);r?.allowExpired||dv(h.exp);const x=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,r?.keys?{keys:r.keys}:r?.jwks);if(!x){const{error:L}=await this.getUser(a);if(L)throw L;return{data:{claims:h,header:i,signature:d},error:null}}const S=hv(i.alg),N=await crypto.subtle.importKey("jwk",x,S,!0,["verify"]);if(!await crypto.subtle.verify(S,N,d,Y0(`${p}.${y}`)))throw new zu("Invalid JWT signature");return{data:{claims:h,header:i,signature:d},error:null}}catch(a){if(Le(a))return{data:null,error:a};throw a}}}ei.nextInstanceID=0;const Tv=ei;class Cv extends Tv{constructor(n){super(n)}}var Rv=function(u,n,r,a){function i(h){return h instanceof r?h:new r(function(d){d(h)})}return new(r||(r=Promise))(function(h,d){function p(S){try{x(a.next(S))}catch(N){d(N)}}function y(S){try{x(a.throw(S))}catch(N){d(N)}}function x(S){S.done?h(S.value):i(S.value).then(p,y)}x((a=a.apply(u,n||[])).next())})};class Ov{constructor(n,r,a){var i,h,d;if(this.supabaseUrl=n,this.supabaseKey=r,!n)throw new Error("supabaseUrl is required.");if(!r)throw new Error("supabaseKey is required.");const p=L0(n),y=new URL(p);this.realtimeUrl=new URL("realtime/v1",y),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",y),this.storageUrl=new URL("storage/v1",y),this.functionsUrl=new URL("functions/v1",y);const x=`sb-${y.hostname.split(".")[0]}-auth-token`,S={db:j0,realtime:C0,auth:Object.assign(Object.assign({},T0),{storageKey:x}),global:N0},N=A0(a??{},S);this.storageKey=(i=N.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(h=N.global.headers)!==null&&h!==void 0?h:{},N.accessToken?(this.accessToken=N.accessToken,this.auth=new Proxy({},{get:(R,L)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(L)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((d=N.auth)!==null&&d!==void 0?d:{},this.headers,N.global.fetch),this.fetch=P0(r,this._getAccessToken.bind(this),N.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},N.realtime)),this.rest=new Kp(new URL("rest/v1",y).href,{headers:this.headers,schema:N.db.schema,fetch:this.fetch}),this.storage=new _0(this.storageUrl.href,this.headers,this.fetch,a?.storage),N.accessToken||this._listenForAuthEvents()}get functions(){return new $p(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,r={},a={}){return this.rest.rpc(n,r,a)}channel(n,r={config:{}}){return this.realtime.channel(n,r)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var n,r;return Rv(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:a}=yield this.auth.getSession();return(r=(n=a.session)===null||n===void 0?void 0:n.access_token)!==null&&r!==void 0?r:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:r,detectSessionInUrl:a,storage:i,userStorage:h,storageKey:d,flowType:p,lock:y,debug:x},S,N){const R={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Cv({url:this.authUrl.href,headers:Object.assign(Object.assign({},R),S),storageKey:d,autoRefreshToken:n,persistSession:r,detectSessionInUrl:a,storage:i,userStorage:h,flowType:p,lock:y,debug:x,fetch:N,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(n){return new u0(this.realtimeUrl.href,Object.assign(Object.assign({},n),{params:Object.assign({apikey:this.supabaseKey},n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,a)=>{this._handleTokenChanged(r,"CLIENT",a?.access_token)})}_handleTokenChanged(n,r,a){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==a?this.changedAccessToken=a:n==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Iv=(u,n,r)=>new Ov(u,n,r);function Pv(){if(typeof window<"u"||typeof process>"u")return!1;const u=process.version;if(u==null)return!1;const n=u.match(/^v(\d+)\./);return n?parseInt(n[1],10)<=18:!1}Pv()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Dv="https://huqijhevmtgardkyeowa.supabase.co",im="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh1cWlqaGV2bXRnYXJka3llb3dhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcyNDgyNTQsImV4cCI6MjA3MjgyNDI1NH0.1G81Zif1YWQwISEGJw4XMzY89Rlvh6Jda1-j-roPZBk",oe=Iv(Dv,im),je=im!=="YOUR_SUPABASE_ANON_KEY",Lv=Object.freeze(Object.defineProperty({__proto__:null,isSupabaseConfigured:je,supabase:oe},Symbol.toStringTag,{value:"Module"})),lm=_.createContext(void 0),no=()=>{const u=_.useContext(lm);if(u===void 0)throw new Error("useAuth must be used within an AuthProvider");return u},Av=({children:u})=>{const[n,r]=_.useState(null),[a,i]=_.useState(null),[h,d]=_.useState(!0);_.useEffect(()=>{oe.auth.getSession().then(({data:{session:L}})=>{i(L),r(L?.user??null),d(!1)});const{data:{subscription:R}}=oe.auth.onAuthStateChange((L,F)=>{i(F),r(F?.user??null),d(!1)});return()=>R.unsubscribe()},[]);const N={user:n,session:a,loading:h,signUp:async(R,L,F)=>{try{const{data:B,error:I}=await oe.auth.signUp({email:R,password:L,options:{data:{full_name:F}}});if(I)return{error:I};if(B.user){const{error:Z}=await oe.from("user_profiles").insert([{user_id:B.user.id,full_name:F,role:"VIEWER"}]);Z&&console.error("Error creating user profile:",Z)}return{error:null}}catch(B){return{error:B}}},signIn:async(R,L)=>{const{error:F}=await oe.auth.signInWithPassword({email:R,password:L});return{error:F}},signOut:async()=>{Object.keys(localStorage).forEach(F=>{F.startsWith("user_role_")&&localStorage.removeItem(F)});const{error:L}=await oe.auth.signOut();L&&console.error("Sign out error:",L)},updateProfile:async R=>{if(!n)return{error:new Error("No user logged in")};const{error:L}=await oe.from("user_profiles").update(R).eq("user_id",n.id);return{error:L}}};return o.jsx(lm.Provider,{value:N,children:u})},$v=({isOpen:u,onClose:n,onSuccess:r})=>{const[a,i]=_.useState(!1),[h,d]=_.useState(""),[p,y]=_.useState(""),[x,S]=_.useState(""),[N,R]=_.useState(!1),[L,F]=_.useState(null),{signUp:B,signIn:I}=no(),Z=async q=>{q.preventDefault(),R(!0),F(null);try{let J;a?J=await B(h,p,x):J=await I(h,p),J.error?F(J.error.message||"An error occurred"):(r(),n())}catch{F("An unexpected error occurred")}finally{R(!1)}},Y=()=>{d(""),y(""),S(""),F(null)},H=()=>{i(!a),Y()};return u?o.jsxs("div",{className:"bg-slate-800 p-8 rounded-xl shadow-2xl max-w-md w-full border border-slate-700",children:[o.jsx("div",{className:"mb-6",children:o.jsx("h2",{className:"text-2xl font-bold text-white text-center",children:a?"Create Account":"Sign In"})}),o.jsxs("form",{onSubmit:Z,className:"space-y-4",children:[a&&o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Full Name"}),o.jsx("input",{type:"text",value:x,onChange:q=>S(q.target.value),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500",placeholder:"Enter your full name",required:a})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Email"}),o.jsx("input",{type:"email",value:h,onChange:q=>d(q.target.value),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500",placeholder:"Enter your email",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Password"}),o.jsx("input",{type:"password",value:p,onChange:q=>y(q.target.value),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500",placeholder:"Enter your password",required:!0,minLength:6})]}),L&&o.jsx("div",{className:"bg-red-900 border border-red-700 text-red-200 px-3 py-2 rounded text-sm",children:L}),o.jsx("button",{type:"submit",disabled:N,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-500 disabled:bg-slate-600 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors",children:N?"Loading...":a?"Create Account":"Sign In"})]}),o.jsx("div",{className:"mt-4 text-center",children:o.jsx("button",{onClick:H,className:"text-blue-400 hover:text-blue-300 text-sm",children:a?"Already have an account? Sign in":"Don't have an account? Sign up"})}),!a&&o.jsx("div",{className:"mt-3 text-center",children:o.jsx("button",{onClick:()=>{i(!0),Y()},className:"text-green-400 hover:text-green-300 text-sm",children:"Create a new account"})}),a&&o.jsx("div",{className:"mt-4 p-3 bg-blue-900 rounded-lg",children:o.jsxs("p",{className:"text-blue-200 text-sm",children:[o.jsx("strong",{children:"Note:"})," After signing up, you'll be able to access the app immediately."]})})]}):null},Mv=({onClose:u})=>{const{user:n,signOut:r,updateProfile:a}=no(),[i,h]=_.useState(null),[d,p]=_.useState(!0),[y,x]=_.useState(!1),[S,N]=_.useState(""),[R,L]=_.useState("VIEWER"),[F,B]=_.useState(!1),I=[{value:"VIEWER",label:"Viewer (Read Only)"},{value:"OPERATOR",label:"Operator (Limited Edit)"},{value:"EDITOR",label:"Editor (Full Access)"}];_.useEffect(()=>{n&&Z()},[n]);const Z=async()=>{if(n)try{const{data:q,error:J}=await oe.from("user_profiles").select("*").eq("user_id",n.id).single();if(J){console.log("No profile found in database, using user metadata:",J);const P={id:n.id,full_name:n.user_metadata?.full_name||n.email||"Unknown",role:n.user_metadata?.role||"VIEWER",email:n.email||"",created_at:n.created_at||new Date().toISOString()};h(P),N(P.full_name),L(P.role)}else h(q),N(q.full_name||""),L(q.role||"VIEWER")}catch(q){console.error("Error fetching profile:",q);const J={id:n.id,full_name:n.user_metadata?.full_name||n.email||"Unknown",role:n.user_metadata?.role||"VIEWER",email:n.email||"",created_at:n.created_at||new Date().toISOString()};h(J),N(J.full_name),L(J.role)}finally{p(!1)}},Y=async()=>{if(n){B(!0);try{const{error:q}=await a({full_name:S,role:R});if(q)console.error("Error updating profile:",q),alert("Error updating profile");else{h(P=>P?{...P,full_name:S,role:R}:null),x(!1);const J=new URLSearchParams(window.location.search).get("eventId")||window.location.pathname.includes("/run-of-show")?"current":null;J&&localStorage.setItem(`user_role_${J}_${n.id}`,R),u&&u()}}catch(q){console.error("Error updating profile:",q),alert("Error updating profile")}finally{B(!1)}}},H=async()=>{confirm("Are you sure you want to sign out?")&&await r()};return d?o.jsxs("div",{className:"flex items-center gap-2 text-slate-300",children:[o.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"}),"Loading..."]}):i?o.jsxs("div",{className:"bg-slate-800 p-4 rounded-lg shadow-2xl w-80 border border-slate-700",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h3",{className:"text-lg font-bold text-white",children:"Profile"}),u&&o.jsx("button",{onClick:u,className:"text-slate-400 hover:text-white transition-colors",children:"✕"})]}),y?o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Full Name"}),o.jsx("input",{type:"text",value:S,onChange:q=>N(q.target.value),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white text-sm",placeholder:"Enter your full name"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Role"}),o.jsx("select",{value:R,onChange:q=>L(q.target.value),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white text-sm",children:I.map(q=>o.jsx("option",{value:q.value,children:q.label},q.value))})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:Y,disabled:F,className:"flex-1 px-3 py-2 bg-green-600 hover:bg-green-500 disabled:bg-slate-600 text-white text-sm rounded transition-colors",children:F?"Saving...":"Save"}),o.jsx("button",{onClick:()=>x(!1),className:"px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white text-sm rounded transition-colors",children:"Cancel"})]})]}):o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white font-medium",children:(i.full_name||"U").charAt(0).toUpperCase()}),o.jsxs("div",{children:[o.jsx("div",{className:"text-white font-medium",children:i.full_name}),o.jsx("div",{className:"text-slate-400 text-sm",children:i.role}),o.jsx("div",{className:"text-slate-500 text-xs",children:n?.email})]})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:()=>x(!0),className:"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white text-sm rounded transition-colors",children:"Edit Profile"}),o.jsx("button",{onClick:H,className:"px-3 py-2 bg-red-600 hover:bg-red-500 text-white text-sm rounded transition-colors",title:"Sign out",children:"Sign Out"})]})]})]}):o.jsx("div",{className:"text-slate-300",children:"Profile not found"})},Wu=()=>{const{user:u,signOut:n}=no(),[r,a]=_.useState(!1);return o.jsx("header",{className:"fixed top-0 left-0 right-0 z-50 bg-slate-800 border-b border-slate-700 px-6 py-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("div",{className:"flex items-center gap-4",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:o.jsx("span",{className:"text-white font-bold text-lg",children:"R"})}),o.jsx("h1",{className:"text-xl font-bold text-white",children:"Run of Show"})]})}),u?o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"text-right",children:[o.jsx("p",{className:"text-white font-semibold text-base",children:u.user_metadata?.full_name||u.email}),o.jsx("p",{className:"text-slate-300 text-xs",children:u.email})]}),o.jsx("button",{onClick:()=>{confirm("Are you sure you want to sign out?")&&n()},className:"px-3 py-1.5 bg-red-600 hover:bg-red-500 text-white text-sm rounded-md transition-colors",title:"Sign out",children:"Sign Out"})]}):o.jsx("div",{className:"flex items-center gap-4",children:o.jsx("div",{className:"text-slate-400 text-sm",children:"Please sign in to continue"})}),r&&o.jsx("div",{className:"absolute top-16 right-6 z-50",children:o.jsx(Mv,{onClose:()=>a(!1)})})]})})},Uv=({children:u})=>{const{user:n,loading:r}=no(),[a,i]=Cl.useState(!1);return Cl.useEffect(()=>{!r&&!n?i(!0):n&&i(!1)},[n,r]),r?o.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 pt-16",children:[o.jsx(Wu,{}),o.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-80px)]",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),o.jsx("p",{className:"text-slate-300",children:"Loading..."})]})})]}):n?o.jsx(o.Fragment,{children:u}):o.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 pt-16",children:[o.jsx(Wu,{}),o.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-80px)]",children:o.jsxs("div",{className:"text-center max-w-md mx-auto p-8",children:[o.jsxs("div",{className:"mb-8",children:[o.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[o.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center",children:o.jsx("span",{className:"text-white font-bold text-2xl",children:"R"})}),o.jsx("h1",{className:"text-4xl font-bold text-white",children:"Run of Show"})]}),o.jsx("p",{className:"text-slate-300 text-lg",children:"Please sign in to access the Run of Show application."})]}),o.jsx($v,{isOpen:a,onClose:()=>{},onSuccess:()=>{i(!1)}}),o.jsx("div",{className:"mt-4 text-center",children:o.jsx("button",{onClick:()=>i(!0),className:"text-blue-400 hover:text-blue-300 text-sm underline",children:"Already have an account? Sign in here"})})]})})]})},Nl=[{value:"Great Hall",label:"Great Hall",color:"bg-blue-600"},{value:"Briefing Center",label:"Briefing Center",color:"bg-green-600"},{value:"Lee Anderson",label:"Lee Anderson",color:"bg-purple-600"},{value:"Virtual Show",label:"Virtual Show",color:"bg-orange-600"},{value:"Off Site",label:"Off Site",color:"bg-red-600"}],Ef=[1,2,3,4,5];class be{static async saveCalendarEvent(n){try{console.log("🔄 Saving calendar event to Supabase:",n);const{data:r,error:a}=await oe.from("calendar_events").insert([n]).select().single();return a?(console.error("Error saving calendar event:",a),this.saveCalendarToLocalStorage(n)):(console.log("✅ Calendar event saved to Supabase:",r),r)}catch(r){return console.error("Error saving calendar event:",r),this.saveCalendarToLocalStorage(n)}}static async updateCalendarEvent(n,r){try{console.log("🔄 Updating calendar event in Supabase:",n,r);const{data:a,error:i}=await oe.from("calendar_events").update({name:r.name,date:r.date,schedule_data:r.schedule_data,updated_at:new Date().toISOString()}).eq("id",n).select().single();return i?(console.error("❌ Error updating calendar event:",i),null):(console.log("✅ Calendar event updated successfully:",a),a)}catch(a){return console.error("❌ Exception updating calendar event:",a),null}}static async getCalendarEvents(){try{console.log("🔄 Loading calendar events from Supabase...");const{data:n,error:r}=await oe.from("calendar_events").select("*").order("date",{ascending:!1});return r?(console.error("Error fetching calendar events:",r),this.getCalendarFromLocalStorage()):(console.log("✅ Calendar events loaded from Supabase:",n?.length||0),n||[])}catch(n){return console.error("Error fetching calendar events:",n),this.getCalendarFromLocalStorage()}}static async getCalendarEvent(n){try{const{data:r,error:a}=await oe.from("calendar_events").select("*").eq("id",n).single();return a?(console.error("Error fetching calendar event:",a),this.getCalendarFromLocalStorageById(n)):r}catch(r){return console.error("Error fetching calendar event:",r),this.getCalendarFromLocalStorageById(n)}}static async deleteCalendarEvent(n){try{const{error:r}=await oe.from("calendar_events").delete().eq("id",n);return r?(console.error("Error deleting calendar event:",r),this.deleteCalendarFromLocalStorage(n)):!0}catch(r){return console.error("Error deleting calendar event:",r),this.deleteCalendarFromLocalStorage(n)}}static async logChange(n,r,a,i,h,d,p,y,x,S,N,R,L,F){try{console.log("Calling log_change with parameters:",{p_event_id:n,p_user_id:r,p_user_name:a,p_user_role:i,p_action:h,p_table_name:d,p_record_id:p,p_field_name:y,p_row_number:R,p_cue_number:L});const B={p_event_id:n,p_user_id:r,p_user_name:a,p_user_role:i,p_action:h,p_table_name:d,p_record_id:p||null,p_field_name:y||null,p_old_value:x?JSON.stringify(x):null,p_new_value:S?JSON.stringify(S):null,p_description:N||null,p_metadata:F||{},p_row_number:R||null,p_cue_number:L?typeof L=="string"?parseInt(L,10):L:null};console.log("Calling log_change with cleaned parameters:",B);const{data:I,error:Z}=await oe.rpc("log_change",B);return Z?(console.error("❌ Error logging change:",Z),console.error("❌ Parameters that caused error:",B),null):(console.log("✅ Change logged:",{action:h,tableName:d,recordId:p,changeId:I}),I)}catch(B){return console.error("Error logging change:",B),null}}static async logFieldChanges(n,r,a,i,h,d,p,y){try{for(const x of p)await this.logChange(n,r,a,i,"UPDATE",h,d,x.fieldName,x.oldValue,x.newValue,y)}catch(x){console.error("Error logging field changes:",x)}}static async getChangeLog(n,r=50,a=0){try{const{data:i,error:h}=await oe.rpc("get_change_log",{p_event_id:n,p_limit:r,p_offset:a});return h?(console.error("❌ Error fetching change log:",h),[]):i||[]}catch(i){return console.error("Error fetching change log:",i),[]}}static async getRecordChangeLog(n,r,a,i=20){try{const{data:h,error:d}=await oe.rpc("get_record_change_log",{p_event_id:n,p_table_name:r,p_record_id:a,p_limit:i});return d?(console.error("❌ Error fetching record change log:",d),[]):h||[]}catch(h){return console.error("Error fetching record change log:",h),[]}}static async getChangeLogSummary(n){try{const{data:r,error:a}=await oe.rpc("get_change_log_summary",{p_event_id:n});return a?(console.error("❌ Error fetching change log summary:",a),null):r?.[0]||null}catch(r){return console.error("Error fetching change log summary:",r),null}}static async cleanupOldChangeLogs(){try{const{data:n,error:r}=await oe.rpc("cleanup_old_change_logs");return r?(console.error("❌ Error cleaning up old change logs:",r),0):(console.log("🧹 Cleaned up old change logs:",n),n||0)}catch(n){return console.error("Error cleaning up old change logs:",n),0}}static async saveRunOfShowData(n,r){try{console.log("🔄 Saving run of show data to Supabase:",{eventId:n.event_id,scheduleItemsCount:n.schedule_items?.length||0,customColumnsCount:n.custom_columns?.length||0,settingsKeys:Object.keys(n.settings||{}),userInfo:r?`${r.userName} (${r.userRole})`:"No user info"});const a=new Date().toISOString(),i={...n,last_modified_by:r?.userId,last_modified_by_name:r?.userName,last_modified_by_role:r?.userRole,updated_at:a},{data:h,error:d}=await oe.from("run_of_show_data").select("*").eq("event_id",n.event_id).single();let p;if(h&&!d){console.log("📝 Updating existing record for event:",n.event_id);const y=h.last_change_at||a,{data:x,error:S}=await oe.from("run_of_show_data").update({event_name:i.event_name,event_date:i.event_date,schedule_items:i.schedule_items,custom_columns:i.custom_columns,settings:i.settings,last_modified_by:i.last_modified_by,last_modified_by_name:i.last_modified_by_name,last_modified_by_role:i.last_modified_by_role,updated_at:i.updated_at,last_change_at:y}).eq("event_id",n.event_id).select().single();if(S)throw console.error("❌ Error updating run of show data:",S),S;p=x}else{console.log("➕ Inserting new record for event:",n.event_id);const y={...i,last_change_at:a},{data:x,error:S}=await oe.from("run_of_show_data").insert([y]).select().single();if(S)throw console.error("❌ Error inserting run of show data:",S),S;p=x}return console.log("✅ Run of show data saved to Supabase successfully"),p}catch(a){console.error("❌ Error saving run of show data:",a),console.error("❌ Error details:",a.message,a.details,a.hint);const i={...n,last_modified_by:r?.userId,last_modified_by_name:r?.userName,last_modified_by_role:r?.userRole,updated_at:new Date().toISOString()};return this.saveRunOfShowToLocalStorage(i)}}static async updateRunOfShowData(n,r){try{console.log("🔄 Updating run of show data in Supabase for event:",n,r);const{data:a,error:i}=await oe.from("run_of_show_data").update({...r,updated_at:new Date().toISOString()}).eq("event_id",n).select().single();return i?(console.error("❌ Error updating run of show data:",i),null):(console.log("✅ Run of show data updated successfully:",a),a)}catch(a){return console.error("❌ Exception updating run of show data:",a),null}}static async getRunOfShowData(n){try{console.log("🔄 Loading run of show data from Supabase for event:",n),console.log("🔍 Supabase configured:",je),console.log("🔍 Executing Supabase query...");const{data:r,error:a}=await oe.from("run_of_show_data").select("*").eq("event_id",n).single();return console.log("🔍 Supabase query completed. Error:",a),console.log("🔍 Supabase query data:",r),a?(console.error("❌ Error fetching run of show data:",a),console.error("❌ Error details:",{message:a.message,details:a.details,hint:a.hint,code:a.code}),console.log("🔄 Falling back to localStorage..."),this.getRunOfShowFromLocalStorageById(n)):(console.log("✅ Run of show data loaded from Supabase:",r?"Found":"Not found"),r&&console.log("🔍 Data structure:",{hasScheduleItems:!!r.schedule_items,scheduleItemsLength:r.schedule_items?.length||0,hasCustomColumns:!!r.custom_columns,customColumnsLength:r.custom_columns?.length||0,hasSettings:!!r.settings}),r)}catch(r){return console.error("❌ Exception in getRunOfShowData:",r),console.error("❌ Exception details:",{message:r.message,stack:r.stack,eventId:n}),console.log("🔄 Falling back to localStorage due to exception..."),this.getRunOfShowFromLocalStorageById(n)}}static async deleteRunOfShowData(n){try{const{error:r}=await oe.from("run_of_show_data").delete().eq("event_id",n);return r?(console.error("Error deleting run of show data:",r),this.deleteRunOfShowFromLocalStorage(n)):!0}catch(r){return console.error("Error deleting run of show data:",r),this.deleteRunOfShowFromLocalStorage(n)}}static saveCalendarToLocalStorage(n){const r=this.getCalendarFromLocalStorage(),a={...n,id:Date.now().toString(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return r.unshift(a),localStorage.setItem("calendar_events",JSON.stringify(r)),console.log("✅ Calendar event saved to localStorage"),a}static getCalendarFromLocalStorage(){try{const n=localStorage.getItem("calendar_events"),r=n?JSON.parse(n):[];return console.log("✅ Calendar events loaded from localStorage:",r.length),r}catch(n){return console.error("Error reading from localStorage:",n),[]}}static getCalendarFromLocalStorageById(n){return this.getCalendarFromLocalStorage().find(a=>a.id===n)||null}static deleteCalendarFromLocalStorage(n){try{const a=this.getCalendarFromLocalStorage().filter(i=>i.id!==n);return localStorage.setItem("calendar_events",JSON.stringify(a)),!0}catch(r){return console.error("Error deleting from localStorage:",r),!1}}static saveRunOfShowToLocalStorage(n){const r=this.getAllRunOfShowFromLocalStorage(),a=new Date().toISOString(),i=r.findIndex(d=>d.event_id===n.event_id);let h;if(i>=0){const d=r[i],p=d.last_change_at||a;h={...n,id:d.id,created_at:d.created_at,updated_at:a,last_change_at:p},r[i]=h}else h={...n,id:Date.now().toString(),created_at:a,updated_at:a,last_change_at:a},r.push(h);return localStorage.setItem("run_of_show_data",JSON.stringify(r)),console.log("✅ Run of show data saved to localStorage"),h}static getAllRunOfShowFromLocalStorage(){try{const n=localStorage.getItem("run_of_show_data");return n?JSON.parse(n):[]}catch(n){return console.error("Error reading run of show data from localStorage:",n),[]}}static getRunOfShowFromLocalStorageById(n){console.log("🔄 Loading from localStorage for event:",n);const r=this.getAllRunOfShowFromLocalStorage();console.log("🔍 All localStorage data:",r);const a=r.find(i=>i.event_id===n);return console.log("🔍 Found data for event:",a?"Yes":"No"),a&&console.log("🔍 Found data structure:",{hasScheduleItems:!!a.schedule_items,scheduleItemsLength:a.schedule_items?.length||0,hasCustomColumns:!!a.custom_columns,customColumnsLength:a.custom_columns?.length||0,hasSettings:!!a.settings}),a||null}static deleteRunOfShowFromLocalStorage(n){try{const a=this.getAllRunOfShowFromLocalStorage().filter(i=>i.event_id!==n);return localStorage.setItem("run_of_show_data",JSON.stringify(a)),!0}catch(r){return console.error("Error deleting run of show data from localStorage:",r),!1}}static async checkForChanges(n,r){try{console.log("🔍 Checking for changes:",{eventId:n,localLastChangeAt:r,isSupabaseConfigured:je});const{data:a,error:i}=await oe.from("run_of_show_data").select("updated_at, last_change_at, last_modified_by, last_modified_by_name").eq("event_id",n).single();if(i||!a)return console.error("❌ Error checking for changes:",i),console.error("❌ Event ID:",n),console.error("❌ Supabase configured:",je),{hasChanges:!1};if(console.log("🔍 Change check data:",a),!r)return{hasChanges:!0,lastChangeAt:a.last_change_at,updatedAt:a.updated_at,lastModifiedBy:a.last_modified_by,lastModifiedByName:a.last_modified_by_name};const h=r?a.updated_at!==r:!1;return console.log("🔍 Change detection:",{localLastChangeAt:r,serverUpdatedAt:a.updated_at,hasChanges:h,lastChangeAt:a.last_change_at}),{hasChanges:h,lastChangeAt:a.last_change_at,updatedAt:a.updated_at,lastModifiedBy:a.last_modified_by,lastModifiedByName:a.last_modified_by_name}}catch(a){return console.error("❌ Error checking for changes:",a),{hasChanges:!1}}}static async loadChangesDynamically(n){try{console.log("🔄 Loading changes dynamically for event:",n);const{data:r,error:a}=await oe.from("run_of_show_data").select("*").eq("event_id",n).single();return a?(console.error("❌ Error loading changes:",a),null):(console.log("✅ Changes loaded successfully"),r)}catch(r){return console.error("❌ Error loading changes dynamically:",r),null}}static async saveUserSession(n,r,a,i){try{console.log("🔄 Saving authenticated user session:",{eventId:n,userId:r,username:a,role:i});const{data:h,error:d}=await oe.rpc("get_or_create_user_session",{p_user_id:r,p_event_id:n,p_user_role:i});return d?(console.error("❌ Supabase error saving user session:",d),console.error("❌ Error details:",d.message,d.details,d.hint),this.saveUserSessionToLocalStorage(n,a,i)):(console.log("✅ Authenticated user session saved to Supabase:",h),!0)}catch(h){return console.error("Error saving user session:",h),this.saveUserSessionToLocalStorage(n,a,i)}}static async getCurrentUserSession(n){try{const{data:r,error:a}=await oe.from("user_sessions").select("id, event_id, user_role").eq("user_id",n).order("created_at",{ascending:!1}).limit(1);return a?(console.error("❌ Error getting current user session:",a),this.getCurrentUserSessionFromLocalStorage()):r?.[0]||null}catch(r){return console.error("Error getting current user session:",r),this.getCurrentUserSessionFromLocalStorage()}}static async updateUserActivity(n){try{const{error:r}=await oe.rpc("update_user_activity",{p_user_id:n});r&&console.error("❌ Error updating user activity:",r)}catch(r){console.error("Error updating user activity:",r)}}static async cleanupInactiveSessions(){try{const{data:n,error:r}=await oe.rpc("cleanup_inactive_sessions");r?console.error("❌ Error cleaning up inactive sessions:",r):console.log("🧹 Cleaned up inactive sessions:",n)}catch(n){console.error("Error cleaning up inactive sessions:",n)}}static saveUserSessionToLocalStorage(n,r,a){try{const i={event_id:n,username:r,role:a,session_started_at:new Date().toISOString(),last_activity_at:new Date().toISOString(),is_active:!0};return localStorage.setItem(`current_user_session_${r}`,JSON.stringify(i)),localStorage.setItem(`user_role_${n}_${r}`,a),console.log("✅ User session saved to localStorage"),!0}catch(i){return console.error("Error saving user session to localStorage:",i),!1}}static getCurrentUserSessionFromLocalStorage(){try{const n=Object.keys(localStorage);let r=null,a=0;for(const i of n)if(i.startsWith("current_user_session_")){const h=JSON.parse(localStorage.getItem(i)||"{}");if(h.is_active&&h.last_activity_at){const d=new Date(h.last_activity_at).getTime();d>a&&(a=d,r=h)}}return r}catch(n){return console.error("Error getting current user session from localStorage:",n),null}}static async loadCue(n,r,a,i,h,d,p){try{const{data:y,error:x}=await oe.rpc("load_cue_for_event",{p_event_id:n,p_item_id:r.toString(),p_user_id:a,p_duration_seconds:i,p_row_is:h||null,p_cue_is:d||null,p_timer_id:p||null});return x?(console.error("❌ Error loading CUE in Supabase:",x),console.error("❌ Error details:",x.message,x.details,x.hint),console.error("❌ Error code:",x.code),(x.code==="PGRST204"||x.message.includes("Could not find"))&&console.warn("⚠️ Timer functions do not exist. Please run the optimized-timer-schema.sql migration script first."),!1):(console.log("✅ CUE loaded in Supabase:",y),y)}catch(y){return console.error("❌ Error loading CUE:",y),!1}}static async startTimer(n,r,a,i,h,d,p,y){try{const{data:x,error:S}=await oe.rpc("start_timer_for_event",{p_event_id:n,p_item_id:r.toString(),p_user_id:a,p_row_is:d||null,p_cue_is:p||null,p_timer_id:y||null});return S?(console.error("❌ Error starting timer in Supabase:",S),console.error("❌ Error details:",S.message,S.details,S.hint),console.error("❌ Error code:",S.code),!1):(console.log("✅ Timer started in Supabase (UPSERT):",x),!0)}catch(x){return console.error("Error starting timer:",x),!1}}static async stopTimer(n,r,a){try{const{data:i,error:h}=await oe.from("active_timers").update({is_running:!1,is_active:!1,timer_state:"stopped"}).eq("event_id",n).select();return h?(console.error("❌ Error stopping timer in Supabase:",h),!1):(console.log("✅ Timer stopped in Supabase:",i),!0)}catch(i){return console.error("Error stopping timer:",i),!1}}static async updateTimerDuration(n,r,a){try{console.log(`🔄 Updating timer duration for event ${n}, item ${r} to ${a}s`);const{data:i,error:h}=await oe.from("active_timers").update({duration_seconds:a}).eq("event_id",n).eq("item_id",r);return h?(console.error("❌ Error updating timer duration in Supabase:",h),!1):(console.log("✅ Timer duration updated in Supabase:",i),!0)}catch(i){return console.error("Error updating timer duration:",i),!1}}static async stopAllTimersForEvent(n,r){try{const{data:a,error:i}=await oe.rpc("stop_timer_for_event",{p_event_id:n});return i?(console.error("❌ Error stopping all timers in Supabase:",i),!1):(console.log("✅ All timers stopped in Supabase"),!0)}catch(a){return console.error("Error stopping all timers:",a),!1}}static async getActiveTimer(n){try{const{data:r,error:a}=await oe.rpc("get_active_timer_for_event",{p_event_id:n});return a?(console.error("❌ Error getting active timer from Supabase:",a),null):r?.[0]||null}catch(r){return console.error("Error getting active timer:",r),null}}static subscribeToTimerChanges(n,r){return oe.channel("active_timers_changes").on("postgres_changes",{event:"*",schema:"public",table:"active_timers",filter:`event_id=eq.${n}`},r).subscribe()}static async hasActiveSubCueTimer(n){try{if(!je||!oe)return console.warn("⚠️ Supabase client not initialized, skipping has active sub-cue timer check"),{data:!1,error:null};const{data:r,error:a}=await oe.rpc("has_active_sub_cue_timer_for_event",{p_event_id:n});return a?(console.error("❌ Error checking active sub-cue timer:",a),{data:!1,error:a}):{data:r||!1,error:null}}catch(r){return console.error("❌ Error checking active sub-cue timer:",r),{data:!1,error:r}}}static async getActiveSubCueTimer(n){try{if(!je||!oe)return console.warn("⚠️ Supabase client not initialized, skipping get active sub-cue timer"),{data:null,error:null};const{data:r,error:a}=await oe.rpc("get_active_sub_cue_timers_for_event",{p_event_id:n});return a?(console.error("❌ Error getting active sub-cue timer:",a),{data:null,error:a}):{data:r?.[0]||null,error:null}}catch(r){return console.error("❌ Error getting active sub-cue timer:",r),{data:null,error:r}}}static async getActiveSubCueTimers(n){try{if(!je||!oe)return console.warn("⚠️ Supabase client not initialized, skipping get active sub-cue timers"),{data:null,error:null};const{data:r,error:a}=await oe.rpc("get_active_sub_cue_timers_for_event",{p_event_id:n});return a?(console.error("❌ Error getting active sub-cue timers:",a),{data:null,error:a}):{data:r,error:null}}catch(r){return console.error("❌ Error getting active sub-cue timers:",r),{data:null,error:r}}}static async startSubCueTimer(n,r,a,i,h,d,p){try{if(!je||!oe)return console.warn("⚠️ Supabase client not initialized, skipping start sub-cue timer"),{data:null,error:null};console.log("🔄 Calling start_sub_cue_timer_for_event with params:",{p_event_id:n,p_item_id:r.toString(),p_user_id:a,p_duration_seconds:i,p_row_is:h,p_cue_is:d,p_timer_id:p}),console.log("🔄 About to call RPC function...");const{data:y,error:x}=await oe.rpc("start_sub_cue_timer_for_event",{p_event_id:n,p_item_id:r.toString(),p_user_id:a,p_duration_seconds:i,p_row_is:h||null,p_cue_is:d||null,p_timer_id:p||null});return console.log("🔄 RPC response:",{data:y,error:x}),x?(console.error("❌ Error starting sub-cue timer:",x),console.error("❌ Error details:",JSON.stringify(x,null,2)),{data:null,error:x}):{data:y,error:null}}catch(y){return console.error("❌ Error starting sub-cue timer:",y),{data:null,error:y}}}static async expireCompletedSubCueTimers(){try{if(!je||!oe)return console.warn("⚠️ Supabase client not initialized, skipping expire completed sub-cue timers"),{data:0,error:null};const{data:n,error:r}=await oe.rpc("expire_completed_sub_cue_timers");return r?(console.error("❌ Error expiring completed sub-cue timers:",r),{data:0,error:r}):{data:n||0,error:null}}catch(n){return console.error("❌ Error expiring completed sub-cue timers:",n),{data:0,error:n}}}static async stopSubCueTimer(n,r){try{if(!je||!oe)return console.warn("⚠️ Supabase client not initialized, skipping stop sub-cue timer"),{data:null,error:null};const{data:a,error:i}=await oe.rpc("stop_sub_cue_timer_for_event",{p_event_id:n,p_item_id:null});return i?(console.error("❌ Error stopping sub-cue timer:",i),console.error("❌ Error details:",JSON.stringify(i,null,2)),{data:null,error:i}):{data:a,error:null}}catch(a){return console.error("❌ Error stopping sub-cue timer:",a),{data:null,error:a}}}static async getActiveSecondaryTimer(n){try{if(!je||!oe)return console.warn("⚠️ Supabase client not initialized, skipping get active secondary timer"),{data:null,error:null};const{data:r,error:a}=await oe.rpc("get_active_secondary_timer_for_event",{p_event_id:n});return a?(console.error("❌ Error getting active secondary timer:",a),{data:null,error:a}):{data:r&&r.length>0?r[0]:null,error:null}}catch(r){return console.error("❌ Error getting active secondary timer:",r),{data:null,error:r}}}static async startSecondaryTimer(n,r,a,i){try{if(!je||!oe)return console.warn("⚠️ Supabase client not initialized, skipping start secondary timer"),{data:null,error:null};const{data:h,error:d}=await oe.rpc("start_secondary_timer_for_event",{p_event_id:n,p_item_id:r,p_user_id:a,p_duration_seconds:i});return d?(console.error("❌ Error starting secondary timer:",d),{data:null,error:d}):{data:h,error:null}}catch(h){return console.error("❌ Error starting secondary timer:",h),{data:null,error:h}}}static async stopSecondaryTimer(n){try{if(!je||!oe)return console.warn("⚠️ Supabase client not initialized, skipping stop secondary timer"),{data:null,error:null};const{data:r,error:a}=await oe.rpc("stop_secondary_timer_for_event",{p_event_id:n});return a?(console.error("❌ Error stopping secondary timer:",a),{data:null,error:a}):{data:r,error:null}}catch(r){return console.error("❌ Error stopping secondary timer:",r),{data:null,error:r}}}static async updateSecondaryTimerRemaining(n,r){try{if(!je||!oe)return console.warn("⚠️ Supabase client not initialized, skipping update secondary timer remaining"),{data:null,error:null};const{data:a,error:i}=await oe.rpc("update_secondary_timer_remaining",{p_event_id:n,p_remaining_seconds:r});return i?(console.error("❌ Error updating secondary timer remaining:",i),{data:null,error:i}):{data:a,error:null}}catch(a){return console.error("❌ Error updating secondary timer remaining:",a),{data:null,error:a}}}static async updateSubCueTimerRemaining(n,r,a){try{if(!je||!oe)return console.warn("⚠️ Supabase client not initialized, skipping update sub-cue timer remaining"),!1;const{error:i}=await oe.from("sub_cue_timers").update({remaining_seconds:a,updated_at:new Date().toISOString()}).eq("event_id",n).eq("item_id",r.toString()).eq("is_active",!0);return i?(console.error("❌ Error updating sub-cue timer remaining time:",i),!1):!0}catch(i){return console.error("Error updating sub-cue timer remaining time:",i),!1}}static async clearAllActiveTimersForEvent(n){try{if(!je||!oe)return console.warn("⚠️ Supabase client not initialized, skipping clear all active timers"),!1;console.log("🔄 Clearing all active timers for event:",n);const{error:r}=await oe.from("active_timers").delete().eq("event_id",n);return r?(console.error("❌ Error clearing all active timers:",r),!1):(console.log("✅ All active timers cleared for event:",n),!0)}catch(r){return console.error("❌ Error clearing all active timers:",r),!1}}static async getCompletedCues(n){try{if(!je||!oe)return console.warn("⚠️ Supabase client not initialized, skipping get completed cues"),null;const{data:r,error:a}=await oe.rpc("get_completed_cues_for_event",{p_event_id:n});if(a)throw a;return r}catch(r){return console.error("❌ Error getting completed cues:",r),null}}static async markCueCompleted(n,r,a,i,h,d){try{if(!je||!oe)return console.warn("⚠️ Supabase client not initialized, skipping mark cue completed"),!1;console.log("🟣 Calling mark_cue_completed RPC with:",{p_event_id:n,p_item_id:r,p_user_id:i});const{data:p,error:y}=await oe.from("completed_cues").insert({event_id:n,item_id:r,user_id:i,cue_id:a,user_name:h,user_role:d,completed_at:new Date().toISOString()});if(y)throw console.error("❌ Insert error:",y),console.error("❌ Error details:",y.message,y.details,y.hint),y;return console.log("✅ Cue marked as completed successfully:",{eventId:n,itemId:r,data:p}),!0}catch(p){return console.error("❌ Error marking cue as completed:",p),!1}}static async unmarkCueCompleted(n,r){try{if(!je||!oe)return console.warn("⚠️ Supabase client not initialized, skipping unmark cue completed"),!1;const{data:a,error:i}=await oe.rpc("unmark_cue_completed",{p_event_id:n,p_item_id:r});if(i)throw i;return console.log("✅ Cue unmarked as completed:",{eventId:n,itemId:r}),!0}catch(a){return console.error("❌ Error unmarking cue as completed:",a),!1}}static async clearCompletedCues(n){try{if(!je||!oe)return console.warn("⚠️ Supabase client not initialized, skipping clear completed cues"),!1;const{data:r,error:a}=await oe.rpc("clear_completed_cues_for_event",{p_event_id:n});if(a)throw a;return console.log("✅ Cleared all completed cues for event:",n),!0}catch(r){return console.error("❌ Error clearing completed cues:",r),!1}}static subscribeToTableChanges(n,r,a){try{if(!je||!oe)return console.error("❌ Supabase client not initialized"),null;const i=a?`event_id=eq.${a}`:void 0;return oe.channel(`${n}_changes`).on("postgres_changes",{event:"*",schema:"public",table:n,filter:i},r).subscribe()}catch(i){return console.error(`❌ Error setting up ${n} subscription:`,i),null}}static async updateLastLoadedCue(n,r,a){try{if(!je||!oe)return console.warn("⚠️ Supabase client not initialized, skipping update last loaded CUE"),{data:null,error:null};const{data:i,error:h}=await oe.rpc("update_last_loaded_cue",{p_event_id:n,p_cue_id:r,p_state:a});return h?(console.error("❌ Error updating last loaded CUE:",h),{data:null,error:h}):{data:i,error:null}}catch(i){return console.error("❌ Error updating last loaded CUE:",i),{data:null,error:i}}}static async getLastLoadedCue(n){try{if(!je||!oe)return console.warn("⚠️ Supabase client not initialized, skipping get last loaded CUE"),{data:null,error:null};const{data:r,error:a}=await oe.rpc("get_last_loaded_cue",{p_event_id:n});return a?(console.error("❌ Error getting last loaded CUE:",a),{data:null,error:a}):{data:r,error:null}}catch(r){return console.error("❌ Error getting last loaded CUE:",r),{data:null,error:r}}}static async saveTimerMessage(n){try{console.log("🔄 Saving timer message to Supabase:",n);const{data:r,error:a}=await oe.from("timer_messages").insert([n]).select().single();return a?(console.error("Error saving timer message:",a),this.saveTimerMessageToLocalStorage(n)):(console.log("✅ Timer message saved to Supabase:",r),r)}catch(r){return console.error("❌ Error saving timer message:",r),this.saveTimerMessageToLocalStorage(n)}}static async getTimerMessage(n){try{const{data:r,error:a}=await oe.rpc("get_latest_timer_message",{p_event_id:n});return a?(console.error("Error loading timer message:",a),this.getTimerMessageFromLocalStorage(n)):r?.[0]||null}catch(r){return console.error("❌ Error loading timer message:",r),this.getTimerMessageFromLocalStorage(n)}}static async updateTimerMessage(n,r){try{const{error:a}=await oe.from("timer_messages").update(r).eq("id",n);return a?(console.error("Error updating timer message:",a),this.updateTimerMessageInLocalStorage(n,r)):!0}catch(a){return console.error("❌ Error updating timer message:",a),this.updateTimerMessageInLocalStorage(n,r)}}static async disableTimerMessage(n){return this.updateTimerMessage(n,{enabled:!1})}static async getTimerMessagesForEvent(n){try{const{data:r,error:a}=await oe.from("timer_messages").select("*").eq("event_id",n).order("created_at",{ascending:!1});return a?(console.error("Error loading timer messages:",a),this.getTimerMessagesFromLocalStorage().filter(i=>i.event_id===n)):r||[]}catch(r){return console.error("❌ Error loading timer messages:",r),this.getTimerMessagesFromLocalStorage().filter(a=>a.event_id===n)}}static saveTimerMessageToLocalStorage(n){const r=this.getTimerMessagesFromLocalStorage(),a={...n,id:`local_${Date.now()}`,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return r.push(a),localStorage.setItem("timer_messages",JSON.stringify(r)),a}static getTimerMessagesFromLocalStorage(){try{const n=localStorage.getItem("timer_messages");return n?JSON.parse(n):[]}catch(n){return console.error("Error loading timer messages from localStorage:",n),[]}}static getTimerMessageFromLocalStorage(n){return this.getTimerMessagesFromLocalStorage().find(a=>a.event_id===n&&a.enabled)||null}static updateTimerMessageInLocalStorage(n,r){try{const a=this.getTimerMessagesFromLocalStorage(),i=a.findIndex(h=>h.id===n);return i!==-1?(a[i]={...a[i],...r,updated_at:new Date().toISOString()},localStorage.setItem("timer_messages",JSON.stringify(a)),!0):!1}catch(a){return console.error("Error updating timer message in localStorage:",a),!1}}}const cm=({isOpen:u,onClose:n,onRoleSelected:r,eventId:a})=>{const{user:i}=no(),[h,d]=_.useState("VIEWER"),[p,y]=_.useState(!1);_.useEffect(()=>{if(u&&i?.id&&a){const N=localStorage.getItem(`user_role_${a}_${i.id}`);N&&["VIEWER","EDITOR","OPERATOR"].includes(N)&&d(N)}},[u,i?.id,a]);const x=[{value:"VIEWER",label:"Viewer (Read Only)",description:"Can view but cannot edit any content",icon:"👁️"},{value:"OPERATOR",label:"Operator (Limited Edit)",description:"Can control timers and view data",icon:"🎮"},{value:"EDITOR",label:"Editor (Full Access)",description:"Can edit all content and settings",icon:"✏️"}],S=async()=>{if(!(!i||!a)){y(!0);try{await be.saveUserSession(a,i.id,i.user_metadata?.full_name||i.email||"Unknown",h)?(r(h),n()):alert("Failed to save user session. Please try again.")}catch(N){console.error("Error saving user session:",N),alert("Error saving user session. Please try again.")}finally{y(!1)}}};return u?o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[9999] p-4",children:o.jsxs("div",{className:"bg-slate-800 p-8 rounded-xl shadow-2xl max-w-2xl w-full",children:[o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"Select Your Role"}),o.jsxs("p",{className:"text-slate-300 text-lg",children:["Welcome, ",i?.user_metadata?.full_name||i?.email,"! Please select your role for this session."]})]}),o.jsx("div",{className:"space-y-4 mb-8",children:x.map(N=>o.jsxs("label",{className:`flex items-start gap-4 cursor-pointer p-4 rounded-lg border-2 transition-colors ${h===N.value?"border-blue-500 bg-blue-900/20":"border-slate-600 hover:border-blue-400"}`,children:[o.jsx("input",{type:"radio",name:"role",value:N.value,checked:h===N.value,onChange:R=>d(R.target.value),className:"w-5 h-5 text-blue-600 mt-1"}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx("span",{className:"text-2xl",children:N.icon}),o.jsx("span",{className:"text-white font-bold text-lg",children:N.label})]}),o.jsx("p",{className:"text-slate-300 text-sm",children:N.description})]})]},N.value))}),o.jsxs("div",{className:"flex gap-4",children:[o.jsx("button",{onClick:S,disabled:p,className:"flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-500 disabled:bg-slate-600 disabled:cursor-not-allowed text-white font-semibold rounded-lg transition-colors",children:p?"Loading...":"Continue with Selected Role"}),o.jsx("button",{onClick:n,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white font-semibold rounded-lg transition-colors",children:"Cancel"})]}),o.jsx("div",{className:"mt-4 p-3 bg-blue-900 rounded-lg",children:o.jsxs("p",{className:"text-blue-200 text-sm",children:[o.jsx("strong",{children:"Note:"})," You can change your role later from your profile menu."]})})]})}):null},Fv=()=>{const u=Zo(),{user:n}=no(),[r,a]=_.useState([]),[i,h]=_.useState("upcoming"),[d,p]=_.useState(!1),[y,x]=_.useState("all"),[S,N]=_.useState("all"),[R,L]=_.useState(""),[F,B]=_.useState(null),[I,Z]=_.useState({name:"",date:"",location:"Great Hall",numberOfDays:1}),[Y,H]=_.useState({name:"",date:"",location:"Great Hall",numberOfDays:1}),[q,J]=_.useState(!1),[P,V]=_.useState(null);_.useEffect(()=>{te()},[]);const te=async()=>{try{console.log("🔄 Loading events from Supabase...");const $=await be.getCalendarEvents();if($&&$.length>0){const M=$.map(k=>({id:k.id||Date.now().toString(),name:k.name,date:k.date,location:k.schedule_data?.location||"Great Hall",numberOfDays:k.schedule_data?.numberOfDays||1,created_at:k.created_at||new Date().toISOString(),updated_at:k.updated_at||new Date().toISOString()}));a(M),console.log("✅ Loaded events from Supabase:",M.length)}else{console.log("ℹ️ No events found in Supabase, trying localStorage...");const M=localStorage.getItem("events");if(M)try{const k=JSON.parse(M);a(k),console.log("Loaded events from localStorage:",k.length)}catch(k){console.error("Error loading events from localStorage:",k)}}}catch($){console.error("Error loading events from Supabase:",$);const M=localStorage.getItem("events");if(M)try{const k=JSON.parse(M);a(k)}catch(k){console.error("Error loading events from localStorage:",k)}}};_.useEffect(()=>{localStorage.setItem("events",JSON.stringify(r))},[r]);const C=async()=>{if(!Y.name||!Y.date||!Y.location){alert("Please fill in all fields");return}const M={id:`event-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:Y.name,date:Y.date,location:Y.location,numberOfDays:Y.numberOfDays,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};p(!1),H({name:"",date:"",location:"Great Hall",numberOfDays:1}),a(k=>[...k,M]);try{const k={name:M.name,date:M.date,schedule_data:{location:M.location,numberOfDays:M.numberOfDays,eventId:M.id}};await be.saveCalendarEvent(k),console.log("Calendar event saved to Supabase with ID:",M.id),await be.saveRunOfShowData({event_id:M.id,event_name:M.name,event_date:M.date,schedule_items:[],custom_columns:[],settings:{eventName:M.name,masterStartTime:"",lastSaved:new Date().toISOString()}},{userId:n?.id||"unknown",userName:n?.user_metadata?.full_name||n?.email||"Unknown User",userRole:"EDITOR"}),console.log("Run of Show data created in Supabase with ID:",M.id)}catch(k){console.error("Error auto-saving event to Supabase:",k)}},re=async()=>{if(!F||!I.name||!I.date||!I.location){alert("Please fill in all fields");return}const $={...F,name:I.name,date:I.date,location:I.location,numberOfDays:I.numberOfDays,updated_at:new Date().toISOString()};B(null),Z({name:"",date:"",location:"Great Hall",numberOfDays:1}),a(M=>M.map(k=>k.id===F.id?$:k));try{const k=(await be.getCalendarEvents()).find(U=>U.schedule_data?.eventId===F.id||U.name===F.name);if(k?.id){const U={name:$.name,date:$.date,schedule_data:{location:$.location,numberOfDays:$.numberOfDays,eventId:$.id}};await be.updateCalendarEvent(k.id,U),console.log("Calendar event updated in Supabase")}await be.updateRunOfShowData(F.id,{event_name:$.name,event_date:$.date,settings:{eventName:$.name,lastSaved:new Date().toISOString()}}),console.log("Run of Show data updated in Supabase")}catch(M){console.error("Error auto-updating event in Supabase:",M)}},ue=async $=>{if(window.confirm("Are you sure you want to delete this event?")){a(M=>M.filter(k=>k.id!==$));try{const M=r.find(k=>k.id===$);if(M){await be.deleteRunOfShowData($),console.log("Run of Show data deleted from Supabase automatically");const U=(await be.getCalendarEvents()).find(ae=>ae.schedule_data?.eventId===$||ae.name===M.name);U?.id&&(await be.deleteCalendarEvent(U.id),console.log("Calendar event deleted from Supabase automatically"))}}catch(M){console.error("Error auto-deleting event from Supabase:",M)}}},Ee=$=>{B($),Z({name:$.name,date:$.date,location:$.location,numberOfDays:$.numberOfDays})},fe=$=>{V($),J(!0)},me=async $=>{if(P&&n?.id){try{const M=n.user_metadata?.full_name||n.email||"Unknown";await be.saveUserSession(P.id,n.id,M,$),console.log("✅ Role saved to Supabase from EventListPage:",$)}catch(M){console.error("❌ Failed to save role to Supabase from EventListPage:",M)}u("/run-of-show",{state:{event:P,userRole:$}}),J(!1),V(null)}},pe=$=>{const M=Nl.find(k=>k.value===$);return M?M.color:"bg-gray-600"},$e=$=>new Date($).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),X=(()=>{const $=new Date;return r.filter(M=>{const k=new Date(M.date),U=i==="upcoming"?k>=$:k<$,ae=y==="all"||M.location===y,he=S==="all"||M.numberOfDays.toString()===S,De=R===""||M.name.toLowerCase().includes(R.toLowerCase())||M.location.toLowerCase().includes(R.toLowerCase());return U&&ae&&he&&De}).sort((M,k)=>{const U=new Date(M.date),ae=new Date(k.date);return i==="upcoming"?U.getTime()-ae.getTime():ae.getTime()-U.getTime()})})();return o.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-slate-200 pt-16",children:[o.jsxs("div",{className:"text-center py-8",children:[o.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"📅 Event List Calendar"}),o.jsx("p",{className:"text-xl text-slate-400 mb-4",children:"Manage your events and schedules"}),n&&o.jsx("div",{className:"text-center mb-6",children:o.jsxs("p",{className:"text-white font-medium text-lg",children:["Welcome back, ",n.user_metadata?.full_name||n.email,"!"]})})]}),o.jsxs("div",{className:"max-w-6xl mx-auto px-6",children:[o.jsx("div",{className:"flex justify-center mb-8",children:o.jsxs("div",{className:"bg-slate-800 rounded-lg p-1 flex",children:[o.jsx("button",{onClick:()=>h("upcoming"),className:`px-6 py-3 rounded-md font-semibold transition-colors ${i==="upcoming"?"bg-green-600 text-white":"text-slate-400 hover:text-white"}`,children:"📅 Upcoming Events"}),o.jsx("button",{onClick:()=>h("past"),className:`px-6 py-3 rounded-md font-semibold transition-colors ${i==="past"?"bg-orange-600 text-white":"text-slate-400 hover:text-white"}`,children:"📋 Past Events"})]})}),o.jsx("div",{className:"flex justify-center mb-6",children:o.jsx("div",{className:"bg-slate-800 rounded-lg p-4 w-full max-w-4xl",children:o.jsxs("div",{className:"flex items-center gap-6",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-white font-semibold",children:"🔍 Search:"}),o.jsx("input",{type:"text",value:R,onChange:$=>L($.target.value),placeholder:"Search events by name or location...",className:"w-80 px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:border-blue-500 focus:outline-none text-sm"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-white font-semibold",children:"📍 Filter by location:"}),o.jsxs("select",{value:y,onChange:$=>x($.target.value),className:"px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:border-blue-500 focus:outline-none text-sm",children:[o.jsx("option",{value:"all",children:"All Locations"}),Nl.map($=>o.jsx("option",{value:$.value,children:$.label},$.value))]})]})]})})}),o.jsx("div",{className:"flex justify-center mb-8",children:o.jsx("button",{onClick:()=>p(!0),className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors",children:"+ Add New Event"})}),o.jsx("div",{className:"bg-slate-800 rounded-xl p-6 shadow-2xl",children:o.jsx("div",{className:"bg-slate-800 rounded-lg overflow-hidden border border-slate-600",children:o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"w-full",children:[o.jsx("thead",{className:"bg-slate-700",children:o.jsxs("tr",{children:[o.jsx("th",{className:"px-4 py-3 text-left text-slate-300 font-semibold border-r border-slate-600",children:"Event Name"}),o.jsx("th",{className:"px-4 py-3 text-left text-slate-300 font-semibold border-r border-slate-600",children:"Date"}),o.jsx("th",{className:"px-4 py-3 text-left text-slate-300 font-semibold border-r border-slate-600",children:"Location"}),o.jsx("th",{className:"px-4 py-3 text-left text-slate-300 font-semibold border-r border-slate-600",children:"Duration"}),o.jsx("th",{className:"px-4 py-3 text-center text-slate-300 font-semibold",children:"Actions"})]})}),o.jsx("tbody",{children:X.length===0?o.jsx("tr",{children:o.jsxs("td",{colSpan:5,className:"px-4 py-12 text-center",children:[o.jsx("div",{className:"text-6xl mb-4",children:i==="upcoming"?"📅":"📋"}),o.jsxs("h3",{className:"text-2xl font-bold text-white mb-2",children:["No ",i," events"]}),o.jsx("p",{className:"text-slate-400",children:i==="upcoming"?"Add your first upcoming event to get started!":"Past events will appear here once you have some."})]})}):X.map($=>o.jsxs("tr",{className:"border-b border-slate-600",children:[o.jsx("td",{className:"px-4 py-3 text-white font-medium border-r border-slate-600",children:$.name}),o.jsx("td",{className:"px-4 py-3 text-slate-300 border-r border-slate-600",children:$e($.date)}),o.jsx("td",{className:"px-4 py-3 border-r border-slate-600",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:`w-3 h-3 rounded-full ${pe($.location)}`}),o.jsx("span",{className:"text-slate-300",children:$.location})]})}),o.jsxs("td",{className:"px-4 py-3 text-slate-300 border-r border-slate-600",children:[$.numberOfDays," day",$.numberOfDays>1?"s":""]}),o.jsx("td",{className:"px-4 py-3",children:o.jsxs("div",{className:"flex gap-2 justify-center",children:[o.jsx("button",{onClick:()=>fe($),className:"px-3 py-1 bg-blue-600 hover:bg-blue-500 text-white text-sm font-medium rounded transition-colors",children:"Launch"}),o.jsx("button",{onClick:()=>Ee($),className:"px-3 py-1 bg-green-600 hover:bg-green-500 text-white text-sm font-medium rounded transition-colors",children:"Edit"}),o.jsx("button",{onClick:()=>ue($.id),className:"px-3 py-1 bg-red-600 hover:bg-red-500 text-white text-sm font-medium rounded transition-colors",children:"Delete"})]})})]},$.id))})]})})})})]}),d&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"bg-slate-800 rounded-lg p-4 max-w-sm w-full",children:[o.jsxs("h2",{className:"text-lg font-bold text-white mb-4",children:[o.jsx("span",{style:{filter:"brightness(0) invert(1)"},children:"📅"})," Add New Event"]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Event Name"}),o.jsx("input",{type:"text",value:Y.name,onChange:$=>H(M=>({...M,name:$.target.value})),placeholder:"Enter event name",className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:border-blue-500 focus:outline-none text-sm"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Date"}),o.jsx("input",{type:"date",value:Y.date,onChange:$=>H(M=>({...M,date:$.target.value})),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:border-blue-500 focus:outline-none text-sm",style:{colorScheme:"dark"}})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Location"}),o.jsx("select",{value:Y.location,onChange:$=>H(M=>({...M,location:$.target.value})),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:border-blue-500 focus:outline-none text-sm",children:Nl.map($=>o.jsx("option",{value:$.value,children:$.label},$.value))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Duration"}),o.jsx("select",{value:Y.numberOfDays,onChange:$=>H(M=>({...M,numberOfDays:parseInt($.target.value)})),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:border-blue-500 focus:outline-none text-sm",children:Ef.map($=>o.jsxs("option",{value:$,children:[$," day",$>1?"s":""]},$))})]})]}),o.jsxs("div",{className:"flex gap-2 mt-4",children:[o.jsx("button",{onClick:()=>{p(!1),H({name:"",date:"",location:"Great Hall",numberOfDays:1})},className:"flex-1 px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded text-sm font-medium",children:"Cancel"}),o.jsx("button",{onClick:C,className:"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded text-sm font-medium",children:"Add Event"})]})]})}),F&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"bg-slate-800 rounded-lg p-4 max-w-sm w-full",children:[o.jsxs("h2",{className:"text-lg font-bold text-white mb-4",children:[o.jsx("span",{style:{filter:"brightness(0) invert(1)"},children:"✏️"})," Edit Event"]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Event Name"}),o.jsx("input",{type:"text",value:I.name,onChange:$=>Z(M=>({...M,name:$.target.value})),placeholder:"Enter event name",className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:border-blue-500 focus:outline-none text-sm"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Date"}),o.jsx("input",{type:"date",value:I.date,onChange:$=>Z(M=>({...M,date:$.target.value})),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:border-blue-500 focus:outline-none text-sm",style:{colorScheme:"dark"}})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Location"}),o.jsx("select",{value:I.location,onChange:$=>Z(M=>({...M,location:$.target.value})),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:border-blue-500 focus:outline-none text-sm",children:Nl.map($=>o.jsx("option",{value:$.value,children:$.label},$.value))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Duration"}),o.jsx("select",{value:I.numberOfDays,onChange:$=>Z(M=>({...M,numberOfDays:parseInt($.target.value)})),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:border-blue-500 focus:outline-none text-sm",children:Ef.map($=>o.jsxs("option",{value:$,children:[$," day",$>1?"s":""]},$))})]})]}),o.jsxs("div",{className:"flex gap-2 mt-4",children:[o.jsx("button",{onClick:()=>{B(null),Z({name:"",date:"",location:"Great Hall",numberOfDays:1})},className:"flex-1 px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded text-sm font-medium",children:"Cancel"}),o.jsx("button",{onClick:re,className:"flex-1 px-3 py-2 bg-green-600 hover:bg-green-500 text-white rounded text-sm font-medium",children:"Update Event"})]})]})}),o.jsx(cm,{isOpen:q,onClose:()=>{J(!1),V(null)},onRoleSelected:me,eventId:P?.id||""})]})};class Vv{constructor(){this.localChanges=[],this.syncTimer=null,this.SYNC_DELAY=5e3,this.MAX_BATCH_SIZE=10,this.MAX_SYNC_ATTEMPTS=3,this.loadLocalChanges(),this.startSyncTimer()}addChange(n){const r={...n,id:`change_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date,synced:!1};this.localChanges.push(r),this.saveLocalChanges(),console.log("📝 Change added to local buffer:",r.description),this.localChanges.filter(a=>!a.synced).length>=this.MAX_BATCH_SIZE&&this.syncChanges()}getLocalChanges(){return[...this.localChanges]}getUnsyncedChanges(){return this.localChanges.filter(n=>!n.synced)}getChangesCount(){const n=this.localChanges.length,r=this.localChanges.filter(a=>!a.synced).length;return{total:n,unsynced:r}}reloadLocalChanges(){this.loadLocalChanges(),console.log("🔄 Reloaded local changes:",this.localChanges.length)}startSyncTimer(){this.syncTimer&&clearInterval(this.syncTimer),this.syncTimer=setInterval(()=>{const n=this.getUnsyncedChanges();n.length>0&&(console.log(`🔄 Auto-syncing ${n.length} changes...`),this.syncChanges())},this.SYNC_DELAY)}stopSyncTimer(){this.syncTimer&&(clearInterval(this.syncTimer),this.syncTimer=null)}async syncChanges(){const n=this.getUnsyncedChanges();if(n.length===0)return!0;console.log(`🔄 Syncing ${n.length} changes to Supabase...`);try{const r=this.groupChangesByEvent(n);for(const[a,i]of r)await this.syncEventChanges(a,i);return this.localChanges=this.localChanges.map(a=>({...a,synced:!0})),this.saveLocalChanges(),console.log("✅ All changes synced successfully"),!0}catch(r){return console.error("❌ Error syncing changes:",r),!1}}groupChangesByEvent(n){const r=new Map;for(const a of n)r.has(a.eventId)||r.set(a.eventId,[]),r.get(a.eventId).push(a);return r}async syncEventChanges(n,r){console.log(`📤 Syncing ${r.length} changes for event ${n}`);const a={event_id:n,changes:r.map(h=>({id:h.id,timestamp:h.timestamp.toISOString(),user_id:h.userId,user_name:h.userName,user_role:h.userRole,action:h.action,description:h.description,details:h.details,row_number:h.rowNumber,cue_number:h.cueNumber,segment_name:h.segmentName})),created_at:new Date().toISOString(),synced:!0},{error:i}=await oe.from("change_log_batches").insert([a]);if(i)throw new Error(`Failed to sync batch: ${i.message}`);for(const h of r)await be.logChange(h.eventId,h.userId,h.userName,h.userRole,h.action,"schedule_items",h.details?.itemId,h.details?.fieldName,h.details?.oldValue,h.details?.newValue,h.description,h.rowNumber,h.cueNumber,h.details)}loadLocalChanges(){try{const n=localStorage.getItem("runofshow_local_changes");if(n){const r=JSON.parse(n);this.localChanges=r.map(a=>({...a,timestamp:new Date(a.timestamp)})),console.log(`📂 Loaded ${this.localChanges.length} local changes from localStorage`)}else console.log("📂 No local changes found in localStorage"),this.localChanges=[]}catch(n){console.error("Error loading local changes:",n),this.localChanges=[]}}saveLocalChanges(){try{localStorage.setItem("runofshow_local_changes",JSON.stringify(this.localChanges))}catch(n){console.error("Error saving local changes:",n)}}clearLocalChanges(){this.localChanges=[],this.saveLocalChanges(),console.log("🗑️ Local changes cleared")}async clearMasterChangeLog(n){try{console.log("🗑️ Clearing master change log for event:",n);let r=0,a=[];const{data:{user:i},error:h}=await oe.auth.getUser();if(console.log("🔄 Authenticated user:",i?.id,i?.email),h||!i)return console.error("❌ Authentication error:",h),{success:!1,error:"Not authenticated",deletedCount:0};console.log("🔄 Attempting to delete from change_log_batches table...");try{const{data:S,error:N}=await oe.from("change_log_batches").select("id").eq("event_id",n);if(N)console.log("⚠️ Cannot access change_log_batches table:",N.message),a.push(`change_log_batches: ${N.message}`);else if(console.log(`📊 Found ${S?.length||0} batches to delete`),S&&S.length>0){const{data:R,error:L}=await oe.from("change_log_batches").delete().eq("event_id",n).select("id");if(L)console.error("❌ Error deleting from change_log_batches:",L),a.push(`change_log_batches delete: ${L.message}`);else{const F=R?.length||0;console.log(`✅ Deleted ${F} batch records`),r+=F}}}catch(S){console.log("⚠️ change_log_batches table not accessible:",S),a.push(`change_log_batches: ${S.message}`)}console.log("🔄 Deleting from change_log table...");const{data:d,error:p}=await oe.from("change_log").select("id").eq("event_id",n);if(p)console.error("❌ Error checking change_log records:",p),a.push(`change_log check: ${p.message}`);else if(console.log(`📊 Found ${d?.length||0} log records to delete`),d&&d.length>0){const{data:S,error:N}=await oe.from("change_log").delete().eq("event_id",n).select("id");if(N)console.error("❌ Error deleting from change_log:",N),a.push(`change_log delete: ${N.message}`);else{const R=S?.length||0;console.log(`✅ Deleted ${R} log records`),r+=R}}const y=a.length===0||r>0,x=a.length>0?a.join("; "):void 0;return console.log(y?`✅ Master change log cleared: ${r} total records deleted`:`⚠️ Master change log clearing failed: ${x}`),{success:y,error:x,deletedCount:r}}catch(r){return console.error("❌ Unexpected error clearing master change log:",r),{success:!1,error:r.message||"Unexpected error",deletedCount:0}}}async getMasterChangeLog(n,r=100){try{console.log("🔄 Fetching master change log from Supabase for event:",n);const{data:a,error:i}=await oe.from("change_log_batches").select("*").eq("event_id",n).order("created_at",{ascending:!1}).limit(r);if(i){console.error("❌ Error fetching change batches:",i),console.log("🔄 Falling back to regular change_log table...");const{data:p,error:y}=await oe.from("change_log").select("*").eq("event_id",n).order("created_at",{ascending:!1}).limit(r);return y?(console.error("❌ Error fetching regular change log:",y),[]):(console.log("📊 Loaded regular change log:",p?.length||0,"changes"),p||[])}console.log("📊 Loaded change batches:",a?.length||0,"batches");const h=[];for(const p of a||[])if(p.changes&&Array.isArray(p.changes))for(const y of p.changes)h.push({...y,batch_id:p.id,batch_created_at:p.created_at});console.log("📊 Flattened changes from batches:",h.length,"changes");const d=h.sort((p,y)=>new Date(y.timestamp).getTime()-new Date(p.timestamp).getTime()).slice(0,r);return console.log("📊 Final sorted changes:",d.length,"changes"),d}catch(a){return console.error("❌ Error getting master change log:",a),[]}}exportChangesAsJSON(){return JSON.stringify(this.localChanges,null,2)}exportChangesAsCSV(){if(this.localChanges.length===0)return"No changes to export";const n=["Timestamp","User","Role","Action","Description","Row","Cue","Segment","Synced"],r=this.localChanges.map(a=>[a.timestamp.toISOString(),a.userName,a.userRole,a.action,a.description,a.rowNumber||"",a.cueNumber||"",a.segmentName||"",a.synced?"Yes":"No"]);return[n,...r].map(a=>a.join(",")).join(`
`)}}const pt=new Vv;window.addEventListener("beforeunload",()=>{pt.stopSyncTimer()});class Xs{static async testBackupTable(){try{console.log("🔄 Testing backup table access...");const{data:n,error:r}=await oe.from("run_of_show_backups").select("id").limit(1);return r?(console.error("❌ Backup table test failed:",r),!1):(console.log("✅ Backup table is accessible"),!0)}catch(n){return console.error("❌ Backup table test error:",n),!1}}static async createBackup(n,r,a,i,h="auto",d){try{console.log(`🔄 Creating/updating ${h} backup for event: ${n}`);const{data:{user:p}}=await oe.auth.getUser();if(!p)throw new Error("User not authenticated");const y=i?.name||"Unknown Event",x=i?.date?new Date(i.date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],S=i?.location||null,N=new Date().toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),R=d||`${h==="auto"?"Auto Backup":"Manual Backup"} - ${N}`,{data:L,error:F}=await oe.from("run_of_show_backups").select("*").eq("event_id",n).eq("event_date",x).single();if(F&&F.code!=="PGRST116")throw F;let B;if(L){console.log(`🔄 Updating existing backup for ${y} on ${x}`);const{data:I,error:Z}=await oe.from("run_of_show_backups").update({backup_name:R,schedule_data:r,custom_columns_data:a,event_data:i,backup_type:h,event_name:y,event_location:S,schedule_items_count:r?.length||0,custom_columns_count:a?.length||0,updated_at:new Date().toISOString()}).eq("id",L.id).select().single();if(Z)throw Z;B=I,console.log(`✅ Backup updated successfully: ${I.backup_name}`)}else{console.log(`🔄 Creating new backup for ${y} on ${x}`);const{data:I,error:Z}=await oe.from("run_of_show_backups").insert({event_id:n,backup_name:R,schedule_data:r,custom_columns_data:a,event_data:i,backup_type:h,event_name:y,event_date:x,event_location:S,schedule_items_count:r?.length||0,custom_columns_count:a?.length||0,created_by:p.id}).select().single();if(Z)throw Z;B=I,console.log(`✅ Backup created successfully: ${I.backup_name}`)}return B}catch(p){throw console.error("❌ Error creating/updating backup:",p),new Error(`Failed to create/update backup: ${p.message}`)}}static async getBackupsForEvent(n){try{console.log(`🔄 Fetching backups for event: ${n}`),console.log("🔄 Supabase client status:",oe?"Connected":"Not connected");const{data:r,error:a}=await oe.from("run_of_show_backups").select("*").eq("event_id",n).order("backup_timestamp",{ascending:!1});if(console.log("🔄 Supabase query result:",{data:r,error:a}),a)throw console.error("❌ Supabase error details:",{code:a.code,message:a.message,details:a.details,hint:a.hint}),a;return console.log(`✅ Found ${r?.length||0} backups for event: ${n}`),console.log("📊 Backup data:",r),r||[]}catch(r){throw console.error("❌ Error fetching backups:",r),console.error("❌ Error type:",typeof r),console.error("❌ Error message:",r.message),new Error(`Failed to fetch backups: ${r.message}`)}}static async getBackupsWithFilters(n={}){try{console.log("🔄 Fetching backups with filters:",n);let r=oe.from("run_of_show_backups").select("*");switch(n.eventId&&(r=r.eq("event_id",n.eventId)),n.eventName&&(r=r.ilike("event_name",`%${n.eventName}%`)),n.eventDate&&(r=r.eq("event_date",n.eventDate)),n.backupType&&(r=r.eq("backup_type",n.backupType)),n.sortBy){case"oldest":r=r.order("backup_timestamp",{ascending:!0});break;case"event":r=r.order("event_name",{ascending:!0});break;case"type":r=r.order("backup_type",{ascending:!0});break;case"newest":default:r=r.order("backup_timestamp",{ascending:!1});break}n.limit&&(r=r.limit(n.limit));const{data:a,error:i}=await r;if(i)throw i;return console.log(`✅ Found ${a?.length||0} backups with filters`),a||[]}catch(r){throw console.error("❌ Error fetching backups with filters:",r),new Error(`Failed to fetch backups: ${r.message}`)}}static async restoreFromBackup(n){try{console.log(`🔄 Restoring from backup: ${n}`);const{data:r,error:a}=await oe.from("run_of_show_backups").select("*").eq("id",n).single();if(a)throw a;if(!r)throw new Error("Backup not found");return console.log(`✅ Restored from backup: ${r.backup_name}`),{scheduleData:r.schedule_data||[],customColumnsData:r.custom_columns_data||[],eventData:r.event_data||{},backupName:r.backup_name,backupTimestamp:r.backup_timestamp}}catch(r){throw console.error("❌ Error restoring from backup:",r),new Error(`Failed to restore from backup: ${r.message}`)}}static async deleteBackup(n){try{console.log(`🔄 Deleting backup: ${n}`);const{error:r}=await oe.from("run_of_show_backups").delete().eq("id",n);if(r)throw r;return console.log(`✅ Backup deleted successfully: ${n}`),!0}catch(r){throw console.error("❌ Error deleting backup:",r),new Error(`Failed to delete backup: ${r.message}`)}}static async getBackupStats(n){try{const r=await this.getBackupsForEvent(n),a=r.filter(d=>d.backup_type==="auto").length,i=r.filter(d=>d.backup_type==="manual").length,h=r.length>0?r[0].backup_timestamp:null;return{totalBackups:r.length,lastBackup:h,autoBackups:a,manualBackups:i}}catch(r){throw console.error("❌ Error getting backup stats:",r),new Error(`Failed to get backup stats: ${r.message}`)}}}class Bv{constructor(n){this.activeTimers=new Map,this.checkInterval=null,this.syncCallbacks=new Map,this.isRunning=!1,this.config={checkInterval:3e4,maxDriftThreshold:5,forceSyncInterval:3e4,minTimerDuration:0,...n}}startMonitoring(n,r,a,i){if(console.log(`🔄 DriftDetector: Starting monitoring for timer ${n}`,{startedAt:r.toISOString(),duration:a,minDuration:this.config.minTimerDuration}),a<this.config.minTimerDuration){console.log(`⏭️ DriftDetector: Skipping timer ${n} - duration too short (${a}s < ${this.config.minTimerDuration}s)`);return}const h={itemId:n,startedAt:r,duration:a,lastSyncAt:new Date,localElapsed:0,serverElapsed:0};this.activeTimers.set(n,h),this.syncCallbacks.set(n,i),this.isRunning||this.startMonitoringLoop()}stopMonitoring(n){console.log(`🔄 DriftDetector: Stopping monitoring for timer ${n}`),this.activeTimers.delete(n),this.syncCallbacks.delete(n),this.activeTimers.size===0&&this.isRunning&&this.stopMonitoringLoop()}updateLocalElapsed(n,r){const a=this.activeTimers.get(n);a&&(a.localElapsed=r)}async forceSync(n,r){const a=this.activeTimers.get(n);if(a)try{const i=await r(),h=Math.abs(i-a.localElapsed);console.log(`🔄 DriftDetector: Force sync for timer ${n}`,{localElapsed:a.localElapsed,serverElapsed:i,drift:h.toFixed(2)}),a.serverElapsed=i,a.lastSyncAt=new Date;const d=this.syncCallbacks.get(n);d&&d(i)}catch(i){console.error(`❌ DriftDetector: Error during force sync for timer ${n}:`,i)}}startMonitoringLoop(){this.isRunning||(console.log("🔄 DriftDetector: Starting monitoring loop"),this.isRunning=!0,this.checkInterval=setInterval(()=>{this.checkAllTimers()},this.config.checkInterval))}stopMonitoringLoop(){this.isRunning&&(console.log("🔄 DriftDetector: Stopping monitoring loop"),this.isRunning=!1,this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null))}async checkAllTimers(){const n=new Date,r=[];for(const[a,i]of this.activeTimers)r.push(this.checkTimerDrift(a,i,n));await Promise.all(r)}async checkTimerDrift(n,r,a){try{const i=a.getTime()-r.lastSyncAt.getTime();if(i>=this.config.forceSyncInterval){console.log(`🔄 DriftDetector: Force sync needed for timer ${n} (${i}ms since last sync)`);return}const d=Math.floor((a.getTime()-r.startedAt.getTime())/1e3),p=Math.abs(d-r.localElapsed);p>this.config.maxDriftThreshold&&console.log(`⚠️ DriftDetector: Significant drift detected for timer ${n}`,{localElapsed:r.localElapsed,expectedElapsed:d,drift:p.toFixed(2),threshold:this.config.maxDriftThreshold})}catch(i){console.error(`❌ DriftDetector: Error checking drift for timer ${n}:`,i)}}getConfig(){return{...this.config}}updateConfig(n){this.config={...this.config,...n},console.log("🔄 DriftDetector: Configuration updated",this.config)}getStatus(){const n=new Date;return Array.from(this.activeTimers.entries()).map(([r,a])=>{const i=Math.abs(a.serverElapsed-a.localElapsed),h=n.getTime()-a.lastSyncAt.getTime();return{itemId:r,drift:i,timeSinceLastSync:h}})}getStatusForTimer(n){const r=this.activeTimers.get(n);if(!r)return{itemId:n,drift:0,timeSinceLastSync:0};const a=new Date,i=Math.abs(r.serverElapsed-r.localElapsed),h=a.getTime()-r.lastSyncAt.getTime();return{itemId:n,drift:i,timeSinceLastSync:h}}destroy(){console.log("🔄 DriftDetector: Destroying drift detector"),this.stopMonitoringLoop(),this.activeTimers.clear(),this.syncCallbacks.clear()}}const rn=new Bv,um=({itemId:u,className:n=""})=>{const[r,a]=_.useState(null);if(_.useEffect(()=>{console.log(`🔄 DriftStatusIndicator: Starting for itemId ${u}`);const y=()=>{const S=rn.getStatusForTimer(u);console.log(`🔄 DriftStatusIndicator: Status for itemId ${u}:`,S),S?(console.log(`🔄 DriftStatusIndicator: Found status for itemId ${u}:`,S),a({drift:S.drift,timeSinceLastSync:S.timeSinceLastSync})):(console.log(`🔄 DriftStatusIndicator: No status found for itemId ${u}`),a(null))};y();const x=setInterval(y,5e3);return()=>clearInterval(x)},[u]),!r)return console.log(`🔄 DriftStatusIndicator: No drift info for itemId ${u}, showing blue dot (starting up)`),o.jsx("div",{className:`drift-status ${n}`,children:o.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500",title:`Drift detection starting up for timer ${u}`})});const{drift:i,timeSinceLastSync:h}=r,d=i>5,p=h>6e4;return o.jsx("div",{className:`drift-status ${n}`,children:o.jsx("div",{className:`w-2 h-2 rounded-full ${d?"bg-red-500":p?"bg-yellow-500":"bg-green-500"}`,title:`Drift: ${i.toFixed(1)}s, Last sync: ${Math.round(h/1e3)}s ago`})})},zv=({isOpen:u,onClose:n,event:r,schedule:a,activeItemId:i,activeTimers:h,onLoadCue:d,onStartTimer:p,onStopTimer:y,onResetTimer:x})=>{const[S,N]=_.useState({isConnected:!1,serverPort:57121}),[R,L]=_.useState([]),[F,B]=_.useState(""),[I,Z]=_.useState(""),[Y,H]=_.useState(!0),[q,J]=_.useState(null),P=_.useRef(null),V=()=>{P.current?.scrollIntoView({behavior:"smooth"})};_.useEffect(()=>{V()},[R]);const te=(k,U)=>{if(console.log("🎯 Handling OSC response:",k,U),k==="/cue/loaded"&&U.length>=1){const ae=U[0];console.log("🎯 Cue loaded, finding item for cue ID:",ae);const he=C(ae);he&&d?(console.log("🎯 Found item for cue, calling onLoadCue:",he.id),d(he.id.toString())):console.log("❌ Could not find item for cue ID:",ae)}else if(k==="/timer/started")console.log("🎯 Generic timer started - controlling currently loaded cue"),p&&p("generic");else if(k==="/timer/stopped")console.log("🎯 Generic timer stopped - controlling currently loaded cue"),y&&y("generic");else if(k==="/timer/reset")console.log("🎯 Generic timer reset - using resetAllStates"),x&&x("generic");else if(k==="/subtimer/started"&&U.length>=1){const ae=U[0];console.log("🎯 Sub-timer started, finding item for sub-timer ID:",ae);const he=re(ae);he&&p?(console.log("🎯 Found item for sub-timer, calling onStartTimer:",he.id),p(he.id.toString())):console.log("❌ Could not find item for sub-timer ID:",ae)}else if(k==="/subtimer/stopped"&&U.length>=1){const ae=U[0];console.log("🎯 Sub-timer stopped, finding item for sub-timer ID:",ae);const he=re(ae);he&&y?(console.log("🎯 Found item for sub-timer, calling onStopTimer:",he.id),y(he.id.toString())):console.log("❌ Could not find item for sub-timer ID:",ae)}},C=k=>a.length?a.find(U=>{const ae=U.customFields?.cue||"";return ae===k||ae===`CUE ${k}`||ae===`CUE${k}`}):null,re=k=>a.length?a.find(U=>U.isIndented&&(U.timerId===k||U.id.toString()===k)):null;_.useEffect(()=>u?((()=>{try{const U=new WebSocket("ws://localhost:57121/osc");U.onopen=()=>{console.log("🔌 OSC WebSocket connected"),N(ae=>({...ae,isConnected:!0,error:void 0})),ue({address:"/system/connected",args:[],direction:"outgoing"})},U.onmessage=ae=>{try{console.log("📨 OSC WebSocket message received:",ae.data);const he=JSON.parse(ae.data);he.type==="connected"?console.log("✅ OSC Server:",he.message):he.type==="osc_response"?(console.log("📥 OSC Response:",he.address,he.args),ue({address:he.address,args:he.args,direction:"incoming"}),te(he.address,he.args)):he.type==="pong"&&(console.log("🏓 Pong received"),ue({address:"/pong",args:["server","alive"],direction:"incoming"}))}catch(he){console.error("❌ Error parsing WebSocket message:",he)}},U.onerror=ae=>{console.error("❌ WebSocket error:",ae),N(he=>({...he,isConnected:!1,error:"OSC server not running - start osc-websocket-server.js"}))},U.onclose=()=>{console.log("🔌 OSC WebSocket disconnected"),N(ae=>({...ae,isConnected:!1,error:"Connection closed"}))},J(U),setTimeout(()=>{U.readyState===WebSocket.OPEN?(console.log("🏓 Sending ping to OSC server..."),U.send(JSON.stringify({type:"osc",address:"/ping",args:[]}))):console.log("❌ WebSocket not ready for ping")},1e3)}catch(U){console.error("❌ Failed to initialize OSC WebSocket:",U),N(ae=>({...ae,isConnected:!1,error:"Failed to create WebSocket connection"}))}})(),()=>{q&&q.readyState===WebSocket.OPEN&&q.close()}):void 0,[u]);const ue=k=>{if(!Y)return;const U={...k,id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:new Date};L(ae=>[...ae.slice(-99),U])},Ee=(k,U=[])=>{if(!q||!S.isConnected){console.log("❌ OSC server not connected - cannot send message"),alert("OSC server not connected");return}try{const ae={type:"osc",address:k,args:U};console.log("📤 Sending OSC message:",ae),q.send(JSON.stringify(ae)),ue({address:k,args:U,direction:"outgoing"})}catch(ae){console.error("❌ Error sending OSC message:",ae),alert("Failed to send OSC message")}},fe=()=>{if(!F.trim()){alert("Please enter a cue name");return}const k=F.trim();Ee(`/cue/${k}/load`,[])},me=()=>{i?(console.log("🎯 Generic start - controlling currently loaded item:",i),Ee("/timer/start",[])):alert("No cue is currently loaded. Please load a cue first.")},pe=()=>{const k=Object.keys(h);if(k.length>0){const U=parseInt(k[0]);console.log("🎯 Generic stop - controlling currently running timer:",U),Ee("/timer/stop",[])}else alert("No timer is currently running.")},$e=()=>{console.log("🎯 Generic reset - using resetAllStates (same as Reset button)"),Ee("/timer/reset",[])},ee=()=>{if(!I.trim()){alert("Please enter a sub-timer ID");return}Ee(`/subtimer/${I.trim()}/start`,[])},X=()=>{if(!I.trim()){alert("Please enter a sub-timer ID");return}Ee(`/subtimer/${I.trim()}/stop`,[])},$=()=>{L([])},M=k=>k.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3});return u?o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h2",{className:"text-xl font-semibold text-white",children:"OSC Control Panel"}),o.jsx("button",{onClick:n,className:"text-slate-400 hover:text-white transition-colors",children:o.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),o.jsxs("div",{className:"flex-1 overflow-hidden",children:[o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-full",children:[o.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Connection Status"}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:`w-3 h-3 rounded-full ${S.isConnected?"bg-green-500":"bg-red-500"}`}),o.jsx("span",{className:"text-sm",children:S.isConnected?"Connected":"Disconnected"})]}),o.jsxs("div",{className:"text-sm text-slate-400",children:["Server: 127.0.0.1:",S.serverPort]}),o.jsxs("div",{className:"border-t border-slate-600 pt-3",children:[o.jsx("div",{className:"text-sm font-medium text-slate-300 mb-2",children:"Current State:"}),o.jsxs("div",{className:"text-xs text-slate-400 space-y-1",children:[o.jsxs("div",{children:["Loaded Cue: ",i?`Item ${i}`:"None"]}),o.jsxs("div",{children:["Running Timers: ",Object.keys(h).length]}),Object.keys(h).length>0&&o.jsxs("div",{className:"text-green-400",children:["Active: ",Object.keys(h).map(k=>`Item ${k}`).join(", ")]})]})]}),S.error&&o.jsxs("div",{className:"text-sm text-red-400",children:["Error: ",S.error]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:()=>{q&&q.readyState===WebSocket.OPEN&&q.send(JSON.stringify({type:"osc",address:"/ping",args:[]}))},className:"px-3 py-1 bg-blue-600 hover:bg-blue-500 text-white text-sm rounded transition-colors",children:"Test Connection"}),!S.isConnected&&o.jsx("button",{onClick:()=>{q&&q.close(),N(k=>({...k,error:void 0}))},className:"px-3 py-1 bg-green-600 hover:bg-green-500 text-white text-sm rounded transition-colors",children:"Retry"})]})]})]}),o.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Cue & Timer Controls"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Cue Name (to load)"}),o.jsx("input",{type:"text",value:F,onChange:k=>B(k.target.value),placeholder:"Enter cue name (1, 1.1, 1A, etc.)",className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Sub-Timer ID (for indented items)"}),o.jsx("input",{type:"text",value:I,onChange:k=>Z(k.target.value),placeholder:"Enter sub-timer ID",className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h4",{className:"text-sm font-medium text-slate-300",children:"Main Cue Controls"}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsx("button",{onClick:fe,className:"px-3 py-2 bg-purple-600 hover:bg-purple-500 text-white text-sm rounded transition-colors",children:"Load Cue"}),o.jsx("button",{onClick:me,className:"px-3 py-2 bg-green-600 hover:bg-green-500 text-white text-sm rounded transition-colors",children:"Start (Generic)"}),o.jsx("button",{onClick:pe,className:"px-3 py-2 bg-red-600 hover:bg-red-500 text-white text-sm rounded transition-colors",children:"Stop (Generic)"}),o.jsx("button",{onClick:$e,className:"px-3 py-2 bg-yellow-600 hover:bg-yellow-500 text-white text-sm rounded transition-colors",children:"Reset (Generic)"})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h4",{className:"text-sm font-medium text-slate-300",children:"Sub-Timer Controls"}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsx("button",{onClick:ee,className:"px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white text-sm rounded transition-colors",children:"Start Sub-Timer"}),o.jsx("button",{onClick:X,className:"px-3 py-2 bg-orange-600 hover:bg-orange-500 text-white text-sm rounded transition-colors",children:"Stop Sub-Timer"})]})]})]})]}),o.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Message Log"}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"checkbox",checked:Y,onChange:k=>H(k.target.checked),className:"rounded"}),o.jsx("label",{className:"text-sm text-slate-300",children:"Enable Logging"})]}),o.jsxs("div",{className:"text-sm text-slate-400",children:["Messages: ",R.length]}),o.jsxs("div",{className:"text-xs text-slate-500 space-y-1",children:[o.jsx("div",{children:o.jsx("strong",{children:"OSC Message Examples:"})}),o.jsx("div",{className:"font-semibold text-slate-400",children:"Main Cue Commands:"}),o.jsx("div",{children:"/cue/1/load"}),o.jsx("div",{children:"/cue/1.1/load"}),o.jsx("div",{children:"/cue/1A/load"}),o.jsx("div",{className:"font-semibold text-slate-400 mt-2",children:"Generic Timer Commands:"}),o.jsx("div",{children:"/timer/start"}),o.jsx("div",{children:"/timer/stop"}),o.jsx("div",{children:"/timer/reset"}),o.jsx("div",{className:"font-semibold text-slate-400 mt-2",children:"Sub-Timer Commands:"}),o.jsx("div",{children:"/subtimer/SUB1/start"}),o.jsx("div",{children:"/subtimer/SUB1/stop"})]})]})]})]}),o.jsxs("div",{className:"mt-6 bg-slate-700 rounded-lg p-4 flex-1 min-h-0",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-white",children:"OSC Message Log"}),o.jsx("button",{onClick:$,className:"px-3 py-1 bg-slate-600 hover:bg-slate-500 text-white text-sm rounded transition-colors",children:"Clear Messages"})]}),o.jsxs("div",{className:"bg-slate-900 rounded-lg p-4 h-64 overflow-y-auto font-mono text-sm",children:[R.length===0?o.jsx("div",{className:"text-slate-500 text-center py-8",children:S.isConnected?"No messages yet. Send OSC commands to see messages.":o.jsxs("div",{children:[o.jsx("div",{className:"text-red-400 mb-2",children:"⚠️ OSC Server Not Connected"}),S.error?.includes("Node.js environment")?o.jsxs("div",{children:[o.jsx("div",{className:"text-sm text-yellow-400 mb-2",children:"OSC requires local Node.js server"}),o.jsx("div",{className:"text-sm",children:"For online deployment, OSC is not available."}),o.jsx("div",{className:"text-sm",children:"For local use with OSC:"}),o.jsx("div",{className:"text-xs font-mono bg-slate-800 p-2 rounded mt-2",children:"start-both-servers.bat"}),o.jsx("div",{className:"text-xs mt-1",children:"Or: start-websocket-osc-server.bat"})]}):o.jsxs("div",{children:[o.jsx("div",{className:"text-sm",children:"Start the OSC server using:"}),o.jsx("div",{className:"text-xs font-mono bg-slate-800 p-2 rounded mt-2",children:"node osc-server.js"}),o.jsx("div",{className:"text-xs mt-2",children:"Or use the batch file: start-osc-server.bat"})]})]})}):R.map(k=>o.jsxs("div",{className:`flex items-start gap-3 py-1 ${k.direction==="incoming"?"text-green-400":"text-blue-400"}`,children:[o.jsx("span",{className:"text-slate-500 text-xs w-20 flex-shrink-0",children:M(k.timestamp)}),o.jsx("span",{className:"text-slate-500 text-xs w-20 flex-shrink-0",children:k.direction==="incoming"?"←":"→"}),o.jsx("span",{className:"text-yellow-400 flex-shrink-0",children:k.address}),k.args.length>0&&o.jsx("span",{className:"text-slate-300",children:JSON.stringify(k.args)})]},k.id)),o.jsx("div",{ref:P})]})]})]})]})}):null},Wv=()=>{const u=vr(),n=Zo();let r=u.state?.event,a=u.state?.userRole;const{user:i,loading:h}=no(),[d,p]=_.useState("VIEWER"),[y,x]=_.useState(!1),[S,N]=_.useState(!1),[R,L]=_.useState([]),[F,B]=_.useState([]),[I,Z]=_.useState(!1),[Y,H]=_.useState(new Map),q=_.useRef(new Map),J=_.useRef(new Set),P=(l,g,v)=>{if(d!=="EDITOR"&&d!=="OPERATOR"||!i||!r?.id){console.log("⚠️ Not logging change - missing requirements:",{role:d,user:!!i,event:!!r?.id});return}let w=g,E,T;v?.itemId&&(E=C.findIndex(Q=>Q.id===v.itemId)+1,T=C.find(Q=>Q.id===v.itemId)?.customFields?.cue||"CUE",w=`ROW ${E} - ${Lt(T)}: ${g}`),pt.addChange({eventId:r.id,userId:i.id,userName:i.user_metadata?.full_name||i.email||"Unknown",userRole:d,action:l,description:w,details:v,rowNumber:E,cueNumber:T,segmentName:v?.itemName||v?.segmentName});const D=pt.getLocalChanges();L(D.slice(0,100)),console.log("📝 Change logged to buffer:",w)},V=(l,g,v,w)=>{if(d!=="EDITOR"&&d!=="OPERATOR"){console.log("⚠️ Not logging change - user role is not EDITOR or OPERATOR:",d);return}const E=w?.fieldName?.includes("Name")||w?.fieldName?.includes("segmentName")||w?.fieldName?.includes("cue")||w?.fieldName?.includes("custom"),T=E?`text_${w?.itemId}_${w?.fieldName}`:l,D=q.current.get(T);D&&(clearTimeout(D),q.current.delete(T)),H(ye=>{const ie=new Map(ye);for(const[ge,Te]of ie.entries())Te.originalKey===T&&ie.delete(ge);return ie});let G=v,Q={...w};if(w?.itemId){const ye=C.findIndex(Te=>Te.id===w.itemId)+1,ge=C.find(Te=>Te.id===w.itemId)?.customFields?.cue||"CUE";G=`ROW ${ye} - ${Lt(ge)}: ${v}`,Q={...w,rowNumber:ye,cueNumber:ge}}if(E)H(ye=>{const ie=new Map(ye);for(const[Te,Ge]of ie.entries())Ge.originalKey===T&&ie.delete(Te);const ge=`${T}_${Date.now()}`;return ie.set(ge,{action:g,description:G,details:Q,timestamp:new Date,user:i?.user_metadata?.full_name||i?.email||"Unknown User",originalKey:T}),console.log("📝 Updated text field pending change:",ge,"for baseKey:",T),console.log("📝 Total pending changes:",ie.size),console.log("📝 Pending change details:",{action:g,description:G,baseKey:T,uniqueKey:ge}),ie});else{const ye=`${T}_${Date.now()}`;H(ie=>{const ge=new Map(ie.set(ye,{action:g,description:G,details:Q,timestamp:new Date,user:i?.user_metadata?.full_name||i?.email||"Unknown User",originalKey:T}));return console.log("📝 Added pending change:",ye,"for baseKey:",T),console.log("📝 Total pending changes:",ge.size),console.log("📝 Pending change details:",{action:g,description:G,baseKey:T,uniqueKey:ye}),ge})}const de=setTimeout(async()=>{console.log("🕐 TIMEOUT FIRED for baseKey:",T),H(ye=>{let ie=null,ge=null;console.log("🕐 TIMEOUT: Looking for baseKey:",T),console.log("🕐 TIMEOUT: Available pending changes:",Array.from(ye.entries()).map(([Ge,rt])=>({key:Ge,originalKey:rt.originalKey})));for(const[Ge,rt]of ye.entries())if(rt.originalKey===T){ie=rt,ge=Ge,console.log("🕐 TIMEOUT: Found match - key:",Ge,"originalKey:",rt.originalKey);break}console.log("🕐 TIMEOUT: Found pending change:",ie?"YES":"NO"),console.log("🕐 TIMEOUT: Change key:",ge),console.log("🕐 TIMEOUT: Has change key in prev:",ye.has(ge||""));const Te=`${T}-${ie?.timestamp?.getTime()||Date.now()}`;if(console.log("🕐 TIMEOUT: Change ID:",Te),console.log("🕐 TIMEOUT: Already processed:",J.current.has(Te)),ie&&ge&&ye.has(ge)&&i&&r?.id&&!J.current.has(Te)){console.log("🕐 TIMEOUT: Processing change..."),J.current.add(Te);const Ge={eventId:r.id,userId:i.id,userName:i.user_metadata?.full_name||i.email||"Unknown",userRole:d||"VIEWER",action:ie?.action||"unknown",description:ie?.description||"unknown",details:ie?.details||{},rowNumber:ie?.details?.rowNumber,cueNumber:ie?.details?.cueNumber,segmentName:ie?.details?.itemName||ie?.details?.segmentName};console.log("🔄 Adding change to service:",Ge),pt.addChange(Ge);const rt=pt.getLocalChanges();console.log("🔄 Local changes after adding to service:",rt.length),console.log("🔄 Latest change:",rt[rt.length-1]),console.log("🔄 Current changeLog state length:",R.length),L(rt.slice(0,100)),console.log("🔄 Set changeLog to:",rt.slice(0,100).length,"changes"),console.log("✅ Debounced change logged to change log service:",ie?.description||"unknown"),console.log("🔄 Removed pending change from queue:",ge),console.log("🔄 Auto-syncing changes after timeout... (with 3s additional delay)"),setTimeout(()=>{va().then(()=>{console.log("✅ Auto-sync completed after timeout + 3s delay"),fi(!0),console.log("⏭️ Set skipNextSync flag to prevent false reset")}).catch(Mt=>{console.error("❌ Auto-sync failed after timeout + 3s delay:",Mt)})},3e3),q.current.delete(T);const rr=new Map(ye);return rr.delete(ge),console.log("🔄 Pending changes after removal:",rr.size),console.log("🔄 Remaining pending keys:",Array.from(rr.keys())),rr}else{q.current.delete(T),J.current.has(Te)?console.log("⚠️ Prevented duplicate processing of change:",Te):console.log("ℹ️ Pending change already processed or removed:",T);const Ge=Date.now(),rt=new Map(ye);let rr=0;for(const[Mt,ja]of rt.entries()){const As=Ge-ja.timestamp.getTime();As>15e3&&(console.log("🧹 Removing stale pending change:",Mt,"age:",As+"ms"),rt.delete(Mt),rr++)}return rr>0?(console.log("🧹 Removed",rr,"stale pending changes"),rt):ye}})},5e3);q.current.set(T,de),console.log("⏰ Set timeout for baseKey:",T,"in",5e3,"ms"),console.log("⏰ Total active timeouts:",q.current.size)},te=async()=>{console.log("🔄 Finalizing all pending changes...");const l=Array.from(Y.entries());if(l.length===0){console.log("ℹ️ No pending changes to finalize");return}q.current.forEach(w=>{clearTimeout(w)}),q.current.clear(),console.log(`🔄 Processing ${l.length} pending changes immediately...`);const g=new Set;for(const[w,E]of l)if(E&&i&&r?.id){const T=`${E.originalKey||w}-${E.timestamp.getTime()}`;if(J.current.has(T)){console.log("⚠️ Skipping already processed change:",T);continue}J.current.add(T),g.add(T);let D=E.description,G,Q;E.details?.itemId&&(G=C.findIndex(ye=>ye.id===E.details.itemId)+1,Q=C.find(ye=>ye.id===E.details.itemId)?.customFields?.cue||"CUE",D=`ROW ${G} - ${Lt(Q)}: ${E.description}`),pt.addChange({eventId:r.id,userId:i.id,userName:i.user_metadata?.full_name||i.email||"Unknown",userRole:d||"VIEWER",action:E.action,description:D,details:E.details,rowNumber:G,cueNumber:Q,segmentName:E.details?.itemName||E.details?.segmentName}),console.log("✅ Processed pending change immediately:",D)}H(new Map);const v=pt.getLocalChanges();L(v.slice(0,100)),console.log(`✅ All ${g.size} pending changes processed immediately`),console.log("🔄 Auto-syncing changes after manual finalization...");try{await va(),console.log("✅ Auto-sync completed after manual finalization")}catch(w){console.error("❌ Auto-sync failed after manual finalization:",w)}setTimeout(()=>{g.forEach(w=>{J.current.delete(w)}),console.log("🧹 Cleaned up processed change tracking for",g.size,"changes")},6e4)};if(_.useEffect(()=>()=>{q.current.forEach(l=>clearTimeout(l))},[]),_.useEffect(()=>{const l=setInterval(()=>{H(g=>{const v=Date.now(),w=new Map(g);let E=0;for(const[T,D]of w.entries()){const G=v-D.timestamp.getTime();G>2e4&&(console.log("🧹 Periodic cleanup: Removing stale pending change:",T,"age:",G+"ms"),w.delete(T),E++)}return E>0&&console.log("🧹 Periodic cleanup: Removed",E,"stale pending changes"),w})},5e3);return()=>clearInterval(l)},[]),_.useEffect(()=>{const l=pt.getChangesCount().unsynced;Vl(l)},[R,Y]),!r){const l=localStorage.getItem("events");if(l){const g=JSON.parse(l);r=g[g.length-1]}}console.log("Event from location.state:",u.state?.event),console.log("Final event data:",r);const[C,re]=_.useState([]),[ue,Ee]=_.useState([]),[fe,me]=_.useState(r?.name||""),[pe,$e]=_.useState(""),[ee,X]=_.useState({}),[$,M]=_.useState(1),[k,U]=_.useState(null),[ae,he]=_.useState(!1),[De,Pe]=_.useState({show:!1}),[Ve,Ae]=_.useState(!1),[He,kt]=_.useState(!1),[an,ra]=_.useState(null),[so,is]=_.useState(!1),[ls,cs]=_.useState(!1),[Jt,us]=_.useState(null),[Cn,Rr]=_.useState(!1),[Et,ln]=_.useState(null),[Nt,yr]=_.useState([]),[ds,hs]=_.useState(!1),[Qt,cn]=_.useState(null),[oi,Rn]=_.useState(!1),[On,ai]=_.useState(null),[fs,ms]=_.useState(!1),[qr,In]=_.useState(null),[jt,Yt]=_.useState([]),[Oe,cr]=_.useState({}),[zt,xr]=_.useState({}),[Ke,ur]=_.useState({}),[na,br]=_.useState({}),[st,wr]=_.useState(null),[gs,Pn]=_.useState(null),[oo,ps]=_.useState(!1),[nd,Kr]=_.useState(null),[sa,ao]=_.useState(null),[ke,Or]=_.useState(null),[Ye,Tt]=_.useState({}),[Xt,Ot]=_.useState({}),[ii,io]=_.useState(new Set),[Al,$l]=_.useState(null),[Ml,Gr]=_.useState({}),[li,Ir]=_.useState(!1),[Be,Ul]=_.useState(null),[oa,vs]=_.useState(!1),[Sr,lo]=_.useState(""),[aa,ys]=_.useState(!1),[_r,ia]=_.useState(!1),[dr,ci]=_.useState(!1),[co,la]=_.useState(!1),[xs,bs]=_.useState([]),[uo,Dn]=_.useState({totalBackups:0,lastBackup:null,autoBackups:0,manualBackups:0}),[Fl,ho]=_.useState(!1),[Wt,ca]=_.useState(null),[Pr,ws]=_.useState(!0),[ua,da]=_.useState(null),[ve,It]=_.useState({start:!0,programType:!0,duration:!0,segmentName:!0,shotType:!0,pptQA:!0,notes:!0,assets:!0,participants:!1,speakers:!0,public:!0,custom:!0}),[Ss,_s]=_.useState({}),[Ue,ui]=_.useState({start:128,programType:224,duration:224,segmentName:320,shotType:192,pptQA:192,notes:384,assets:192,participants:256,speakers:384,public:128}),[ks,ha]=_.useState({}),[Pt,Dr]=_.useState(!1);_.useEffect(()=>{const l=localStorage.getItem(`followEnabled_${r?.id}`);l!==null&&Dr(l==="true")},[r?.id]),_.useEffect(()=>{localStorage.setItem(`followEnabled_${r?.id}`,Pt.toString())},[Pt,r?.id]),_.useEffect(()=>{if(Pt&&ke){const l=localStorage.getItem(`scrollPosition_${r?.id}`);if(l){const g=parseInt(l);setTimeout(()=>{window.scrollTo({top:g,behavior:"smooth"})},100)}}},[ke,Pt,r?.id]);const[Lr,Dt]=_.useState(new Set),Lt=l=>l?l.includes("CUE ")?l:l.replace(/^CUE(\d+)$/,"CUE $1"):"CUE",[Ln,Ht]=_.useState(new Set),[di,An]=_.useState(null),[Es,hi]=_.useState(!1),[un,hr]=_.useState(!1),[Ns,Vl]=_.useState(0),[Zt,dn]=_.useState(null),[Ar,fo]=_.useState(0),[Bl,fi]=_.useState(!1),[$n,$r]=_.useState(!1),[Jr,js]=_.useState(null),[Qr,Mn]=_.useState(20),[mo,Ts]=_.useState(!1),Mr=_.useRef(null),Qe=()=>{console.log("✏️ User started editing - pausing sync"),$r(!0),Jr&&clearTimeout(Jr);const l=setTimeout(()=>{console.log("⏸️ User stopped editing - resuming sync"),$r(!1),xt()},5e3);js(l)},At=()=>{console.log("✏️ Modal opened - pausing sync until closed"),$r(!0),Jr&&(clearTimeout(Jr),js(null))},xt=_.useCallback(()=>{Mr.current&&clearInterval(Mr.current),Mn(20),Ts(!1);const l=setInterval(()=>{Mn(g=>g<=1?(Ts(!0),setTimeout(()=>{Ts(!1),Mn(20)},3e3),0):g-1)},1e3);Mr.current=l},[]),hn=_.useCallback(()=>{Mr.current&&(clearInterval(Mr.current),Mr.current=null),Mn(20),Ts(!1)},[]),ht=()=>{console.log("✏️ Modal closed - resuming sync in 5 seconds");const l=setTimeout(()=>{console.log("⏸️ User stopped editing - resuming sync"),$r(!1),xt()},5e3);js(l)};_.useEffect(()=>{if(h){console.log("⏳ Authentication still loading, waiting...");return}i&&r?.id?(async()=>{try{console.log("🔍 Loading role from Supabase for user:",i.id,"event:",r.id);const g=await be.getCurrentUserSession(i.id);if(console.log("📋 User session from Supabase:",g),g&&g.event_id===r.id&&g.user_role)return p(g.user_role),console.log("✅ Loaded role from Supabase:",g.user_role),!0;console.log("❌ No valid role found in Supabase:",{hasSession:!!g,eventIdMatch:g?.event_id===r.id,hasRole:!!g?.user_role})}catch(g){console.log("⚠️ Failed to load role from Supabase:",g)}return!1})().then(g=>{if(g){console.log("✅ Using role from Supabase");return}if(a&&["VIEWER","EDITOR","OPERATOR"].includes(a)){p(a),be.saveUserSession(r.id,i.id,i.user_metadata?.full_name||i.email||"Unknown",a),console.log("✅ Using role from navigation state (no Supabase role found):",a);return}console.log("❌ No role found, showing role selection modal"),x(!0)}):!i&&r?.id&&(console.log("❌ No user authenticated, defaulting to VIEWER role"),p("VIEWER"))},[i,r?.id,h,a,n]),_.useEffect(()=>{if(r?.id){console.log("🔄 Loading change log data for event:",r.id),pt.reloadLocalChanges();const l=pt.getLocalChanges();L(l.slice(0,100)),console.log("📝 Loaded local changes:",l.length),pa(),mi(),zl(),po(),Wl();const g=setInterval(()=>{const v=pt.getLocalChanges();L(v.slice(0,100))},2e3);return()=>clearInterval(g)}},[r?.id]);const[Cs,fa]=_.useState(!1),[Rs,ma]=_.useState(null),[Un,go]=_.useState(!1);_.useEffect(()=>{r?.id&&C.length>0&&!Un&&(console.log("🔄 Schedule loaded, checking for running timers for event:",r.id),ga(),go(!0))},[r?.id,C.length,Un]),_.useEffect(()=>{if(!r?.id)return;const l=async()=>{try{const{data:v,error:w}=await oe.from("completed_cues").select("*").eq("event_id",r.id);if(!w&&v){const E={};v.forEach(T=>{T.item_id&&(E[T.item_id]=!0)}),br(E),console.log("🟣 Synced completed cues:",E)}}catch(v){console.warn("⚠️ Error syncing completed cues:",v)}};l();const g=setInterval(l,2e3);return()=>clearInterval(g)},[r?.id]),_.useEffect(()=>{if(!r?.id)return;const l=async()=>{try{await po()}catch(v){console.warn("⚠️ Error syncing sub-cue timers:",v)}};l();const g=setInterval(l,1e3);return()=>clearInterval(g)},[r?.id]),_.useEffect(()=>{if(!r?.id||!i?.id)return;const l=async()=>{try{const{data:v,error:w}=await oe.from("active_timers").select("*").eq("event_id",r.id).order("updated_at",{ascending:!1}).limit(1);if(w){console.warn("⚠️ Top text sync error:",w);return}const E=v?.[0];if(E&&E.user_id===i.id)return;if(E){const T=E.timer_state||"unknown",D=parseInt(E.item_id),G=E.is_active,Q=E.started_at;let de=T;if((T==="unknown"||!T)&&(G&&Q?de="running":G?de="loaded":de="stopped"),de==="running"){Or(D),Gr(ge=>({...ge,[D]:!0})),cr(ge=>({...ge,[D]:!0}));const ye=C.findIndex(ge=>ge.id===D),ie=new Set;if(ye!==-1)for(let ge=ye+1;ge<C.length&&C[ge].isIndented;ge++)ie.add(C[ge].id);Ht(ie),An(D)}else if(de==="loaded"){Or(D),Gr(ge=>({...ge,[D]:!0})),cr({});const ye=C.findIndex(ge=>ge.id===D),ie=new Set;if(ye!==-1)for(let ge=ye+1;ge<C.length&&C[ge].isIndented;ge++)ie.add(C[ge].id);Ht(ie),An(D)}else de==="stopped"&&(Or(null),Gr({}),cr({}),Ht(new Set),An(null))}else Or(null),Gr({}),cr({}),Ht(new Set),An(null)}catch(v){console.warn("⚠️ Top text sync error:",v)}};l();const g=setInterval(l,2e3);return()=>clearInterval(g)},[r?.id,i?.id,C]),_.useEffect(()=>()=>{console.log("🔄 Cleaning up drift detector on component unmount"),rn.destroy()},[]),_.useEffect(()=>{if(r?.id&&i?.id&&d&&d!=="VIEWER"){console.log("💾 Saving current role to Supabase:",d);try{const l=i.user_metadata?.full_name||i.email||"Unknown";be.saveUserSession(r.id,i.id,l,d),console.log("✅ Role saved to Supabase:",d)}catch(l){console.error("❌ Failed to save role to Supabase:",l)}}},[r?.id,i?.id,d]),_.useEffect(()=>()=>{if(r?.id&&i?.id&&d&&d!=="VIEWER"){console.log("💾 Saving current role to Supabase before navigating away:",d);try{const l=i.user_metadata?.full_name||i.email||"Unknown";be.saveUserSession(r.id,i.id,l,d),console.log("✅ Role saved to Supabase on navigation away:",d)}catch(l){console.error("❌ Failed to save role to Supabase on navigation away:",l)}}},[r?.id,i?.id,d]);const mi=async()=>{if(r?.id)try{console.log("🟣 Loading completed cues from Supabase for event:",r.id);const l=await be.getCompletedCues(r.id);if(l&&l.length>0){console.log("🟣 Found completed cues:",l);const g={};l.forEach(v=>{if(v.item_id){if(ke&&v.item_id===ke){console.log("🟣 Skipping currently loaded cue from completed cues:",v.item_id);return}g[v.item_id]=!0}}),br(g),console.log("🟣 Set completedCues state:",g)}else console.log("🟣 No completed cues found")}catch(l){console.error("❌ Error loading completed cues from Supabase:",l),console.log("💡 This means the completed_cues table or functions need to be created first"),console.log("📋 Please run the create-completed-cues-table.sql script in your Supabase SQL Editor")}};_.useCallback(()=>r?.id?(console.log("🔄 Starting countdown sync for Browser B"),setInterval(async()=>{try{const g=await be.getActiveTimer(r.id);g&&g.timer_state==="running"&&g.started_at&&g.elapsed_seconds!==void 0&&g.duration_seconds!==void 0&&Tt(v=>({...v,[g.item_id]:{elapsed:g.elapsed_seconds,total:g.duration_seconds,startedAt:new Date(g.started_at)}}))}catch(g){console.warn("⚠️ Failed to sync countdown from server:",g)}},1e3)):void 0,[r?.id]),_.useEffect(()=>{if(!r?.id||!i?.id)return;console.log("🔄 Starting countdown sync for Browser B");const l=setInterval(async()=>{try{const g=await be.getActiveTimer(r.id);if(g){if(g.user_id===i.id){console.log("⏭️ Skipping countdown sync - timer started by current user");return}if(console.log("🔄 Browser B: Syncing timer from server:",{itemId:g.item_id,state:g.timer_state,elapsed:g.elapsed_seconds,total:g.duration_seconds,startedAt:g.started_at,userId:g.user_id,currentUserId:i.id}),Tt(v=>{const w=v[g.item_id];return g.timer_state==="running"&&g.started_at?{...v,[g.item_id]:{elapsed:g.elapsed_seconds,total:g.duration_seconds,startedAt:new Date(g.started_at)}}:{...v,[g.item_id]:{elapsed:0,total:g.duration_seconds,startedAt:null}}}),g.timer_state==="running"&&g.started_at){const v=new Date(g.started_at),w=g.duration_seconds;console.log(`🔄 Browser B: Starting drift detection for timer ${g.item_id} with duration ${w}s`),rn.startMonitoring(g.item_id,v,w,E=>{console.log(`🔄 Browser B DriftDetector: Syncing timer ${g.item_id} with server elapsed: ${E}s`),io(T=>{const D=new Set([...T,g.item_id]);return console.log(`🔄 Browser B DriftDetector: Marking timer ${g.item_id} as server-synced. Server-synced timers:`,Array.from(D)),D}),Tt(T=>{const D={...T,[g.item_id]:{...T[g.item_id],elapsed:E}};return console.log(`🔄 Browser B DriftDetector: Updated timer ${g.item_id} progress to elapsed: ${E}s`),D})})}}else console.log("🔄 No active timer, clearing timer progress"),Tt({})}catch(g){console.warn("⚠️ Failed to sync countdown from server:",g)}},1e3);return()=>{console.log("🔄 Cleaning up countdown sync"),clearInterval(l)}},[r?.id,i?.id]);const po=async()=>{if(r?.id){console.log("🟠 Polling for sub-cue timer...");try{const{data:l}=await be.hasActiveSubCueTimer(r.id);if(!l){console.log("🟠 No active sub-cue timer found, clearing local state"),Object.keys(Ke).forEach(w=>{Ke[parseInt(w)]&&clearInterval(Ke[parseInt(w)])}),ur({}),Ot({}),wr(null);return}const{data:g,error:v}=await be.getActiveSubCueTimer(r.id);if(console.log("🟠 Sub-cue timer data from Supabase:",g),v){console.error("❌ Error loading sub-cue timer:",v);return}if(g&&g.is_active&&g.is_running){if(console.log("🟠 Sub-cue timer loaded:",g.item_id,"Duration:",g.duration_seconds,"s","Active:",g.is_active,"Running:",g.is_running),i&&g.user_id===i.id){console.log("⏭️ Skipping sub-cue sync - change made by current user");return}hi(!0),Object.keys(Ke).forEach(Q=>{Ke[parseInt(Q)]&&clearInterval(Ke[parseInt(Q)])});const w=parseInt(g.item_id),E=new Date(g.started_at),D=Math.floor((new Date().getTime()-E.getTime())/1e3)+2;Ot(Q=>({...Q,[w]:{elapsed:Math.max(0,D),total:g.duration_seconds,startedAt:E}})),console.log("🟠 Browser B: Not starting local timer, will update via 2-second sync"),console.log("🟠 Set sub-cue timer state");const G=Math.max(0,g.duration_seconds-D);console.log("🟠 Browser B timing debug:",{startedAt:E.toISOString(),elapsed:D,duration:g.duration_seconds,remaining:G,fix:"Browser B uses database elapsed time, no local timer"}),wr({itemId:w,remaining:G,duration:g.duration_seconds,isActive:!0,startedAt:E,timerState:"running"}),console.log("🟠 Set secondaryTimer state for top UI"),setTimeout(()=>{hi(!1)},100)}else g&&(!g.is_active||!g.is_running)?(console.log("🟠 Sub-cue timer found but not active or not running, clearing local state"),Object.keys(Ke).forEach(w=>{Ke[parseInt(w)]&&clearInterval(Ke[parseInt(w)])}),ur({}),Ot({}),wr(null)):(console.log("🟠 No sub-cue timer found, clearing local state"),Object.keys(Ke).forEach(w=>{Ke[parseInt(w)]&&clearInterval(Ke[parseInt(w)])}),ur({}),Ot({}),wr(null))}catch(l){console.error("❌ Error loading sub-cue timer:",l),Object.keys(Ke).forEach(g=>{Ke[parseInt(g)]&&clearInterval(Ke[parseInt(g)])}),ur({}),Ot({})}}},zl=async()=>{if(r?.id)try{const{data:l,error:g}=await be.getActiveSubCueTimers(r.id);if(g){console.error("❌ Error loading sub-cue timers:",g);return}l&&l.length>0&&(console.log("🔄 Loaded sub-cue timers from Supabase:",l),console.log("🔄 Setting up sub-cue timer states..."),l.forEach(v=>{const w=v.item_id,E=v.duration_seconds||0;if(console.log(`🔄 Setting up sub-cue timer for item ${w}:`,{elapsed:v.elapsed_seconds||0,total:E,startedAt:v.started_at?new Date(v.started_at):null,timer_state:v.timer_state}),Ot(T=>({...T,[w]:{elapsed:v.elapsed_seconds||0,total:E,startedAt:v.started_at?new Date(v.started_at):null}})),v.timer_state==="running"){console.log(`🔄 Starting local timer interval for sub-cue item ${w}`);const T=setInterval(()=>{Ot(D=>{if(D[w]&&D[w].startedAt){const G=D[w].startedAt,Q=G instanceof Date?G.getTime():new Date(G).getTime(),de=Math.floor((Date.now()-Q)/1e3);return{...D,[w]:{...D[w],elapsed:de}}}return D})},100);ur(D=>(console.log(`🔄 Setting sub-cue timer state for item ${w}`),{...D,[w]:T}))}else console.log(`🔄 Sub-cue timer for item ${w} is not running, state: ${v.timer_state}`)}))}catch(l){console.error("❌ Error loading sub-cue timers:",l)}},Wl=async()=>{if(r?.id){console.log("🧪 Testing database connection...");try{const{data:l,error:g}=await be.getLastLoadedCue(r.id);g?(console.error("❌ Database test failed:",g),console.log("💡 This means the SQL migration needs to be run first"),console.log("📋 Please run the migrate-timer-states.sql script in your Supabase SQL Editor")):(console.log("✅ Database connection test passed"),console.log("📊 Test data received:",l))}catch(l){console.error("❌ Database connection test error:",l)}}},ga=async()=>{if(!r?.id){console.log("⚠️ No event ID for checking running timers");return}console.log("🔄 Checking for running timers for event:",r.id);try{console.log("🔄 Using fallback timer detection..."),ma({cueName:"Timer Detected",remainingTime:"Check Console"}),fa(!0),console.log("✅ Fallback timer popup shown")}catch(l){console.error("❌ Error checking running timers:",l)}},Hl=async()=>{if(console.log("🔄 Master sync: Getting active timer from database..."),!r?.id){console.warn("⚠️ No event selected for sync");return}try{const l=await be.getActiveTimer(r.id);if(!l){console.log("ℹ️ No active timer found in database");return}console.log("🔄 Found active timer in database:",l);const g=new Date,v=Math.floor(g.getTime()/1e3),w=new Date(l.started_at),E=Math.floor(w.getTime()/1e3),T=l.duration_seconds||0,D=l.is_running;if(console.log("📊 Timer calculation:",{currentTime:v,startTimeSeconds:E,durationSeconds:T,isRunning:D,currentTimeFormatted:g.toISOString(),startTimeFormatted:w.toISOString()}),Or(l.item_id),D){const G=v-E,Q=T-G;if(console.log("🔄 Time calculation for running timer:",{elapsedSeconds:G,remainingSeconds:Q,isOverdue:Q<0}),Tt(de=>({...de,[l.item_id]:{elapsed:G,total:T,startedAt:w}})),Q!==0){Q>0?console.log(`✅ Timer synced: ${Q} seconds remaining - starting countdown`):console.log(`⚠️ Timer synced: ${Math.abs(Q)} seconds overdue - starting count up`),Oe[l.item_id]&&clearInterval(zt[l.item_id]);const de=setInterval(()=>{Tt(ye=>{const ie=ye[l.item_id];if(!ie)return ye;const ge=ie.elapsed+1,Te=ie.total-ge;return Te>0?console.log(`🔄 Timer countdown: ${Te} seconds remaining`):console.log(Te===0?"⏰ Timer just expired":`🔄 Timer count up: ${Math.abs(Te)} seconds overdue`),{...ye,[l.item_id]:{...ie,elapsed:ge}}})},1e3);xr(ye=>({...ye,[l.item_id]:de}))}else console.log("⏰ Timer just expired")}else console.log("⏸️ Timer is loaded but not running - setting duration only"),Tt(G=>({...G,[l.item_id]:{elapsed:0,total:T,startedAt:null}})),console.log(`✅ Timer synced: Set loaded duration to ${T} seconds`)}catch(l){console.error("❌ Error during master sync:",l)}},vo=async()=>{if(!(!r?.id||!i?.id))try{console.log("🔄 Backing up schedule data..."),await be.saveRunOfShowData({event_id:r.id,event_name:r.name,event_date:r.date,schedule_items:C,custom_columns:ue,settings:{}}),console.log("✅ Schedule data backed up")}catch(l){console.error("❌ Error backing up schedule data:",l)}},pa=async()=>{if(!r?.id){console.log("⚠️ No event ID for loading master change log");return}try{console.log("🔄 Loading master change log for event:",r.id);const l=await pt.getMasterChangeLog(r.id,100);B(l),console.log("📊 Loaded master change log:",l.length,"changes"),l.length===0&&console.log("ℹ️ No master changes found - this might be normal for new events")}catch(l){console.error("❌ Error loading master change log:",l),B([])}},va=async()=>{if(!r?.id||!i){console.log("❌ Cannot sync - missing event ID or user");return}if(!Pr){console.log("👁️ Skipping sync - page not visible");return}if(Cn||ls||ds||fs||co){console.log("🚫 Skipping sync - modal is open");return}if($n){console.log("✏️ Skipping sync - user is actively editing");return}try{console.log("🔄 Syncing schedule data to database...");const l={event_id:r.id,event_name:r.name,event_date:r.date,schedule_items:C,custom_columns:ue,settings:{eventName:fe,masterStartTime:pe,dayStartTimes:ee}};await be.saveRunOfShowData(l,{userId:i.id,userName:i.user_metadata?.full_name||i.email||"Unknown User",userRole:d||"VIEWER"})?(console.log("✅ Schedule data synced to database successfully"),pa()):console.log("❌ Failed to sync schedule data to database")}catch(l){console.error("❌ Error syncing schedule data to database:",l)}},ql=async()=>{if(prompt("Enter password to clear all change logs:")!=="1615"){alert("Incorrect password. Change logs not cleared.");return}if(confirm(`⚠️ WARNING: This will permanently delete ALL change logs (local and master) for this event. This action cannot be undone.

Are you sure you want to continue?`))try{if(pt.clearLocalChanges(),L([]),console.log("✅ Local changes cleared"),r?.id){console.log("🔄 Attempting to clear master change log for event:",r.id);const{data:{user:v},error:w}=await oe.auth.getUser();if(console.log("🔄 Current user:",v?.id,v?.email),w){console.error("❌ Auth error:",w),alert("❌ Authentication error. Please refresh and try again.");return}const E=await pt.clearMasterChangeLog(r.id);if(E.success){B([]),console.log("✅ Master change log cleared successfully"),console.log("🔄 Verifying master change log is cleared...");const T=await pt.getMasterChangeLog(r.id);console.log("🔄 Master change log after clearing:",T.length,"records"),B(T),T.length===0?alert(`✅ All change logs cleared successfully!

- Local changes: ✅ Cleared
- Master changes: ✅ Cleared (${E.deletedCount} records deleted)`):alert(`⚠️ Partial success:

- Local changes: ✅ Cleared
- Master changes: ⚠️ ${E.deletedCount} deleted, but ${T.length} remain

Some records may be protected by RLS policies.`)}else console.log("❌ Failed to clear master change log:",E.error),alert(`⚠️ Partial success:

- Local changes: ✅ Cleared
- Master changes: ❌ Failed

Error: ${E.error}

This might be due to database permissions. Check the console for details.`)}else alert("❌ Error: No event ID found. Cannot clear master change log.")}catch(v){console.error("Error clearing change logs:",v),alert("❌ Error clearing change logs. Check the console for details.")}};_.useEffect(()=>{if(!un||Object.keys(Oe).length===0){hr(!1);return}const l=parseInt(Object.keys(Oe)[0]),g=C.find(v=>v.id===l);if(g)try{const v=new Date,w=C.findIndex(T=>T.id===g.id),E=gn(w);if(E){const[T,D]=E.split(" "),[G,Q]=T.split(":").map(Number);let de=G;D==="PM"&&G!==12&&(de+=12),D==="AM"&&G===12&&(de=0);const ye=new Date,ie=new Date(ye.getFullYear(),ye.getMonth(),ye.getDate(),de,Q),ge=v.getTime()-ie.getTime(),Te=Math.round(ge/(1e3*60));fo(Math.abs(Te)),Te<-1?(dn("early"),hr(!0)):Te>1?(dn("late"),hr(!0)):(dn("on-time"),hr(!0)),setTimeout(()=>{hr(!1)},2e4)}}catch(v){console.error("Error calculating time status:",v),hr(!1)}},[Oe,C,un]);const gi=()=>{if(!Pt)return;const l=document.querySelector(`[data-item-id="${ke}"]`);if(l){const g=l.getBoundingClientRect(),v=window.pageYOffset||document.documentElement.scrollTop,w=g.top+v,E=document.querySelector("#main-scroll-container .h-24");let T=100;E&&(T=E.getBoundingClientRect().height+20);const G=w-T-230;window.scrollTo({top:Math.max(0,G),behavior:"smooth"}),localStorage.setItem(`scrollPosition_${r?.id}`,G.toString())}},[qe,ft]=_.useState({cue:"",day:1,programType:"PreShow/End",shotType:"",segmentName:"",durationHours:0,durationMinutes:0,durationSeconds:0,notes:"",assets:"",speakers:"",speakersText:"",hasPPT:!1,hasQA:!1,timerId:"",isPublic:!1,isIndented:!1,customFields:{}});_.useEffect(()=>{ft(l=>({...l,day:$}))},[$]);const pi=["PreShow/End","Podium Transition","Panel Transition","Sub Cue","No Transition","Video","Panel+Remote","Remote Only","Break","TBD","KILLED"],yo={"PreShow/End":"#8B5CF6","Podium Transition":"#8B4513","Panel Transition":"#404040","Sub Cue":"#F3F4F6","No Transition":"#059669",Video:"#F59E0B","Panel+Remote":"#1E40AF","Remote Only":"#60A5FA",Break:"#EC4899",TBD:"#6B7280",KILLED:"#DC2626"},$t=(l,g,v,w,E)=>{let T=6.5;if(l&&l.trim()!==""){const D=document.createElement("div");D.style.position="absolute",D.style.visibility="hidden",D.style.width="22rem",D.style.padding="0.75rem",D.style.fontSize="1rem",D.style.lineHeight="1.5",D.style.fontFamily="system-ui, -apple-system, sans-serif",D.style.whiteSpace="pre-wrap",D.style.wordWrap="break-word",D.innerHTML=l,document.body.appendChild(D);const G=D.scrollHeight;document.body.removeChild(D);const ye=G/16+3;T=Math.max(T,ye)}if(v&&v.trim()!=="")try{const D=JSON.parse(v);if(Array.isArray(D)&&D.length>0){const G=D.filter(Q=>Q.fullName&&Q.fullName.trim()!=="");if(G.length>0){const ye=4+G.length*1.5;T=Math.max(T,ye)}}}catch{if(v.includes(`
`)){const Q=4+v.split(`
`).filter(de=>de.trim()!=="").length*1.5;T=Math.max(T,Q)}}if(g&&g.trim()!=="")try{const D=JSON.parse(g);if(Array.isArray(D)&&D.length>0){const G=D.filter(Q=>Q.fullName&&Q.fullName.trim()!=="");if(G.length>0){const ye=4+G.length*1.5;T=Math.max(T,ye)}}}catch{if(g.includes(`
`)){const Q=4+g.split(`
`).filter(de=>de.trim()!=="").length*1.5;T=Math.max(T,Q)}}return w&&E&&E.length>0&&E.forEach(D=>{const G=w[D.name];if(G&&G.trim()!==""){const Q=G.split(`
`),Te=3+Math.max(2,Q.length)*1.6+1;T=Math.max(T,Te)}}),`${T}rem`},vi=l=>{if(!l||l.trim()==="")return"4.5rem";const g=document.createElement("div");g.style.position="absolute",g.style.visibility="hidden",g.style.width="20rem",g.style.padding="0.5rem",g.style.fontSize="1rem",g.style.lineHeight="1.4",g.style.fontFamily="system-ui, -apple-system, sans-serif",g.style.whiteSpace="pre-wrap",g.style.wordWrap="break-word",g.innerHTML=l,document.body.appendChild(g);const v=g.scrollHeight;document.body.removeChild(g);const w=v/16,E=2.5,T=4.5,D=w+E;return`${Math.max(T,D)}rem`},yi=l=>{if(!l||l.trim()==="")return"3.5rem";let g=1;try{const T=JSON.parse(l);if(Array.isArray(T)){const D=T.filter(G=>G.fullName&&G.fullName.trim()!=="");g=Math.max(1,D.length)}}catch{g=Math.max(1,l.split(`
`).filter(D=>D.trim()!=="").length)}const E=3+(g-1)*1.5;return`${Math.max(3.5,E)}rem`},Je=(l,g)=>{const v=document.getElementById("notes-editor");if(v){v.focus();try{switch(l){case"bold":document.execCommand("bold",!1);break;case"italic":document.execCommand("italic",!1);break;case"underline":document.execCommand("underline",!1);break;case"color":g&&document.execCommand("foreColor",!1,g);break;case"highlight":g&&g!=="none"?document.execCommand("backColor",!1,g):document.execCommand("removeFormat",!1);break;case"fontSize":g&&document.execCommand("fontSize",!1,g);break;case"bullet":document.execCommand("insertUnorderedList",!1);break;case"list":document.execCommand("insertOrderedList",!1);break;case"left":document.execCommand("justifyLeft",!1);break;case"center":document.execCommand("justifyCenter",!1);break;case"right":document.execCommand("justifyRight",!1);break;case"undo":document.execCommand("undo",!1);break;case"redo":document.execCommand("redo",!1);break}}catch{console.warn("Formatting command not supported:",l)}}},xi=()=>{const l=document.getElementById("notes-editor");if(l&&Jt!==null){const g=l.innerHTML;if(Jt===-1)ft(v=>({...v,notes:g}));else{const v=C.find(E=>E.id===Jt)?.notes||"",w=C.find(E=>E.id===Jt);re(E=>E.map(T=>T.id===Jt?{...T,notes:g}:T)),w&&P("FIELD_UPDATE",`Updated notes for "${w.segmentName}"`,{changeType:"FIELD_CHANGE",itemId:w.id,itemName:w.segmentName,fieldName:"notes",oldValue:v,newValue:g,details:{fieldType:"text",characterChange:g.length-v.length}})}cs(!1),us(null),ht()}},Kl=()=>{if(Et!==null){const l=JSON.stringify(Nt);if(Et===-1)ft(g=>({...g,speakersText:l}));else{const g=C.find(w=>w.id===Et)?.speakersText||"",v=C.find(w=>w.id===Et);re(w=>w.map(E=>E.id===Et?{...E,speakersText:l}:E)),v&&P("FIELD_UPDATE",`Updated speakers for "${v.segmentName}"`,{changeType:"FIELD_CHANGE",itemId:v.id,itemName:v.segmentName,fieldName:"speakers",oldValue:g,newValue:l,details:{fieldType:"speakers",speakerCount:Nt.length,characterChange:l.length-g.length}})}Rr(!1),ln(null),ht()}},Gl=()=>{if(Qt!==null){const l=document.getElementById("assets-list");if(l){const g=l.querySelectorAll(".asset-item"),v=[];g.forEach(E=>{const T=E.querySelector(".asset-name"),D=E.querySelector(".asset-link");if(T&&D){const G=T.value.trim(),Q=D.value.trim();G&&v.push(Q?`${G}|${Q}`:G)}});const w=v.join("||");if(Qt===-1)ft(E=>({...E,assets:w}));else{const E=C.find(D=>D.id===Qt)?.assets||"",T=C.find(D=>D.id===Qt);re(D=>D.map(G=>G.id===Qt?{...G,assets:w}:G)),T&&P("FIELD_UPDATE",`Updated assets for "${T.segmentName}"`,{changeType:"FIELD_CHANGE",itemId:T.id,itemName:T.segmentName,fieldName:"assets",oldValue:E,newValue:w,details:{fieldType:"assets",assetCount:v.length,characterChange:w.length-E.length}})}hs(!1),cn(null),ht()}}},bi=()=>{const l=document.getElementById("assets-list");if(l){const g=document.createElement("div");g.className="asset-item p-3 bg-slate-700 rounded-lg space-y-3",g.innerHTML=`
        <div class="flex gap-3 items-center">
          <input type="text" class="asset-name flex-1 px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500" placeholder="Asset name..." />
          <button type="button" class="toggle-link px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded transition-colors text-sm">
            + Link
          </button>
          <button type="button" class="remove-asset px-3 py-2 bg-red-600 hover:bg-red-500 text-white rounded transition-colors">Remove</button>
        </div>
        <div class="asset-link-container hidden">
          <input type="url" class="asset-link w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500" placeholder="Enter asset URL..." />
        </div>
      `;const v=g.querySelector(".toggle-link"),w=g.querySelector(".asset-link-container"),E=g.querySelector(".asset-link");v?.addEventListener("click",()=>{w?.classList.contains("hidden")?(w.classList.remove("hidden"),v.textContent="− Link",v.classList.remove("bg-blue-600","hover:bg-blue-500"),v.classList.add("bg-slate-600","hover:bg-slate-500"),E?.focus()):(w?.classList.add("hidden"),v.textContent="+ Link",v.classList.remove("bg-slate-600","hover:bg-slate-500"),v.classList.add("bg-blue-600","hover:bg-blue-500"),E&&(E.value=""))}),g.querySelector(".remove-asset")?.addEventListener("click",()=>{g.remove()}),l.appendChild(g)}},wi=()=>{if(jt.length>=7)return;const l=jt.map(w=>w.slot),g=[1,2,3,4,5,6,7].find(w=>!l.includes(w))||1,v={id:`speaker_${Date.now()}`,slot:g,location:"Podium",fullName:"",title:"",org:"",photoLink:""};Yt(w=>[...w,v].sort((E,T)=>E.slot-T.slot))},Jl=l=>{Yt(g=>g.filter(v=>v.id!==l))},Fn=(l,g,v)=>{Yt(w=>w.map(E=>E.id===l?{...E,[g]:v}:E).sort((E,T)=>E.slot-T.slot))},Ql=()=>{if(qr!==null){const l=JSON.stringify(jt);qr===-1?ft(g=>({...g,speakers:l})):re(g=>g.map(v=>v.id===qr?{...v,speakers:l}:v)),ms(!1),In(null)}},ya=()=>{if(Nt.length>=7)return;const l=Nt.map(w=>w.slot),g=[1,2,3,4,5,6,7].find(w=>!l.includes(w))||1,v={id:Date.now().toString(),fullName:"",location:"Podium",slot:g,title:"",org:"",photoLink:""};yr(w=>[...w,v])},Os=l=>{yr(g=>g.filter(v=>v.id!==l))},fn=(l,g,v)=>{yr(w=>w.map(E=>E.id===l?{...E,[g]:v}:E))},Si=(l,g)=>{if(Nt.some(w=>w.id!==l&&w.slot===g)){const w=Nt.find(E=>E.id!==l&&E.slot===g);if(w){const E=Nt.find(T=>T.id===l);E&&fn(w.id,"slot",E.slot)}}fn(l,"slot",g)},_i=(l,g)=>{const v=jt.find(E=>E.id===l);if(!v)return;const w=jt.find(E=>E.id!==l&&E.slot===g);if(w){const E=jt.map(T=>T.id===l?{...T,slot:g}:T.id===w.id?{...T,slot:v.slot}:T);Yt(E)}else Fn(l,"slot",g)},xa=l=>{if(!l)return"Click to add participants...";try{const g=JSON.parse(l);return!Array.isArray(g)||g.length===0?"Click to add participants...":g.sort((v,w)=>v.slot-w.slot).map(v=>`${v.location==="Podium"?"P":v.location==="Seat"?"S":"V"}${v.slot} - ${v.fullName||"Unnamed"}`).join(`
`)}catch{return"Click to add participants..."}},xo=l=>{if(!l)return"Click to add speakers...";try{const g=JSON.parse(l);return!Array.isArray(g)||g.length===0?"Click to add speakers...":g.sort((v,w)=>v.slot-w.slot).filter(v=>v.fullName&&v.fullName.trim()!=="").map(v=>`${v.location==="Podium"?"P":v.location==="Seat"?"S":"V"}${v.slot} - ${v.fullName||"Unnamed"}`).join(`
`)}catch{return"Click to add speakers..."}},ba=["Podium","2-Shot","3-Shot","4-Shot","5-Shot","6-Shot","7-Shot","Ted-Talk"],Vn=l=>{if(isNaN(l)||l===void 0||l===null)return console.warn("⚠️ formatTime received invalid value:",l),"00:00:00";const g=l<0,v=Math.abs(l),w=Math.floor(v/3600),E=Math.floor(v%3600/60),T=Math.floor(v%60);return`${g?"-":""}${w.toString().padStart(2,"0")}:${E.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}`},Yl=l=>{if(isNaN(l)||l===void 0||l===null)return console.warn("⚠️ formatSubCueTime received invalid value:",l),"00:00";const g=l<0,v=Math.abs(l),w=Math.floor(v/3600),E=Math.floor(v%3600/60),T=Math.floor(v%60),D=g?"-":"";return w===0?`${D}${E.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}`:`${D}${w.toString().padStart(2,"0")}:${E.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}`},Is=l=>{const g=C.find(w=>w.id===l);if(!g||!g.isIndented)return!1;const v=C.findIndex(w=>w.id===l);if(v===-1)return!1;for(let w=v-1;w>=0;w--){const E=C[w];if(!E.isIndented)return Oe[E.id]!==void 0}return!1},Xl=()=>{const l=Object.keys(Oe);if(l.length>0){const v=parseInt(l[0]);if(Ye[v]){const w=Ye[v];return w.total-w.elapsed}}const g=Object.keys(Ke);if(g.length>0){const v=parseInt(g[0]);if(Xt[v]){const w=Xt[v];return w.total-w.elapsed}}if(ke&&Ye[ke]){const v=Ye[ke];return v.total-v.elapsed}return 0},ki=()=>{const l=Object.keys(Oe);if(l.length>0){const v=parseInt(l[0]);if(Ye[v]){const w=Ye[v],E=w.total-w.elapsed;return E<0?0:w.total>0?E/w.total*100:0}}const g=Object.keys(Ke);if(g.length>0){const v=parseInt(g[0]);if(Xt[v]){const w=Xt[v],E=w.total-w.elapsed;return w.total>0?E/w.total*100:0}}if(ke&&Ye[ke]){const v=Ye[ke],w=v.total-v.elapsed;return v.total>0?w/v.total*100:0}return 0},Ei=()=>{const l=Object.keys(Oe);if(l.length>0){const v=parseInt(l[0]);if(Ye[v]){const w=Ye[v],E=w.total-w.elapsed;return E<0?"bg-red-500":E>120?"#10b981":E>30?"#f59e0b":"#ef4444"}}const g=Object.keys(Ke);if(g.length>0){const v=parseInt(g[0]);if(Xt[v]){const w=Xt[v],E=w.total-w.elapsed;return E>120?"#10b981":E>30?"#f59e0b":"#ef4444"}}if(ke&&Ye[ke]){const v=Ye[ke],w=v.total-v.elapsed;return w>120?"#10b981":w>30?"#f59e0b":"#ef4444"}return"transparent"},Ps=()=>{const l=Object.keys(Oe);if(l.length>0){const g=parseInt(l[0]);if(Ye[g]){const v=Ye[g],w=v.total-v.elapsed;return w>120?"#10b981":w>30?"#f59e0b":"#ef4444"}}if(ke&&Ye[ke]){const g=Ye[ke],v=g.total-g.elapsed;return v>120?"#10b981":v>30?"#f59e0b":"#ef4444"}return"#ffffff"},Yr=async l=>{if(!ke||!i||!r?.id)return;const g=C.find(D=>D.id===ke);if(!g)return;const v=Math.max(0,g.durationHours*3600+g.durationMinutes*60+g.durationSeconds+l),w=Math.floor(v/3600),E=Math.floor(v%3600/60),T=v%60;re(D=>D.map(G=>G.id===ke?{...G,durationHours:w,durationMinutes:E,durationSeconds:T}:G)),Ye[ke]&&(console.log("🔄 Updating timer duration for item:",ke,"new duration:",v),Tt(D=>({...D,[ke]:{...D[ke],total:v}})),Oe[ke]?(console.log("✅ Timer duration updated locally for running timer"),await be.updateTimerDuration(r.id,ke,v)?console.log("✅ Timer duration updated on server - Browser B will see the change"):console.warn("⚠️ Failed to update timer duration on server"),await vo(),console.log("✅ Time adjustment completed locally and on server")):console.log("✅ Timer duration updated locally for loaded timer"))},Ni=async l=>{if(console.log("🚀🚀🚀 loadCue function STARTED with itemId:",l),console.log("🚀🚀🚀 loadCue function STARTED with itemId:",l),console.log("🚀🚀🚀 loadCue function STARTED with itemId:",l),!i||!r?.id){console.log("❌ Missing user or event ID:",{user:!!i,eventId:r?.id});return}Object.keys(Oe).forEach(async T=>{if(Oe[parseInt(T)]){clearInterval(zt[parseInt(T)]),br(G=>({...G,[parseInt(T)]:!0}));const D=C.find(G=>G.id===parseInt(T));console.log("🟣 About to mark cue as completed:",{eventId:r.id,itemId:parseInt(T),userId:i.id,cueId:D?.customFields?.cue||"CUE"});try{const G=await be.markCueCompleted(r.id,parseInt(T),D?.customFields?.cue||"CUE",i.id,i.user_metadata?.full_name||i.email||"Unknown User",d||"VIEWER");console.log("🟣 Mark completed result:",G)}catch(G){console.error("❌ Error marking cue as completed:",G)}}}),cr({}),console.log("🔄 Stopping all timers in Supabase for event:",r.id,"user:",i.id);const g=await be.stopAllTimersForEvent(r.id,i.id);if(console.log("🔄 Stop all timers result:",g),ke&&ke!==l){Dt(G=>new Set([...G,ke])),br(G=>({...G,[ke]:!0}));const T=C.find(G=>G.id===ke);console.log("🟣 About to mark active cue as completed:",{eventId:r.id,itemId:ke,userId:i.id,cueId:T?.customFields?.cue||"CUE"});try{const G=await be.markCueCompleted(r.id,ke,T?.customFields?.cue||"CUE",i.id,i.user_metadata?.full_name||i.email||"Unknown User",d||"VIEWER");console.log("🟣 Mark active completed result:",G)}catch(G){console.error("❌ Error marking active cue as completed:",G)}const D=C.findIndex(G=>G.id===ke);if(D!==-1)for(let G=D+1;G<C.length&&C[G].isIndented;G++)br(Q=>({...Q,[C[G].id]:!0})),Dt(Q=>new Set([...Q,C[G].id])),await be.markCueCompleted(r.id,C[G].id,C[G].customFields?.cue||"CUE",i.id,i.user_metadata?.full_name||i.email||"Unknown User",d||"VIEWER")}br(T=>{const D={...T};delete D[l];const G=C.findIndex(Q=>Q.id===l);if(G!==-1)for(let Q=G+1;Q<C.length&&C[Q].isIndented;Q++)delete D[C[Q].id];return D}),Dt(T=>{const D=new Set(T);D.delete(l);const G=C.findIndex(Q=>Q.id===l);if(G!==-1)for(let Q=G+1;Q<C.length&&C[Q].isIndented;Q++)D.delete(C[Q].id);return D});const v=C.find(T=>T.id===l);if(v){console.log("🔄 Item found:",v),console.log("🔄 Item ID type:",typeof v.id,"Value:",v.id),console.log("🔄 Item duration values:",{durationHours:v.durationHours,durationMinutes:v.durationMinutes,durationSeconds:v.durationSeconds});const T=v.durationHours*3600+v.durationMinutes*60+v.durationSeconds;console.log("🔄 Calculated total seconds:",T);const D=typeof l=="string"?parseInt(l):l;console.log("🔄 Numeric item ID:",D),console.log("⚡ Optimistic UI update - showing loaded state immediately"),Tt(ie=>({...ie,[l]:{elapsed:0,total:T,startedAt:null}})),Or(l),Gr(ie=>({...ie,[l]:!0}));const Q=C.findIndex(ie=>ie.id===l)+1,de=Lt(v.customFields.cue),ye=v.timerId;console.log("🔄 Loading CUE in Supabase:",{eventId:r.id,itemId:D,userId:i.id,totalSeconds:T,rowNumber:Q,cueDisplay:de,timerId:ye}),console.log("🔄 About to call DatabaseService.loadCue..."),console.log("🔄 DatabaseService object:",typeof be),console.log("🔄 DatabaseService.loadCue function:",typeof be.loadCue),console.log("🔄 Testing Supabase configuration...");try{const{isSupabaseConfigured:ie}=await ea(async()=>{const{isSupabaseConfigured:ge}=await Promise.resolve().then(()=>Lv);return{isSupabaseConfigured:ge}},void 0);console.log("🔄 Supabase configured:",ie)}catch(ie){console.error("❌ Error importing Supabase config:",ie)}try{console.log("🔄 Calling DatabaseService.loadCue now...");const ie=await be.loadCue(r.id,D,i.id,T,Q,de,ye);console.log("🔄 Load CUE result:",ie),ie?console.log("✅ Load CUE succeeded!"):console.error("❌ Load CUE failed - check database connection and functions")}catch(ie){console.error("❌ Load CUE error:",ie),console.error("❌ Error stack:",ie.stack)}console.log("🔄 Finished loadCue database call"),An(D);try{await be.updateLastLoadedCue(r.id,D,"loaded"),console.log("✅ Last loaded CUE saved")}catch(ie){console.log("⚠️ Could not save last loaded CUE (migration may not be run):",ie)}await vo(),console.log("✅ Load CUE action completed locally")}const w=C.findIndex(T=>T.id===l),E=new Set;if(w!==-1)for(let T=w+1;T<C.length&&C[T].isIndented;T++)E.add(C[T].id);Ht(E)},Ds=async()=>{if(Object.keys(Oe).forEach(l=>{Oe[parseInt(l)]&&clearInterval(zt[parseInt(l)])}),Object.keys(Ke).forEach(l=>{Ke[parseInt(l)]&&clearInterval(Ke[parseInt(l)])}),r?.id)try{await be.clearCompletedCues(r.id),console.log("✅ Cleared completed cues from database"),await be.clearAllActiveTimersForEvent(r.id),console.log("✅ Cleared all active timers from Supabase")}catch(l){console.warn("⚠️ Failed to clear database:",l)}cr({}),ur({}),Tt({}),Ot({}),br({}),Or(null),Dt(new Set),Ht(new Set)},Zl=()=>{Ir(!1),Be&&!Be.closed&&Be.close();const l=Object.keys(Oe),g=l.length>0?C.find(E=>Oe[E.id]):C.find(E=>E.id===ke),v={isRunning:l.length>0,elapsedTime:g&&Ye[g.id]?Ye[g.id].elapsed:0,totalDuration:g?g.durationHours*3600+g.durationMinutes*60+g.durationSeconds:0,eventId:r?.id,mainTimer:g?{cue:g.customFields.cue||"CUE",segmentName:g.segmentName||""}:null,secondaryTimer:st?{itemId:st.itemId,remaining:st.remaining,duration:st.duration,cue:C.find(E=>E.id===st.itemId)?.customFields.cue||"CUE",segmentName:C.find(E=>E.id===st.itemId)?.segmentName||""}:null},w=window.open("/fullscreen-timer","fullScreenTimer","width=1920,height=1080,fullscreen=yes,menubar=no,toolbar=no,location=no,status=no,scrollbars=no,resizable=yes");w&&(Ul(w),w.addEventListener("load",()=>{w.postMessage({type:"TIMER_UPDATE",...v},"*")}))};_.useEffect(()=>{const l=()=>{ao(null),Kr(null),Ir(!1)};return document.addEventListener("click",l),()=>document.removeEventListener("click",l)},[]),_.useEffect(()=>{if(ls&&Jt!==null){const l=document.getElementById("notes-editor");if(l)if(Jt===-1)l.innerHTML=qe.notes||"";else{const g=C.find(v=>v.id===Jt);l.innerHTML=g?.notes||""}}},[ls,Jt,C,qe.notes]),_.useEffect(()=>{if(Cn&&Et!==null)if(Et===-1)if(qe.speakersText)try{const l=JSON.parse(qe.speakersText);yr(Array.isArray(l)?l:[])}catch{yr([])}else yr([]);else{const l=C.find(g=>g.id===Et);if(l?.speakersText)try{const g=JSON.parse(l.speakersText);yr(Array.isArray(g)?g:[])}catch{yr([])}else yr([])}},[Cn,Et,C,qe.speakersText]),_.useEffect(()=>{if(ds&&Qt!==null){const l=document.getElementById("assets-list");if(l){l.innerHTML="";let g="";Qt===-1?g=qe.assets||"":g=C.find(w=>w.id===Qt)?.assets||"",g&&g.split("||").forEach(w=>{if(w.trim()){const[E,T]=w.split("|"),D=T&&T.trim()!=="",G=document.createElement("div");G.className="asset-item p-3 bg-slate-700 rounded-lg space-y-3",G.innerHTML=`
                <div class="flex gap-3 items-center">
                  <input type="text" class="asset-name flex-1 px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500" placeholder="Asset name..." value="${E||""}" />
                  <button type="button" class="toggle-link px-3 py-2 text-white rounded transition-colors text-sm ${D?"bg-slate-600 hover:bg-slate-500":"bg-blue-600 hover:bg-blue-500"}">
                    ${D?"− Link":"+ Link"}
                  </button>
                  <button type="button" class="remove-asset px-3 py-2 bg-red-600 hover:bg-red-500 text-white rounded transition-colors">Remove</button>
                </div>
                <div class="asset-link-container ${D?"":"hidden"}">
                  <input type="url" class="asset-link w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500" placeholder="Enter asset URL..." value="${T||""}" />
                </div>
              `;const Q=G.querySelector(".toggle-link"),de=G.querySelector(".asset-link-container"),ye=G.querySelector(".asset-link");Q?.addEventListener("click",()=>{de?.classList.contains("hidden")?(de.classList.remove("hidden"),Q.textContent="− Link",Q.classList.remove("bg-blue-600","hover:bg-blue-500"),Q.classList.add("bg-slate-600","hover:bg-slate-500"),ye?.focus()):(de?.classList.add("hidden"),Q.textContent="+ Link",Q.classList.remove("bg-slate-600","hover:bg-slate-500"),Q.classList.add("bg-blue-600","hover:bg-blue-500"),ye&&(ye.value=""))}),G.querySelector(".remove-asset")?.addEventListener("click",()=>{G.remove()}),l.appendChild(G)}}),l.children.length===0&&bi()}}},[ds,Qt,C,qe.assets]),_.useEffect(()=>{if(fs&&qr!==null)if(qr===-1)if(qe.speakers)try{const l=JSON.parse(qe.speakers);Yt(Array.isArray(l)?l:[])}catch{Yt([])}else Yt([]);else{const l=C.find(g=>g.id===qr);if(l?.speakers)try{const g=JSON.parse(l.speakers);Yt(Array.isArray(g)?g:[])}catch{Yt([])}else Yt([])}},[fs,qr,C,qe.speakers]);const fr=Cl.useCallback(wa(async()=>{if(r?.id)try{const l={event_id:r.id,event_name:r.name,event_date:r.date,schedule_items:C,custom_columns:ue,settings:{eventName:fe,masterStartTime:pe,dayStartTimes:ee,lastSaved:new Date().toISOString()}};console.log("🔄 Auto-saving to Supabase:",{eventId:r.id,scheduleItemsCount:C.length,customColumnsCount:ue.length,eventName:fe,masterStartTime:pe,sampleScheduleItem:C[0]?{id:C[0].id,segmentName:C[0].segmentName,speakersText:C[0].speakersText?"Has speakers data":"No speakers data",speakers:C[0].speakers?"Has speakers data":"No speakers data"}:"No schedule items"});const g=await be.saveRunOfShowData(l,{userId:i?.id||"unknown",userName:i?.user_metadata?.full_name||i?.email||"Unknown User",userRole:d||"VIEWER"});console.log("✅ Auto-saved to Supabase successfully")}catch(l){console.error("❌ Error auto-saving to Supabase:",l)}},1e3),[r?.id,r?.name,r?.date,C,ue,fe,pe,ee]);function wa(l,g){let v;return((...w)=>{clearTimeout(v),v=setTimeout(()=>l(...w),g)})}const Sa=_.useCallback(async()=>{if(r?.id)try{console.log("🔄 Loading from Supabase for event:",r.id);const l=be.getRunOfShowData(r.id),g=new Promise((w,E)=>setTimeout(()=>E(new Error("Database query timeout after 10 seconds")),1e4)),v=await Promise.race([l,g]);if(console.log("🔍 Debug - Raw data from Supabase:",v),console.log("🔍 Debug - schedule_items:",v?.schedule_items),console.log("🔍 Debug - custom_columns:",v?.custom_columns),console.log("🔍 Debug - settings:",v?.settings),v)console.log("📥 Data loaded from Supabase:",{scheduleItemsCount:v.schedule_items?.length||0,customColumnsCount:v.custom_columns?.length||0,eventName:v.settings?.eventName,masterStartTime:v.settings?.masterStartTime,sampleScheduleItem:v.schedule_items?.[0]?{id:v.schedule_items[0].id,segmentName:v.schedule_items[0].segmentName,speakersText:v.schedule_items[0].speakersText?"Has speakers data":"No speakers data",speakers:v.schedule_items[0].speakers?"Has speakers data":"No speakers data"}:"No schedule items"}),re(v.schedule_items||[]),Ee(v.custom_columns||[]),v.settings?.eventName&&me(v.settings.eventName),v.settings?.masterStartTime&&$e(v.settings.masterStartTime),v.settings?.dayStartTimes&&X(v.settings.dayStartTimes),U(v.updated_at||null),he(!1),Pe({show:!1}),console.log("✅ Run of Show data loaded from Supabase successfully");else{console.log("ℹ️ No data found in Supabase, falling back to localStorage for event:",r.id);const w=localStorage.getItem(`runOfShowSchedule_${r.id}`),E=localStorage.getItem(`customColumns_${r.id}`),T=localStorage.getItem(`eventName_${r.id}`),D=localStorage.getItem(`masterStartTime_${r.id}`),G=localStorage.getItem(`dayStartTimes_${r.id}`);if(w)try{const Q=JSON.parse(w);console.log("🔍 Parsed schedule from localStorage:",Q);const de=Q.map(ye=>({...ye,day:ye.day||1}));re(de),console.log("📥 Loaded schedule from localStorage:",de.length,"items"),console.log("🔍 First few items:",de.slice(0,3))}catch(Q){console.error("❌ Error parsing schedule from localStorage:",Q),console.log("🔍 Raw localStorage data:",w)}else console.log("❌ No schedule found in localStorage for event:",r.id);E&&(Ee(JSON.parse(E)),console.log("📥 Loaded custom columns from localStorage")),T&&(me(T),console.log("📥 Loaded event name from localStorage")),D&&($e(D),console.log("📥 Loaded master start time from localStorage")),G&&(X(JSON.parse(G)),console.log("📥 Loaded day start times from localStorage"))}}catch(l){console.error("❌ Error loading run of show data from Supabase:",l),console.error("❌ Error details:",{message:l.message,stack:l.stack,eventId:r?.id}),console.log("🔄 Falling back to localStorage due to error");const g=localStorage.getItem(`runOfShowSchedule_${r.id}`);if(g)try{const w=JSON.parse(g).map(E=>({...E,day:E.day||1}));re(w),console.log("📥 Loaded schedule from localStorage after error:",w.length,"items"),console.log("🔍 First few items after error:",w.slice(0,3))}catch(v){console.error("❌ Error parsing schedule from localStorage after error:",v),console.log("🔍 Raw localStorage data after error:",g)}else console.log("❌ No schedule found in localStorage after error for event:",r.id)}},[r?.id]),_a=_.useCallback(async()=>{if(r?.id)try{console.log("🔄 Loading changes dynamically for event:",r.id);const l=await be.loadChangesDynamically(r.id);l&&(console.log("📥 Dynamic changes loaded:",{scheduleItemsCount:l.schedule_items?.length||0,customColumnsCount:l.custom_columns?.length||0,lastModifiedBy:l.last_modified_by_name}),re(l.schedule_items||[]),Ee(l.custom_columns||[]),l.settings?.eventName&&me(l.settings.eventName),l.settings?.masterStartTime&&$e(l.settings.masterStartTime),l.settings?.dayStartTimes&&X(l.settings.dayStartTimes),U(l.updated_at||null),he(!1),Pe({show:!1}),console.log("✅ Changes loaded dynamically - timers preserved"))}catch(l){console.error("❌ Error loading changes dynamically:",l)}},[r?.id]);_.useEffect(()=>{console.log("🔄 useEffect triggered for event ID:",r?.id),r?.id?(console.log("🔄 Calling loadFromSupabase for event:",r.id),Sa()):console.log("❌ No event ID available for loading data")},[r?.id]),_.useEffect(()=>{console.log("📊 Schedule state changed:",{scheduleLength:C.length,firstItem:C[0]?{id:C[0].id,segmentName:C[0].segmentName,programType:C[0].programType}:"No items",eventId:r?.id})},[C,r?.id]);const bo=async()=>{if(!r?.id){console.log("❌ No event ID available for loading backups");return}try{if(console.log("🔄 Loading backups for event:",r.id),console.log("🔄 Event details:",{id:r.id,name:r.name}),!await Xs.testBackupTable())throw new Error("Backup table is not accessible");const g=await Xs.getBackupsForEvent(r.id);console.log("📊 Raw backup data received:",g),bs(g),console.log("🔄 Loading backup stats...");const v=await Xs.getBackupStats(r.id);console.log("📊 Backup stats:",v),Dn(v),console.log(`✅ Loaded ${g.length} backups successfully`)}catch(l){console.error("❌ Error loading backups:",l),console.error("❌ Error details:",{message:l.message,stack:l.stack,eventId:r?.id}),bs([]),Dn({totalBackups:0,lastBackup:null,autoBackups:0,manualBackups:0})}},ji=async()=>{if(r?.id)try{console.log("🔄 Creating manual backup for event:",r.id);const l=new Date().toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}),g=`${r.name} • ${l}`;await Xs.createBackup(r.id,C,ue,r,"manual",g),console.log("✅ Manual backup created:",g);const v=await Xs.getBackupStats(r.id);Dn(v),alert(`✅ Manual backup created successfully!

Backup: ${g}
Schedule Items: ${C.length}
Custom Columns: ${ue.length}`)}catch(l){console.error("❌ Error creating manual backup:",l),alert(`❌ Error creating manual backup: ${l.message}`)}},ec=l=>{ca(l),ho(!0)},tc=async()=>{if(!(!r?.id||!Wt))try{console.log("🔄 Restoring from backup:",Wt.id);const l=await Xs.restoreFromBackup(Wt.id);re(l.scheduleData),Ee(l.customColumnsData),localStorage.setItem(`runOfShowSchedule_${r.id}`,JSON.stringify(l.scheduleData)),localStorage.setItem(`customColumns_${r.id}`,JSON.stringify(l.customColumnsData)),await be.saveRunOfShowData({event_id:r.id,schedule_items:l.scheduleData,custom_columns:l.customColumnsData}),console.log("✅ Restored from backup:",l.backupName),ho(!1),la(!1),ca(null),alert(`✅ Data restored from backup!

Backup: ${l.backupName}
Date: ${new Date(l.backupTimestamp).toLocaleString()}

Schedule Items: ${l.scheduleData.length}
Custom Columns: ${l.customColumnsData.length}`)}catch(l){console.error("❌ Error restoring from backup:",l),alert(`❌ Error restoring from backup: ${l.message}`)}},rc=async l=>{if(confirm("Are you sure you want to delete this backup?"))try{console.log("🔄 Deleting backup:",l),await Xs.deleteBackup(l),console.log("✅ Backup deleted successfully"),alert("Backup deleted successfully"),await bo()}catch(g){console.error("❌ Error deleting backup:",g),alert(`Error deleting backup: ${g.message}`)}};_.useEffect(()=>{if(!r?.id){console.log("❌ No event ID, skipping change detection");return}console.log("🔄 Starting change detection for event:",r.id),xt();const l=async()=>{try{if(Bl){console.log("⏭️ Skipping sync check - user just made a change"),fi(!1),xt();return}if($n){console.log("✏️ Skipping sync check - user is actively editing");return}console.log("🔄 Running change check...");const v=await be.checkForChanges(r.id,k??void 0);v.hasChanges?(console.log("🔄 Changes detected:",v),he(!0),Pe({show:!0,lastModifiedBy:v.lastModifiedBy,lastModifiedByName:v.lastModifiedByName}),Pr?(console.log("🔄 Loading changes automatically..."),await _a()):console.log("👁️ Changes detected but page not visible - will load when page becomes visible")):console.log("✅ No changes detected")}catch(v){console.error("❌ Error checking for changes:",v)}};l();const g=setInterval(l,2e4);return()=>{clearInterval(g),hn()}},[r?.id,k,Pr,hn]),_.useEffect(()=>{Pr&&ae&&(console.log("👁️ Page became visible with pending changes - loading changes..."),_a())},[Pr,ae]),_.useEffect(()=>{co&&r?.id&&bo()},[co,r?.id]),_.useEffect(()=>{const l=()=>{const g=!document.hidden;console.log(`🔄 Page visibility changed: ${g?"visible":"hidden"}`),ws(g),g?(console.log("🔄 Page became visible, checking for changes..."),nc()):(da(new Date),console.log("🔄 Page became hidden, recording last sync time"))};return document.addEventListener("visibilitychange",l),()=>document.removeEventListener("visibilitychange",l)},[]);const nc=async()=>{if(!r?.id||!ua){console.log("🔄 No event ID or last sync time, skipping change check");return}try{console.log("🔄 Checking for changes since last sync...");const l=await be.getRunOfShowData(r.id);if(l){const g=new Date(l.last_change_at||new Date);console.log("🔄 Latest change time:",g),console.log("🔄 Last sync time:",ua),g>ua?(console.log("🔄 Changes detected since last sync, updating local data..."),re(l.schedule_items||[]),Ee(l.custom_columns||[]),localStorage.setItem(`runOfShowSchedule_${r.id}`,JSON.stringify(l.schedule_items||[])),localStorage.setItem(`customColumns_${r.id}`,JSON.stringify(l.custom_columns||[])),console.log("✅ Local data updated with latest changes")):console.log("✅ No changes detected since last sync")}}catch(l){console.error("❌ Error checking for changes on return:",l)}};_.useEffect(()=>{r?.id&&(localStorage.setItem(`runOfShowSchedule_${r.id}`,JSON.stringify(C)),window.dispatchEvent(new CustomEvent("scheduleUpdated",{detail:{eventId:r.id,schedule:C}})),console.log("📝 Schedule saved and event dispatched for event:",r.id),fr())},[C,r?.id,fr]),_.useEffect(()=>{if(!r?.id)return;const l=()=>{console.log("🔄 Updating graphics data for live JSON files..."),localStorage.setItem(`runOfShowSchedule_${r.id}`,JSON.stringify(C)),localStorage.setItem(`customColumns_${r.id}`,JSON.stringify(ue)),localStorage.setItem(`eventName_${r.id}`,fe),localStorage.setItem(`masterStartTime_${r.id}`,pe),localStorage.setItem(`dayStartTimes_${r.id}`,JSON.stringify(ee)),window.dispatchEvent(new CustomEvent("scheduleUpdated",{detail:{eventId:r.id,schedule:C}}))};l();const g=setInterval(l,1e4);return()=>clearInterval(g)},[r?.id,C,ue,fe,pe,ee]),_.useEffect(()=>{r?.id&&(localStorage.setItem(`customColumns_${r.id}`,JSON.stringify(ue)),fr())},[ue,r?.id,fr]),_.useEffect(()=>{r?.id&&(localStorage.setItem(`eventName_${r.id}`,fe),fr())},[fe,r?.id,fr]),_.useEffect(()=>{r?.id&&(localStorage.setItem(`masterStartTime_${r.id}`,pe),fr())},[pe,r?.id,fr]),_.useEffect(()=>{r?.id&&(localStorage.setItem(`dayStartTimes_${r.id}`,JSON.stringify(ee)),fr())},[ee,r?.id,fr]),_.useEffect(()=>{if(Be&&!Be.closed){const l=Object.keys(Oe),g=l.length>0?C.find(w=>Oe[w.id]):C.find(w=>w.id===ke),v={type:"TIMER_UPDATE",isRunning:l.length>0,elapsedTime:g&&Ye[g.id]?Ye[g.id].elapsed:0,totalDuration:g&&Ye[g.id]?Ye[g.id].total:g?g.durationHours*3600+g.durationMinutes*60+g.durationSeconds:0,eventId:r?.id,itemId:g?.id,mainTimer:g?{cue:g.customFields.cue||"CUE",segmentName:g.segmentName||""}:null,secondaryTimer:st?{itemId:st.itemId,remaining:st.remaining,duration:st.duration,cue:C.find(w=>w.id===st.itemId)?.customFields.cue||"CUE",segmentName:C.find(w=>w.id===st.itemId)?.segmentName||""}:null};Be.postMessage(v,"*")}},[Oe,Ye,ke,C,pe,fe,Be,st]);const sc=l=>{const g=()=>{const E="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let T="";for(let D=0;D<5;D++)T+=E.charAt(Math.floor(Math.random()*E.length));return T},v={...l,id:Date.now(),timerId:g(),isIndented:l.isIndented||!1,customFields:{cue:l.cue?`CUE${l.cue}`:"CUE"}};an!==null?(re(E=>{const T=[...E];return T.splice(an+1,0,v),T}),ra(null)):re(E=>[...E,v]);const w=an!==null?an+2:C.length+1;P("ADD_ITEM",`Added new schedule item: "${v.segmentName}"`,{changeType:"ADD",itemId:v.id,itemName:v.segmentName,rowNumber:w,cueNumber:v.customFields.cue?parseInt(v.customFields.cue,10):null,details:{day:v.day,programType:v.programType,shotType:v.shotType,position:`Row ${w}`,durationHours:v.durationHours,durationMinutes:v.durationMinutes,totalDurationMinutes:v.durationHours*60+v.durationMinutes,speakers:v.speakers||"None",speakersText:v.speakersText||"None",notes:v.notes||"",assets:v.assets||"None",hasPPT:v.hasPPT,hasQA:v.hasQA,timerId:v.timerId,isPublic:v.isPublic,isIndented:v.isIndented}}),Ae(!1),ht(),ft({cue:"",day:$,programType:"PreShow/End",shotType:"",segmentName:"",durationHours:0,durationMinutes:0,durationSeconds:0,notes:"",assets:"",speakers:"",speakersText:"",hasPPT:!1,hasQA:!1,timerId:"",isPublic:!1,isIndented:!1,customFields:{}})},er=l=>{const g={name:l,id:Date.now().toString()};Ee(v=>[...v,g]),re(v=>v.map(w=>({...w,customFields:{...w.customFields,[l]:""}}))),P("COLUMN_ADD",`Added custom column "${l}"`,{changeType:"COLUMN_ADD",columnName:l,details:{columnType:"text",affectedItems:C.length,defaultValue:""}}),is(!1),ht()},Ls=l=>{const g=ue.find(v=>v.id===l);g&&(Ee(v=>v.filter(w=>w.id!==l)),re(v=>v.map(w=>{const{[g.name]:E,...T}=w.customFields;return{...w,customFields:T}})),P("COLUMN_REMOVE",`Removed custom column "${g.name}"`,{changeType:"COLUMN_REMOVE",columnName:g.name,details:{affectedItems:C.length,columnId:g.id}}))},tt=(l,g)=>{l.preventDefault(),l.stopPropagation();const v=l.clientX,w=Ue[g]||256;document.body.style.cursor="col-resize",document.body.style.userSelect="none";const E=D=>{const G=D.clientX-v,Q=Math.max(100,w+G);ui(de=>({...de,[g]:Q}))},T=()=>{document.body.style.cursor="",document.body.style.userSelect="",document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",T)};document.addEventListener("mousemove",E),document.addEventListener("mouseup",T)},ka=(l,g)=>{l.preventDefault(),l.stopPropagation();const v=l.clientX,w=ks[g]||256;document.body.style.cursor="col-resize",document.body.style.userSelect="none";const E=D=>{const G=D.clientX-v,Q=Math.max(100,w+G);ha(de=>({...de,[g]:Q}))},T=()=>{document.body.style.cursor="",document.body.style.userSelect="",document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",T)};document.addEventListener("mousemove",E),document.addEventListener("mouseup",T)},Bn=async l=>{if(!(!i||!r?.id))if(Oe[l]){clearInterval(zt[l]);const g=`${l}_drift`;Oe[g]&&clearInterval(zt[g]),cr(w=>{const E={...w};return delete E[l],delete E[g],E}),xr(w=>{const E={...w};return delete E[l],delete E[g],E}),rn.stopMonitoring(l),io(w=>{const E=new Set(w);return E.delete(l),E}),br(w=>({...w,[l]:!0})),Dt(w=>new Set([...w,l]));try{const w=C.find(E=>E.id===l);await be.markCueCompleted(r.id,l,w?.customFields?.cue||"CUE",i.id,i.user_metadata?.full_name||i.email||"Unknown User",d||"VIEWER")}catch(w){console.warn("⚠️ Failed to mark cue as completed in database:",w),console.log("💡 This means the completed_cues table needs to be created first")}const v=C.findIndex(w=>w.id===l);if(v!==-1)for(let w=v+1;w<C.length&&C[w].isIndented;w++)br(E=>({...E,[C[w].id]:!0})),Dt(E=>new Set([...E,C[w].id])),await be.markCueCompleted(r.id,C[w].id,C[w].customFields?.cue||"CUE",i.id,i.user_metadata?.full_name||i.email||"Unknown User",d||"VIEWER");Gr(w=>{const E={...w};return delete E[l],E}),ke===l&&Or(null),Tt(w=>{const E={...w};return delete E[l],E}),console.log("🔄 Stopping timer in Supabase for item:",l),await be.stopTimer(r.id,l,i.id),console.log("✅ Timer stopped in Supabase");try{await be.updateLastLoadedCue(r.id,l,"stopped"),console.log("✅ Last loaded CUE saved as stopped")}catch(w){console.log("⚠️ Could not save last loaded CUE as stopped (migration may not be run):",w)}await vo()}else{if(Object.keys(Oe).length>0)return;const g=C.find(v=>v.id===l);if(g){const v=g.durationHours*3600+g.durationMinutes*60+g.durationSeconds;console.log("⚡ Optimistic UI update - showing running state immediately");const w=new Date;Tt(ie=>({...ie,[l]:{elapsed:0,total:v,startedAt:w}}));const E=setInterval(()=>{Tt(ie=>{if(ie[l]){if(ii.has(l)&&Oe[l]&&ie[l]?.startedAt)return console.log(`🔄 Timer ${l}: Skipping local update - using server-synced time (Browser A)`),ie;const ge=Date.now(),Te=ie[l].startedAt;let Ge;Te instanceof Date?Ge=Te.getTime():typeof Te=="string"?Ge=new Date(Te).getTime():(console.warn("⚠️ startedAt is not a Date or string:",Te),Ge=ge);const rt=Math.floor((ge-Ge)/1e3),rr=v-rt;return rn.updateLocalElapsed(l,rt),rt<=10&&console.log(`🕐 Timer ${l}: Elapsed=${rt}s, Remaining=${rr}s, Start=${new Date(Ge).toISOString()}, Now=${new Date(ge).toISOString()}`),{...ie,[l]:{...ie[l],elapsed:rt}}}return ie})},100);xr(ie=>({...ie,[l]:E})),cr(ie=>({...ie,[l]:!0})),console.log(`🔄 Starting drift detection for timer ${l} with duration ${v}s`),console.log("🔄 Drift detector config:",rn.getConfig()),rn.startMonitoring(l,w,v,ie=>{console.log(`🔄 DriftDetector: Syncing timer ${l} with server elapsed: ${ie}s`),io(ge=>{const Te=new Set([...ge,l]);return console.log(`🔄 DriftDetector: Marking timer ${l} as server-synced. Server-synced timers:`,Array.from(Te)),Te}),Tt(ge=>{const Te={...ge,[l]:{...ge[l],elapsed:ie}};return console.log(`🔄 DriftDetector: Updated timer ${l} progress to elapsed: ${ie}s`),Te})});const T=rn.getStatus();console.log("🔄 Drift detector status after starting:",T),console.log(`🔄 Timer ${l} will run locally until first drift sync`);const G=C.findIndex(ie=>ie.id===l)+1,Q=Lt(g.customFields.cue),de=g.timerId;console.log("🔄 Starting timer in Supabase for item:",l,"at:",w.toISOString(),"row:",G,"cue:",Q,"timerId:",de);try{const ie=await be.startTimer(r.id,l,i.id,v,w,G,Q,de);console.log("✅ Timer started in Supabase:",ie),ie||console.error("❌ Start timer failed - check database connection and functions")}catch(ie){console.error("❌ Start timer error:",ie)}try{await be.updateLastLoadedCue(r.id,l,"running"),console.log("✅ Last loaded CUE saved as running")}catch(ie){console.log("⚠️ Could not save last loaded CUE as running (migration may not be run):",ie)}const ye=setInterval(async()=>{try{console.log(`🔄 DriftDetector: Starting periodic sync for timer ${l}`),await rn.forceSync(l,async()=>{const ge=(await be.getActiveTimer(r.id))?.elapsed_seconds||0;return console.log(`🔄 DriftDetector: Server returned elapsed: ${ge}s for timer ${l}`),ge}),console.log(`🔄 DriftDetector: Periodic sync completed for timer ${l}`)}catch(ie){console.warn(`⚠️ DriftDetector: Failed to sync timer ${l}:`,ie)}},3e4);xr(ie=>({...ie,[`${l}_drift`]:ye})),console.log("✅ Timer started locally with drift detection enabled"),await vo(),Dt(ie=>{const ge=new Set(ie);ge.delete(l);const Te=C.findIndex(Ge=>Ge.id===l);if(Te!==-1)for(let Ge=Te+1;Ge<C.length&&C[Ge].isIndented;Ge++)ge.delete(C[Ge].id);return ge})}}},Ti=async l=>{if(!(!i||!r?.id)){if(console.log("🔄 Reset timer for item:",l),Oe[l]){clearInterval(zt[l]);const g=`${l}_drift`;zt[g]&&clearInterval(zt[g]),cr(v=>{const w={...v};return delete w[l],delete w[g],w}),xr(v=>{const w={...v};return delete w[l],delete w[g],w}),rn.stopMonitoring(l),io(v=>{const w=new Set(v);return w.delete(l),w}),Tt(v=>{const w={...v};return delete w[l],w});try{await be.stopTimer(r.id,l,i.id),console.log("✅ Timer reset in Supabase")}catch(v){console.error("❌ Error resetting timer in database:",v)}}Gr(g=>{const v={...g};return delete v[l],v}),ke===l&&Or(null),console.log("✅ Timer reset completed for item:",l)}},Ea=async l=>{if(!i||!r?.id)return;const g=C.find(v=>v.id===l);if(g&&g.isIndented){const v=g.durationHours*3600+g.durationMinutes*60+g.durationSeconds;console.log("🟠 Starting secondary timer for item:",l,"Duration:",v,"s"),Ot(E=>({...E,[l]:{elapsed:0,total:v,startedAt:new Date}}));const w=setInterval(()=>{Ot(E=>{const T=E[l];if(!T)return E;const D=Math.floor((Date.now()-(T.startedAt?.getTime()||Date.now()))/1e3);return Math.max(0,T.total-D),{...E,[l]:{...T,elapsed:D}}}),wr(E=>{if(!E)return null;if(Es)return E;const T=E.startedAt?.getTime()||Date.now(),D=Math.floor((Date.now()-T)/1e3),G=Math.max(0,E.duration-D);if(G===0){console.log("⏰ Sub-cue timer reached 0 - holding for a beat");const Q=r?.id;console.log("⏰ Current event ID for database call:",Q),setTimeout(()=>{console.log("⏰ Sub-cue timer auto-stopping after hold - clearing local state"),gs&&(clearInterval(gs),Pn(null)),Object.keys(Ke).forEach(de=>{Ke[parseInt(de)]&&clearInterval(Ke[parseInt(de)])}),ur({}),Ot({}),wr(null),setTimeout(async()=>{try{if(Q){console.log("⏰ Clearing sub-cue timer from database after 3s delay with event ID:",Q);const de=await be.stopSubCueTimer(Q);console.log("⏰ Database stop result:",de),console.log("⏰ Sub-cue timer stopped in database (is_active = false)")}else console.error("❌ No event ID available for database call")}catch(de){console.error("❌ Error stopping sub-cue timer in database:",de),console.error("❌ Error details:",de)}},3e3)},1e3)}return{...E,remaining:G}})},1e3);ur(E=>({...E,[l]:w})),wr({itemId:l,remaining:v,duration:v,isActive:!0,startedAt:new Date,timerState:"running"});try{console.log("🟠 User ID:",i.id,"Event ID:",r.id);const E=C.find(Q=>Q.id===l),T=C.findIndex(Q=>Q.id===l)+1,D=E?Lt(E.customFields.cue):`CUE ${l}`,G=E?.timerId||`SUB${l}`;try{console.log("🔄 Starting sub-cue timer for item:",l,"(will auto-stop any existing timers)");const Q=await be.startSubCueTimer(r.id,l,i.id,v,T,D,G);console.log("✅ Secondary timer started in Supabase for item:",l,"Result:",Q),Q?.error&&console.error("❌ Secondary timer database error:",Q.error)}catch(Q){console.error("❌ Secondary timer call failed:",Q)}try{console.log("✅ Sub-cue timer started locally"),console.log("✅ Secondary timer action broadcasted")}catch(Q){console.error("❌ Error broadcasting secondary timer action:",Q)}await po()}catch(E){console.error("❌ Error starting secondary timer:",E),clearInterval(w),ur(T=>{const D={...T};return delete D[l],D}),Ot(T=>{const D={...T};return delete D[l],D})}}},oc=async()=>{if(r?.id){console.log("🛑 Stopping secondary timer..."),wr(null),gs&&(clearInterval(gs),Pn(null)),Object.keys(Ke).forEach(l=>{Ke[parseInt(l)]&&clearInterval(Ke[parseInt(l)])}),ur({}),Ot({}),console.log("✅ Local secondary timer state cleared");try{console.log("🛑 Stopping sub-cue timer in database with event ID:",r.id);const l=await be.stopSubCueTimer(r.id);console.log("🛑 Database stop result:",l),console.log("🛑 Secondary timer stopped in database (is_active = false)");try{console.log("🛑 Broadcasting STOP_SECONDARY_TIMER action..."),console.log("✅ Sub-cue timer stopped locally"),console.log("✅ Secondary timer stop action broadcasted successfully")}catch(g){console.error("❌ Error broadcasting secondary timer stop action:",g)}}catch(l){console.error("❌ Error stopping sub-cue timer in database:",l),console.error("❌ Error details:",l)}try{await po()}catch(l){console.error("❌ Error loading updated timer from Supabase:",l)}}},ac=l=>{if(window.confirm("Delete this schedule item?")){const g=C.find(v=>v.id===l);if(re(v=>v.filter(w=>w.id!==l)),Kr(null),g){const v=C.findIndex(w=>w.id===l)+1;P("REMOVE_ITEM",`Deleted schedule item: "${g.segmentName}"`,{changeType:"DELETE",itemId:g.id,itemName:g.segmentName,rowNumber:v,cueNumber:g.customFields.cue?parseInt(g.customFields.cue,10):null,details:{day:g.day,programType:g.programType,shotType:g.shotType,position:`Row ${v}`,durationHours:g.durationHours,durationMinutes:g.durationMinutes,totalDurationMinutes:g.durationHours*60+g.durationMinutes,speakers:g.speakers||"None",speakersText:g.speakersText||"None",notes:g.notes||"",assets:g.assets||"None",hasPPT:g.hasPPT,hasQA:g.hasQA,timerId:g.timerId,isPublic:g.isPublic,isIndented:g.isIndented}})}}},mn=(l,g)=>{const v=C.findIndex(G=>G.id===l);if(v===-1)return;const w=g==="up"?v-1:v+1;if(w<0||w>=C.length)return;const E=C[v],T=v+1,D=w+1;re(G=>{const Q=[...G];return[Q[v],Q[w]]=[Q[w],Q[v]],Q}),E&&P("MOVE_ITEM",`Moved "${E.segmentName}" from row ${T} to row ${D}`,{changeType:"MOVE",itemId:E.id,itemName:E.segmentName,details:{fromRow:T,toRow:D,direction:g}}),Kr(null)},Na=(l,g)=>{const v=C.findIndex(G=>G.id===l);if(v===-1)return;const w=g-1;if(w<0||w>=C.length||w===v)return;const E=C[v],T=v+1,D=g;re(G=>{const Q=[...G],de=Q[v];return Q.splice(v,1),Q.splice(w,0,de),Q}),E&&P("MOVE_ITEM",`Moved "${E.segmentName}" from row ${T} to row ${D}`,{changeType:"MOVE",itemId:E.id,itemName:E.segmentName,details:{fromRow:T,toRow:D,direction:"specific"}}),Kr(null)},gn=l=>{const g=C[l];if(!g||g.isIndented)return"";const v=g.day||1,w=ee[v]||pe;if(!w)return"";let E=0;for(let ge=0;ge<l;ge++){const Te=C[ge];(Te.day||1)===v&&!Te.isIndented&&(E+=(Te.durationHours||0)*3600+(Te.durationMinutes||0)*60+(Te.durationSeconds||0))}const[T,D]=w.split(":").map(Number),Q=T*3600+D*60+E,de=Math.floor(Q/3600)%24,ye=Math.floor(Q%3600/60),ie=new Date;return ie.setHours(de,ye,0,0),ie.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})},tr=()=>C.filter(l=>(l.day||1)===$);return _.useEffect(()=>{const l=()=>{const g=window.pageYOffset||document.documentElement.scrollTop;ps(g>100)};return window.addEventListener("scroll",l),()=>window.removeEventListener("scroll",l)},[]),_.useEffect(()=>{const l=document.getElementById("main-scroll-container");if(!l)return;let g=!1;const v=(D,G)=>{g||(g=!0,G.scrollLeft=D.scrollLeft,requestAnimationFrame(()=>{g=!1}))},w=()=>{const D=document.querySelector(".sticky-header-scroll-container");D&&v(l,D)},E=()=>{const D=document.querySelector(".sticky-header-scroll-container");D&&v(D,l)};l.addEventListener("scroll",w);const T=new MutationObserver(()=>{const D=document.querySelector(".sticky-header-scroll-container");D&&D.addEventListener("scroll",E)});return T.observe(document.body,{childList:!0,subtree:!0}),()=>{l.removeEventListener("scroll",w),T.disconnect()}},[]),_.useEffect(()=>{ke!==null&&setTimeout(()=>{gi()},100)},[ke,Pt]),_.useEffect(()=>{if(Pt&&Object.keys(Oe).length>0){const l=parseInt(Object.keys(Oe)[0]),g=document.querySelector(`[data-item-id="${l}"]`);g&&setTimeout(()=>{const v=document.querySelector("#main-scroll-container .h-24");let w=100;if(v){const D=v.getBoundingClientRect(),G=document.querySelector("#main-scroll-container")?.getBoundingClientRect();G&&(w=D.bottom-G.top-120)}const E=g.getBoundingClientRect(),T=document.querySelector("#main-scroll-container")?.getBoundingClientRect();if(T){const D=E.top-T.top-w;window.scrollTo({top:D,behavior:"smooth"})}},100)}},[Oe,Pt]),r?o.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-slate-200",children:[!Pr&&o.jsxs("div",{className:"fixed top-4 right-4 z-50 bg-yellow-600 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2",children:[o.jsx("div",{className:"w-2 h-2 bg-yellow-300 rounded-full animate-pulse"}),o.jsx("span",{className:"text-sm font-medium",children:"Tab Hidden - Syncing Paused"})]}),o.jsx(cm,{isOpen:y,onClose:()=>x(!1),onRoleSelected:l=>{if(p(l),r?.id&&i?.id)try{const g=i.user_metadata?.full_name||i.email||"Unknown";be.saveUserSession(r.id,i.id,g,l),console.log("✅ Role saved to Supabase from RunOfShowPage:",l)}catch(g){console.error("❌ Failed to save role to Supabase from RunOfShowPage:",g)}x(!1)},eventId:r?.id||""}),Cs&&Rs&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsx("div",{className:"bg-slate-800 rounded-lg p-6 max-w-md w-full mx-4 border-2 border-orange-500",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-orange-400 text-2xl font-bold mb-4",children:"⏰ Timer Running"}),o.jsx("div",{className:"text-white text-lg mb-2",children:o.jsx("strong",{children:Rs.cueName})}),o.jsxs("div",{className:"text-orange-300 text-xl font-mono mb-6",children:[Rs.remainingTime," remaining"]}),o.jsxs("div",{className:"flex gap-3 justify-center",children:[o.jsx("button",{onClick:()=>fa(!1),className:"px-6 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded transition-colors",children:"Dismiss"}),o.jsx("button",{onClick:()=>{fa(!1),Hl()},className:"px-6 py-2 bg-orange-600 hover:bg-orange-500 text-white rounded transition-colors",children:"Sync Timer"})]})]})})}),S&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-slate-800 rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[80vh] overflow-hidden flex flex-col",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("h2",{className:"text-2xl font-bold text-white",children:"Change Log"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs("button",{onClick:()=>Z(!1),className:`px-3 py-1 rounded text-sm transition-colors ${I?"bg-slate-600 text-slate-300 hover:bg-slate-500":"bg-blue-600 text-white"}`,children:["Local (",R.length,")"]}),o.jsxs("button",{onClick:()=>Z(!0),className:`px-3 py-1 rounded text-sm transition-colors ${I?"bg-blue-600 text-white":"bg-slate-600 text-slate-300 hover:bg-slate-500"}`,children:["Master (",F.length,")"]})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[!I&&o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:va,className:"px-3 py-1 bg-green-600 hover:bg-green-500 text-white text-sm rounded transition-colors",title:"Sync changes to Supabase",children:"🔄 Sync"}),o.jsx("button",{onClick:()=>{pt.reloadLocalChanges();const l=pt.getLocalChanges();L(l.slice(0,100)),console.log("🔄 Manually reloaded local changes:",l.length)},className:"px-3 py-1 bg-blue-600 hover:bg-blue-500 text-white text-sm rounded transition-colors",title:"Reload local changes",children:"🔄 Reload"})]}),I&&o.jsx("button",{onClick:pa,className:"px-3 py-1 bg-blue-600 hover:bg-blue-500 text-white text-sm rounded transition-colors",title:"Reload master change log",children:"🔄 Reload"}),o.jsx("button",{onClick:()=>N(!1),className:"text-gray-400 hover:text-white text-2xl",children:"×"})]})]}),o.jsx("div",{className:"flex-1 overflow-y-auto",children:I?F.length===0?o.jsx("p",{className:"text-gray-400 text-center py-8",children:"No master changes found"}):o.jsx("div",{className:"space-y-3",children:F.map(l=>o.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[o.jsxs("div",{className:"flex justify-between items-start mb-2",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:`text-white text-xs px-2 py-1 rounded ${l.action==="ADD_ITEM"?"bg-green-600":l.action==="REMOVE_ITEM"?"bg-red-600":l.action==="FIELD_UPDATE"?"bg-blue-600":l.action==="MOVE_ITEM"?"bg-yellow-600":l.action==="COLUMN_ADD"?"bg-purple-600":l.action==="COLUMN_REMOVE"?"bg-orange-600":"bg-blue-600"}`,children:l.action}),o.jsxs("span",{className:"text-gray-300 text-sm",children:["by ",l.user_name]}),o.jsxs("span",{className:"text-gray-500 text-xs",children:["(",l.user_role,")"]}),l.row_number&&o.jsxs("span",{className:"text-gray-400 text-xs bg-slate-600 px-2 py-1 rounded",children:["ROW ",l.row_number]}),l.cue_number&&l.cue_number!=="CUE"&&o.jsx("span",{className:"text-gray-400 text-xs bg-slate-600 px-2 py-1 rounded",children:Lt(l.cue_number)})]}),o.jsx("div",{className:"text-gray-400 text-xs",children:new Date(l.timestamp||l.change_timestamp).toLocaleString()})]}),l.details&&o.jsxs("div",{className:"space-y-1 text-sm",children:[l.details.fieldName&&o.jsxs("div",{className:"text-gray-300",children:[o.jsx("strong",{children:"Field:"})," ",l.details.fieldName]}),l.details.oldValue!==void 0&&l.details.newValue!==void 0&&o.jsxs("div",{className:"text-gray-300",children:[o.jsx("strong",{children:"Changed from:"}),o.jsxs("span",{className:"text-red-300 ml-1",children:['"',l.details.oldValue,'"']}),o.jsx("span",{className:"text-slate-400 mx-1",children:"→"}),o.jsxs("span",{className:"text-green-300",children:['"',l.details.newValue,'"']})]}),l.batch_id&&o.jsxs("div",{className:"text-gray-500 text-xs mt-2 pt-2 border-t border-slate-600",children:["Batch: ",l.batch_id.slice(0,8),"... | Synced: ",new Date(l.batch_created_at).toLocaleString()]})]})]},l.id))}):R.length===0&&Y.size===0?o.jsx("p",{className:"text-gray-400 text-center py-8",children:"No local changes recorded yet"}):o.jsxs("div",{className:"space-y-3",children:[R.map(l=>o.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[o.jsxs("div",{className:"flex justify-between items-start mb-2",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:`text-white text-xs px-2 py-1 rounded ${l.action==="ADD_ITEM"?"bg-green-600":l.action==="REMOVE_ITEM"?"bg-red-600":l.action==="FIELD_UPDATE"?"bg-blue-600":l.action==="MOVE_ITEM"?"bg-yellow-600":l.action==="COLUMN_ADD"?"bg-purple-600":l.action==="COLUMN_REMOVE"?"bg-orange-600":l.action==="AUTO_SAVE"?"bg-gray-600":"bg-blue-600"}`,children:l.action}),l.details?.processedBy&&o.jsx("span",{className:`text-white text-xs px-2 py-1 rounded ${l.details.processedBy==="TIMEOUT"?"bg-orange-600":l.details.processedBy==="SAVE_BUTTON"?"bg-purple-600":"bg-gray-600"}`,children:l.details.processedBy}),o.jsxs("span",{className:"text-gray-300 text-sm",children:["by ",l.userName]}),l.details?.itemId&&o.jsxs("span",{className:"text-gray-400 text-xs",children:["Item #",l.details.itemId]})]}),o.jsx("div",{className:"text-gray-400 text-xs",children:l.timestamp.toLocaleString()})]}),l.details&&o.jsxs("div",{className:"space-y-1 text-sm",children:[(l.details?.rowNumber||l.details?.cueNumber)&&o.jsx("div",{className:"text-gray-300",children:o.jsxs("strong",{children:["Row ",l.details?.rowNumber||"?"," | ",l.details?.cueNumber||"CUE"]})}),l.action==="ADD_ITEM"&&l.details.details&&o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"text-gray-300",children:[o.jsx("strong",{children:"Program Type:"})," ",l.details.details.programType]}),o.jsxs("div",{className:"text-gray-300",children:[o.jsx("strong",{children:"Shot Type:"})," ",l.details.details.shotType]}),o.jsxs("div",{className:"text-gray-300",children:[o.jsx("strong",{children:"Duration:"})," ",l.details.details.durationHours,"h ",l.details.details.durationMinutes,"m"]}),o.jsxs("div",{className:"text-gray-300",children:[o.jsx("strong",{children:"Speakers:"})," ",l.details.details.speakers]}),l.details.details.notes&&o.jsxs("div",{className:"text-gray-300",children:[o.jsx("strong",{children:"Notes:"})," ",l.details.details.notes]}),o.jsxs("div",{className:"text-gray-300",children:[o.jsx("strong",{children:"Position:"})," ",l.details.details.position]})]}),l.action==="REMOVE_ITEM"&&l.details.details&&o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"text-gray-300",children:[o.jsx("strong",{children:"Program Type:"})," ",l.details.details.programType]}),o.jsxs("div",{className:"text-gray-300",children:[o.jsx("strong",{children:"Shot Type:"})," ",l.details.details.shotType]}),o.jsxs("div",{className:"text-gray-300",children:[o.jsx("strong",{children:"Duration:"})," ",l.details.details.durationHours,"h ",l.details.details.durationMinutes,"m"]}),o.jsxs("div",{className:"text-gray-300",children:[o.jsx("strong",{children:"Speakers:"})," ",l.details.details.speakers]}),l.details.details.notes&&o.jsxs("div",{className:"text-gray-300",children:[o.jsx("strong",{children:"Notes:"})," ",l.details.details.notes]})]}),l.action!=="ADD_ITEM"&&l.action!=="REMOVE_ITEM"&&l.details.fieldName&&o.jsxs("div",{className:"text-gray-300",children:[o.jsx("strong",{children:"Field:"})," ",l.details.fieldName]}),l.action!=="ADD_ITEM"&&l.action!=="REMOVE_ITEM"&&l.details.fieldName==="speakers"&&l.details.details&&o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"text-gray-300",children:[o.jsx("strong",{children:"Speaker Count:"})," ",l.details.details.speakerCount||0]}),l.details.newValue&&o.jsxs("div",{className:"text-gray-300",children:[o.jsx("strong",{children:"Speakers:"}),o.jsx("div",{className:"mt-1 text-sm text-blue-300",children:(()=>{try{const g=JSON.parse(l.details.newValue);if(Array.isArray(g))return g.sort((v,w)=>v.slot-w.slot).map(v=>`${v.slot}. ${v.fullName||v.name||"Unknown"} (${v.location||"Unknown"})`).join(", ")}catch{return"Unable to parse speakers"}return"No speakers"})()})]})]}),l.action!=="ADD_ITEM"&&l.action!=="REMOVE_ITEM"&&l.details.fieldName==="assets"&&l.details.details&&o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"text-gray-300",children:[o.jsx("strong",{children:"Asset Count:"})," ",l.details.details.assetCount||0]}),l.details.newValue&&o.jsxs("div",{className:"text-gray-300",children:[o.jsx("strong",{children:"Assets:"}),o.jsx("div",{className:"mt-1 text-sm text-blue-300",children:l.details.newValue.split("||").filter(v=>v.trim()).map(v=>{if(v.includes("|")){const[w,E]=v.split("|");return`${w}${E?` (${E})`:""}`}return v}).join(", ")})]})]}),l.action==="MOVE_ITEM"&&l.details.details&&o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"text-gray-300",children:[o.jsx("strong",{children:"Moved from Row:"})," ",l.details.details.fromRow||"Unknown"]}),o.jsxs("div",{className:"text-gray-300",children:[o.jsx("strong",{children:"Moved to Row:"})," ",l.details.details.toRow||"Unknown"]})]}),l.action!=="ADD_ITEM"&&l.action!=="REMOVE_ITEM"&&l.action!=="MOVE_ITEM"&&l.details.fieldName!=="speakers"&&l.details.fieldName!=="assets"&&l.details.oldValue!==void 0&&l.details.newValue!==void 0&&o.jsx("div",{className:"text-gray-300",children:l.details.fieldName==="durationHours"||l.details.fieldName==="durationMinutes"||l.details.fieldName==="durationSeconds"?o.jsx("span",{className:"text-green-300",children:l.details.newValue}):o.jsxs(o.Fragment,{children:[o.jsx("strong",{children:"Changed from:"}),o.jsxs("span",{className:"text-red-300 ml-1",children:['"',l.details.oldValue,'"']}),o.jsx("span",{className:"text-gray-400 mx-1",children:"→"}),o.jsxs("span",{className:"text-green-300",children:['"',l.details.newValue,'"']})]})})]})]},l.id)),Array.from(Y.entries()).map(([l,g])=>{const v=Date.now()-g.timestamp.getTime(),w=Math.max(0,1e4-v),E=Math.ceil(w/1e3);return o.jsxs("div",{className:"bg-slate-600 rounded-lg p-4 border-2 border-yellow-500 animate-pulse",children:[o.jsxs("div",{className:"flex justify-between items-start mb-2",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("span",{className:"bg-yellow-600 text-white text-xs px-2 py-1 rounded",children:["PENDING [",g.originalKey||"NO_KEY","]"]}),o.jsxs("span",{className:"text-slate-300 text-sm",children:["by ",g.user]}),o.jsxs("span",{className:"text-yellow-300 text-xs",children:["⏳ Will confirm in ",E,"s"]})]}),o.jsx("div",{className:"text-slate-400 text-xs",children:g.timestamp.toLocaleString()})]}),g.details&&o.jsxs("div",{className:"space-y-1 text-sm",children:[(g.details?.rowNumber||g.details?.cueNumber)&&o.jsx("div",{className:"text-slate-300",children:o.jsxs("strong",{children:["Row ",g.details?.rowNumber||"?"," | ",g.details?.cueNumber||"CUE"]})}),g.details.fieldName&&o.jsxs("div",{className:"text-slate-300",children:[o.jsx("strong",{children:"Field:"})," ",g.details.fieldName]}),g.details.oldValue!==void 0&&g.details.newValue!==void 0&&o.jsxs("div",{className:"text-slate-300",children:[o.jsx("strong",{children:"Will change from:"}),o.jsxs("span",{className:"text-red-300 ml-1",children:['"',g.details.oldValue,'"']}),o.jsx("span",{className:"text-slate-400 mx-1",children:"→"}),o.jsxs("span",{className:"text-green-300",children:['"',g.details.newValue,'"']})]})]})]},l)})]})}),o.jsx("div",{className:"mt-4 pt-4 border-t border-slate-600",children:o.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-400",children:[o.jsxs("div",{children:[o.jsxs("span",{children:["Total changes: ",R.length," (",Y.size," pending)"]}),Y.size>0&&o.jsx("span",{className:"ml-2 text-yellow-400",children:"• Changes will be confirmed after 10s of inactivity"})]}),o.jsxs("div",{className:"flex gap-2",children:[Y.size>0&&o.jsxs("button",{className:"px-3 py-1 bg-yellow-600 text-white rounded transition-colors animate-pulse cursor-not-allowed",disabled:!0,title:"Changes are pending and will auto-save after 5 seconds",children:["⏳ Changes Pending (",Y.size,")"]}),o.jsx("button",{onClick:ql,className:"px-3 py-1 bg-red-600 hover:bg-red-500 text-white rounded transition-colors",title:"Clear all change logs (password protected)",children:"🗑️ Clear All Logs"})]})]})})]})}),o.jsx("style",{children:`
          select {
            border: 2px solid #64748b !important;
            border-radius: 6px !important;
          }
          select:focus {
            border-color: #3b82f6 !important;
            outline: none !important;
          }
          select option {
            background-color: #1e293b !important;
            color: #ffffff !important;
            border-bottom: 1px solid #475569 !important;
            padding: 8px 12px !important;
            margin: 0 !important;
          }
          select option:hover {
            background-color: #334155 !important;
          }
          select option:checked {
            background-color: #3b82f6 !important;
          }
        `}),o.jsx("div",{className:"fixed top-16 left-0 right-0 z-40 bg-slate-900 shadow-lg border-b border-slate-600",style:{height:oo?"240px":"150px"},children:o.jsxs("div",{className:"py-2 pt-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2 px-8",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("button",{onClick:()=>n("/"),className:"px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white font-semibold rounded-lg transition-colors",children:"← Back to Events"}),o.jsxs("div",{className:"relative",children:[o.jsx("button",{onClick:l=>{l.stopPropagation(),Ir(!li)},className:"px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors",title:"Menu",children:o.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),li&&o.jsx("div",{className:"absolute top-full left-0 mt-1 w-48 bg-slate-800 border border-slate-600 rounded-lg shadow-lg z-50",children:o.jsxs("div",{className:"py-1",children:[o.jsxs("button",{onClick:Zl,className:"w-full px-4 py-2 text-left text-white hover:bg-slate-700 transition-colors flex items-center gap-3",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Full Timer"]}),o.jsxs("button",{onClick:()=>{Ir(!1);const l=`/reports?eventId=${r?.id}&eventName=${encodeURIComponent(r?.name||"")}`;window.open(l,"_blank")},className:"w-full px-4 py-2 text-left text-white hover:bg-slate-700 transition-colors flex items-center gap-3",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Reports and Printing"]}),o.jsxs("button",{onClick:()=>{Ir(!1);const l=`/graphics-links?eventId=${r?.id}&eventName=${encodeURIComponent(r?.name||"")}`;window.open(l,"_blank")},className:"w-full px-4 py-2 text-left text-white hover:bg-slate-700 transition-colors flex items-center gap-3",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),"Graphic Links"]}),o.jsxs("button",{onClick:()=>{Ir(!1),console.log("=== CSV EXPORT ==="),console.log("Event:",r),console.log("Schedule length:",C.length),console.log("Full schedule:",C),console.log("Master start time:",pe);const l=["ROW","CUE","Program Type","Shot Type","Segment Name","Duration","Start Time","End Time","Notes","Assets","Speakers","Has PPT","Has QA","Timer ID","Is Public","Is Indented","Day"],g=ue.map(de=>de.name),v=[...l,...g],E=C.filter(de=>(de.day||1)===$).map((de,ye)=>{const ie=C.findIndex(Mt=>Mt.id===de.id),ge=gn(ie),Te=`${de.durationHours}:${de.durationMinutes.toString().padStart(2,"0")}:${de.durationSeconds.toString().padStart(2,"0")}`,Ge=ge?(()=>{const[Mt,ja,As]=ge.split(":").map(Number),[Ci,Xe,Ta]=Te.split(":").map(Number);let zn=Mt*3600+ja*60+As+(Ci*3600+Xe*60+Ta);const $s=Math.floor(zn/3600),Ri=Math.floor(zn%3600/60),Ca=zn%60;return`${$s.toString().padStart(2,"0")}:${Ri.toString().padStart(2,"0")}:${Ca.toString().padStart(2,"0")}`})():"",rt=[ye+1,de.customFields?.cue||`CUE ${ye+1}`,de.programType||"",de.shotType||"",de.segmentName||"",Te,ge||"",Ge,de.notes||"",de.assets||"",de.speakersText||"",de.hasPPT?"Yes":"No",de.hasQA?"Yes":"No",de.timerId||"",de.isPublic?"Yes":"No",de.isIndented?"Yes":"No",de.day||1],rr=ue.map(Mt=>de.customFields[Mt.id]||"");return[...rt,...rr]}),T=[v.join(","),...E.map(de=>de.map(ye=>typeof ye=="string"&&(ye.includes(",")||ye.includes('"')||ye.includes(`
`))?`"${ye.replace(/"/g,'""')}"`:ye).join(","))].join(`
`);console.log("CSV Content:",T);const D=new Blob([T],{type:"text/csv;charset=utf-8;"}),G=URL.createObjectURL(D),Q=document.createElement("a");Q.href=G,Q.download=`${r?.name||"RunOfShow"}_Day${$}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(Q),Q.click(),document.body.removeChild(Q),URL.revokeObjectURL(G),console.log("=== END CSV EXPORT ===")},className:"w-full px-4 py-2 text-left text-white hover:bg-slate-700 transition-colors flex items-center gap-3",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Export CSV"]}),o.jsxs("button",{onClick:()=>{Ir(!1),la(!0)},className:"w-full px-4 py-2 text-left text-white hover:bg-slate-700 transition-colors flex items-center gap-3",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Backups"]}),o.jsxs("button",{onClick:()=>{Ir(!1);const l=`/green-room?eventId=${r?.id}&eventName=${encodeURIComponent(r?.name||"")}&eventDate=${r?.date||""}&eventLocation=${encodeURIComponent(r?.location||"")}`;window.open(l,"_blank")},className:"w-full px-4 py-2 text-left text-white hover:bg-slate-700 transition-colors flex items-center gap-3",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),"Green Room"]}),o.jsxs("button",{onClick:()=>{Ir(!1),ci(!0)},className:"w-full px-4 py-2 text-left text-white hover:bg-slate-700 transition-colors flex items-center gap-3",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),"OSC Control"]})]})})]})]}),o.jsxs("div",{className:"flex items-center gap-6",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("label",{className:"text-white font-semibold",children:"Event Name:"}),o.jsx("div",{className:"px-4 py-2 bg-slate-700 border-2 border-slate-600 rounded-lg text-white w-64",children:fe||"No Event Name"}),r?.numberOfDays&&r.numberOfDays>1&&o.jsxs(o.Fragment,{children:[o.jsx("label",{className:"text-white font-semibold",children:"Working Day:"}),o.jsx("select",{value:$,onChange:l=>{Qe(),M(parseInt(l.target.value))},className:"px-4 py-2 bg-slate-700 border-2 border-slate-600 rounded-lg text-white focus:border-blue-500 focus:outline-none w-32",children:Array.from({length:r.numberOfDays},(l,g)=>o.jsxs("option",{value:g+1,children:["Day ",g+1]},g+1))})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("label",{className:"text-white font-semibold",children:"Start Time:"}),o.jsx("input",{type:"time",value:r?.numberOfDays&&r.numberOfDays>1?ee[$]||"":pe,onChange:l=>{if(Qe(),d==="VIEWER"||d==="OPERATOR"){alert("Only EDITORs can change start time. Please change your role to EDITOR.");return}r?.numberOfDays&&r.numberOfDays>1?X(g=>({...g,[$]:l.target.value})):$e(l.target.value)},disabled:d==="VIEWER"||d==="OPERATOR",className:"px-4 py-2 border-2 rounded-lg focus:outline-none w-48 transition-colors bg-slate-700 border-slate-600 text-white focus:border-blue-500",style:{colorScheme:"dark"},title:d==="VIEWER"||d==="OPERATOR"?"Only EDITORs can change start time":`Set ${r?.numberOfDays&&r.numberOfDays>1?`Day ${$}`:"master"} start time`})]})]}),o.jsxs("div",{className:"flex items-center gap-6",children:[o.jsx("div",{className:"text-center",children:Object.keys(Oe).length>0?o.jsxs("div",{className:"text-lg text-green-400 font-bold",children:["RUNNING - ",Lt(C.find(l=>Oe[l.id])?.customFields.cue),st&&o.jsxs("div",{className:"text-lg text-orange-400 mt-0.5 font-bold",children:[Lt(C.find(l=>l.id===st.itemId)?.customFields.cue)," - ",Yl(st.remaining)]})]}):ke&&Ye[ke]?o.jsxs("div",{className:"text-lg text-yellow-400 font-bold",children:["LOADED - ",Lt(C.find(l=>l.id===ke)?.customFields.cue)]}):o.jsx("div",{className:"text-lg text-slate-300 font-bold",children:"No CUE Selected"})}),o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"text-3xl font-mono bg-slate-800 px-6 py-3 rounded-lg border border-slate-600",style:{color:Ps()},children:Vn(Xl())}),ke&&o.jsx("div",{className:"absolute bottom-1 right-1",children:o.jsx(um,{itemId:ke,className:"flex-shrink-0"})})]})]})]}),o.jsx("div",{className:"px-8 mb-2",children:o.jsx("div",{className:"w-full h-2 bg-slate-700 rounded-full overflow-hidden border border-slate-600 relative",children:o.jsx("div",{className:"h-full transition-all duration-1000 absolute top-0 right-0",style:{width:`${ki()}%`,background:Ei()}})})}),o.jsx("div",{className:"px-8 pb-2",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsxs("div",{className:"text-sm text-slate-300",children:["Role: ",o.jsx("span",{className:"font-semibold text-white",children:d})]}),o.jsx("button",{onClick:()=>x(!0),className:"px-3 py-1 bg-slate-600 hover:bg-slate-500 text-white text-sm rounded transition-colors",title:"Change your role",children:"Change Role"}),o.jsx("button",{onClick:ji,className:"px-3 py-1 bg-blue-600 hover:bg-blue-500 text-white text-sm rounded transition-colors",title:"Create a manual backup of current data",children:"💾 Create Backup"}),$n&&o.jsxs("div",{className:"flex items-center space-x-2 px-3 py-1 bg-yellow-600 rounded text-sm",children:[o.jsx("div",{className:"w-2 h-2 bg-yellow-200 rounded-full animate-pulse"}),o.jsx("span",{className:"text-yellow-100 font-medium",children:"Editing - Sync Paused"})]}),!$n&&Pr&&o.jsxs("div",{className:"flex items-center space-x-2 px-3 py-1 bg-blue-600 rounded text-sm",children:[o.jsx("div",{className:"w-2 h-2 bg-blue-200 rounded-full animate-pulse"}),o.jsx("span",{className:"text-blue-100 font-medium",children:mo?"Syncing...":`Next sync in ${Qr}s`})]})]}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("button",{onClick:()=>ia(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white text-sm font-medium rounded transition-colors",title:"Open Filter View",children:"Filter View"}),o.jsx("button",{onClick:()=>hr(!un),className:`px-4 py-2 text-white text-sm font-medium rounded transition-colors ${un?"bg-green-600 hover:bg-green-500":"bg-slate-600 hover:bg-slate-500"}`,title:un?"Disable Time Toast":"Enable Time Toast",children:"⏰ Time Toast"}),o.jsx("button",{onClick:()=>Dr(!Pt),className:`px-4 py-2 text-white text-sm font-medium rounded transition-colors ${Pt?"bg-purple-600 hover:bg-purple-500 ring-4 ring-inset ring-green-400":"bg-purple-600 hover:bg-purple-500"}`,title:Pt?"Disable auto-scroll to active row":"Enable auto-scroll to active row",children:"🎯 Follow"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-white text-sm font-medium",children:"Duration:"}),o.jsx("button",{onClick:async()=>{if(d==="VIEWER"||d==="EDITOR"){alert("Only OPERATORs can adjust timer duration. Please change your role to OPERATOR.");return}await Yr(-300)},className:`w-8 h-8 text-white text-sm font-bold rounded transition-colors ${d==="VIEWER"||d==="EDITOR"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-red-700 hover:bg-red-600"}`,disabled:d==="VIEWER"||d==="EDITOR",title:d==="VIEWER"||d==="EDITOR"?"Only OPERATORs can adjust timer duration":"Subtract 5 minutes",children:"-5"}),o.jsx("button",{onClick:async()=>{if(d==="VIEWER"||d==="EDITOR"){alert("Only OPERATORs can adjust timer duration. Please change your role to OPERATOR.");return}await Yr(-60)},className:`w-8 h-8 text-white text-sm font-bold rounded transition-colors ${d==="VIEWER"||d==="EDITOR"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-red-600 hover:bg-red-500"}`,disabled:d==="VIEWER"||d==="EDITOR",title:d==="VIEWER"||d==="EDITOR"?"Only OPERATORs can adjust timer duration":"Subtract 1 minute",children:"-1"}),o.jsx("button",{onClick:async()=>{if(d==="VIEWER"||d==="EDITOR"){alert("Only OPERATORs can adjust timer duration. Please change your role to OPERATOR.");return}await Yr(60)},className:`w-8 h-8 text-white text-sm font-bold rounded transition-colors ${d==="VIEWER"||d==="EDITOR"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-500"}`,disabled:d==="VIEWER"||d==="EDITOR",title:d==="VIEWER"||d==="EDITOR"?"Only OPERATORs can adjust timer duration":"Add 1 minute",children:"+1"}),o.jsx("button",{onClick:async()=>{if(d==="VIEWER"||d==="EDITOR"){alert("Only OPERATORs can adjust timer duration. Please change your role to OPERATOR.");return}await Yr(300)},className:`w-8 h-8 text-white text-sm font-bold rounded transition-colors ${d==="VIEWER"||d==="EDITOR"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-blue-700 hover:bg-blue-600"}`,disabled:d==="VIEWER"||d==="EDITOR",title:d==="VIEWER"||d==="EDITOR"?"Only OPERATORs can adjust timer duration":"Add 5 minutes",children:"+5"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:()=>{if(d==="VIEWER"||d==="EDITOR"){alert("Only OPERATORs can send messages. Please change your role to OPERATOR.");return}vs(!0)},className:`px-4 py-2 text-white text-sm font-medium rounded transition-colors ${d==="VIEWER"||d==="EDITOR"?"bg-gray-500 text-gray-300 cursor-not-allowed":aa?"bg-purple-600 hover:bg-purple-500 ring-4 ring-inset ring-green-500":"bg-purple-600 hover:bg-purple-500"}`,disabled:d==="VIEWER"||d==="EDITOR",title:d==="VIEWER"||d==="EDITOR"?"Only OPERATORs can send messages":"Send Messages to Full Screen Timer",children:"Messages"}),aa&&o.jsx("button",{onClick:async()=>{if(d==="VIEWER"||d==="EDITOR"){alert("Only OPERATORs can control messages. Please change your role to OPERATOR.");return}try{if(r?.id){const g=(await be.getTimerMessagesForEvent(r.id)).find(v=>v.enabled);g&&(await be.disableTimerMessage(g.id),console.log("✅ Message disabled in Supabase via Turn Off button"))}}catch(l){console.error("❌ Error disabling message in Supabase:",l)}ys(!1),lo(""),Be&&!Be.closed&&Be.postMessage({type:"MESSAGE_UPDATE",message:"",enabled:!1},"*")},className:`px-4 py-2 text-white text-sm font-medium rounded transition-colors ${d==="VIEWER"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-slate-600 hover:bg-slate-500 animate-pulse"}`,disabled:d==="VIEWER",title:d==="VIEWER"?"Viewers cannot control messages":"Turn Off Message",children:"Click to Turn Off"})]})]})]})}),o.jsx("div",{className:`px-8 transition-all duration-500 ease-in-out overflow-hidden ${oo?"max-h-80 opacity-100 -mb-6":"max-h-0 opacity-0 mb-0"}`,children:o.jsx("div",{className:"bg-slate-800 rounded-xl p-4 shadow-2xl",style:{transform:"scale(0.75)",transformOrigin:"top center",width:"127.67%",marginLeft:"-13.83%"},children:o.jsxs("div",{className:"flex border-2 border-slate-600 rounded-lg overflow-hidden bg-slate-900",children:[o.jsx("div",{className:"w-12 flex-shrink-0 bg-slate-900 border-r-2 border-slate-600",children:o.jsx("div",{className:"h-16 bg-slate-700 border-b-3 border-slate-600 flex items-center justify-center",children:o.jsx("span",{className:"text-white font-bold text-xs",children:"#"})})}),o.jsx("div",{className:"w-40 flex-shrink-0 bg-slate-900",style:{borderRight:"6px solid #475569"},children:o.jsx("div",{className:"h-16 bg-slate-700 border-b-3 border-slate-600 flex items-center justify-center",children:o.jsxs("span",{className:"text-white font-bold text-lg flex items-center gap-1",children:["CUE",d==="VIEWER"&&o.jsx("span",{className:"text-yellow-400",title:"Viewers cannot edit CUE",children:"🔒"})]})})}),o.jsx("div",{className:"flex-1 overflow-x-auto sticky-header-scroll-container",style:{scrollbarWidth:"thin"},children:o.jsx("div",{className:"min-w-max",children:o.jsxs("div",{className:"h-16 bg-slate-700 border-b-3 border-slate-600 flex",children:[ve.start&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.start},children:[o.jsx("span",{className:"text-white font-bold",children:"Start"}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"start")})]}),ve.programType&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.programType},children:[o.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Program Type",(d==="VIEWER"||d==="OPERATOR")&&o.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"programType")})]}),ve.duration&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.duration},children:[o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"text-white font-bold flex items-center justify-center gap-1",children:["Duration",d==="VIEWER"&&o.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),o.jsx("div",{className:"text-xs text-slate-400",children:"HH MM SS"})]}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"duration")})]}),ve.segmentName&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.segmentName},children:[o.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Segment Name",(d==="VIEWER"||d==="OPERATOR")&&o.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"segmentName")})]}),ve.shotType&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.shotType},children:[o.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Shot Type",(d==="VIEWER"||d==="OPERATOR")&&o.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"shotType")})]}),ve.pptQA&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.pptQA},children:[o.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["PPT/Q&A",(d==="VIEWER"||d==="OPERATOR")&&o.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"pptQA")})]}),ve.notes&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.notes},children:[o.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Notes",(d==="VIEWER"||d==="OPERATOR")&&o.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"notes")})]}),ve.assets&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.assets},children:[o.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Assets",d==="VIEWER"&&o.jsx("span",{className:"text-yellow-400",title:"Read-only for VIEWERs",children:"🔒"})]}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"assets")})]}),ve.participants&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.participants},children:[o.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Participants",(d==="VIEWER"||d==="OPERATOR")&&o.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"participants")})]}),ve.speakers&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.speakers},children:[o.jsx("span",{className:"text-white font-bold",children:"Speakers"}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"speakers")})]}),ve.public&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.public},children:[o.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Public",(d==="VIEWER"||d==="OPERATOR")&&o.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"public")})]}),ue.map(l=>Ss[l.id]!==!1&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center relative flex-shrink-0",style:{width:ks[l.id]||256},children:[o.jsx("span",{className:"text-white font-bold",children:l.name}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:g=>ka(g,l.id)})]},l.id))]})})}),o.jsx("div",{className:"w-32 flex-shrink-0 bg-slate-900",style:{borderLeft:"6px solid #475569"},children:o.jsx("div",{className:"h-16 bg-slate-700 border-b-3 border-slate-600 flex items-center justify-center",children:o.jsxs("span",{className:"text-white font-bold text-base flex items-center gap-1",children:["Timer",(d==="VIEWER"||d==="EDITOR")&&o.jsx("span",{className:"text-yellow-400",title:"Only OPERATORs can control timers",children:"🔒"})]})})})]})})})]})}),o.jsx("div",{className:"max-w-[95%] mx-auto px-6",style:{paddingTop:"250px"},children:o.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 shadow-2xl",style:{transform:"scale(0.75)",transformOrigin:"top center",width:"133.33%",marginLeft:"-16.67%"},children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsxs("div",{children:[o.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Schedule",r?.numberOfDays&&r.numberOfDays>1?` - Day ${$}`:""]}),i&&o.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[o.jsxs("button",{onClick:()=>N(!0),className:"text-xs bg-purple-600 hover:bg-purple-500 text-white px-2 py-1 rounded transition-colors",title:"View change history",children:["📝 Change Log (",R.length+Y.size,")",pt.getChangesCount().unsynced>0&&o.jsxs("span",{className:"ml-1 text-yellow-400",children:["(",pt.getChangesCount().unsynced," unsynced)"]})]}),Ns>0&&o.jsx("button",{onClick:async()=>{await te()},className:"text-xs bg-yellow-600 hover:bg-yellow-500 text-white px-2 py-1 rounded transition-colors animate-pulse",title:`${Ns} unsynced change${Ns!==1?"s":""} - Click to sync`,children:Ns}),Y.size>0&&o.jsxs("button",{className:"text-xs bg-yellow-600 text-white px-2 py-1 rounded transition-colors animate-pulse cursor-not-allowed",title:"Changes are pending and will auto-save after 5 seconds",disabled:!0,children:["⏳ Changes Pending (",Y.size,")"]})]})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:()=>{if(d==="VIEWER"){alert("Viewers cannot add items. Please change your role to EDITOR or OPERATOR.");return}At(),Ae(!0),ft({cue:"",day:$,programType:"PreShow/End",shotType:"",segmentName:"",durationHours:0,durationMinutes:0,durationSeconds:0,notes:"",assets:"",speakers:"",speakersText:"",hasPPT:!1,hasQA:!1,timerId:"",isPublic:!1,isIndented:!1,customFields:{}})},className:`px-4 py-2 font-medium rounded text-sm transition-colors ${d==="VIEWER"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,disabled:d==="VIEWER",title:d==="VIEWER"?"Only EDITORs and OPERATORs can add items":"Add new item",children:"+ Item"}),o.jsx("button",{onClick:()=>{if(d==="VIEWER"){alert("Viewers cannot add columns. Please change your role to EDITOR or OPERATOR.");return}At(),is(!0)},className:`px-4 py-2 font-medium rounded text-sm transition-colors ${d==="VIEWER"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white"}`,disabled:d==="VIEWER",title:d==="VIEWER"?"Viewers cannot add columns":"Add custom column",children:"+ Column"}),o.jsx("button",{onClick:async()=>{if(d==="VIEWER"){alert("Viewers cannot reset the schedule. Please change your role to EDITOR or OPERATOR.");return}await Ds()},className:`px-4 py-2 font-medium rounded text-sm transition-colors ${d==="VIEWER"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-red-600 hover:bg-red-700 text-white"}`,disabled:d==="VIEWER",title:d==="VIEWER"?"Viewers cannot reset the schedule":"Reset all states",children:"Reset"})]})]}),o.jsxs("div",{className:"flex border-2 border-slate-600 rounded-lg overflow-hidden bg-slate-900",children:[o.jsxs("div",{className:"w-12 flex-shrink-0 bg-slate-900 border-r-2 border-slate-600",children:[o.jsx("div",{className:"h-24 bg-slate-700 border-b-3 border-slate-600 flex items-center justify-center",children:o.jsx("span",{className:"text-white font-bold text-xs",children:"#"})}),tr().length===0?o.jsx("div",{className:"h-24 flex items-center justify-center text-slate-500",children:"-"}):tr().map((l,g)=>o.jsx("div",{className:`border-b-2 border-slate-600 flex items-center justify-center gap-1 ${Oe[l.id]?"bg-green-900 border-green-500":ke===l.id?"bg-blue-900 border-blue-500":Ln.has(l.id)?"bg-amber-800 border-amber-600":na[l.id]||Lr.has(l.id)?"bg-gray-900 border-gray-700 opacity-40":g%2===0?"bg-slate-800":"bg-slate-900"}`,style:{height:$t(l.notes,l.speakersText,l.speakers,l.customFields,ue)},children:o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[o.jsx("button",{onClick:()=>{if(d==="VIEWER"){alert("Viewers cannot jump to rows. Please change your role to EDITOR or OPERATOR.");return}console.log("✏️ Row jump button clicked - pausing sync"),$r(!0),Jr&&clearTimeout(Jr),setTimeout(()=>{const v=prompt(`Move to row (1-${tr().length}):`,(g+1).toString());console.log("⏸️ Row jump prompt closed - resuming sync in 5 seconds");const w=setTimeout(()=>{console.log("⏸️ User stopped editing - resuming sync"),$r(!1)},5e3);js(w),v&&!isNaN(Number(v))&&Na(l.id,Number(v))},0)},className:`w-5 h-5 text-white rounded flex items-center justify-center text-xs font-bold transition-colors ${d==="VIEWER"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-purple-600 hover:bg-purple-500"}`,disabled:d==="VIEWER",title:d==="VIEWER"?"Viewers cannot jump to rows":"Jump to Row",children:"#"}),o.jsx("span",{className:"text-white font-bold text-lg",children:g+1}),o.jsx("button",{onClick:()=>{if(d==="VIEWER"){alert("Viewers cannot add rows. Please change your role to EDITOR or OPERATOR.");return}At(),ra(g),Ae(!0)},className:`w-5 h-5 text-white rounded flex items-center justify-center text-xs font-bold transition-colors ${d==="VIEWER"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-500"}`,disabled:d==="VIEWER",title:d==="VIEWER"?"Viewers cannot add rows":`Insert row after row ${g+1}`,children:"+"})]})},`${l.id}-${l.notes?.length||0}-${l.speakers?.length||0}`))]}),o.jsxs("div",{className:"w-40 flex-shrink-0 bg-slate-900",style:{borderRight:"6px solid #475569"},children:[o.jsx("div",{className:"h-24 bg-slate-700 border-b-3 border-slate-600 flex items-center justify-center",children:o.jsxs("span",{className:"text-white font-bold text-lg flex items-center gap-1",children:["CUE",d==="VIEWER"&&o.jsx("span",{className:"text-yellow-400",title:"Viewers cannot edit CUE",children:"🔒"})]})}),tr().length===0?o.jsx("div",{className:"h-24 flex items-center justify-center text-slate-500",children:"No items"}):tr().map((l,g)=>o.jsxs("div",{className:`border-b-2 border-slate-600 flex flex-col items-center justify-center gap-1 ${g%2===0?"bg-slate-800":"bg-slate-900"}`,style:{height:$t(l.notes,l.speakersText,l.speakers,l.customFields,ue)},children:[o.jsxs("div",{className:"flex",children:[o.jsx("div",{className:`flex items-center px-1 py-1 border border-slate-600 border-r-0 rounded-l text-white text-lg font-medium min-w-[40px] ${di===l.id?"bg-purple-600":"bg-slate-600"}`,children:"CUE"}),o.jsx("input",{type:"text",value:l.customFields.cue?l.customFields.cue.replace(/^CUE\s*/,""):"",onChange:v=>{if(Qe(),d==="VIEWER"){alert("Viewers cannot edit cue names. Please change your role to EDITOR or OPERATOR.");return}const w=l.customFields.cue||"CUE ",E=v.target.value?`CUE ${v.target.value}`:"CUE ";re(T=>T.map(D=>D.id===l.id?{...D,customFields:{...D.customFields,cue:E}}:D)),V(`cue_${l.id}`,"FIELD_UPDATE",`Updated cue for "${l.segmentName}" from "${w}" to "${E}"`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:"cue",oldValue:w,newValue:E,details:{fieldType:"text",characterChange:E.length-w.length}})},disabled:d==="VIEWER",className:"w-14 px-1 py-1 border border-slate-600 rounded-r text-center text-lg transition-colors bg-slate-700 text-white focus:outline-none focus:border-blue-500",title:d==="VIEWER"?"Viewers cannot edit cue names":"Edit cue number",maxLength:4})]}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx("button",{onClick:()=>{if(Qe(),d==="VIEWER"){alert("Viewers cannot indent/unindent items. Please change your role to EDITOR or OPERATOR.");return}const v=l.isIndented;re(w=>w.map(E=>E.id===l.id?{...E,isIndented:!E.isIndented}:E)),P("FIELD_UPDATE",`Updated indentation for "${l.segmentName}" from ${v} to ${!v}`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:"isIndented",oldValue:v,newValue:!v,details:{fieldType:"boolean",booleanChange:!0}})},className:`w-7 h-7 text-white flex items-center justify-center text-lg rounded font-bold transition-colors ${d==="VIEWER"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-slate-600 hover:bg-slate-500"}`,disabled:d==="VIEWER",title:d==="VIEWER"?"Viewers cannot indent/unindent items":l.isIndented?"Unindent (group with row above)":"Indent (group with row above)",children:l.isIndented?"↗":"↘"}),o.jsx("button",{onClick:()=>{if(Qe(),d==="VIEWER"){alert("Viewers cannot move items. Please change your role to EDITOR or OPERATOR.");return}mn(l.id,"up")},disabled:g===0||d==="VIEWER",className:`w-7 h-7 text-white flex items-center justify-center text-lg rounded font-bold transition-colors ${d==="VIEWER"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-slate-600 hover:bg-slate-500 disabled:opacity-30 disabled:cursor-not-allowed"}`,title:d==="VIEWER"?"Viewers cannot move items":"Move Up",children:"↑"}),o.jsx("button",{onClick:()=>{if(Qe(),d==="VIEWER"){alert("Viewers cannot move items. Please change your role to EDITOR or OPERATOR.");return}mn(l.id,"down")},disabled:g===tr().length-1||d==="VIEWER",className:`w-7 h-7 text-white flex items-center justify-center text-lg rounded font-bold transition-colors ${d==="VIEWER"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-slate-600 hover:bg-slate-500 disabled:opacity-30 disabled:cursor-not-allowed"}`,title:d==="VIEWER"?"Viewers cannot move items":"Move Down",children:"↓"}),o.jsx("button",{onClick:()=>{if(Qe(),d==="VIEWER"){alert("Viewers cannot delete items. Please change your role to EDITOR or OPERATOR.");return}ac(l.id)},className:`w-7 h-7 text-white flex items-center justify-center text-lg rounded font-bold transition-colors ${d==="VIEWER"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-red-600 hover:bg-red-500"}`,disabled:d==="VIEWER",title:d==="VIEWER"?"Viewers cannot delete items":"Delete",children:"×"})]})]},`${l.id}-${l.notes?.length||0}-${l.speakers?.length||0}`))]}),o.jsx("div",{id:"main-scroll-container",className:"flex-1 overflow-x-auto",style:{scrollbarWidth:"thin"},children:o.jsxs("div",{className:"min-w-max",children:[o.jsxs("div",{className:"h-24 bg-slate-700 border-b-3 border-slate-600 flex",children:[ve.start&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.start},children:[o.jsx("span",{className:"text-white font-bold",children:"Start"}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"start")})]}),ve.programType&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.programType},children:[o.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Program Type",(d==="VIEWER"||d==="OPERATOR")&&o.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"programType")})]}),ve.duration&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.duration},children:[o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"text-white font-bold flex items-center justify-center gap-1",children:["Duration",d==="VIEWER"&&o.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),o.jsx("div",{className:"text-xs text-slate-400",children:"HH MM SS"})]}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"duration")})]}),ve.segmentName&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.segmentName},children:[o.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Segment Name",(d==="VIEWER"||d==="OPERATOR")&&o.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"segmentName")})]}),ve.shotType&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.shotType},children:[o.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Shot Type",(d==="VIEWER"||d==="OPERATOR")&&o.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"shotType")})]}),ve.pptQA&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.pptQA},children:[o.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["PPT/Q&A",(d==="VIEWER"||d==="OPERATOR")&&o.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"pptQA")})]}),ve.notes&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.notes},children:[o.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Notes",(d==="VIEWER"||d==="OPERATOR")&&o.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"notes")})]}),ve.assets&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.assets},children:[o.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Assets",d==="VIEWER"&&o.jsx("span",{className:"text-yellow-400",title:"Read-only for VIEWERs",children:"🔒"})]}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"assets")})]}),ve.participants&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.participants},children:[o.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Participants",(d==="VIEWER"||d==="OPERATOR")&&o.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"participants")})]}),ve.speakers&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.speakers},children:[o.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Speakers",(d==="VIEWER"||d==="OPERATOR")&&o.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"speakers")})]}),ve.public&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:Ue.public},children:[o.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Public",(d==="VIEWER"||d==="OPERATOR")&&o.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>tt(l,"public")})]}),ue.map(l=>Ss[l.id]!==!1&&o.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center relative flex-shrink-0",style:{width:ks[l.id]||256},children:[o.jsx("span",{className:"text-white font-bold",children:l.name}),o.jsx("button",{onClick:()=>{window.confirm(`Are you sure you want to remove the "${l.name}" column? This will delete all data in this column.`)&&Ls(l.id)},className:"absolute top-1 right-1 w-6 h-6 bg-red-600 hover:bg-red-700 text-white rounded-md text-base font-bold flex items-center justify-center transition-colors shadow-md hover:shadow-lg",title:`Remove "${l.name}" column`,children:"×"}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:g=>ka(g,l.id)})]},l.id))]}),tr().length===0?o.jsxs("div",{className:"h-24 flex items-center justify-center text-slate-500 text-xl",children:["No schedule items for Day ",$,'. Click "Add Schedule Item" to start!']}):tr().map((l,g)=>o.jsxs("div",{"data-item-id":l.id,className:`border-b-2 border-slate-600 flex ${Oe[l.id]?"bg-green-950":ke===l.id?"bg-blue-950":Ln.has(l.id)?"bg-amber-950 border-amber-600":na[l.id]||Lr.has(l.id)?"bg-gray-900 opacity-40":di===l.id?"bg-purple-950 border-purple-400":g%2===0?"bg-slate-800":"bg-slate-900"}`,style:{height:$t(l.notes,l.speakersText,l.speakers,l.customFields,ue)},children:[ve.start&&o.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0",style:{width:Ue.start},children:o.jsx("span",{className:"text-white font-mono text-base font-bold",children:l.isIndented?"↘":gn(g)})}),ve.programType&&o.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0",style:{width:Ue.programType},children:o.jsx("select",{value:l.programType,onFocus:()=>{console.log("✏️ Program Type dropdown focused - pausing sync"),At()},onChange:v=>{if(d==="VIEWER"||d==="OPERATOR"){alert("Only EDITORs can edit program type. Please change your role to EDITOR.");return}const w=l.programType;re(E=>E.map(T=>T.id===l.id?{...T,programType:v.target.value}:T)),V(`programType_${l.id}`,"FIELD_UPDATE",`Updated program type for "${l.segmentName}" from "${w}" to "${v.target.value}"`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:"programType",oldValue:w,newValue:v.target.value,details:{fieldType:"select",optionChange:!0}}),ht()},disabled:d==="VIEWER"||d==="OPERATOR",className:"w-full px-3 py-2 border-2 rounded text-base transition-colors bg-slate-700 border-slate-500 text-white focus:border-blue-500",style:{backgroundColor:yo[l.programType]||"#374151",color:l.programType==="Sub Cue"?"#000000":"#ffffff",opacity:1},title:d==="VIEWER"||d==="OPERATOR"?"Only EDITORs can edit program type":"Select program type",children:pi.map(v=>o.jsx("option",{value:v,style:{backgroundColor:yo[v]||"#374151",color:v==="Sub Cue"?"#000000":"#ffffff"},children:v},v))})}),ve.duration&&o.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0",style:{width:Ue.duration},children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"number",min:"0",max:"23",value:l.durationHours,onChange:v=>{if(Qe(),d==="VIEWER"){alert("Only EDITORs and OPERATORs can edit duration. Please change your role to EDITOR or OPERATOR.");return}const w=l.durationHours,E=parseInt(v.target.value)||0;re(T=>T.map(D=>D.id===l.id?{...D,durationHours:E}:D)),V(`durationHours_${l.id}`,"FIELD_UPDATE",`Updated duration hours for "${l.segmentName}" from ${w} to ${E}`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:"durationHours",oldValue:w,newValue:E,details:{fieldType:"number",timeChange:E-w}})},disabled:d==="VIEWER",className:"w-14 px-2 py-2 border border-slate-600 rounded text-center text-lg font-mono font-bold transition-colors bg-slate-700 text-white",style:{opacity:1},title:d==="VIEWER"?"Only EDITORs and OPERATORs can edit duration":"Edit hours"}),o.jsx("span",{className:"text-slate-400 text-xl font-bold",children:":"}),o.jsx("input",{type:"number",min:"0",max:"59",value:l.durationMinutes,onChange:v=>{if(Qe(),d==="VIEWER"){alert("Only EDITORs and OPERATORs can edit duration. Please change your role to EDITOR or OPERATOR.");return}const w=l.durationMinutes,E=parseInt(v.target.value)||0;re(T=>T.map(D=>D.id===l.id?{...D,durationMinutes:E}:D)),V(`durationMinutes_${l.id}`,"FIELD_UPDATE",`Updated duration minutes for "${l.segmentName}" from ${w} to ${E}`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:"durationMinutes",oldValue:w,newValue:E,details:{fieldType:"number",timeChange:E-w}})},disabled:d==="VIEWER",className:"w-14 px-2 py-2 border border-slate-600 rounded text-center text-lg font-mono font-bold transition-colors bg-slate-700 text-white",style:{opacity:1},title:d==="VIEWER"?"Only EDITORs and OPERATORs can edit duration":"Edit minutes"}),o.jsx("span",{className:"text-slate-400 text-xl font-bold",children:":"}),o.jsx("input",{type:"number",min:"0",max:"59",value:l.durationSeconds,onChange:v=>{if(Qe(),d==="VIEWER"){alert("Only EDITORs and OPERATORs can edit duration. Please change your role to EDITOR or OPERATOR.");return}const w=l.durationSeconds,E=parseInt(v.target.value)||0;re(T=>T.map(D=>D.id===l.id?{...D,durationSeconds:E}:D)),V(`durationSeconds_${l.id}`,"FIELD_UPDATE",`Updated duration seconds for "${l.segmentName}" from ${w} to ${E}`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:"durationSeconds",oldValue:w,newValue:E,details:{fieldType:"number",timeChange:E-w}})},disabled:d==="VIEWER",className:"w-14 px-2 py-2 border border-slate-600 rounded text-center text-lg font-mono font-bold transition-colors bg-slate-700 text-white",style:{opacity:1},title:d==="VIEWER"?"Only EDITORs and OPERATORs can edit duration":"Edit seconds"})]})}),ve.segmentName&&o.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0",style:{width:Ue.segmentName},children:o.jsx("input",{type:"text",value:l.segmentName,onChange:v=>{if(Qe(),d==="VIEWER"||d==="OPERATOR"){alert("Only EDITORs can edit segment names. Please change your role to EDITOR.");return}const w=l.segmentName;re(E=>E.map(T=>T.id===l.id?{...T,segmentName:v.target.value}:T)),V(`segmentName_${l.id}`,"FIELD_UPDATE",`Updated segment name for "${w}" to "${v.target.value}"`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:v.target.value,fieldName:"segmentName",oldValue:w,newValue:v.target.value,details:{fieldType:"text",characterChange:v.target.value.length-w.length}})},disabled:d==="VIEWER"||d==="OPERATOR",className:"w-full px-3 py-2 border border-slate-600 rounded text-base transition-colors bg-slate-700 text-white",placeholder:d==="VIEWER"||d==="OPERATOR"?"Only EDITORs can edit":"Enter segment name",title:d==="VIEWER"||d==="OPERATOR"?"Only EDITORs can edit segment names":"Edit segment name"})}),ve.shotType&&o.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0",style:{width:Ue.shotType},children:o.jsxs("select",{value:l.shotType,onFocus:()=>{console.log("✏️ Shot Type dropdown focused - pausing sync"),At()},onChange:v=>{if(d==="VIEWER"||d==="OPERATOR"){alert("Only EDITORs can edit shot type. Please change your role to EDITOR.");return}const w=l.shotType;re(E=>E.map(T=>T.id===l.id?{...T,shotType:v.target.value}:T)),V(`shotType_${l.id}`,"FIELD_UPDATE",`Updated shot type for "${l.segmentName}" from "${w}" to "${v.target.value}"`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:"shotType",oldValue:w,newValue:v.target.value,details:{fieldType:"select",optionChange:!0}}),ht()},disabled:d==="VIEWER"||d==="OPERATOR",className:"w-full px-3 py-2 border border-slate-600 rounded text-base transition-colors bg-slate-700 text-white",style:{opacity:1},title:d==="VIEWER"||d==="OPERATOR"?"Only EDITORs can edit shot type":"Select shot type",children:[o.jsx("option",{value:"",children:"Select Shot Type"}),ba.map(v=>o.jsx("option",{value:v,children:v},v))]})}),ve.pptQA&&o.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0",style:{width:Ue.pptQA},children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("label",{className:"flex items-center gap-1",children:[o.jsx("input",{type:"checkbox",checked:l.hasPPT,onChange:v=>{if(Qe(),d==="VIEWER"||d==="OPERATOR"){alert("Only EDITORs can edit PPT settings. Please change your role to EDITOR.");return}const w=l.hasPPT;re(E=>E.map(T=>T.id===l.id?{...T,hasPPT:v.target.checked}:T)),V(`hasPPT_${l.id}`,"FIELD_UPDATE",`Updated PPT status for "${l.segmentName}" from ${w?"TRUE":"FALSE"} to ${v.target.checked?"TRUE":"FALSE"}`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:"hasPPT",oldValue:w?"TRUE":"FALSE",newValue:v.target.checked?"TRUE":"FALSE",details:{fieldType:"checkbox",booleanChange:!0}})},className:`w-6 h-6 rounded border-2 transition-colors ${d==="VIEWER"||d==="OPERATOR"?"border-slate-400 bg-slate-700 cursor-not-allowed":"border-slate-400 bg-slate-700 hover:border-blue-400 focus:ring-2 focus:ring-blue-500"}`,style:{opacity:1,filter:"none",WebkitFilter:"none"},title:d==="VIEWER"||d==="OPERATOR"?"Only EDITORs can edit PPT settings":"Toggle PPT"}),o.jsx("span",{className:"text-base font-medium text-white",children:"PPT"})]}),o.jsxs("label",{className:"flex items-center gap-1",children:[o.jsx("input",{type:"checkbox",checked:l.hasQA,onChange:v=>{if(Qe(),d==="VIEWER"||d==="OPERATOR"){alert("Only EDITORs can edit Q&A settings. Please change your role to EDITOR.");return}const w=l.hasQA;re(E=>E.map(T=>T.id===l.id?{...T,hasQA:v.target.checked}:T)),V(`hasQA_${l.id}`,"FIELD_UPDATE",`Updated Q&A status for "${l.segmentName}" from ${w?"TRUE":"FALSE"} to ${v.target.checked?"TRUE":"FALSE"}`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:"hasQA",oldValue:w?"TRUE":"FALSE",newValue:v.target.checked?"TRUE":"FALSE",details:{fieldType:"checkbox",booleanChange:!0}})},className:`w-6 h-6 rounded border-2 transition-colors ${d==="VIEWER"||d==="OPERATOR"?"border-slate-400 bg-slate-700 cursor-not-allowed":"border-slate-400 bg-slate-700 hover:border-blue-400 focus:ring-2 focus:ring-blue-500"}`,style:{opacity:1,filter:"none",WebkitFilter:"none"},title:d==="VIEWER"||d==="OPERATOR"?"Only EDITORs can edit Q&A settings":"Toggle Q&A"}),o.jsx("span",{className:"text-base font-medium text-white",children:"Q&A"})]})]})}),ve.notes&&o.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 transition-all duration-300 ease-in-out",style:{width:Ue.notes,height:$t(l.notes,l.speakersText,l.speakers,l.customFields,ue)},children:o.jsx("div",{onClick:()=>{if(d==="VIEWER"||d==="OPERATOR"){if(d==="OPERATOR"&&l.notes){alert(`Notes (View Only):

${l.notes.replace(/<[^>]*>/g,"")}`);return}alert("Only EDITORs can edit notes. Please change your role to EDITOR.");return}At(),us(l.id),cs(!0)},className:"w-full px-3 py-2 border border-slate-600 rounded text-white text-base transition-colors flex items-start justify-center bg-slate-700 cursor-pointer hover:bg-slate-600",style:{height:vi(l.notes),minHeight:vi(l.notes),wordWrap:"break-word",overflowWrap:"break-word",overflow:"hidden",paddingBottom:"1rem"},title:d==="VIEWER"?"Viewers cannot edit notes":d==="OPERATOR"?"Click to view notes (read-only)":"Click to edit notes",children:l.notes?o.jsx("div",{className:"text-left w-full",dangerouslySetInnerHTML:{__html:l.notes}}):o.jsx("span",{className:"text-slate-400",children:"Click to edit notes..."})})}),ve.assets&&o.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0",style:{width:Ue.assets},children:o.jsx("div",{onClick:()=>{if(d==="VIEWER"||d==="OPERATOR"){if(d==="OPERATOR"&&l.assets){ai(l.id),Rn(!0);return}alert("Only EDITORs can edit assets. Please change your role to EDITOR.");return}At(),cn(l.id),hs(!0)},className:"w-full px-3 py-2 border border-slate-600 rounded text-white text-base transition-colors flex items-center justify-center bg-slate-700 cursor-pointer hover:bg-slate-600",title:d==="VIEWER"?"Viewers cannot edit assets":d==="OPERATOR"?"Click to view assets (read-only)":"Click to edit assets",children:l.assets?o.jsx("div",{className:"text-center",children:o.jsxs("div",{className:"text-sm font-medium",children:[l.assets.split("||").length," Asset",l.assets.split("||").length!==1?"s":""]})}):o.jsx("span",{className:"text-slate-400",children:"Click to add assets..."})})}),ve.participants&&o.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-start justify-center flex-shrink-0 transition-all duration-300 ease-in-out",style:{width:Ue.participants,height:$t(l.notes,l.speakersText,l.speakers,l.customFields,ue)},children:o.jsx("div",{onClick:()=>{if(d==="VIEWER"||d==="OPERATOR"){if(d==="OPERATOR"&&l.speakers){alert(`Participants (View Only):

${xa(l.speakers)}`);return}alert("Only EDITORs can edit participants. Please change your role to EDITOR.");return}In(l.id),ms(!0)},className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white text-base cursor-pointer hover:bg-slate-600",style:{height:`calc(${$t(l.notes,l.speakersText,l.speakers,l.customFields,ue)} - 2rem)`,maxHeight:`calc(${$t(l.notes,l.speakersText,l.speakers,l.customFields,ue)} - 2rem)`,overflow:"hidden",lineHeight:"1.6",wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"pre-wrap"},title:d==="VIEWER"?"Viewers cannot edit participants":d==="OPERATOR"?"Click to view participants (read-only)":"Click to edit participants",children:xa(l.speakers||"")||"Click to add participants..."})}),ve.speakers&&o.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 transition-all duration-300 ease-in-out",style:{width:Ue.speakers,height:$t(l.notes,l.speakersText,l.speakers,l.customFields,ue)},children:o.jsx("div",{onClick:()=>{if(d==="VIEWER"||d==="OPERATOR"){if(d==="OPERATOR"&&l.speakersText){alert(`Speakers (View Only):

${xo(l.speakersText)}`);return}alert("Only EDITORs can edit speakers. Please change your role to EDITOR.");return}At(),ln(l.id),Rr(!0)},className:"w-full px-3 py-2 border border-slate-600 rounded text-white text-base transition-colors flex items-start justify-start bg-slate-700 cursor-pointer hover:bg-slate-600",style:{height:yi(l.speakersText),minHeight:yi(l.speakersText),wordWrap:"break-word",overflowWrap:"break-word",overflow:"hidden",paddingBottom:"1rem",lineHeight:"1.6",whiteSpace:"pre-wrap"},title:d==="VIEWER"?"Viewers cannot edit speakers":d==="OPERATOR"?"Click to view speakers (read-only)":"Click to edit speakers",children:o.jsx("div",{className:"text-left w-full",children:xo(l.speakersText||"")||"Click to add speakers..."})})}),ve.public&&o.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0",style:{width:Ue.public},children:o.jsx("input",{type:"checkbox",checked:l.isPublic||!1,onChange:v=>{if(d==="VIEWER"||d==="OPERATOR"){alert("Only EDITORs can change public status. Please change your role to EDITOR.");return}const w=l.isPublic;re(E=>E.map(T=>T.id===l.id?{...T,isPublic:v.target.checked}:T)),P("FIELD_UPDATE",`Updated Public status for "${l.segmentName}" from ${w} to ${v.target.checked}`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:"isPublic",oldValue:w,newValue:v.target.checked,details:{fieldType:"checkbox",booleanChange:!0}})},className:`w-5 h-5 rounded border-2 focus:ring-2 transition-colors ${d==="VIEWER"||d==="OPERATOR"?"border-slate-500 bg-slate-700 text-blue-600 cursor-not-allowed":"border-slate-500 bg-slate-700 text-blue-600 focus:ring-blue-500"}`,style:{opacity:1,filter:"none",WebkitFilter:"none"},title:d==="VIEWER"||d==="OPERATOR"?"Only EDITORs can change public status":"Toggle public visibility"})}),ue.map(v=>Ss[v.id]!==!1&&o.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 transition-all duration-300 ease-in-out",style:{width:ks[v.id]||256,height:$t(l.notes,l.speakersText,l.speakers,l.customFields,ue)},children:o.jsx("textarea",{value:l.customFields[v.name]||"",onFocus:()=>{console.log("✏️ Custom column focused - pausing sync"),Qe()},onChange:w=>{Qe();const E=l.customFields[v.name]||"";re(T=>T.map(D=>D.id===l.id?{...D,customFields:{...D.customFields,[v.name]:w.target.value}}:D)),V(`custom_${v.name}_${l.id}`,"FIELD_UPDATE",`Updated custom field "${v.name}" for "${l.segmentName}" from "${E}" to "${w.target.value}"`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:`custom_${v.name}`,oldValue:E,newValue:w.target.value,details:{fieldType:"custom_field",columnName:v.name,characterChange:w.target.value.length-E.length}})},className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white text-base resize-none",style:{height:`calc(${$t(l.notes,l.speakersText,l.speakers,l.customFields,ue)} - 2rem)`,maxHeight:`calc(${$t(l.notes,l.speakersText,l.speakers,l.customFields,ue)} - 2rem)`,overflow:"hidden",lineHeight:"1.6",wordWrap:"break-word",overflowWrap:"break-word"},rows:Math.max(2,(l.customFields[v.name]||"").split(`
`).length),placeholder:`${v.name}...`})},v.id))]},`${l.id}-${l.notes?.length||0}-${l.speakers?.length||0}`))]})}),o.jsxs("div",{className:"w-32 flex-shrink-0 bg-slate-900",style:{borderLeft:"6px solid #475569"},children:[o.jsx("div",{className:"h-24 bg-slate-700 border-b-3 border-slate-600 flex items-center justify-center",children:o.jsxs("span",{className:"text-white font-bold text-base flex items-center gap-1",children:["Timer",(d==="VIEWER"||d==="EDITOR")&&o.jsx("span",{className:"text-yellow-400",title:"Only OPERATORs can control timers",children:"🔒"})]})}),tr().length===0?o.jsx("div",{className:"h-24 flex items-center justify-center text-slate-500",children:"-"}):tr().map((l,g)=>o.jsx("div",{className:`border-b-2 border-slate-600 flex flex-col items-center justify-center gap-1 ${g%2===0?"bg-slate-800":"bg-slate-900"}`,style:{height:$t(l.notes,l.speakersText,l.speakers,l.customFields,ue)},children:o.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-1",children:[o.jsx("div",{className:"text-sm font-mono text-slate-300",children:l.timerId||"TIMER"}),o.jsx("div",{className:"flex flex-col gap-1",children:l.isIndented?o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:()=>{if(d==="VIEWER"||d==="EDITOR"){alert("Only OPERATORs can start secondary timers. Please change your role to OPERATOR.");return}Ea(l.id)},disabled:st?.itemId===l.id||d==="VIEWER"||d==="EDITOR"||!Is(l.id),className:`px-3 py-1 rounded text-sm font-bold transition-colors ${d==="VIEWER"||d==="EDITOR"?"bg-gray-500 text-gray-300 cursor-not-allowed":Is(l.id)?st?.itemId===l.id?"bg-orange-600 text-white cursor-default":"bg-orange-500 hover:bg-orange-400 text-white":"bg-gray-500 text-gray-300 cursor-not-allowed"}`,title:d==="VIEWER"||d==="EDITOR"?"Only OPERATORs can start secondary timers":Is(l.id)?"Start secondary timer":"Start the CUE above first before starting secondary timer",children:st?.itemId===l.id?"PLAYING":"PLAY"}),o.jsx("button",{onClick:()=>{if(d==="VIEWER"||d==="EDITOR"){alert("Only OPERATORs can stop secondary timers. Please change your role to OPERATOR.");return}oc()},disabled:st?.itemId!==l.id||d==="VIEWER"||d==="EDITOR"||!Is(l.id),className:`px-3 py-1 rounded text-sm font-bold transition-colors ${d==="VIEWER"||d==="EDITOR"?"bg-gray-500 text-gray-300 cursor-not-allowed":Is(l.id)?st?.itemId===l.id?"bg-red-600 hover:bg-red-500 text-white":"bg-slate-600 text-slate-400 cursor-not-allowed":"bg-gray-500 text-gray-300 cursor-not-allowed"}`,title:d==="VIEWER"||d==="EDITOR"?"Only OPERATORs can stop secondary timers":"Stop secondary timer",children:"STOP"})]}):o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:async()=>{if(d==="VIEWER"){alert("Viewers cannot load cues. Please change your role to EDITOR or OPERATOR.");return}if(console.log("🔄🔄🔄 Button clicked, currentUserRole:",d),console.log("🔄🔄🔄 Button clicked, item.id:",l.id),d==="EDITOR"){alert("Editors cannot load cues. Please change your role to OPERATOR.");return}console.log("🔄🔄🔄 Button clicked, calling loadCue with item.id:",l.id),await Ni(l.id)},disabled:ke===l.id||d==="VIEWER"||d==="EDITOR",className:`px-3 py-1 rounded text-sm font-bold transition-colors ${d==="VIEWER"||d==="EDITOR"?"bg-gray-500 text-gray-300 cursor-not-allowed":ke===l.id?"bg-blue-600 text-white cursor-default":"bg-slate-600 hover:bg-slate-500 text-white"}`,title:d==="VIEWER"?"Viewers cannot load cues":d==="EDITOR"?"Editors cannot load cues":"Load this cue",children:ke===l.id?"LOADED":"LOAD"}),o.jsx("button",{onClick:async()=>{if(d==="VIEWER"||d==="EDITOR"){alert("Only OPERATORs can start/stop timers. Please change your role to OPERATOR.");return}await Bn(l.id)},disabled:ke!==l.id||(Oe[l.id]?!1:Object.keys(Oe).length>0)||d==="VIEWER"||d==="EDITOR",className:`px-3 py-1 rounded text-sm font-bold transition-colors ${d==="VIEWER"||d==="EDITOR"?"bg-gray-500 text-gray-300 cursor-not-allowed":Oe[l.id]?"bg-red-600 hover:bg-red-500 text-white":ke===l.id&&Object.keys(Oe).length===0?"bg-green-600 hover:bg-green-500 text-white":"bg-slate-600 text-slate-400 cursor-not-allowed"}`,title:d==="VIEWER"||d==="EDITOR"?"Only OPERATORs can start/stop timers":Oe[l.id]?"Stop timer":"Start timer",children:Oe[l.id]?"STOP":"START"})]})})]})},`${l.id}-${l.notes?.length||0}-${l.speakers?.length||0}`))]})]})]})}),Ve&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"bg-slate-800 rounded-lg max-w-lg w-full max-h-[90vh] flex flex-col",children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-600",children:[o.jsx("h2",{className:"text-lg font-bold text-white",children:"Add Schedule Item"}),o.jsxs("label",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"checkbox",checked:qe.isPublic,onChange:l=>ft(g=>({...g,isPublic:l.target.checked})),className:"rounded"}),o.jsx("span",{className:"text-slate-300 text-sm",children:"Public"})]})]}),o.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Cue"}),o.jsxs("div",{className:"flex",children:[o.jsx("div",{className:"flex items-center px-2 py-2 bg-slate-600 border border-slate-600 border-r-0 rounded-l text-white text-sm font-medium min-w-[40px]",children:"CUE"}),o.jsx("input",{type:"text",value:qe.cue,onChange:l=>{Qe(),ft(g=>({...g,cue:l.target.value}))},className:"flex-1 px-3 py-2 bg-slate-700 border border-slate-600 rounded-r text-white placeholder-slate-400 focus:outline-none focus:border-blue-500 text-sm",placeholder:"1, 1.1, 1A, etc."})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Program Type"}),o.jsx("select",{value:qe.programType,onFocus:()=>{console.log("✏️ Program Type modal dropdown focused - pausing sync"),At()},onChange:l=>{ft(g=>({...g,programType:l.target.value})),ht()},className:"w-full px-3 py-2 bg-slate-700 border-2 border-slate-500 rounded text-white focus:outline-none focus:border-blue-500 text-sm",style:{backgroundColor:yo[qe.programType]||"#374151",color:qe.programType==="Sub Cue"?"#000000":"#ffffff"},children:pi.map(l=>o.jsx("option",{value:l,style:{backgroundColor:yo[l]||"#374151",color:l==="Sub Cue"?"#000000":"#ffffff"},children:l},l))})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Segment Name"}),o.jsx("input",{type:"text",value:qe.segmentName,onChange:l=>{Qe(),ft(g=>({...g,segmentName:l.target.value}))},className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500 text-sm",placeholder:"Enter segment name"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Shot Type"}),o.jsxs("select",{value:qe.shotType,onFocus:()=>{console.log("✏️ Shot Type modal dropdown focused - pausing sync"),At()},onChange:l=>{ft(g=>({...g,shotType:l.target.value})),ht()},className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:outline-none focus:border-blue-500 text-sm",children:[o.jsx("option",{value:"",children:"Select Shot Type"}),ba.map(l=>o.jsx("option",{value:l,children:l},l))]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Duration"}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx("input",{type:"number",value:qe.durationHours,onChange:l=>{Qe(),ft(g=>({...g,durationHours:parseInt(l.target.value)||0}))},className:"w-12 px-2 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:outline-none focus:border-blue-500 text-sm text-center",min:"0",placeholder:"H"}),o.jsx("span",{className:"text-slate-400 self-center text-sm",children:":"}),o.jsx("input",{type:"number",value:qe.durationMinutes,onChange:l=>{Qe(),ft(g=>({...g,durationMinutes:parseInt(l.target.value)||0}))},className:"w-12 px-2 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:outline-none focus:border-blue-500 text-sm text-center",min:"0",max:"59",placeholder:"M"}),o.jsx("span",{className:"text-slate-400 self-center text-sm",children:":"}),o.jsx("input",{type:"number",value:qe.durationSeconds,onChange:l=>{Qe(),ft(g=>({...g,durationSeconds:parseInt(l.target.value)||0}))},className:"w-12 px-2 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:outline-none focus:border-blue-500 text-sm text-center",min:"0",max:"59",placeholder:"S"})]})]})]}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("label",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"checkbox",checked:qe.hasPPT,onChange:l=>{Qe(),ft(g=>({...g,hasPPT:l.target.checked}))},className:"rounded"}),o.jsx("span",{className:"text-slate-300 text-sm",children:"Has PPT"})]}),o.jsxs("label",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"checkbox",checked:qe.hasQA,onChange:l=>{Qe(),ft(g=>({...g,hasQA:l.target.checked}))},className:"rounded"}),o.jsx("span",{className:"text-slate-300 text-sm",children:"Has QA"})]})]})]}),o.jsxs("div",{className:"mt-3",children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Notes"}),o.jsx("div",{className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500 text-sm cursor-pointer hover:bg-slate-600 transition-colors min-h-[60px] flex items-center",onClick:()=>{At(),us(-1),cs(!0)},children:qe.notes?o.jsx("div",{className:"text-sm",dangerouslySetInnerHTML:{__html:qe.notes}}):o.jsx("span",{className:"text-slate-400",children:"Click to edit notes with rich formatting..."})})]}),o.jsxs("div",{className:"mt-3",children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Assets"}),o.jsx("div",{className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500 text-sm cursor-pointer hover:bg-slate-600 transition-colors min-h-[60px] flex items-center",onClick:()=>{At(),cn(-1),hs(!0)},children:qe.assets?o.jsx("div",{className:"text-sm",dangerouslySetInnerHTML:{__html:qe.assets.replace(/\|\|/g,"<br>")}}):o.jsx("span",{className:"text-slate-400",children:"Click to edit assets with advanced management..."})})]}),o.jsxs("div",{className:"mt-3",children:[o.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Speakers"}),o.jsx("div",{className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500 text-sm cursor-pointer hover:bg-slate-600 transition-colors min-h-[60px] flex items-start justify-start",onClick:()=>{At(),ln(-1),Rr(!0)},style:{wordWrap:"break-word",overflowWrap:"break-word",lineHeight:"1.6",whiteSpace:"pre-wrap"},children:qe.speakersText?o.jsx("div",{className:"text-sm text-left w-full",children:xo(qe.speakersText)}):o.jsx("span",{className:"text-slate-400",children:"Click to add speakers..."})})]})]}),o.jsx("div",{className:"p-4 border-t border-slate-600",children:o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:()=>sc(qe),className:"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white font-medium rounded transition-colors text-sm",children:"Add Item"}),o.jsx("button",{onClick:()=>{Ae(!1),ht()},className:"flex-1 px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white font-medium rounded transition-colors text-sm",children:"Cancel"})]})})]})}),so&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"bg-slate-800 rounded-xl p-8 max-w-md w-full",children:[o.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Add Custom Column"}),o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{className:"block text-slate-300 font-semibold mb-2",children:"Column Name"}),o.jsx("input",{type:"text",placeholder:"Enter column name",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:border-blue-500",onFocus:()=>{console.log("✏️ Custom column input focused - pausing sync"),Qe()},onKeyPress:l=>{if(l.key==="Enter"){const g=l.target;g.value.trim()&&(er(g.value.trim()),g.value="")}}})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:()=>{const l=document.querySelector('input[placeholder="Enter column name"]');l?.value.trim()&&(er(l.value.trim()),l.value="")},className:"flex-1 px-4 py-3 bg-purple-600 hover:bg-purple-500 text-white font-semibold rounded-lg transition-colors",children:"Add Column"}),o.jsx("button",{onClick:()=>{is(!1),ht()},className:"flex-1 px-4 py-3 bg-slate-600 hover:bg-slate-500 text-white font-semibold rounded-lg transition-colors",children:"Cancel"})]})]})}),ls&&Jt!==null&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 max-w-5xl w-full max-h-[90vh] flex flex-col",children:[o.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Edit Notes"}),o.jsxs("div",{className:"mb-4 bg-slate-700 rounded-lg overflow-hidden",children:[o.jsxs("div",{className:"flex items-center justify-between gap-4 p-3 border-b border-slate-600",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-white text-sm font-semibold",children:"Format:"}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx("button",{onClick:()=>Je("undo"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded flex items-center justify-center",title:"Undo",children:"↶"}),o.jsx("button",{onClick:()=>Je("redo"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded flex items-center justify-center",title:"Redo",children:"↷"}),o.jsx("div",{className:"w-px h-6 bg-slate-500 mx-1"}),o.jsx("button",{onClick:()=>Je("bold"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-sm rounded font-bold flex items-center justify-center",title:"Bold",children:"B"}),o.jsx("button",{onClick:()=>Je("italic"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-sm rounded italic flex items-center justify-center",title:"Italic",children:"I"}),o.jsx("button",{onClick:()=>Je("underline"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-sm rounded underline flex items-center justify-center",title:"Underline",children:"U"})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-white text-sm font-semibold",children:"Size:"}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx("button",{onClick:()=>Je("fontSize","1"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded flex items-center justify-center",title:"Small",children:"S"}),o.jsx("button",{onClick:()=>Je("fontSize","3"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-sm rounded flex items-center justify-center",title:"Normal",children:"N"}),o.jsx("button",{onClick:()=>Je("fontSize","5"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-base rounded flex items-center justify-center",title:"Large",children:"L"}),o.jsx("button",{onClick:()=>Je("fontSize","7"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-lg rounded flex items-center justify-center",title:"X-Large",children:"XL"})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-white text-sm font-semibold",children:"Align:"}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx("button",{onClick:()=>Je("left"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded flex items-center justify-center",title:"Left Align",children:"≡"}),o.jsx("button",{onClick:()=>Je("center"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded flex items-center justify-center",title:"Center Align",children:"≣"}),o.jsx("button",{onClick:()=>Je("right"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded flex items-center justify-center",title:"Right Align",children:"≡"})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-white text-sm font-semibold",children:"Lists:"}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx("button",{onClick:()=>Je("bullet"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-sm rounded flex items-center justify-center",title:"Bullet List",children:"•"}),o.jsx("button",{onClick:()=>Je("list"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-sm rounded flex items-center justify-center",title:"Numbered List",children:"1."})]})]})]}),o.jsxs("div",{className:"flex items-center justify-center gap-6 p-3",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-white text-sm font-semibold",children:"Text Color:"}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx("button",{onClick:()=>Je("color","#ffffff"),className:"w-6 h-6 bg-white border border-slate-400 rounded",title:"White"}),o.jsx("button",{onClick:()=>Je("color","#ef4444"),className:"w-6 h-6 bg-red-500 rounded",title:"Red"}),o.jsx("button",{onClick:()=>Je("color","#3b82f6"),className:"w-6 h-6 bg-blue-500 rounded",title:"Blue"}),o.jsx("button",{onClick:()=>Je("color","#22c55e"),className:"w-6 h-6 bg-green-500 rounded",title:"Green"}),o.jsx("button",{onClick:()=>Je("color","#f97316"),className:"w-6 h-6 bg-orange-500 rounded",title:"Orange"}),o.jsx("button",{onClick:()=>Je("color","#a855f7"),className:"w-6 h-6 bg-purple-500 rounded",title:"Purple"}),o.jsx("button",{onClick:()=>Je("color","#000000"),className:"w-6 h-6 bg-black border border-slate-400 rounded",title:"Black"})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-white text-sm font-semibold",children:"Highlight:"}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx("button",{onClick:()=>Je("highlight","transparent"),className:"w-6 h-6 bg-slate-600 border border-slate-400 rounded flex items-center justify-center text-white text-xs",title:"No Highlight",children:"×"}),o.jsx("button",{onClick:()=>Je("highlight","#fbbf24"),className:"w-6 h-6 bg-yellow-400 rounded",title:"Yellow"}),o.jsx("button",{onClick:()=>Je("highlight","#60a5fa"),className:"w-6 h-6 bg-blue-400 rounded",title:"Light Blue"}),o.jsx("button",{onClick:()=>Je("highlight","#4ade80"),className:"w-6 h-6 bg-green-400 rounded",title:"Light Green"}),o.jsx("button",{onClick:()=>Je("highlight","#f472b6"),className:"w-6 h-6 bg-pink-400 rounded",title:"Pink"}),o.jsx("button",{onClick:()=>Je("highlight","#fb923c"),className:"w-6 h-6 bg-orange-400 rounded",title:"Orange"})]})]})]})]}),o.jsxs("div",{className:"flex-1 min-h-[400px] mb-6",children:[o.jsx("label",{className:"block text-white text-sm mb-2",children:"Notes:"}),o.jsx("div",{id:"notes-editor",contentEditable:!0,className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white text-base focus:outline-none focus:border-blue-500 overflow-auto",style:{height:"400px",lineHeight:"1.5",fontFamily:"system-ui, -apple-system, sans-serif"},"data-placeholder":"Start typing your notes here...",onInput:l=>{}})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:xi,className:"flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white font-semibold rounded-lg transition-colors",children:"Save & Close"}),o.jsx("button",{onClick:()=>{cs(!1),us(null),ht()},className:"flex-1 px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white font-semibold rounded-lg transition-colors",children:"Cancel"})]})]})}),Cn&&Et!==null&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"bg-slate-800 rounded-xl max-w-5xl w-full max-h-[90vh] flex flex-col",children:[o.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-slate-700",children:[o.jsxs("h2",{className:"text-xl font-bold text-white",children:["Edit Speakers (",Nt.length,"/7)"]}),o.jsx("button",{onClick:()=>{Rr(!1),ln(null),ht()},className:"text-slate-400 hover:text-white text-xl",children:"✕"})]}),o.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[o.jsx("div",{className:"mb-6",children:o.jsxs("button",{onClick:ya,disabled:Nt.length>=7,className:"px-4 py-2 bg-green-600 hover:bg-green-500 disabled:bg-slate-600 disabled:cursor-not-allowed text-white font-semibold rounded-lg transition-colors",children:["+ Add Speaker ",Nt.length<7&&`(${7-Nt.length} slots remaining)`]})}),o.jsxs("div",{className:"space-y-4 mb-6",children:[Nt.sort((l,g)=>l.slot-g.slot).map(l=>o.jsxs("div",{className:"bg-slate-700 rounded-lg p-4 border border-slate-600",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Speaker ",l.slot]}),o.jsx("button",{onClick:()=>Os(l.id),className:"w-8 h-8 bg-red-600 hover:bg-red-500 text-white rounded flex items-center justify-center transition-colors",title:"Remove Speaker",children:"✕"})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Slot Number"}),o.jsx("select",{value:l.slot,onChange:g=>Si(l.id,parseInt(g.target.value)),className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm focus:outline-none focus:border-blue-500",children:[1,2,3,4,5,6,7].map(g=>{const v=Nt.some(w=>w.id!==l.id&&w.slot===g);return o.jsxs("option",{value:g,className:v?"bg-yellow-600 text-white":"bg-slate-600 text-white",children:[g," ",v?"(Used)":""]},g)})})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Location"}),o.jsxs("select",{value:l.location,onChange:g=>fn(l.id,"location",g.target.value),className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm focus:outline-none focus:border-blue-500",children:[o.jsx("option",{value:"Podium",children:"Podium"}),o.jsx("option",{value:"Seat",children:"Seat"}),o.jsx("option",{value:"Virtual",children:"Virtual"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Full Name"}),o.jsx("input",{type:"text",value:l.fullName,onChange:g=>fn(l.id,"fullName",g.target.value),placeholder:"Enter full name",className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm placeholder-slate-400 focus:outline-none focus:border-blue-500"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Title"}),o.jsx("input",{type:"text",value:l.title,onChange:g=>fn(l.id,"title",g.target.value),placeholder:"Enter title",className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm placeholder-slate-400 focus:outline-none focus:border-blue-500"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Organization"}),o.jsx("input",{type:"text",value:l.org,onChange:g=>fn(l.id,"org",g.target.value),placeholder:"Enter organization",className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm placeholder-slate-400 focus:outline-none focus:border-blue-500"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Photo Link"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("input",{type:"url",value:l.photoLink,onChange:g=>fn(l.id,"photoLink",g.target.value),placeholder:"Enter photo URL",className:"flex-1 px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm placeholder-slate-400 focus:outline-none focus:border-blue-500"}),l.photoLink&&o.jsx("div",{className:"flex-shrink-0",children:o.jsx("img",{src:l.photoLink,alt:l.fullName,className:"w-12 h-12 rounded object-cover border-2 border-slate-500 -mt-2.5",onError:g=>{g.currentTarget.style.display="none"}})})]})]})]})]},l.id)),Nt.length===0&&o.jsx("div",{className:"text-center py-8 text-slate-400",children:'No speakers added yet. Click "Add Speaker" to get started.'})]})]}),o.jsx("div",{className:"border-t border-slate-700 p-6",children:o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:Kl,className:"flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white font-semibold rounded-lg transition-colors",children:"Save & Close"}),o.jsx("button",{onClick:()=>{Rr(!1),ln(null),ht()},className:"flex-1 px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white font-semibold rounded-lg transition-colors",children:"Cancel"})]})})]})}),ds&&Qt!==null&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[o.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Edit Assets"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h3",{className:"text-lg font-semibold text-white",children:"Assets List"}),o.jsx("button",{onClick:bi,className:"px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded-lg transition-colors",children:"+ Add Asset"})]}),o.jsx("div",{id:"assets-list",className:"space-y-3"})]}),o.jsxs("div",{className:"flex gap-3 mt-6",children:[o.jsx("button",{onClick:Gl,className:"flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white font-semibold rounded-lg transition-colors",children:"Save & Close"}),o.jsx("button",{onClick:()=>{hs(!1),cn(null),ht()},className:"flex-1 px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white font-semibold rounded-lg transition-colors",children:"Cancel"})]})]})}),oi&&On!==null&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-white",children:"Assets List"}),o.jsx("button",{onClick:()=>{Rn(!1),ai(null)},className:"px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors",children:"Close"})]}),o.jsx("div",{className:"space-y-4",children:(()=>{const l=C.find(v=>v.id===On);if(!l||!l.assets)return o.jsx("div",{className:"text-center py-8",children:o.jsx("p",{className:"text-slate-400 text-lg",children:"No assets available for this item."})});let g=[];if(l.assets.includes("||"))g=l.assets.split("||").filter(w=>w.trim()).map(w=>{if(w.includes("|")){const[E,T]=w.split("|").map(D=>D.trim());return{name:E||"Unnamed Asset",url:T||""}}else return{name:w.trim(),url:""}});else if(l.assets.includes("|")){const[v,w]=l.assets.split("|").map(E=>E.trim());g=[{name:v||"Unnamed Asset",url:w||""}]}else try{const v=JSON.parse(l.assets);Array.isArray(v)?g=v.map(w=>({name:w.name||"Unnamed Asset",url:w.link||w.url||""})):g=[{name:v.name||"Unnamed Asset",url:v.link||v.url||""}]}catch{g=[{name:l.assets.trim(),url:""}]}return g.length===0?o.jsx("div",{className:"text-center py-8",children:o.jsx("p",{className:"text-slate-400 text-lg",children:"No assets available for this item."})}):o.jsx("div",{className:"space-y-4",children:o.jsx("div",{className:"max-h-96 overflow-y-auto space-y-3 pr-2",children:g.map((v,w)=>o.jsx("div",{className:"bg-slate-700 rounded-lg p-4 border border-slate-600",children:o.jsxs("div",{className:"space-y-2",children:[o.jsx("div",{className:"text-white font-semibold text-lg",children:v.name}),v.url&&o.jsx("div",{children:o.jsx("a",{href:v.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 underline break-all text-sm",children:v.url})})]})},w))})})})()})]})}),fs&&qr!==null&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"bg-slate-800 rounded-xl max-w-5xl w-full max-h-[90vh] flex flex-col",children:[o.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-slate-700",children:[o.jsxs("h2",{className:"text-xl font-bold text-white",children:["Edit Participants (",jt.length,"/7)"]}),o.jsx("button",{onClick:()=>{ms(!1),In(null)},className:"text-slate-400 hover:text-white text-xl",children:"✕"})]}),o.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[o.jsx("div",{className:"mb-6",children:o.jsxs("button",{onClick:wi,disabled:jt.length>=7,className:"px-4 py-2 bg-green-600 hover:bg-green-500 disabled:bg-slate-600 disabled:cursor-not-allowed text-white font-semibold rounded-lg transition-colors",children:["+ Add Speaker ",jt.length<7&&`(${7-jt.length} slots remaining)`]})}),o.jsxs("div",{className:"space-y-4",children:[jt.sort((l,g)=>l.slot-g.slot).map(l=>o.jsxs("div",{className:"bg-slate-700 rounded-lg p-4 border border-slate-600",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Speaker ",l.slot]}),o.jsx("button",{onClick:()=>Jl(l.id),className:"w-8 h-8 bg-red-600 hover:bg-red-500 text-white rounded flex items-center justify-center transition-colors",title:"Remove Speaker",children:"✕"})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Slot Number"}),o.jsx("select",{value:l.slot,onChange:g=>_i(l.id,parseInt(g.target.value)),className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm focus:outline-none focus:border-blue-500",children:[1,2,3,4,5,6,7].map(g=>{const v=jt.some(w=>w.id!==l.id&&w.slot===g);return o.jsxs("option",{value:g,className:v?"bg-yellow-600 text-white":"bg-slate-600 text-white",children:[g," ",v?"(Used)":""]},g)})})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Location"}),o.jsxs("select",{value:l.location,onChange:g=>Fn(l.id,"location",g.target.value),className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm focus:outline-none focus:border-blue-500",children:[o.jsx("option",{value:"Podium",children:"Podium"}),o.jsx("option",{value:"Seat",children:"Seat"}),o.jsx("option",{value:"Virtual",children:"Virtual"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Full Name"}),o.jsx("input",{type:"text",value:l.fullName,onChange:g=>Fn(l.id,"fullName",g.target.value),placeholder:"Enter full name",className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm placeholder-slate-400 focus:outline-none focus:border-blue-500"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Title"}),o.jsx("input",{type:"text",value:l.title,onChange:g=>Fn(l.id,"title",g.target.value),placeholder:"Enter title/position",className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm placeholder-slate-400 focus:outline-none focus:border-blue-500"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Organization"}),o.jsx("input",{type:"text",value:l.org,onChange:g=>Fn(l.id,"org",g.target.value),placeholder:"Enter organization",className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm placeholder-slate-400 focus:outline-none focus:border-blue-500"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Speaker Photo Link"}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("input",{type:"url",value:l.photoLink,onChange:g=>Fn(l.id,"photoLink",g.target.value),placeholder:"Enter photo URL",className:"flex-1 px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm placeholder-slate-400 focus:outline-none focus:border-blue-500"}),l.photoLink&&o.jsx("div",{className:"flex-shrink-0",children:o.jsx("img",{src:l.photoLink,alt:l.fullName,className:"w-12 h-12 rounded object-cover border-2 border-slate-500 -mt-2.5",onError:g=>{g.target.style.display="none"}})})]})]})]})]},l.id)),jt.length===0&&o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-slate-400 text-lg mb-4",children:"No speakers added yet"}),o.jsx("button",{onClick:wi,className:"px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white font-semibold rounded-lg transition-colors",children:"Add Your First Speaker"})]})]})]}),o.jsx("div",{className:"border-t border-slate-700 p-6",children:o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:Ql,className:"flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white font-semibold rounded-lg transition-colors",children:"Save & Close"}),o.jsx("button",{onClick:()=>{ms(!1),In(null)},className:"flex-1 px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white font-semibold rounded-lg transition-colors",children:"Cancel"})]})})]})}),oa&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"bg-slate-800 rounded-lg p-6 max-w-md w-full",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h3",{className:"text-xl font-bold text-white",children:"Send Message to Full Screen Timer"}),o.jsx("button",{onClick:()=>vs(!1),className:"text-slate-400 hover:text-white transition-colors",children:o.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Quick Presets"}),o.jsx("div",{className:"grid grid-cols-2 gap-2",children:["Break in 5 minutes","Technical difficulties","Starting soon","Please wait","Break time","Resuming shortly","Stall / Stretch Time","Wrap Up Please"].map(l=>o.jsx("button",{onClick:()=>lo(l),className:"px-3 py-2 bg-slate-700 hover:bg-slate-600 border border-slate-600 rounded text-white text-sm transition-colors text-left",children:l},l))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Custom Message"}),o.jsx("textarea",{value:Sr,onChange:l=>lo(l.target.value),placeholder:"Enter custom message to display on full screen timer...",className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500 text-sm h-24 resize-none"})]}),Sr&&o.jsx("div",{className:"p-3 bg-slate-700 rounded-lg",children:o.jsxs("div",{className:"text-slate-300 text-sm",children:[o.jsx("strong",{children:"Message Preview:"})," ",Sr]})})]}),o.jsxs("div",{className:"flex gap-3 mt-6",children:[o.jsx("button",{onClick:async()=>{if(!(!Sr.trim()||!r?.id))try{const g=(await be.getTimerMessagesForEvent(r.id)).filter(E=>E.enabled);for(const E of g)await be.disableTimerMessage(E.id),console.log("✅ Disabled existing message:",E.id);const v={event_id:r.id,message:Sr.trim(),enabled:!0,sent_by:i?.id,sent_by_name:i?.user_metadata?.full_name||i?.email||"Unknown User",sent_by_role:d||"VIEWER",message_type:"general",priority:2},w=await be.saveTimerMessage(v);if(!w){console.error("❌ Failed to save message to Supabase"),alert("Failed to save message. Please try again.");return}console.log("✅ New message created in Supabase:",w),ys(!0),Be&&!Be.closed&&Be.postMessage({type:"MESSAGE_UPDATE",message:Sr,enabled:!0},"*"),lo(""),vs(!1)}catch(l){console.error("❌ Error saving message:",l),alert("Error saving message. Please try again.")}},className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white font-medium rounded transition-colors",disabled:!Sr.trim()||!r?.id,children:"Send & Activate Message"}),o.jsx("button",{onClick:()=>vs(!1),className:"flex-1 px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white font-medium rounded transition-colors",children:"Cancel"})]})]})}),_r&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"bg-slate-800 rounded-lg max-w-md w-full max-h-[80vh] flex flex-col",children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-600",children:[o.jsx("h2",{className:"text-lg font-bold text-white",children:"Filter Columns"}),o.jsx("button",{onClick:()=>ia(!1),className:"text-slate-400 hover:text-white text-xl",children:"×"})]}),o.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:o.jsxs("div",{className:"space-y-3",children:[o.jsx("p",{className:"text-slate-300 text-sm mb-4",children:"Select which columns to display in the schedule:"}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("label",{className:"flex items-center gap-3",children:[o.jsx("input",{type:"checkbox",checked:ve.start,onChange:l=>It(g=>({...g,start:l.target.checked})),className:"rounded"}),o.jsx("span",{className:"text-white",children:"Start Time"})]}),o.jsxs("label",{className:"flex items-center gap-3",children:[o.jsx("input",{type:"checkbox",checked:ve.programType,onChange:l=>It(g=>({...g,programType:l.target.checked})),className:"rounded"}),o.jsx("span",{className:"text-white",children:"Program Type"})]}),o.jsxs("label",{className:"flex items-center gap-3",children:[o.jsx("input",{type:"checkbox",checked:ve.duration,onChange:l=>It(g=>({...g,duration:l.target.checked})),className:"rounded"}),o.jsx("span",{className:"text-white",children:"Duration"})]}),o.jsxs("label",{className:"flex items-center gap-3",children:[o.jsx("input",{type:"checkbox",checked:ve.segmentName,onChange:l=>It(g=>({...g,segmentName:l.target.checked})),className:"rounded"}),o.jsx("span",{className:"text-white",children:"Segment Name"})]}),o.jsxs("label",{className:"flex items-center gap-3",children:[o.jsx("input",{type:"checkbox",checked:ve.shotType,onChange:l=>It(g=>({...g,shotType:l.target.checked})),className:"rounded"}),o.jsx("span",{className:"text-white",children:"Shot Type"})]}),o.jsxs("label",{className:"flex items-center gap-3",children:[o.jsx("input",{type:"checkbox",checked:ve.pptQA,onChange:l=>It(g=>({...g,pptQA:l.target.checked})),className:"rounded"}),o.jsx("span",{className:"text-white",children:"PPT/Q&A"})]}),o.jsxs("label",{className:"flex items-center gap-3",children:[o.jsx("input",{type:"checkbox",checked:ve.notes,onChange:l=>It(g=>({...g,notes:l.target.checked})),className:"rounded"}),o.jsx("span",{className:"text-white",children:"Notes"})]}),o.jsxs("label",{className:"flex items-center gap-3",children:[o.jsx("input",{type:"checkbox",checked:ve.assets,onChange:l=>It(g=>({...g,assets:l.target.checked})),className:"rounded"}),o.jsx("span",{className:"text-white",children:"Assets"})]}),o.jsxs("label",{className:"flex items-center gap-3",children:[o.jsx("input",{type:"checkbox",checked:ve.participants,onChange:l=>It(g=>({...g,participants:l.target.checked})),className:"rounded"}),o.jsx("span",{className:"text-white",children:"Participants"})]}),o.jsxs("label",{className:"flex items-center gap-3",children:[o.jsx("input",{type:"checkbox",checked:ve.speakers,onChange:l=>It(g=>({...g,speakers:l.target.checked})),className:"rounded"}),o.jsx("span",{className:"text-white",children:"Speakers"})]}),o.jsxs("label",{className:"flex items-center gap-3",children:[o.jsx("input",{type:"checkbox",checked:ve.public,onChange:l=>It(g=>({...g,public:l.target.checked})),className:"rounded"}),o.jsx("span",{className:"text-white",children:"Public"})]}),ue.map((l,g)=>o.jsxs("label",{className:"flex items-center gap-3",children:[o.jsx("input",{type:"checkbox",checked:Ss[l.id]!==!1,onChange:v=>_s(w=>({...w,[l.id]:v.target.checked})),className:"rounded"}),o.jsxs("span",{className:"text-white",children:[l.name,o.jsx("span",{className:"text-slate-400 text-xs ml-2",children:"(Custom)"})]})]},l.id))]})]})}),o.jsx("div",{className:"p-4 border-t border-slate-600",children:o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:()=>{It({start:!0,programType:!0,duration:!0,segmentName:!0,shotType:!0,pptQA:!0,notes:!0,assets:!0,participants:!1,speakers:!0,public:!0,custom:!0});const l={};ue.forEach(g=>{l[g.id]=!0}),_s(l)},className:"px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white font-medium rounded transition-colors text-sm",children:"Show All"}),o.jsx("button",{onClick:()=>{It({start:!1,programType:!1,duration:!1,segmentName:!1,shotType:!1,pptQA:!1,notes:!1,assets:!1,participants:!1,speakers:!1,public:!1,custom:!1});const l={};ue.forEach(g=>{l[g.id]=!1}),_s(l)},className:"px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white font-medium rounded transition-colors text-sm",children:"Hide All"}),o.jsx("button",{onClick:()=>ia(!1),className:"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white font-medium rounded transition-colors text-sm",children:"Apply Filters"})]})})]})}),un&&o.jsx("div",{className:"fixed bottom-6 left-1/2 transform -translate-x-1/2 z-50",children:o.jsxs("div",{className:`px-6 py-4 rounded-lg shadow-lg border-2 flex items-center gap-3 ${Zt==="early"?"bg-yellow-600 border-yellow-500 text-yellow-100":Zt==="late"?"bg-red-600 border-red-500 text-red-100":"bg-green-600 border-green-500 text-green-100"}`,children:[o.jsx("div",{className:"text-3xl flex-shrink-0",children:Zt==="early"?"⏰":Zt==="late"?"⚠️":"✅"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-bold text-lg mb-1",children:Zt==="early"?"EARLY":Zt==="late"?"RUNNING LATE":"ON TIME"}),o.jsxs("div",{className:"text-base font-medium",children:[o.jsx("span",{className:"text-2xl font-bold",children:Ar>=60?`${Math.floor(Ar/60)}h ${Ar%60}m`:`${Ar}m`}),Zt==="early"?` before ${Object.keys(Oe).length>0&&C.find(l=>l.id===parseInt(Object.keys(Oe)[0]))?.customFields.cue||"CUE"} start`:Zt==="late"?` after ${Object.keys(Oe).length>0&&C.find(l=>l.id===parseInt(Object.keys(Oe)[0]))?.customFields.cue||"CUE"} start`:" - Timing is on track"]})]}),o.jsx("button",{onClick:()=>hr(!1),className:"ml-4 text-xl hover:opacity-70 transition-opacity",children:"×"})]})}),o.jsx(zv,{isOpen:dr,onClose:()=>ci(!1),event:r,schedule:C,activeItemId:ke,activeTimers:Oe,onLoadCue:async l=>{const g=parseInt(l);isNaN(g)||await Ni(g)},onStartTimer:async l=>{if(l==="generic")ke?(console.log("🎯 Generic start - controlling currently loaded item:",ke),await Bn(ke)):console.log("❌ No item currently loaded for generic start");else{const g=parseInt(l);isNaN(g)||await Bn(g)}},onStopTimer:async l=>{if(l==="generic"){const g=Object.keys(Oe);if(g.length>0){const v=parseInt(g[0]);console.log("🎯 Generic stop - controlling currently running timer:",v),await Bn(v)}else console.log("❌ No timer currently running for generic stop")}else{const g=parseInt(l);isNaN(g)||await Bn(g)}},onResetTimer:async l=>{if(l==="generic")console.log("🎯 Generic reset - using resetAllStates (same as Reset button)"),await Ds();else{const g=parseInt(l);isNaN(g)||await Ti(g)}}}),co&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"bg-slate-800 rounded-lg p-8 w-full max-w-7xl max-h-[95vh] overflow-hidden flex flex-col",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-white",children:"Backup Management"}),o.jsx("button",{onClick:()=>la(!1),className:"text-slate-400 hover:text-white text-2xl font-bold",children:"✕"})]}),o.jsx("div",{className:"bg-blue-900 border border-blue-600 rounded-lg p-4 mb-6",children:o.jsxs("div",{className:"flex items-start",children:[o.jsx("div",{className:"text-blue-400 text-xl mr-3",children:"ℹ️"}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-blue-200 font-semibold mb-1",children:"Manual Backup Only"}),o.jsx("p",{className:"text-blue-100 text-sm",children:'Automatic backups have been disabled to prevent interference with the main run of show. Use the "💾 Create Backup" button in the main interface to create backups when needed.'})]})]})}),o.jsxs("div",{className:"bg-slate-700 rounded-lg p-6 mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Filter & Search"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-base font-medium mb-3",children:"Search by Event Name"}),o.jsx("input",{type:"text",placeholder:"Filter by event name...",className:"w-full px-4 py-3 bg-slate-600 border border-slate-500 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:border-blue-500 text-base",onChange:l=>{}})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-base font-medium mb-3",children:"Filter by Date"}),o.jsx("input",{type:"date",className:"w-full px-4 py-3 bg-slate-600 border border-slate-500 rounded-lg text-white focus:outline-none focus:border-blue-500 text-base",onChange:l=>{}})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-slate-300 text-base font-medium mb-3",children:"Sort by"}),o.jsxs("select",{className:"w-full px-4 py-3 bg-slate-600 border border-slate-500 rounded-lg text-white focus:outline-none focus:border-blue-500 text-base",children:[o.jsx("option",{value:"newest",children:"Newest First"}),o.jsx("option",{value:"oldest",children:"Oldest First"}),o.jsx("option",{value:"event",children:"Event Name"}),o.jsx("option",{value:"type",children:"Backup Type"})]})]})]})]}),o.jsxs("div",{className:"bg-slate-700 rounded-lg p-6 flex-1 overflow-hidden flex flex-col",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h3",{className:"text-xl font-semibold text-white",children:"Available Backups"}),o.jsx("button",{onClick:bo,className:"px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white text-base font-medium rounded-lg transition-colors",children:"🔄 Refresh"})]}),o.jsx("div",{className:"flex-1 overflow-y-auto",children:xs.length===0?o.jsx("div",{className:"text-slate-400 text-center py-12 text-lg",children:'No backups available. Use the "💾 Create Backup" button in the main interface to create a manual backup.'}):o.jsx("div",{className:"space-y-4",children:xs.map(l=>o.jsxs("div",{className:"bg-slate-600 p-6 rounded-lg flex justify-between items-center hover:bg-slate-500 transition-colors",children:[o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"text-white font-semibold text-xl mb-2 flex items-center gap-3",children:[l.backup_name,o.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${l.backup_type==="auto"?"bg-blue-600 text-blue-100":"bg-green-600 text-green-100"}`,children:l.backup_type})]}),o.jsxs("div",{className:"text-slate-400 text-sm",children:[o.jsx("strong",{children:"Event Date:"})," ",l.event_data?.date?new Date(l.event_data.date).toLocaleDateString():"N/A"," •",o.jsx("strong",{children:" Schedule Items:"})," ",l.schedule_data?.length||0," •",o.jsx("strong",{children:" Custom Columns:"})," ",l.custom_columns_data?.length||0]})]}),o.jsxs("div",{className:"flex space-x-3",children:[o.jsx("button",{onClick:()=>ec(l),className:"px-6 py-3 bg-green-600 hover:bg-green-500 text-white text-base font-medium rounded-lg transition-colors",title:"Preview and load this backup",children:"🔄 Load/Overwrite"}),o.jsx("button",{onClick:()=>rc(l.id),className:"px-5 py-3 bg-red-600 hover:bg-red-500 text-white text-base font-medium rounded-lg transition-colors",title:"Delete this backup",children:"🗑️ Delete"})]})]},l.id))})})]})]})}),Fl&&Wt&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"bg-slate-800 rounded-lg p-8 w-full max-w-2xl",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-white",children:"Confirm Backup Restore"}),o.jsx("button",{onClick:()=>ho(!1),className:"text-slate-400 hover:text-white text-2xl font-bold",children:"✕"})]}),o.jsxs("div",{className:"bg-slate-700 rounded-lg p-6 mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Backup Details"}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-slate-300",children:"Backup Name:"}),o.jsx("span",{className:"text-white font-medium",children:Wt.backup_name})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-slate-300",children:"Event:"}),o.jsx("span",{className:"text-white font-medium",children:Wt.event_data?.name||"Unknown"})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-slate-300",children:"Date:"}),o.jsx("span",{className:"text-white font-medium",children:new Date(Wt.backup_timestamp).toLocaleString()})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-slate-300",children:"Type:"}),o.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${Wt.backup_type==="auto"?"bg-blue-600 text-blue-100":"bg-green-600 text-green-100"}`,children:Wt.backup_type})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-slate-300",children:"Schedule Items:"}),o.jsx("span",{className:"text-white font-medium",children:Wt.schedule_data?.length||0})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-slate-300",children:"Custom Columns:"}),o.jsx("span",{className:"text-white font-medium",children:Wt.custom_columns_data?.length||0})]})]})]}),o.jsx("div",{className:"bg-yellow-900 border border-yellow-600 rounded-lg p-4 mb-6",children:o.jsxs("div",{className:"flex items-start",children:[o.jsx("div",{className:"text-yellow-400 text-xl mr-3",children:"⚠️"}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-yellow-200 font-semibold mb-2",children:"Warning"}),o.jsx("p",{className:"text-yellow-100 text-sm",children:"This will completely overwrite your current run of show data with the backup data. This action cannot be undone. Make sure you want to proceed."})]})]})}),o.jsxs("div",{className:"flex justify-end space-x-4",children:[o.jsx("button",{onClick:()=>ho(!1),className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white text-base font-medium rounded-lg transition-colors",children:"Cancel"}),o.jsx("button",{onClick:tc,className:"px-6 py-3 bg-green-600 hover:bg-green-500 text-white text-base font-medium rounded-lg transition-colors",children:"🔄 Confirm Restore"})]})]})})]}):o.jsx("div",{className:"min-h-screen bg-slate-900 text-white flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h1",{className:"text-2xl font-bold mb-4",children:"No Event Selected"}),o.jsx("button",{onClick:()=>n("/"),className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded",children:"Back to Event List"})]})})},Hv=({isRunning:u=!1,elapsedTime:n=0,totalDuration:r=0,onClose:a,message:i="",messageEnabled:h=!1,itemId:d,eventId:p,mainTimer:y=null,secondaryTimer:x=null})=>{const[S,N]=_.useState({elapsed:n,total:r}),[R,L]=_.useState(new Date),[F,B]=_.useState(!1),[I,Z]=_.useState(null),[Y,H]=_.useState(!1);_.useEffect(()=>{N({elapsed:n,total:r})},[n,r]),_.useEffect(()=>{const C=setInterval(()=>{L(new Date)},1e3);return()=>clearInterval(C)},[]),_.useEffect(()=>{const C=()=>{B(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",C),()=>document.removeEventListener("fullscreenchange",C)},[]),_.useEffect(()=>{if(!p)return;const C=async()=>{H(!0);try{const ue=await be.getTimerMessage(p);Z(ue),console.log("📨 Loaded timer message from Supabase:",ue)}catch(ue){console.error("❌ Error loading timer message:",ue)}finally{H(!1)}};C();const re=setInterval(C,5e3);return()=>clearInterval(re)},[p]);const q=C=>{const re=C<0,ue=Math.abs(C),Ee=Math.floor(ue/3600),fe=Math.floor(ue%3600/60),me=Math.floor(ue%60),pe=re?"-":"";return Ee===0?`${pe}${fe.toString().padStart(2,"0")}:${me.toString().padStart(2,"0")}`:`${pe}${Ee.toString().padStart(2,"0")}:${fe.toString().padStart(2,"0")}:${me.toString().padStart(2,"0")}`},J=C=>C.toLocaleTimeString("en-US",{hour12:!0,hour:"2-digit",minute:"2-digit",second:"2-digit"}),P=()=>{const C=S;return C.total-C.elapsed},V=()=>{const C=S,re=C.total-C.elapsed;return C.total>0?re/C.total*100:0},te=()=>{const C=S,re=C.total-C.elapsed;return re>120?"#10b981":re>30?"#f59e0b":"#ef4444"};return o.jsxs("div",{className:"fixed inset-0 bg-black text-white overflow-hidden flex flex-col items-center justify-center",style:{padding:0,margin:0},children:[o.jsxs("div",{className:"absolute top-10 left-10 text-3xl font-mono text-white",children:[o.jsx("div",{className:"text-slate-400 text-lg mb-1",children:"CURRENT TIME"}),o.jsx("div",{className:"text-white",children:J(R)})]}),o.jsxs("div",{className:"absolute top-10 right-10 text-3xl font-mono text-white",children:[o.jsx("div",{className:"text-slate-400 text-lg mb-1",children:"CURRENT CUE"}),o.jsxs("div",{className:"text-white flex items-center gap-3",children:[o.jsx("span",{children:y?`${y.cue}${y.segmentName?` - ${y.segmentName}`:""}`:"No CUE"}),d&&o.jsx(um,{itemId:d,className:"flex-shrink-0"})]})]}),!F&&o.jsx("button",{onClick:()=>{document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen()},className:"absolute top-10 left-1/2 transform -translate-x-1/2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-bold text-lg transition-colors z-50",children:"FULL SCREEN"}),(h&&i||I&&I.enabled)&&o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:o.jsx("div",{className:"font-bold text-white bg-black bg-opacity-50 rounded-lg border-4 border-white text-center flex items-center justify-center",style:{width:"80vw",height:"50vh",lineHeight:"1.1",whiteSpace:"pre-line",overflow:"hidden",paddingBottom:"20px"},children:(()=>{const C=I?.message||i,re=C.split(" ");let ue;if(re.length<=3)ue=C;else if(re.length<=6){const me=Math.ceil(re.length/2);ue=re.slice(0,me).join(" ")+`
`+re.slice(me).join(" ")}else if(re.length<=10){const me=Math.ceil(re.length/3);ue=re.slice(0,me).join(" ")+`
`+re.slice(me,me*2).join(" ")+`
`+re.slice(me*2).join(" ")}else{const me=Math.ceil(re.length/4);ue=re.slice(0,me).join(" ")+`
`+re.slice(me,me*2).join(" ")+`
`+re.slice(me*2,me*3).join(" ")+`
`+re.slice(me*3).join(" ")}let Ee;const fe=/[gjpqy]/.test(C.toLowerCase());return re.length<=3?Ee=fe?"clamp(3rem, 12vw, 16rem)":"clamp(3.5rem, 13.5vw, 18rem)":re.length<=6?Ee=fe?"clamp(1.9rem, 8vw, 12rem)":"clamp(2.25rem, 9vw, 13.5rem)":re.length<=10?Ee=fe?"clamp(1.4rem, 6vw, 9rem)":"clamp(1.6rem, 7vw, 10.5rem)":Ee=fe?"clamp(0.9rem, 4vw, 6rem)":"clamp(1.1rem, 5vw, 7rem)",o.jsx("div",{style:{fontSize:Ee},children:ue})})()})}),x&&o.jsxs("div",{className:`absolute animate-in fade-in duration-500 ${h&&i||I&&I.enabled?"bottom-20 right-1/3 transform translate-x-1/2 flex flex-col items-center":"inset-0 flex flex-col items-center justify-center"}`,style:{marginTop:h&&i||I&&I.enabled?"0":"-80px"},children:[o.jsxs("div",{className:`text-orange-400 font-bold animate-in slide-in-from-top duration-500 ${h&&i||I&&I.enabled?"text-lg md:text-xl lg:text-2xl mb-2":"text-xl md:text-2xl lg:text-3xl mb-4"}`,style:{lineHeight:"1.2"},children:[x.cue,x.segmentName&&` - ${x.segmentName}`]}),o.jsx("div",{className:`text-orange-400 font-mono font-bold animate-in zoom-in duration-500 ${(()=>{const C=Math.floor(x.remaining/3600);return h&&i||I&&I.enabled?"text-3xl md:text-4xl lg:text-5xl":C===0?"text-[15rem] md:text-[16.875rem] lg:text-[22.5rem]":"text-[12rem] md:text-[13.5rem] lg:text-[18rem]"})()}`,style:{lineHeight:"1"},children:(()=>{const C=Math.floor(x.remaining/3600),re=Math.floor(x.remaining%3600/60),ue=x.remaining%60;return C===0?`${re.toString().padStart(2,"0")}:${ue.toString().padStart(2,"0")}`:`${C.toString().padStart(2,"0")}:${re.toString().padStart(2,"0")}:${ue.toString().padStart(2,"0")}`})()})]}),!x&&!(h&&i||I&&I.enabled)&&o.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center",children:[P()<0&&o.jsx("div",{className:"mb-[-50px]",children:o.jsx("div",{className:"font-bold text-red-500 text-5xl",children:"OVER TIME"})}),o.jsx("div",{className:"text-center",children:o.jsx("div",{className:`font-mono font-bold ${(()=>{const C=P();return Math.floor(Math.abs(C)/3600)===0?"text-[15rem] md:text-[16.875rem] lg:text-[22.5rem]":"text-[12rem] md:text-[13.5rem] lg:text-[18rem]"})()}`,style:{color:te()},children:q(P())})}),o.jsx("div",{className:"w-full max-w-5xl mt-0",children:o.jsx("div",{className:"w-full bg-slate-700 rounded-full overflow-hidden border-3 border-slate-600 relative h-8",children:o.jsx("div",{className:"h-full transition-all duration-1000 absolute top-0 right-0",style:{width:`${V()}%`,background:te()}})})})]}),(h&&i||I&&I.enabled)&&!x&&o.jsxs("div",{className:"text-center transition-all duration-500 ease-in-out absolute bottom-20 left-1/2 transform -translate-x-1/2",children:[P()<0&&o.jsx("div",{className:"mb-2",children:o.jsx("div",{className:"font-bold text-red-500 text-lg md:text-xl lg:text-2xl",children:"OVER TIME"})}),o.jsx("div",{className:"font-mono font-bold transition-all duration-500 ease-in-out text-3xl md:text-4xl lg:text-5xl",style:{color:te()},children:q(P())})]}),x&&!(h&&i||I&&I.enabled)&&o.jsxs("div",{className:"text-center transition-all duration-500 ease-in-out absolute bottom-20 left-1/2 transform -translate-x-1/2",children:[P()<0&&o.jsx("div",{className:"mb-2",children:o.jsx("div",{className:"font-bold text-red-500 text-lg md:text-xl lg:text-2xl",children:"OVER TIME"})}),o.jsx("div",{className:"font-mono font-bold transition-all duration-500 ease-in-out text-3xl md:text-4xl lg:text-5xl",style:{color:te()},children:q(P())})]}),(h&&i||I&&I.enabled)&&!x&&o.jsx("div",{className:"w-full transition-all duration-500 ease-in-out absolute bottom-8 left-1/2 transform -translate-x-1/2 max-w-2xl",children:o.jsx("div",{className:"w-full bg-slate-700 rounded-full overflow-hidden border-3 border-slate-600 relative h-2",children:o.jsx("div",{className:"h-full transition-all duration-1000 absolute top-0 right-0",style:{width:`${V()}%`,background:te()}})})}),x&&!(h&&i||I&&I.enabled)&&o.jsx("div",{className:"w-full transition-all duration-500 ease-in-out absolute bottom-8 left-1/2 transform -translate-x-1/2 max-w-2xl",children:o.jsx("div",{className:"w-full bg-slate-700 rounded-full overflow-hidden border-3 border-slate-600 relative h-2",children:o.jsx("div",{className:"h-full transition-all duration-1000 absolute top-0 right-0",style:{width:`${V()}%`,background:te()}})})})]})},qv=()=>{const u=vr();Zo();const n=u.state||{},[r,a]=_.useState(n.isRunning||!1),[i,h]=_.useState(n.elapsedTime||0),[d,p]=_.useState(n.totalDuration||0),[y,x]=_.useState(""),[S,N]=_.useState(!1),[R,L]=_.useState(null),[F,B]=_.useState(n.itemId||null),[I,Z]=_.useState(n.eventId||null),[Y,H]=_.useState(n.mainTimer||null),[q,J]=_.useState(n.secondaryTimer||null);_.useEffect(()=>{const V=te=>{switch(te.key){case"Escape":window.close();break;case" ":te.preventDefault(),a(!r);break;case"r":case"R":(te.ctrlKey||te.metaKey)&&(te.preventDefault(),h(0),a(!1));break;case"+":case"=":(te.ctrlKey||te.metaKey)&&te.preventDefault();break;case"-":(te.ctrlKey||te.metaKey)&&te.preventDefault();break}};return window.addEventListener("keydown",V),()=>window.removeEventListener("keydown",V)},[r]);const P=async()=>{if(I&&(S||R))try{const te=(await be.getTimerMessagesForEvent(I)).find(C=>C.enabled);te&&(await be.disableTimerMessage(te.id),console.log("✅ Message disabled in Supabase on close"))}catch(V){console.error("❌ Error clearing message on close:",V)}window.close()};return _.useEffect(()=>{if(!I)return;const V=async()=>{try{const C=await be.getTimerMessage(I);L(C),console.log("📨 Loaded timer message from Supabase:",C)}catch(C){console.error("❌ Error loading timer message:",C)}};V();const te=setInterval(V,5e3);return()=>clearInterval(te)},[I]),_.useEffect(()=>{const V=te=>{if(te.data.type==="TIMER_UPDATE"){const{isRunning:C,elapsedTime:re,totalDuration:ue,eventId:Ee,itemId:fe,mainTimer:me,secondaryTimer:pe}=te.data;C!==void 0&&a(C),re!==void 0&&h(re),ue!==void 0&&p(ue),Ee!==void 0&&Z(Ee),fe!==void 0&&B(fe),me!==void 0&&H(me),pe!==void 0&&J(pe)}else if(te.data.type==="MESSAGE_UPDATE"){const{message:C,enabled:re}=te.data;C!==void 0&&x(C),re!==void 0&&N(re)}};return window.addEventListener("message",V),()=>window.removeEventListener("message",V)},[]),o.jsx(Hv,{isRunning:r,elapsedTime:i,totalDuration:d,onClose:P,message:y,messageEnabled:S,itemId:F,eventId:I,supabaseMessage:R,mainTimer:Y,secondaryTimer:q})},Kv=()=>{const u=vr();Zo();const n=new URLSearchParams(u.search),r=n.get("eventId"),a=n.get("eventName"),i=u.state?.event||{id:r||"",name:a||"Current Event",date:"",location:"",schedule:[]},[h,d]=_.useState([]),[p,y]=_.useState(null),[x,S]=_.useState(!0),[N,R]=_.useState(null),[L,F]=_.useState(!1);_.useEffect(()=>{(async()=>{console.log("=== GRAPHICS LINKS PAGE INITIALIZATION ==="),console.log("Event from location.state:",u.state?.event),console.log("Event from URL params:",{eventId:r,eventName:a}),console.log("Final event object:",i);try{if(i?.id){console.log("🔄 Loading from Supabase for event:",i.id);const V=await be.getRunOfShowData(i.id);if(V){console.log("✅ Loaded from Supabase:",V),console.log("Schedule items from Supabase:",V.schedule_items?.length||0),console.log("Sample schedule item:",V.schedule_items?.[0]),d(V.schedule_items||[]),y(V.updated_at||null),S(!1);return}}console.log("📱 Falling back to localStorage...");let P=null;if(i?.id){const V=`runOfShowSchedule_${i.id}`;P=localStorage.getItem(V)}if(!P&&r){const V=`runOfShowSchedule_${r}`;P=localStorage.getItem(V)}if(!P){const te=Object.keys(localStorage).filter(C=>C.startsWith("runOfShowSchedule_"));if(te.length>0){const C=te[te.length-1];P=localStorage.getItem(C)}}if(P){const V=JSON.parse(P);console.log("📱 Loaded from localStorage:",V),d(V)}}catch(P){console.error("❌ Error loading initial data:",P)}finally{S(!1)}})()},[i?.id,r]),_.useEffect(()=>{if(!i?.id){console.log("❌ No event ID, skipping change detection");return}console.log("🔄 Starting change detection for Graphics Links page");const J=async()=>{try{console.log("🔄 Checking for changes in Graphics Links...");const V=await be.checkForChanges(i.id,p??void 0);if(V.hasChanges){console.log("🔄 Changes detected in Graphics Links:",V),F(!0);const te=await be.loadChangesDynamically(i.id);te&&(console.log("📥 Loading updated data for Graphics Links:",te),console.log("📥 Updated schedule items:",te.schedule_items?.length||0),console.log("📥 Sample updated item:",te.schedule_items?.[0]),d(te.schedule_items||[]),y(te.updated_at||null),R(new Date),console.log("✅ Graphics Links data updated")),F(!1)}else console.log("✅ No changes detected in Graphics Links")}catch(V){console.error("❌ Error checking for changes in Graphics Links:",V)}};J();const P=setInterval(J,5e3);return()=>clearInterval(P)},[i?.id,p]),_.useEffect(()=>{const J=()=>{console.log("🔄 localStorage changed, updating schedule...");let V=null;if(i?.id){const te=`runOfShowSchedule_${i.id}`;V=localStorage.getItem(te)}if(!V&&r){const te=`runOfShowSchedule_${r}`;V=localStorage.getItem(te)}if(!V){const C=Object.keys(localStorage).filter(re=>re.startsWith("runOfShowSchedule_"));if(C.length>0){const re=C[C.length-1];V=localStorage.getItem(re)}}if(V)try{F(!0);const te=JSON.parse(V);console.log("📝 Updated schedule from localStorage:",te),console.log("📝 Schedule items count:",te.length),console.log("📝 Sample item with speakers:",te.find(C=>C.speakersText)),d(te),R(new Date),F(!1)}catch(te){console.log("Error parsing updated schedule:",te),F(!1)}};window.addEventListener("storage",J),window.addEventListener("scheduleUpdated",J);const P=setInterval(()=>{console.log("🔍 Polling for schedule changes..."),J()},1e3);return()=>{window.removeEventListener("storage",J),window.removeEventListener("scheduleUpdated",J),clearInterval(P)}},[i?.id,r]);const B=()=>{console.log("=== GRAPHICS LINKS JSON GENERATION ==="),console.log("Using schedule from state:",h);let J="";const V=Object.keys(localStorage).filter(me=>me.startsWith("masterStartTime_"));if(console.log("Master time keys found:",V),V.length>0){const me=V[V.length-1],pe=localStorage.getItem(me);console.log("Master time data from key",me,":",pe),pe&&(J=pe)}console.log("Final masterStartTime:",J);const te=me=>{if(!J)return"";let pe=0;for(let $=0;$<me;$++){const M=h[$];pe+=M.durationHours*60+M.durationMinutes}const[$e,ee]=J.split(":").map(Number),X=new Date;return X.setHours($e,ee+pe,0,0),X.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})};console.log("=== FINAL DATA SUMMARY ==="),console.log("Schedule from state:",h),console.log("Final masterStartTime:",J),console.log("=== END FINAL DATA SUMMARY ===");const C=h.filter(me=>me.isPublic===!0).map(me=>{const pe=h.findIndex(ee=>ee.id===me.id),$e=te(pe);return{segmentName:me.segmentName||"Untitled Segment",startTime:$e||"No Start Time"}});console.log("Public items found:",C);const re={event:i?.name||"Current Event",generated:new Date().toISOString(),schedule:C},ue=JSON.stringify(re,null,2),Ee=new Blob([ue],{type:"application/json;charset=utf-8;"}),fe=URL.createObjectURL(Ee);window.open(fe,"_blank")},I=()=>{console.log("=== GENERATING LOWER THIRDS JSON ==="),console.log("Event ID from URL:",r),console.log("Event object:",i),console.log("Using schedule from state:",h),console.log("Schedule length:",h.length),console.log("First few items:",h.slice(0,3));const J=h.filter(fe=>fe.speakersText&&fe.speakersText.trim());console.log("Items with speakers data:",J.length),console.log("Items with speakers:",J.map(fe=>({segmentName:fe.segmentName,speakersText:fe.speakersText,speakersLength:fe.speakersText?.length||0}))),h.length===0&&(console.log("⚠️ NO SCHEDULE DATA FOUND!"),console.log("Available localStorage keys:",Object.keys(localStorage)),console.log("Looking for keys with event ID:",r));const V=Object.keys(localStorage).filter(fe=>fe.startsWith("masterStartTime_"));if(V.length>0){const fe=V[V.length-1];localStorage.getItem(fe)}const te={speaker1:[],speaker2:[],speaker3:[],speaker4:[],speaker5:[],speaker6:[],speaker7:[]};h.forEach((fe,me)=>{if(console.log("Processing item:",fe.segmentName,"Speakers:",fe.speakersText),console.log("Item details:",{id:fe.id,segmentName:fe.segmentName,speakersText:fe.speakersText,speakersTextLength:fe.speakersText?.length||0,speakersTextType:typeof fe.speakersText}),fe.speakersText&&fe.speakersText.trim())try{const pe=JSON.parse(fe.speakersText);console.log("Parsed speakers array:",pe),console.log("Speakers array length:",pe?.length||0);const $e=pe.sort((ee,X)=>ee.slot-X.slot);console.log("Sorted speakers by slot:",$e),$e.forEach(ee=>{const X=ee.slot,$=`speaker${X}`;if(X>=1&&X<=7){const M={row:me+1,cue:fe.customFields.cue||"",program:fe.programType||"",name:ee.fullName||"",titleOrg:ee.title&&ee.org?`${ee.title}
${ee.org}`:ee.title||ee.org||"",photo:ee.photoLink||""};console.log(`Adding to ${$} (slot ${X} in row ${me+1}):`,M),te[$].push(M)}else console.log(`Speaker slot ${X} (${ee.fullName}) is outside range 1-7, skipping`)})}catch(pe){console.log("Error parsing speakers JSON:",pe),console.log("Raw speakers data:",fe.speakersText)}else console.log("No speakers found in row:",fe.segmentName)}),console.log("Speaker sections:",te);const C={event:i?.name||"Current Event",generated:new Date().toISOString(),lowerThirds:te},re=JSON.stringify(C,null,2),ue=new Blob([re],{type:"application/json;charset=utf-8;"}),Ee=URL.createObjectURL(ue);window.open(Ee,"_blank"),console.log("=== END GENERATING LOWER THIRDS JSON ===")},Z=()=>{const P=`${window.location.origin}/lower-thirds-live.html?eventId=${r||i?.id}`;navigator.clipboard.writeText(P).then(()=>{alert(`Live URL copied to clipboard:
${P}

Use this URL in VMIX Data Sources → JSON/XML

This URL will automatically update every 10 seconds!`)}).catch(()=>{const V=document.createElement("textarea");V.value=P,document.body.appendChild(V),V.select(),document.execCommand("copy"),document.body.removeChild(V),alert(`Live URL copied to clipboard:
${P}

Use this URL in VMIX Data Sources → JSON/XML

This URL will automatically update every 10 seconds!`)})},Y=()=>{const P=`${window.location.origin}/schedule-live.html?eventId=${r||i?.id}`;navigator.clipboard.writeText(P).then(()=>{alert(`Live Schedule URL copied to clipboard:
${P}

Use this URL in VMIX Data Sources → JSON/XML

This URL will automatically update every 10 seconds!`)}).catch(()=>{const V=document.createElement("textarea");V.value=P,document.body.appendChild(V),V.select(),document.execCommand("copy"),document.body.removeChild(V),alert(`Live Schedule URL copied to clipboard:
${P}

Use this URL in VMIX Data Sources → JSON/XML

This URL will automatically update every 10 seconds!`)})},H=()=>{const P=`${window.location.origin}/custom-graphics-live.html?eventId=${r||i?.id}`;navigator.clipboard.writeText(P).then(()=>{alert(`Live Custom Graphics URL copied to clipboard:
${P}

Use this URL in VMIX Data Sources → JSON/XML

This URL will automatically update every 10 seconds!`)}).catch(()=>{const V=document.createElement("textarea");V.value=P,document.body.appendChild(V),V.select(),document.execCommand("copy"),document.body.removeChild(V),alert(`Live Custom Graphics URL copied to clipboard:
${P}

Use this URL in VMIX Data Sources → JSON/XML

This URL will automatically update every 10 seconds!`)})},q=()=>{let J="";const V=Object.keys(localStorage).filter(me=>me.startsWith("masterStartTime_"));if(V.length>0){const me=V[V.length-1],pe=localStorage.getItem(me);pe&&(J=pe)}const te=me=>{if(!J)return"";let pe=0;for(let $=0;$<me;$++){const M=h[$];pe+=M.durationHours*60+M.durationMinutes}const[$e,ee]=J.split(":").map(Number),X=new Date;return X.setHours($e,ee+pe,0,0),X.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})},C=h.filter(me=>me.isPublic).map(me=>({type:me.segmentName||"Segment",text:me.segmentName||"Custom Graphic",duration:`${me.durationHours.toString().padStart(2,"0")}:${me.durationMinutes.toString().padStart(2,"0")}:${me.durationSeconds.toString().padStart(2,"0")}`,cue:me.customFields.cue||"CUE##",startTime:te(h.findIndex(pe=>pe.id===me.id)),notes:me.notes||""})),re={event:i?.name||"Current Event",generated:new Date().toISOString(),customGraphics:C.length>0?C:[{type:"Title",text:"Welcome to Event",duration:"00:00:10",cue:"CUE01",startTime:"00:00:00",notes:"Opening title"},{type:"Break",text:"Commercial Break",duration:"00:02:00",cue:"CUE02",startTime:"00:15:00",notes:"Commercial break"}]},ue=JSON.stringify(re,null,2),Ee=new Blob([ue],{type:"application/json;charset=utf-8;"}),fe=URL.createObjectURL(Ee);window.open(fe,"_blank")};return o.jsxs("div",{className:"min-h-screen bg-slate-900 text-white pt-16",children:[o.jsx("div",{className:"bg-slate-800 border-b border-slate-700",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex items-center justify-between h-16",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx("button",{onClick:()=>{window.close()},className:"text-slate-300 hover:text-white transition-colors mr-6",children:"← Back to Run of Show"}),o.jsx("h1",{className:"text-xl font-semibold",children:"Graphics Links"})]}),o.jsx("div",{className:"text-slate-400",children:i?.name||"Event"})]})})}),o.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:o.jsxs("div",{className:"bg-slate-800 rounded-xl p-8 shadow-2xl",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-white",children:"Generate JSON Files"}),x&&o.jsx("p",{className:"text-blue-400 text-sm mt-1",children:"🔄 Loading data..."}),N&&!x&&o.jsxs("p",{className:"text-green-400 text-sm mt-1",children:["✅ Last updated: ",N.toLocaleTimeString()]}),L&&o.jsx("p",{className:"text-blue-400 text-sm mt-1",children:"🔄 Updating data..."})]}),o.jsx("button",{onClick:async()=>{console.log("🔄 Manual refresh triggered"),S(!0);try{if(i?.id){const P=await be.getRunOfShowData(i.id);if(P){d(P.schedule_items||[]),y(P.updated_at||null),console.log("✅ Refreshed from Supabase"),alert("Data refreshed from database!");return}}let J=null;if(i?.id){const P=`runOfShowSchedule_${i.id}`;J=localStorage.getItem(P)}if(!J&&r){const P=`runOfShowSchedule_${r}`;J=localStorage.getItem(P)}if(!J){const V=Object.keys(localStorage).filter(te=>te.startsWith("runOfShowSchedule_"));if(V.length>0){const te=V[V.length-1];J=localStorage.getItem(te)}}if(J){const P=JSON.parse(J);console.log("📝 Manually refreshed schedule:",P),d(P),alert("Data refreshed from local storage!")}else alert("No schedule data found")}catch(J){console.error("❌ Error refreshing data:",J),alert("Error refreshing data")}finally{S(!1)}},className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white font-medium rounded-lg transition-colors",children:"🔄 Refresh Data"})]}),o.jsxs("p",{className:"text-slate-300 mb-8",children:["Click the buttons below to generate .json files that VMIX can use as data sources for graphics systems.",o.jsx("span",{className:"text-green-400 font-medium",children:" ✨ This page now updates automatically when content changes!"}),`Use "Refresh Data" if changes don't appear automatically.`]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[o.jsxs("div",{className:"bg-slate-700 rounded-lg p-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Lower Thirds JSON"}),o.jsx("p",{className:"text-slate-300 text-sm mb-4",children:"Generate a .json file for lower third graphics with speaker information."}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("button",{onClick:I,className:"w-full px-4 py-3 bg-blue-600 hover:bg-blue-500 text-white font-medium rounded-lg transition-colors",children:"📄 Generate Static JSON"}),o.jsx("button",{onClick:Z,className:"w-full px-4 py-3 bg-green-600 hover:bg-green-500 text-white font-medium rounded-lg transition-colors",children:"🔄 Generate Live URL"})]})]}),o.jsxs("div",{className:"bg-slate-700 rounded-lg p-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Schedule JSON"}),o.jsx("p",{className:"text-slate-300 text-sm mb-4",children:"Generate a .json file with Segment Name and Start Time, sorted by time."}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("button",{onClick:B,className:"w-full px-4 py-3 bg-green-600 hover:bg-green-500 text-white font-medium rounded-lg transition-colors",children:"📄 Generate Static JSON"}),o.jsx("button",{onClick:Y,className:"w-full px-4 py-3 bg-emerald-600 hover:bg-emerald-500 text-white font-medium rounded-lg transition-colors",children:"🔄 Generate Live URL"})]})]}),o.jsxs("div",{className:"bg-slate-700 rounded-lg p-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Custom Graphics JSON"}),o.jsx("p",{className:"text-slate-300 text-sm mb-4",children:"Generate a .json file for custom graphics and overlays."}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("button",{onClick:q,className:"w-full px-4 py-3 bg-purple-600 hover:bg-purple-500 text-white font-medium rounded-lg transition-colors",children:"📄 Generate Static JSON"}),o.jsx("button",{onClick:H,className:"w-full px-4 py-3 bg-violet-600 hover:bg-violet-500 text-white font-medium rounded-lg transition-colors",children:"🔄 Generate Live URL"})]})]})]}),o.jsxs("div",{className:"mt-8 p-4 bg-slate-600 rounded-lg",children:[o.jsx("h4",{className:"text-white font-semibold mb-2",children:"VMIX Data Source Information"}),o.jsx("p",{className:"text-slate-300 text-sm",children:'These .json files are designed for VMIX and will include only items marked as "Public":'}),o.jsxs("ul",{className:"text-slate-300 text-sm mt-2 ml-4 list-disc",children:[o.jsxs("li",{children:[o.jsx("strong",{children:"Schedule JSON:"})," Segment Name, Start Time (sorted by time)"]}),o.jsxs("li",{children:[o.jsx("strong",{children:"Lower Thirds JSON:"})," Name, Title, Organization, Segment, CUE"]}),o.jsxs("li",{children:[o.jsx("strong",{children:"Custom Graphics JSON:"})," Type, Text, Duration, CUE, Start Time, Notes"]})]}),o.jsx("div",{className:"mt-4 p-3 bg-blue-900 rounded-lg",children:o.jsxs("p",{className:"text-blue-200 text-sm",children:[o.jsx("strong",{children:"VMIX Setup:"})," Save the .json files to your server, then add the URLs in VMIX Data Sources → JSON/XML"]})})]})]})})]})},Gv=()=>{const u=vr();Zo();const n=new URLSearchParams(u.search),r=n.get("eventId"),a=n.get("eventName"),i=u.state?.event||{id:r||"",name:a||"Current Event",date:"",location:"",schedule:[]};console.log("ReportsPage event data:",{fromState:!!u.state?.event,eventId:r,eventName:a,finalEvent:i,userRole:localStorage.getItem("currentUserRole")});const[h,d]=_.useState([]),[p,y]=_.useState(""),[x,S]=_.useState("showfile"),[N,R]=_.useState(1);_.useEffect(()=>{console.log("=== REPORTS PAGE INITIALIZATION ==="),console.log("Event:",i);let H=null;if(i?.id){const V=`runOfShowSchedule_${i.id}`;H=localStorage.getItem(V)}if(!H&&r){const V=`runOfShowSchedule_${r}`;H=localStorage.getItem(V)}if(!H){const te=Object.keys(localStorage).filter(C=>C.startsWith("runOfShowSchedule_"));if(te.length>0){const C=te[te.length-1];H=localStorage.getItem(C)}}if(H)try{const V=JSON.parse(H);d(V),console.log("Schedule loaded:",V),console.log("First schedule item:",V[0]),console.log("Schedule item duration fields:",V[0]?{durationHours:V[0].durationHours,durationMinutes:V[0].durationMinutes,durationSeconds:V[0].durationSeconds}:"No items")}catch(V){console.log("Error parsing schedule:",V)}const J=Object.keys(localStorage).filter(V=>V.startsWith("masterStartTime_"));console.log("Master time keys found:",J);let P=null;if(i?.id&&(P=localStorage.getItem(`masterStartTime_${i.id}`),console.log(`Master time for event ${i.id}:`,P)),!P&&J.length>0){const V=J[J.length-1];P=localStorage.getItem(V),console.log("Latest master time key:",V,"Value:",P)}P?(y(P),console.log("Master start time set to:",P)):(console.log("No master start time found in localStorage"),y("09:00"),console.log("Set default master start time to 09:00"))},[i?.id,r]);const L=H=>{if(console.log(`calculateStartTime called with index: ${H}, masterStartTime: ${p}`),!p)return console.log("No master start time, returning empty string"),"";let q=0;for(let C=0;C<H;C++){const re=h[C];q+=re.durationHours*60+re.durationMinutes}console.log(`Total minutes for index ${H}: ${q}`);const[J,P]=p.split(":").map(Number),V=new Date;V.setHours(J,P+q,0,0);const te=V.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return console.log(`Calculated start time for index ${H}: ${te}`),te},F=H=>({"PreShow/End":"#8B5CF6","Podium Transition":"#8B4513","Panel Transition":"#404040","Sub Cue":"#F3F4F6","No Transition":"#059669",Video:"#F59E0B","Panel+Remote":"#1E40AF","Remote Only":"#60A5FA",Break:"#EC4899",TBD:"#6B7280",KILLED:"#DC2626",Podium:"#FFFFFF",Panel:"#FFFFFF"})[H]||"#D3D3D3",B=H=>H==="Panel Transition"||H==="Podium Transition"||H==="Panel"||H==="Podium"?"#FFFFFF":F(H),I=()=>{const H=x==="showfile",q=h.filter(J=>(J.day||1)===N);if(console.log("=== GENERATING REPORT ==="),console.log("Report type:",x),console.log("Selected day:",N),console.log("Total schedule items:",h.length),console.log("Filtered schedule items:",q.length),console.log("Sample item:",q[0]),console.log("Master start time:",p),q.length>0){const J=h.findIndex(V=>V.id===q[0].id),P=L(J);console.log("Test start time calculation:",{testIndex:J,testStartTime:P,item:q[0].segmentName})}if(H){let J=`
        <!DOCTYPE html>
        <html>
        <head>
          <title>ROS Show File - ${i?.name||"Event"}</title>
          <style>
            body { 
              font-family: Arial, sans-serif; 
              margin: 0; 
              padding: 15px;
              font-size: 11px;
              line-height: 1.3;
              background: white;
            }
            @media print {
              body { 
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
              }
              * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
              }
            }
            .header { 
              text-align: center; 
              margin-bottom: 15px; 
            }
            .header h1 { 
              font-size: 16px; 
              margin: 0; 
              color: #000;
              font-weight: normal;
            }
            .header h2 { 
              font-size: 12px; 
              margin: 3px 0 0 0; 
              color: #333; 
              font-weight: normal;
            }
            .event-info { 
              background: #f5f5f5; 
              padding: 8px; 
              margin-bottom: 12px; 
              font-size: 10px;
              border: 1px solid #ddd;
            }
            .section { 
              margin-bottom: 8px; 
              border: 1px solid #000;
              page-break-inside: avoid;
            }
            .section-header { 
              padding: 6px 8px; 
              font-weight: normal; 
              font-size: 11px;
              color: white;
              background: #366092;
              border-bottom: 1px solid #000;
            }
            .section-content { 
              padding: 0; 
              background: white;
            }
            .modal-table { 
              width: 100%;
              border-collapse: collapse;
              border: 2px solid #000;
              background: white;
            }
            .modal-table td { 
              border: 1px solid #000; 
              padding: 6px 8px; 
              background: white;
              vertical-align: top;
            }
            .modal-table .header-cell { 
              background: #d9d9d9; 
              font-weight: normal; 
              text-align: center;
              font-size: 10px;
              width: 70px;
              min-width: 70px;
            }
            .modal-table .segment-cell { 
              min-width: 180px;
              max-width: 250px;
              word-wrap: break-word;
              font-size: 11px;
            }
            .modal-table .notes-cell { 
              background: #f0f0f0; 
              min-height: 35px;
              min-width: 200px;
              font-size: 10px;
            }
            .modal-table .participants-cell { 
              background: #f0f0f0; 
              min-height: 60px;
              min-width: 250px;
            }
            .modal-table .start-time-cell { 
              background: #e7f3ff; 
              font-weight: normal;
              font-size: 12px;
            }
            .times-cell {
              background: #e7f3ff;
              font-weight: normal;
              text-align: center;
              vertical-align: middle;
              width: 80px;
              min-width: 80px;
            }
            .times-content {
              display: flex;
              flex-direction: column;
              gap: 2px;
            }
            .start-time {
              font-size: 11px;
              font-weight: normal;
              color: #000;
            }
            .duration {
              font-size: 11px;
              font-weight: normal;
              color: #000;
            }
            .time-label {
              font-size: 9px;
              font-weight: normal;
              color: #333;
              margin-right: 4px;
            }
            .simple-table { 
              width: 100%;
              border-collapse: collapse;
              border: 1px solid #000;
              background: white;
            }
            .simple-table td { 
              border: 1px solid #000; 
              padding: 8px; 
              background: white;
              vertical-align: top;
              font-size: 11px;
            }
        .simple-table .header-cell { 
          background: #d9d9d9; 
          font-weight: normal; 
          text-align: center;
          font-size: 10px;
        }
        .stacked-header {
          width: 250px;
        }
        .stacked-cell {
          width: 250px;
          max-width: 250px;
          vertical-align: top;
          padding: 8px;
        }
        .stacked-item {
          margin-bottom: 8px;
          padding-bottom: 6px;
          border-bottom: 1px solid #e0e0e0;
          display: flex;
          flex-direction: column;
        }
        .stacked-item:last-child {
          border-bottom: none;
          margin-bottom: 0;
          padding-bottom: 0;
        }
        .stacked-label {
          font-weight: normal;
          font-size: 9px;
          color: #333;
          margin-bottom: 3px;
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }
        .stacked-value {
          font-size: 10px;
          line-height: 1.3;
          word-wrap: break-word;
          color: #000;
          padding-left: 4px;
        }
        .slot-cell {
          width: 120px;
          height: 100px;
          vertical-align: top;
        }
        .slot-container {
          height: 100px;
          display: flex;
          flex-direction: column;
          justify-content: flex-start;
          padding: 4px;
        }
        .slot-name {
          font-weight: normal;
          font-size: 11px;
          line-height: 1.2;
        }
        .slot-title {
          font-size: 10px;
          line-height: 1.1;
          color: #666;
        }
        .slot-org {
          font-size: 10px;
          line-height: 1.1;
          color: #666;
        }
        .slot-photo {
          display: flex;
          align-items: center;
          justify-content: center;
          margin-top: 8px;
        }
        .slot-photo-img {
          width: 65px;
          height: 65px;
          object-fit: cover;
          border-radius: 4px;
          border: 1px solid #ccc;
        }
        .notes-header-row {
          background: #e0e0e0;
        }
        .notes-header-cell {
          padding: 6px 8px;
          font-size: 10px;
          font-weight: normal;
          text-align: center;
          border-top: 2px solid #ddd;
          background: #e0e0e0;
        }
        .notes-content-row {
          background: #f9f9f9;
        }
        .notes-content-cell {
          padding: 8px;
          font-size: 10px;
          line-height: 1.3;
          background: #f9f9f9;
        }
            .modal-cell .field-label { 
              font-weight: normal; 
              font-size: 11px; 
              color: #333; 
              margin-bottom: 4px;
            }
            .modal-cell .field-value { 
              font-size: 12px; 
              color: #000;
              line-height: 1.3;
            }
            .speaker-item { 
              display: flex; 
              align-items: center; 
              margin-bottom: 6px;
              padding: 6px;
              background: white;
              border: 1px solid #ddd;
              border-radius: 4px;
              box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            }
            .speaker-photo { 
              width: 40px; 
              height: 40px; 
              border-radius: 4px; 
              object-fit: cover; 
              border: 2px solid #007acc;
              margin-right: 10px;
              flex-shrink: 0;
            }
            .speaker-info { 
              flex: 1;
            }
            .speaker-badges { 
              display: flex; 
              gap: 4px;
              margin-bottom: 3px;
            }
            .speaker-name { 
              font-weight: normal; 
              font-size: 11px; 
              color: #000;
              margin-bottom: 2px;
            }
            .slot-badge { 
              background: #007acc; 
              color: white; 
              padding: 2px 6px; 
              border-radius: 6px; 
              font-size: 8px; 
              font-weight: normal;
            }
            .location-badge { 
              background: #28a745; 
              color: white; 
              padding: 2px 6px; 
              border-radius: 6px; 
              font-size: 8px; 
              font-weight: normal;
            }
            .speaker-title { 
              color: #666; 
              font-size: 10px;
              margin-bottom: 1px;
            }
            .speaker-org { 
              color: #888; 
              font-size: 9px;
            }
            .footer { 
              margin-top: 40px; 
              text-align: center; 
              color: #666; 
              font-size: 12px;
              border-top: 1px solid #ddd;
              padding-top: 20px;
            }
            @media print {
              body { margin: 0; }
              .no-print { display: none; }
              @page { 
                size: A4; 
                margin: 0.5in; 
              }
              .section { 
                page-break-inside: avoid;
              }
            }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>ROS SHOW FILE</h1>
            <h2>${i?.name||"Event"}${i?.numberOfDays&&i.numberOfDays>1?` - Day ${N}`:""}</h2>
          </div>
          
      `;return q.forEach((P,V)=>{const te=h.findIndex(pe=>pe.id===P.id),C=L(te),re=`${P.durationHours.toString().padStart(2,"0")}:${P.durationMinutes.toString().padStart(2,"0")}:${P.durationSeconds.toString().padStart(2,"0")}`,ue=F(P.programType||"");console.log(`SHOW FILE - Item ${V} (${P.segmentName}):`,{originalIndex:te,startTime:C,duration:re,masterStartTime:p,itemId:P.id});let Ee=[];if(P.speakersText)try{Ee=JSON.parse(P.speakersText),console.log(`Speakers parsed for item ${V}:`,Ee)}catch(pe){console.log(`Error parsing speakers for item ${V}:`,pe),Ee=[{fullName:P.speakersText,title:"",org:"",photoLink:""}]}else console.log(`No speakersText for item ${V}:`,P.segmentName);let fe="";P.hasPPT&&P.hasQA?fe="PPT + Q&A":P.hasPPT?fe="PPT":P.hasQA?fe="Q&A":fe="None",J+=`
          <div class="section">
            <div class="section-content">
              <table class="simple-table">
                <tr>
                  <td class="header-cell">CUE</td>
                  <td class="header-cell">TIME</td>
                  <td class="header-cell stacked-header">SEGMENT INFO</td>
                  <td class="header-cell">SLOT 1</td>
                  <td class="header-cell">SLOT 2</td>
                  <td class="header-cell">SLOT 3</td>
                  <td class="header-cell">SLOT 4</td>
                  <td class="header-cell">SLOT 5</td>
                  <td class="header-cell">SLOT 6</td>
                  <td class="header-cell">SLOT 7</td>
                </tr>
                <tr>
                  <td>
                    <div style="margin-bottom: 4px;">${P.customFields.cue||`CUE ${V+1}`}</div>
                    <div style="background-color: ${ue}; color: ${P.programType==="Sub Cue"?"black":"white"}; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: normal; display: inline-block; ${P.programType==="Sub Cue"?"border: 1px solid #000000;":""}">${P.programType||"Unknown"}</div>
                  </td>
                  <td class="times-cell">
                    <div class="times-content">
                      <div class="start-time">
                        <span class="time-label">Start:</span> ${C}
                      </div>
                      <div class="duration">
                        <span class="time-label">Dur:</span> ${re}
                      </div>
                    </div>
                  </td>
                  <td class="stacked-cell">
                    <div class="stacked-item">
                      <div class="stacked-label">SEGMENT:</div>
                      <div class="stacked-value">${P.segmentName||"Untitled Segment"}</div>
                    </div>
                    <div class="stacked-item">
                      <div class="stacked-label">SHOT:</div>
                      <div class="stacked-value">${P.shotType||"Not specified"}</div>
                    </div>
                    <div class="stacked-item">
                      <div class="stacked-label">PPT/Q&A:</div>
                      <div class="stacked-value">${fe}</div>
                    </div>
                  </td>
        `;const me=["","","","","","",""];Ee.length>0&&Ee.forEach(pe=>{const $e=pe.fullName||pe.name||"Unknown",ee=pe.title||"",X=pe.org||"",$=pe.slot||1,M=pe.location||"Podium",k=pe.photoLink||"";let ae=`
              <div class="slot-container">
                <div class="slot-name">${M==="Podium"?"P":M==="Seat"?"S":"V"}${$} - ${$e}</div>
                <div class="slot-title">${ee}</div>
                <div class="slot-org">${X}</div>
                <div class="slot-photo">${k?`<img src="${k}" alt="${$e}" class="slot-photo-img" />`:""}</div>
              </div>
            `;const he=Math.min($-1,6);he>=0&&he<7&&(me[he]=ae)});for(let pe=0;pe<7;pe++)J+=`<td class="slot-cell">${me[pe]||""}</td>`;J+=`
                </tr>
                <tr class="notes-header-row">
                  <td colspan="10" class="notes-header-cell">NOTES</td>
                </tr>
                <tr class="notes-content-row">
                  <td colspan="10" class="notes-content-cell">${P.notes||"None"}</td>
                </tr>
              </table>
            </div>
          </div>
        `}),J+=`
          <div class="footer">
            <p>Generated: ${new Date().toLocaleString()} | Run of Show Application</p>
          </div>
        </body>
        </html>
      `,J}else{let J=`
        <!DOCTYPE html>
        <html>
        <head>
          <title>Run of Show Report - ${i?.name||"Event"}</title>
          <style>
            body { 
              font-family: Arial, sans-serif; 
              margin: 20px; 
              font-size: 14px;
            }
            .header { 
              text-align: center; 
              margin-bottom: 30px; 
            }
            .header h1 { 
              font-size: 24px; 
              margin: 0; 
            }
            .header h2 { 
              font-size: 18px; 
              margin: 5px 0 0 0; 
              color: #666; 
            }
            .event-info { 
              background: #f5f5f5; 
              padding: 15px; 
              border-radius: 5px; 
              margin-bottom: 20px; 
              font-size: 12px;
            }
            table { 
              width: 100%; 
              border-collapse: collapse; 
              margin-top: 20px; 
            }
            th, td { 
              border: 1px solid #ddd; 
              padding: 8px; 
              text-align: left; 
              font-size: 12px;
            }
            th { 
              background-color: #f2f2f2; 
              font-weight: normal; 
            }
            tr { 
              -webkit-print-color-adjust: exact !important;
              color-adjust: exact !important;
              print-color-adjust: exact !important;
            }
            .footer { 
              margin-top: 30px; 
              text-align: center; 
              color: #666; 
              font-size: 12px;
            }
            @media print {
              body { margin: 0; }
              .no-print { display: none; }
              @page { 
                size: A4; 
                margin: 0.5in; 
              }
              tr { 
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
              }
            }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>RUN OF SHOW REPORT</h1>
            <h2>${i?.name||"Event"}${i?.numberOfDays&&i.numberOfDays>1?` - Day ${N}`:""}</h2>
            <h3>ROS CONDENSED</h3>
          </div>
          
          <div class="event-info">
            <p><strong>Event:</strong> ${i?.name||"Current Event"} | 
               <strong>Date:</strong> ${i?.date||"Not specified"} | 
               <strong>Location:</strong> ${i?.location||"Not specified"} | 
               <strong>Start Time:</strong> ${p||"Not set"} | 
               <strong>Total Items:</strong> ${h.length}</p>
          </div>
          
          <table>
            <thead>
              <tr>
                <th>CUE</th>
                <th>START</th>
                <th>DURATION</th>
                <th>SEGMENT</th>
                <th>SHOT TYPE</th>
                <th>PPT/Q&A</th>
                <th>PARTICIPANTS</th>
              </tr>
            </thead>
            <tbody>
      `;return q.forEach((P,V)=>{const te=h.findIndex(fe=>fe.id===P.id),C=L(te),re=`${P.durationHours.toString().padStart(2,"0")}:${P.durationMinutes.toString().padStart(2,"0")}:${P.durationSeconds.toString().padStart(2,"0")}`;F(P.programType||"");let ue="";if(P.speakersText)try{ue=JSON.parse(P.speakersText).map(me=>me.fullName||me.name||me).join(`
`)}catch{ue=P.speakersText}let Ee="";P.hasPPT&&P.hasQA?Ee="PPT + Q&A":P.hasPPT?Ee="PPT":P.hasQA?Ee="Q&A":Ee="",J+=`
          <tr style="background-color: ${B(P.programType)};">
            <td>${P.programType==="Sub Cue"?`<span style="background-color: #9CA3AF; color: white; padding: 2px 6px; border-radius: 4px; font-weight: bold;">${P.customFields?.cue||""}</span>`:P.programType==="Podium"||P.programType==="Podium Transition"?`<span style="background-color: #8B4513; color: white; padding: 2px 6px; border-radius: 4px; font-weight: bold;">${P.customFields?.cue||""}</span>`:P.programType==="Panel"||P.programType==="Panel Transition"?`<span style="background-color: #404040; color: white; padding: 2px 6px; border-radius: 4px; font-weight: bold;">${P.customFields?.cue||""}</span>`:P.customFields?.cue||""}</td>
            <td>${C}</td>
            <td>${re}</td>
            <td>${P.segmentName||"Untitled Segment"}</td>
            <td>${P.shotType||""}</td>
            <td>${Ee}</td>
            <td style="white-space: pre-line;">${ue}</td>
          </tr>
        `}),J+=`
            </tbody>
          </table>
          
          <div class="footer">
            <p>Generated: ${new Date().toLocaleString()} | Run of Show Application</p>
          </div>
        </body>
        </html>
      `,J}},Z=()=>{const H=I(),q=window.open("","_blank");q&&(q.document.write(H),q.document.close(),q.focus(),q.print())},Y=()=>{const H=I(),q=new Blob([H],{type:"text/html"}),J=URL.createObjectURL(q),P=document.createElement("a");P.href=J,P.download=`ros-${x==="showfile"?"show-file":"condensed"}${i?.numberOfDays&&i.numberOfDays>1?`-day-${N}`:""}-${i?.name?.replace(/\s+/g,"-")||"event"}-${new Date().toISOString().split("T")[0]}.html`,document.body.appendChild(P),P.click(),document.body.removeChild(P),URL.revokeObjectURL(J)};return o.jsxs("div",{className:"min-h-screen bg-slate-900 text-white pt-16",children:[o.jsx("div",{className:"bg-slate-800 border-b border-slate-700",children:o.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o.jsxs("div",{className:"flex items-center justify-between h-16",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx("button",{onClick:()=>{window.close()},className:"text-slate-300 hover:text-white transition-colors mr-6",children:"← Back to Run of Show"}),o.jsx("h1",{className:"text-xl font-semibold",children:"Reports and Printing"})]}),o.jsx("div",{className:"text-slate-400",children:i?.name||"Event"})]})})}),o.jsx("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:o.jsxs("div",{className:"bg-slate-800 rounded-xl p-8 shadow-2xl",children:[o.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Generate Reports"}),o.jsxs("div",{className:"bg-slate-700 rounded-lg p-6 mb-8",children:[o.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Report Options"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Report Type"}),o.jsxs("select",{value:x,onChange:H=>S(H.target.value),className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[o.jsx("option",{value:"showfile",children:"ROS Show File"}),o.jsx("option",{value:"condensed",children:"ROS CONDENSED"})]})]}),i?.numberOfDays&&i.numberOfDays>1&&o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Select Day"}),o.jsx("select",{value:N,onChange:H=>R(parseInt(H.target.value)),className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:Array.from({length:i.numberOfDays},(H,q)=>o.jsxs("option",{value:q+1,children:["Day ",q+1]},q+1))})]}),o.jsxs("div",{className:"text-slate-400 text-sm",children:[o.jsxs("p",{children:[o.jsx("strong",{children:"ROS Show File:"})," Section-based format with all details and speaker photos"]}),o.jsxs("p",{children:[o.jsx("strong",{children:"ROS CONDENSED:"})," Table format with all information"]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Color Coding:"})," Sections colored by program type"]})]})]})]}),o.jsxs("div",{className:"flex flex-wrap gap-4",children:[o.jsxs("button",{onClick:Z,className:"px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white font-medium rounded-lg transition-colors flex items-center gap-2",children:[o.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"Print Report"]}),o.jsxs("button",{onClick:Y,className:"px-6 py-3 bg-green-600 hover:bg-green-500 text-white font-medium rounded-lg transition-colors flex items-center gap-2",children:[o.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download Report"]})]}),o.jsxs("div",{className:"mt-8",children:[o.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Report Preview"}),o.jsx("div",{className:"bg-slate-700 rounded-lg p-4 max-h-96 overflow-y-auto",children:o.jsxs("div",{className:"text-slate-300 text-sm",children:[o.jsxs("p",{children:[o.jsx("strong",{children:"Event:"})," ",i?.name||"Current Event"]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Total Items:"})," ",h.length,i?.numberOfDays&&i.numberOfDays>1?` | <strong>Day ${N} Items:</strong> ${h.filter(H=>(H.day||1)===N).length}`:""]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Master Start Time:"})," ",p||"Not set"]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Report Type:"})," ",x==="showfile"?"ROS Show File":"ROS CONDENSED"]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Format:"})," ",x==="showfile"?"Section-based with speaker photos":"Table format"]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Color Coding:"})," Sections colored by program type"]})]})})]})]})})]})},Jv=()=>{const u=vr(),n=new URLSearchParams(u.search),r=n.get("eventId"),a=n.get("eventName"),i=n.get("eventDate"),h=n.get("eventLocation"),d=u.state?.event||{id:r||"",name:a||"Current Event",date:i||"",location:h||"",numberOfDays:1},[p,y]=_.useState([]),[x,S]=_.useState(new Date),[N,R]=_.useState(!0),[L,F]=_.useState(null),[B,I]=_.useState(null),[Z,Y]=_.useState({}),[H,q]=_.useState(null),[J,P]=_.useState({}),[V,te]=_.useState("09:00"),[C,re]=_.useState({}),ue=ee=>{if(console.log(`🔄 calculateStartTime called for index ${ee}:`,{masterStartTime:V,scheduleLength:p.length}),!V)return console.log("❌ No master start time, returning empty string"),"";let X=0;for(let Ae=0;Ae<ee;Ae++){const He=p[Ae],kt=He.durationHours*60+He.durationMinutes;X+=kt,console.log(`  Item ${Ae} (${He.segmentName}): ${He.durationHours}h ${He.durationMinutes}m = ${kt} total minutes`)}const[$,M]=V.split(":").map(Number),k=$*60+M,U=k+X,ae=Math.floor(U/60),he=U%60,De=ae>=12?"PM":"AM";let Pe=ae;ae>12&&(Pe=ae-12),ae===0&&(Pe=12);const Ve=`${Pe}:${he.toString().padStart(2,"0")} ${De}`;return console.log(`🔄 calculateStartTime result for index ${ee}:`,{masterStartTime:V,totalMinutes:X,totalStartMinutes:k,finalMinutes:U,hours:ae,minutes:he,period:De,displayHours:Pe,result:Ve}),Ve};_.useEffect(()=>{if(d?.id){console.log("🔍 Loading master start time for event ID:",d.id);const ee=localStorage.getItem(`masterStartTime_${d.id}`),X=localStorage.getItem(`dayStartTimes_${d.id}`);if(console.log("🔍 Raw localStorage values:",{masterStartTime:ee,dayStartTimes:X,eventId:d.id}),ee)te(ee),console.log("📥 Loaded master start time from localStorage:",ee);else{console.log("❌ No master start time found in localStorage for event:",d.id),console.log("🔍 Available localStorage keys:",Object.keys(localStorage).filter(U=>U.includes("masterStartTime"))),console.log("🔍 All localStorage keys:",Object.keys(localStorage));const $=Object.keys(localStorage).filter(U=>U.includes("masterStartTime")).map(U=>({key:U,value:localStorage.getItem(U)}));console.log("🔍 All master start times in localStorage:",$);let M=null;const k=$.find(U=>U.value&&U.value!=="09:00");k?(M=k,console.log("📥 Found non-default master start time:",k.value)):(M=$.find(U=>U.value),console.log("📥 Using first available master start time:",M?.value)),M&&M.value?(console.log("📥 Setting master start time to:",M.value),te(M.value)):(console.log("❌ No suitable master start time found in localStorage"),console.log("🔍 Will try to get master start time from Supabase data..."))}X?(re(JSON.parse(X)),console.log("📥 Loaded day start times from localStorage:",JSON.parse(X))):console.log("❌ No day start times found in localStorage for event:",d.id)}},[d?.id]),_.useEffect(()=>{const ee=setInterval(()=>{S(new Date)},1e3);return()=>clearInterval(ee)},[]);const Ee=async()=>{if(d?.id)try{console.log("🔄 Loading active timer for Green Room...");const ee=await be.getActiveTimer(d.id);ee?(console.log("🔄 Active timer found:",ee),console.log("🔄 Timer state:",ee.timer_state),console.log("🔄 Item ID:",ee.item_id),I(ee.item_id),q(ee.timer_state),P({[ee.item_id]:!0}),console.log("🔄 Set loaded items:",{[ee.item_id]:!0}),Y({[ee.item_id]:{elapsed:ee.elapsed_seconds||0,total:ee.duration_seconds||0,startedAt:ee.started_at?new Date(ee.started_at):null}})):(console.log("🔄 No active timer found"),I(null),q(null),P({}),Y({}))}catch(ee){console.error("❌ Error loading active timer:",ee)}};_.useEffect(()=>{if(!d?.id)return;Ee();const ee=setInterval(Ee,2e3);return()=>clearInterval(ee)},[d?.id]),_.useEffect(()=>{(async()=>{if(!d?.id){F("No event selected"),R(!1);return}try{console.log("🔄 Loading schedule for Green Room..."),console.log("🔄 Event details:",{id:d.id,name:d.name,location:d.location});const X=await be.getRunOfShowData(d.id);if(console.log("🔄 Raw data received:",X),X&&X.settings&&X.settings.masterStartTime&&V==="09:00"&&(console.log("📥 Found master start time in Supabase data:",X.settings.masterStartTime),te(X.settings.masterStartTime)),X?.schedule_items){const $=X.schedule_items.filter(k=>k.isPublic===!0);console.log("🔄 Public items found:",$.length);const M=$.map(k=>{console.log("🔄 Processing item:",{id:k.id,segmentName:k.segmentName,customFields:k.customFields,customFieldsKeys:k.customFields?Object.keys(k.customFields):"No customFields",durationHours:k.durationHours,durationMinutes:k.durationMinutes,durationSeconds:k.durationSeconds,allKeys:Object.keys(k)});const U=(k.durationHours||0)*60+(k.durationMinutes||0)+(k.durationSeconds||0)/60,ae=U>0?`${Math.round(U)} min`:"0 min",he=p.findIndex(Ve=>Ve.id===k.id),De=ue(he);let Pe=null;if(console.log(`🔄 Calculated start time for ${k.segmentName}:`,{itemIndex:he,startTime:De,masterStartTime:V,duration:U,itemDurationHours:k.durationHours,itemDurationMinutes:k.durationMinutes,itemDurationSeconds:k.durationSeconds}),De&&U>0){const Ve=new Date(`1970-01-01 ${De}`);Pe=new Date(Ve.getTime()+U*6e4).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0})}else Pe="TBD";return{...k,startTime:De,endTime:Pe,duration:ae,isPublic:k.isPublic||!1}});M.sort((k,U)=>{if(k.startTime&&k.startTime!=="TBD"&&U.startTime&&U.startTime!=="TBD"){const ae=new Date(`1970-01-01 ${k.startTime}`),he=new Date(`1970-01-01 ${U.startTime}`);return ae.getTime()-he.getTime()}return(!k.startTime||k.startTime==="TBD")&&U.startTime&&U.startTime!=="TBD"?1:k.startTime&&k.startTime!=="TBD"&&(!U.startTime||U.startTime==="TBD")?-1:0}),y(M),console.log("✅ Schedule loaded for Green Room:",M)}else F("No schedule data found")}catch(X){console.error("❌ Error loading schedule:",X),F("Failed to load schedule data")}finally{R(!1)}})()},[d?.id]);const fe=(()=>{const ee=B?p.findIndex(M=>String(M.id)===String(B)):-1;console.log("🔄 Modifying schedule visibility:",{totalScheduleItems:p.length,currentIndex:ee,activeItemId:B,activeItemIdType:typeof B,scheduleItemIds:p.map(M=>({id:M.id,idType:typeof M.id,name:M.segmentName})),originalSchedule:p.map(M=>({id:M.id,name:M.segmentName,isPublic:M.isPublic}))});const X=p.map((M,k)=>ee>=0&&k<ee?{...M,isPublic:!1}:M),$=X.filter(M=>M.isPublic===!0);return console.log("🔄 Modified schedule:",{modifiedSchedule:X.map(M=>({id:M.id,name:M.segmentName,isPublic:M.isPublic})),visibleItems:$.map(M=>({id:M.id,name:M.segmentName}))}),$})(),me=()=>{if(!B||!Z[B])return"No Timer";const ee=Z[B];return ee.startedAt?new Date(ee.startedAt.getTime()+ee.total*1e3).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0}):"Not Started"},pe=()=>{if(!B||!Z[B])return"00:00";const ee=Z[B],X=ee.total-ee.elapsed,$=X<0,M=Math.abs(X),k=Math.floor(M/60),U=Math.floor(M%60),ae=`${k.toString().padStart(2,"0")}:${U.toString().padStart(2,"0")}`;return $?`-${ae}`:ae},$e=()=>{if(!B||!Z[B])return!1;const ee=Z[B];return ee.total-ee.elapsed<0};return N?o.jsxs("div",{className:"w-full h-screen flex items-center justify-center relative",style:{aspectRatio:"9/16"},children:[o.jsxs("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover",style:{objectFit:"cover"},children:[o.jsx("source",{src:"/pointed_crop_loop.webm",type:"video/webm"}),"Your browser does not support the video tag."]}),o.jsx("div",{className:"text-white text-xl relative z-10 bg-black/50 px-4 py-2 rounded",children:"Loading Green Room..."})]}):L?o.jsxs("div",{className:"w-full h-screen flex items-center justify-center relative",style:{aspectRatio:"9/16"},children:[o.jsxs("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover",style:{objectFit:"cover"},children:[o.jsx("source",{src:"/pointed_crop_loop.webm",type:"video/webm"}),"Your browser does not support the video tag."]}),o.jsx("div",{className:"text-red-400 text-xl relative z-10 bg-black/50 px-4 py-2 rounded",children:L})]}):o.jsxs("div",{className:"w-full h-screen text-white overflow-hidden relative",style:{aspectRatio:"9/16"},children:[o.jsxs("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover",style:{objectFit:"cover"},children:[o.jsx("source",{src:"/pointed_crop_loop.webm",type:"video/webm"}),"Your browser does not support the video tag."]}),o.jsxs("div",{className:"relative z-10",children:[o.jsxs("div",{className:"p-6 flex items-center",children:[o.jsx("div",{className:"text-white font-bold flex-1 text-center",style:{fontSize:"clamp(2rem, 6vw, 4rem)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.1",marginRight:"20px"},children:d?.name||"Current Event"}),o.jsxs("div",{className:`rounded-lg p-4 text-center flex-shrink-0 ${$e()?"bg-red-800":"bg-red-600"}`,children:[o.jsx("div",{className:"text-white text-lg font-semibold mb-2",children:$e()?"OVER TIME":"Stage Timer"}),o.jsx("div",{className:`text-4xl font-bold mb-2 ${$e()?"text-red-200":"text-white"}`,children:pe()}),o.jsxs("div",{className:"text-white text-sm",children:["Expected Finish: ",me()]})]})]}),o.jsx("div",{className:"flex-1 overflow-y-auto p-6 max-h-[calc(100vh-200px)] [&::-webkit-scrollbar]:hidden",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:o.jsx("div",{className:"space-y-4",children:fe.length===0?o.jsx("div",{className:"text-center text-gray-400 text-lg py-12",children:"No public schedule items available"}):o.jsx(o.Fragment,{children:fe.slice(0,8).map((ee,X)=>{const $=J[ee.id],M=H==="running"&&String(B)===String(ee.id),k=String(B)===String(ee.id);return console.log(`🔄 Item ${ee.id} (${ee.segmentName}):`,{isLoaded:$,isRunning:M,isActive:k,timerState:H,activeItemId:B,loadedItems:J}),o.jsxs("div",{className:`p-4 rounded-lg transition-all duration-300 ${$?M?"bg-red-600 text-white":"bg-green-600 text-white":"bg-gray-300 text-gray-700"}`,children:[o.jsx("div",{className:"font-bold text-xl mb-2 uppercase",children:ee.segmentName}),o.jsxs("div",{className:"text-sm space-y-1",children:[o.jsxs("div",{children:["Scheduled Start: ",ee.startTime]}),o.jsxs("div",{children:["Scheduled End: ",ee.endTime]}),ee.speakersText&&o.jsxs("div",{className:"text-xs opacity-80",children:["Speakers: ",ee.speakersText]})]})]},ee.id)})})})})]})]})};function Qv(){const u=vr(),n=u.pathname==="/fullscreen-timer",r=u.pathname==="/green-room";return o.jsx("div",{className:"App",children:o.jsxs(Uv,{children:[!n&&!r&&o.jsx(Wu,{})," ",o.jsxs(Zg,{children:[o.jsx(Zs,{path:"/",element:o.jsx(Fv,{})}),o.jsx(Zs,{path:"/run-of-show",element:o.jsx(Wv,{})}),o.jsx(Zs,{path:"/fullscreen-timer",element:o.jsx(qv,{})}),o.jsx(Zs,{path:"/graphics-links",element:o.jsx(Kv,{})}),o.jsx(Zs,{path:"/reports",element:o.jsx(Gv,{})}),o.jsx(Zs,{path:"/green-room",element:o.jsx(Jv,{})})]})]})})}function Yv(){return o.jsx(Av,{children:o.jsx(Sp,{children:o.jsx(Qv,{})})})}const Xv=cg.createRoot(document.getElementById("root"));Xv.render(o.jsx(Cl.StrictMode,{children:o.jsx(Yv,{})}));
