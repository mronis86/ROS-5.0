(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const h of i)if(h.type==="childList")for(const d of h.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function r(i){const h={};return i.integrity&&(h.integrity=i.integrity),i.referrerPolicy&&(h.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?h.credentials="include":i.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function a(i){if(i.ep)return;i.ep=!0;const h=r(i);fetch(i.href,h)}})();function Hu(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}function Zm(u){if(Object.prototype.hasOwnProperty.call(u,"__esModule"))return u;var n=u.default;if(typeof n=="function"){var r=function a(){var i=!1;try{i=this instanceof a}catch{}return i?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};r.prototype=n.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(u).forEach(function(a){var i=Object.getOwnPropertyDescriptor(u,a);Object.defineProperty(r,a,i.get?i:{enumerable:!0,get:function(){return u[a]}})}),r}var pu={exports:{}},Ka={},vu={exports:{}},Be={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fh;function eg(){if(Fh)return Be;Fh=1;var u=Symbol.for("react.element"),n=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),h=Symbol.for("react.provider"),d=Symbol.for("react.context"),p=Symbol.for("react.forward_ref"),x=Symbol.for("react.suspense"),y=Symbol.for("react.memo"),S=Symbol.for("react.lazy"),N=Symbol.iterator;function R(E){return E===null||typeof E!="object"?null:(E=N&&E[N]||E["@@iterator"],typeof E=="function"?E:null)}var A={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},U=Object.assign,$={};function O(E,F,ee){this.props=E,this.context=F,this.refs=$,this.updater=ee||A}O.prototype.isReactComponent={},O.prototype.setState=function(E,F){if(typeof E!="object"&&typeof E!="function"&&E!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,E,F,"setState")},O.prototype.forceUpdate=function(E){this.updater.enqueueForceUpdate(this,E,"forceUpdate")};function J(){}J.prototype=O.prototype;function X(E,F,ee){this.props=E,this.context=F,this.refs=$,this.updater=ee||A}var q=X.prototype=new J;q.constructor=X,U(q,O.prototype),q.isPureReactComponent=!0;var K=Array.isArray,Y=Object.prototype.hasOwnProperty,P={current:null},B={key:!0,ref:!0,__self:!0,__source:!0};function ne(E,F,ee){var ce,$e={},Me=null,ze=null;if(F!=null)for(ce in F.ref!==void 0&&(ze=F.ref),F.key!==void 0&&(Me=""+F.key),F)Y.call(F,ce)&&!B.hasOwnProperty(ce)&&($e[ce]=F[ce]);var Fe=arguments.length-2;if(Fe===1)$e.children=ee;else if(1<Fe){for(var Ge=Array(Fe),mt=0;mt<Fe;mt++)Ge[mt]=arguments[mt+2];$e.children=Ge}if(E&&E.defaultProps)for(ce in Fe=E.defaultProps,Fe)$e[ce]===void 0&&($e[ce]=Fe[ce]);return{$$typeof:u,type:E,key:Me,ref:ze,props:$e,_owner:P.current}}function T(E,F){return{$$typeof:u,type:E.type,key:F,ref:E.ref,props:E.props,_owner:E._owner}}function re(E){return typeof E=="object"&&E!==null&&E.$$typeof===u}function de(E){var F={"=":"=0",":":"=2"};return"$"+E.replace(/[=:]/g,function(ee){return F[ee]})}var Ne=/\/+/g;function fe(E,F){return typeof E=="object"&&E!==null&&E.key!=null?de(""+E.key):F.toString(36)}function me(E,F,ee,ce,$e){var Me=typeof E;(Me==="undefined"||Me==="boolean")&&(E=null);var ze=!1;if(E===null)ze=!0;else switch(Me){case"string":case"number":ze=!0;break;case"object":switch(E.$$typeof){case u:case n:ze=!0}}if(ze)return ze=E,$e=$e(ze),E=ce===""?"."+fe(ze,0):ce,K($e)?(ee="",E!=null&&(ee=E.replace(Ne,"$&/")+"/"),me($e,F,ee,"",function(mt){return mt})):$e!=null&&(re($e)&&($e=T($e,ee+(!$e.key||ze&&ze.key===$e.key?"":(""+$e.key).replace(Ne,"$&/")+"/")+E)),F.push($e)),1;if(ze=0,ce=ce===""?".":ce+":",K(E))for(var Fe=0;Fe<E.length;Fe++){Me=E[Fe];var Ge=ce+fe(Me,Fe);ze+=me(Me,F,ee,Ge,$e)}else if(Ge=R(E),typeof Ge=="function")for(E=Ge.call(E),Fe=0;!(Me=E.next()).done;)Me=Me.value,Ge=ce+fe(Me,Fe++),ze+=me(Me,F,ee,Ge,$e);else if(Me==="object")throw F=String(E),Error("Objects are not valid as a React child (found: "+(F==="[object Object]"?"object with keys {"+Object.keys(E).join(", ")+"}":F)+"). If you meant to render a collection of children, use an array instead.");return ze}function ve(E,F,ee){if(E==null)return E;var ce=[],$e=0;return me(E,ce,"","",function(Me){return F.call(ee,Me,$e++)}),ce}function Ve(E){if(E._status===-1){var F=E._result;F=F(),F.then(function(ee){(E._status===0||E._status===-1)&&(E._status=1,E._result=ee)},function(ee){(E._status===0||E._status===-1)&&(E._status=2,E._result=ee)}),E._status===-1&&(E._status=0,E._result=F)}if(E._status===1)return E._result.default;throw E._result}var we={current:null},z={transition:null},D={ReactCurrentDispatcher:we,ReactCurrentBatchConfig:z,ReactCurrentOwner:P};function V(){throw Error("act(...) is not supported in production builds of React.")}return Be.Children={map:ve,forEach:function(E,F,ee){ve(E,function(){F.apply(this,arguments)},ee)},count:function(E){var F=0;return ve(E,function(){F++}),F},toArray:function(E){return ve(E,function(F){return F})||[]},only:function(E){if(!re(E))throw Error("React.Children.only expected to receive a single React element child.");return E}},Be.Component=O,Be.Fragment=r,Be.Profiler=i,Be.PureComponent=X,Be.StrictMode=a,Be.Suspense=x,Be.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,Be.act=V,Be.cloneElement=function(E,F,ee){if(E==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+E+".");var ce=U({},E.props),$e=E.key,Me=E.ref,ze=E._owner;if(F!=null){if(F.ref!==void 0&&(Me=F.ref,ze=P.current),F.key!==void 0&&($e=""+F.key),E.type&&E.type.defaultProps)var Fe=E.type.defaultProps;for(Ge in F)Y.call(F,Ge)&&!B.hasOwnProperty(Ge)&&(ce[Ge]=F[Ge]===void 0&&Fe!==void 0?Fe[Ge]:F[Ge])}var Ge=arguments.length-2;if(Ge===1)ce.children=ee;else if(1<Ge){Fe=Array(Ge);for(var mt=0;mt<Ge;mt++)Fe[mt]=arguments[mt+2];ce.children=Fe}return{$$typeof:u,type:E.type,key:$e,ref:Me,props:ce,_owner:ze}},Be.createContext=function(E){return E={$$typeof:d,_currentValue:E,_currentValue2:E,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},E.Provider={$$typeof:h,_context:E},E.Consumer=E},Be.createElement=ne,Be.createFactory=function(E){var F=ne.bind(null,E);return F.type=E,F},Be.createRef=function(){return{current:null}},Be.forwardRef=function(E){return{$$typeof:p,render:E}},Be.isValidElement=re,Be.lazy=function(E){return{$$typeof:S,_payload:{_status:-1,_result:E},_init:Ve}},Be.memo=function(E,F){return{$$typeof:y,type:E,compare:F===void 0?null:F}},Be.startTransition=function(E){var F=z.transition;z.transition={};try{E()}finally{z.transition=F}},Be.unstable_act=V,Be.useCallback=function(E,F){return we.current.useCallback(E,F)},Be.useContext=function(E){return we.current.useContext(E)},Be.useDebugValue=function(){},Be.useDeferredValue=function(E){return we.current.useDeferredValue(E)},Be.useEffect=function(E,F){return we.current.useEffect(E,F)},Be.useId=function(){return we.current.useId()},Be.useImperativeHandle=function(E,F,ee){return we.current.useImperativeHandle(E,F,ee)},Be.useInsertionEffect=function(E,F){return we.current.useInsertionEffect(E,F)},Be.useLayoutEffect=function(E,F){return we.current.useLayoutEffect(E,F)},Be.useMemo=function(E,F){return we.current.useMemo(E,F)},Be.useReducer=function(E,F,ee){return we.current.useReducer(E,F,ee)},Be.useRef=function(E){return we.current.useRef(E)},Be.useState=function(E){return we.current.useState(E)},Be.useSyncExternalStore=function(E,F,ee){return we.current.useSyncExternalStore(E,F,ee)},Be.useTransition=function(){return we.current.useTransition()},Be.version="18.3.1",Be}var Vh;function qu(){return Vh||(Vh=1,vu.exports=eg()),vu.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bh;function tg(){if(Bh)return Ka;Bh=1;var u=qu(),n=Symbol.for("react.element"),r=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,i=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,h={key:!0,ref:!0,__self:!0,__source:!0};function d(p,x,y){var S,N={},R=null,A=null;y!==void 0&&(R=""+y),x.key!==void 0&&(R=""+x.key),x.ref!==void 0&&(A=x.ref);for(S in x)a.call(x,S)&&!h.hasOwnProperty(S)&&(N[S]=x[S]);if(p&&p.defaultProps)for(S in x=p.defaultProps,x)N[S]===void 0&&(N[S]=x[S]);return{$$typeof:n,type:p,key:R,ref:A,props:N,_owner:i.current}}return Ka.Fragment=r,Ka.jsx=d,Ka.jsxs=d,Ka}var zh;function rg(){return zh||(zh=1,pu.exports=tg()),pu.exports}var s=rg(),_=qu();const Cl=Hu(_);var yl={},xu={exports:{}},xr={},yu={exports:{}},bu={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wh;function ng(){return Wh||(Wh=1,(function(u){function n(z,D){var V=z.length;z.push(D);e:for(;0<V;){var E=V-1>>>1,F=z[E];if(0<i(F,D))z[E]=D,z[V]=F,V=E;else break e}}function r(z){return z.length===0?null:z[0]}function a(z){if(z.length===0)return null;var D=z[0],V=z.pop();if(V!==D){z[0]=V;e:for(var E=0,F=z.length,ee=F>>>1;E<ee;){var ce=2*(E+1)-1,$e=z[ce],Me=ce+1,ze=z[Me];if(0>i($e,V))Me<F&&0>i(ze,$e)?(z[E]=ze,z[Me]=V,E=Me):(z[E]=$e,z[ce]=V,E=ce);else if(Me<F&&0>i(ze,V))z[E]=ze,z[Me]=V,E=Me;else break e}}return D}function i(z,D){var V=z.sortIndex-D.sortIndex;return V!==0?V:z.id-D.id}if(typeof performance=="object"&&typeof performance.now=="function"){var h=performance;u.unstable_now=function(){return h.now()}}else{var d=Date,p=d.now();u.unstable_now=function(){return d.now()-p}}var x=[],y=[],S=1,N=null,R=3,A=!1,U=!1,$=!1,O=typeof setTimeout=="function"?setTimeout:null,J=typeof clearTimeout=="function"?clearTimeout:null,X=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function q(z){for(var D=r(y);D!==null;){if(D.callback===null)a(y);else if(D.startTime<=z)a(y),D.sortIndex=D.expirationTime,n(x,D);else break;D=r(y)}}function K(z){if($=!1,q(z),!U)if(r(x)!==null)U=!0,Ve(Y);else{var D=r(y);D!==null&&we(K,D.startTime-z)}}function Y(z,D){U=!1,$&&($=!1,J(ne),ne=-1),A=!0;var V=R;try{for(q(D),N=r(x);N!==null&&(!(N.expirationTime>D)||z&&!de());){var E=N.callback;if(typeof E=="function"){N.callback=null,R=N.priorityLevel;var F=E(N.expirationTime<=D);D=u.unstable_now(),typeof F=="function"?N.callback=F:N===r(x)&&a(x),q(D)}else a(x);N=r(x)}if(N!==null)var ee=!0;else{var ce=r(y);ce!==null&&we(K,ce.startTime-D),ee=!1}return ee}finally{N=null,R=V,A=!1}}var P=!1,B=null,ne=-1,T=5,re=-1;function de(){return!(u.unstable_now()-re<T)}function Ne(){if(B!==null){var z=u.unstable_now();re=z;var D=!0;try{D=B(!0,z)}finally{D?fe():(P=!1,B=null)}}else P=!1}var fe;if(typeof X=="function")fe=function(){X(Ne)};else if(typeof MessageChannel<"u"){var me=new MessageChannel,ve=me.port2;me.port1.onmessage=Ne,fe=function(){ve.postMessage(null)}}else fe=function(){O(Ne,0)};function Ve(z){B=z,P||(P=!0,fe())}function we(z,D){ne=O(function(){z(u.unstable_now())},D)}u.unstable_IdlePriority=5,u.unstable_ImmediatePriority=1,u.unstable_LowPriority=4,u.unstable_NormalPriority=3,u.unstable_Profiling=null,u.unstable_UserBlockingPriority=2,u.unstable_cancelCallback=function(z){z.callback=null},u.unstable_continueExecution=function(){U||A||(U=!0,Ve(Y))},u.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<z?Math.floor(1e3/z):5},u.unstable_getCurrentPriorityLevel=function(){return R},u.unstable_getFirstCallbackNode=function(){return r(x)},u.unstable_next=function(z){switch(R){case 1:case 2:case 3:var D=3;break;default:D=R}var V=R;R=D;try{return z()}finally{R=V}},u.unstable_pauseExecution=function(){},u.unstable_requestPaint=function(){},u.unstable_runWithPriority=function(z,D){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var V=R;R=z;try{return D()}finally{R=V}},u.unstable_scheduleCallback=function(z,D,V){var E=u.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?E+V:E):V=E,z){case 1:var F=-1;break;case 2:F=250;break;case 5:F=1073741823;break;case 4:F=1e4;break;default:F=5e3}return F=V+F,z={id:S++,callback:D,priorityLevel:z,startTime:V,expirationTime:F,sortIndex:-1},V>E?(z.sortIndex=V,n(y,z),r(x)===null&&z===r(y)&&($?(J(ne),ne=-1):$=!0,we(K,V-E))):(z.sortIndex=F,n(x,z),U||A||(U=!0,Ve(Y))),z},u.unstable_shouldYield=de,u.unstable_wrapCallback=function(z){var D=R;return function(){var V=R;R=D;try{return z.apply(this,arguments)}finally{R=V}}}})(bu)),bu}var Hh;function sg(){return Hh||(Hh=1,yu.exports=ng()),yu.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qh;function og(){if(qh)return xr;qh=1;var u=qu(),n=sg();function r(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,o=1;o<arguments.length;o++)t+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,i={};function h(e,t){d(e,t),d(e+"Capture",t)}function d(e,t){for(i[e]=t,e=0;e<t.length;e++)a.add(t[e])}var p=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),x=Object.prototype.hasOwnProperty,y=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,S={},N={};function R(e){return x.call(N,e)?!0:x.call(S,e)?!1:y.test(e)?N[e]=!0:(S[e]=!0,!1)}function A(e,t,o,c){if(o!==null&&o.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return c?!1:o!==null?!o.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function U(e,t,o,c){if(t===null||typeof t>"u"||A(e,t,o,c))return!0;if(c)return!1;if(o!==null)switch(o.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function $(e,t,o,c,f,m,b){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=c,this.attributeNamespace=f,this.mustUseProperty=o,this.propertyName=e,this.type=t,this.sanitizeURL=m,this.removeEmptyString=b}var O={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){O[e]=new $(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];O[t]=new $(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){O[e]=new $(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){O[e]=new $(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){O[e]=new $(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){O[e]=new $(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){O[e]=new $(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){O[e]=new $(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){O[e]=new $(e,5,!1,e.toLowerCase(),null,!1,!1)});var J=/[\-:]([a-z])/g;function X(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(J,X);O[t]=new $(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(J,X);O[t]=new $(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(J,X);O[t]=new $(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){O[e]=new $(e,1,!1,e.toLowerCase(),null,!1,!1)}),O.xlinkHref=new $("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){O[e]=new $(e,1,!1,e.toLowerCase(),null,!0,!0)});function q(e,t,o,c){var f=O.hasOwnProperty(t)?O[t]:null;(f!==null?f.type!==0:c||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(U(t,o,f,c)&&(o=null),c||f===null?R(t)&&(o===null?e.removeAttribute(t):e.setAttribute(t,""+o)):f.mustUseProperty?e[f.propertyName]=o===null?f.type===3?!1:"":o:(t=f.attributeName,c=f.attributeNamespace,o===null?e.removeAttribute(t):(f=f.type,o=f===3||f===4&&o===!0?"":""+o,c?e.setAttributeNS(c,t,o):e.setAttribute(t,o))))}var K=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Y=Symbol.for("react.element"),P=Symbol.for("react.portal"),B=Symbol.for("react.fragment"),ne=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),re=Symbol.for("react.provider"),de=Symbol.for("react.context"),Ne=Symbol.for("react.forward_ref"),fe=Symbol.for("react.suspense"),me=Symbol.for("react.suspense_list"),ve=Symbol.for("react.memo"),Ve=Symbol.for("react.lazy"),we=Symbol.for("react.offscreen"),z=Symbol.iterator;function D(e){return e===null||typeof e!="object"?null:(e=z&&e[z]||e["@@iterator"],typeof e=="function"?e:null)}var V=Object.assign,E;function F(e){if(E===void 0)try{throw Error()}catch(o){var t=o.stack.trim().match(/\n( *(at )?)/);E=t&&t[1]||""}return`
`+E+e}var ee=!1;function ce(e,t){if(!e||ee)return"";ee=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(G){var c=G}Reflect.construct(e,[],t)}else{try{t.call()}catch(G){c=G}e.call(t.prototype)}else{try{throw Error()}catch(G){c=G}e()}}catch(G){if(G&&c&&typeof G.stack=="string"){for(var f=G.stack.split(`
`),m=c.stack.split(`
`),b=f.length-1,j=m.length-1;1<=b&&0<=j&&f[b]!==m[j];)j--;for(;1<=b&&0<=j;b--,j--)if(f[b]!==m[j]){if(b!==1||j!==1)do if(b--,j--,0>j||f[b]!==m[j]){var I=`
`+f[b].replace(" at new "," at ");return e.displayName&&I.includes("<anonymous>")&&(I=I.replace("<anonymous>",e.displayName)),I}while(1<=b&&0<=j);break}}}finally{ee=!1,Error.prepareStackTrace=o}return(e=e?e.displayName||e.name:"")?F(e):""}function $e(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=ce(e.type,!1),e;case 11:return e=ce(e.type.render,!1),e;case 1:return e=ce(e.type,!0),e;default:return""}}function Me(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case B:return"Fragment";case P:return"Portal";case T:return"Profiler";case ne:return"StrictMode";case fe:return"Suspense";case me:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case de:return(e.displayName||"Context")+".Consumer";case re:return(e._context.displayName||"Context")+".Provider";case Ne:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case ve:return t=e.displayName||null,t!==null?t:Me(e.type)||"Memo";case Ve:t=e._payload,e=e._init;try{return Me(e(t))}catch{}}return null}function ze(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Me(t);case 8:return t===ne?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Fe(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Ge(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function mt(e){var t=Ge(e)?"checked":"value",o=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),c=""+e[t];if(!e.hasOwnProperty(t)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var f=o.get,m=o.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return f.call(this)},set:function(b){c=""+b,m.call(this,b)}}),Object.defineProperty(e,t,{enumerable:o.enumerable}),{getValue:function(){return c},setValue:function(b){c=""+b},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function br(e){e._valueTracker||(e._valueTracker=mt(e))}function tn(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var o=t.getValue(),c="";return e&&(c=Ge(e)?e.checked?"true":"false":e.value),e=c,e!==o?(t.setValue(e),!0):!1}function $n(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function te(e,t){var o=t.checked;return V({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??e._wrapperState.initialChecked})}function pe(e,t){var o=t.defaultValue==null?"":t.defaultValue,c=t.checked!=null?t.checked:t.defaultChecked;o=Fe(t.value!=null?t.value:o),e._wrapperState={initialChecked:c,initialValue:o,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function _e(e,t){t=t.checked,t!=null&&q(e,"checked",t,!1)}function De(e,t){_e(e,t);var o=Fe(t.value),c=t.type;if(o!=null)c==="number"?(o===0&&e.value===""||e.value!=o)&&(e.value=""+o):e.value!==""+o&&(e.value=""+o);else if(c==="submit"||c==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?bt(e,t.type,o):t.hasOwnProperty("defaultValue")&&bt(e,t.type,Fe(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Ze(e,t,o){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var c=t.type;if(!(c!=="submit"&&c!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,o||t===e.value||(e.value=t),e.defaultValue=t}o=e.name,o!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,o!==""&&(e.name=o)}function bt(e,t,o){(t!=="number"||$n(e.ownerDocument)!==e)&&(o==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+o&&(e.defaultValue=""+o))}var at=Array.isArray;function dt(e,t,o,c){if(e=e.options,t){t={};for(var f=0;f<o.length;f++)t["$"+o[f]]=!0;for(o=0;o<e.length;o++)f=t.hasOwnProperty("$"+e[o].value),e[o].selected!==f&&(e[o].selected=f),f&&c&&(e[o].defaultSelected=!0)}else{for(o=""+Fe(o),t=null,f=0;f<e.length;f++){if(e[f].value===o){e[f].selected=!0,c&&(e[f].defaultSelected=!0);return}t!==null||e[f].disabled||(t=e[f])}t!==null&&(t.selected=!0)}}function wt(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(r(91));return V({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function it(e,t){var o=t.value;if(o==null){if(o=t.children,t=t.defaultValue,o!=null){if(t!=null)throw Error(r(92));if(at(o)){if(1<o.length)throw Error(r(93));o=o[0]}t=o}t==null&&(t=""),o=t}e._wrapperState={initialValue:Fe(o)}}function Et(e,t){var o=Fe(t.value),c=Fe(t.defaultValue);o!=null&&(o=""+o,o!==e.value&&(e.value=o),t.defaultValue==null&&e.defaultValue!==o&&(e.defaultValue=o)),c!=null&&(e.defaultValue=""+c)}function gt(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Mt(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ot(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Mt(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var vn,oi=(function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,o,c,f){MSApp.execUnsafeLocalFunction(function(){return e(t,o,c,f)})}:e})(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(vn=vn||document.createElement("div"),vn.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=vn.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Mn(e,t){if(t){var o=e.firstChild;if(o&&o===e.lastChild&&o.nodeType===3){o.nodeValue=t;return}}e.textContent=t}var Un={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ai=["Webkit","ms","Moz","O"];Object.keys(Un).forEach(function(e){ai.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Un[t]=Un[e]})});function ps(e,t,o){return t==null||typeof t=="boolean"||t===""?"":o||typeof t!="number"||t===0||Un.hasOwnProperty(e)&&Un[e]?(""+t).trim():t+"px"}function vs(e,t){e=e.style;for(var o in t)if(t.hasOwnProperty(o)){var c=o.indexOf("--")===0,f=ps(o,t[o],c);o==="float"&&(o="cssFloat"),c?e.setProperty(o,f):e[o]=f}}var rn=V({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Fn(e,t){if(t){if(rn[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(r(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(r(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(r(61))}if(t.style!=null&&typeof t.style!="object")throw Error(r(62))}}function Ut(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ir=null;function Le(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var wr=null,tr=null,Cr=null;function Ye(e){if(e=Oa(e)){if(typeof wr!="function")throw Error(r(280));var t=e.stateNode;t&&(t=Di(t),wr(e.stateNode,e.type,t))}}function Sr(e){tr?Cr?Cr.push(e):Cr=[e]:tr=e}function na(){if(tr){var e=tr,t=Cr;if(Cr=tr=null,Ye(e),t)for(e=0;e<t.length;e++)Ye(t[e])}}function Rr(e,t){return e(t)}function ht(){}var Ir=!1;function xs(e,t,o){if(Ir)return e(t,o);Ir=!0;try{return Rr(e,t,o)}finally{Ir=!1,(tr!==null||Cr!==null)&&(ht(),na())}}function Vn(e,t){var o=e.stateNode;if(o===null)return null;var c=Di(o);if(c===null)return null;o=c[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(e=e.type,c=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!c;break e;default:e=!1}if(e)return null;if(o&&typeof o!="function")throw Error(r(231,t,typeof o));return o}var ao=!1;if(p)try{var ys={};Object.defineProperty(ys,"passive",{get:function(){ao=!0}}),window.addEventListener("test",ys,ys),window.removeEventListener("test",ys,ys)}catch{ao=!1}function nd(e,t,o,c,f,m,b,j,I){var G=Array.prototype.slice.call(arguments,3);try{t.apply(o,G)}catch(oe){this.onError(oe)}}var nn=!1,sa=null,io=!1,Te=null,Vr={onError:function(e){nn=!0,sa=e}};function rt(e,t,o,c,f,m,b,j,I){nn=!1,sa=null,nd.apply(Vr,arguments)}function Ft(e,t,o,c,f,m,b,j,I){if(rt.apply(this,arguments),nn){if(nn){var G=sa;nn=!1,sa=null}else throw Error(r(198));io||(io=!0,Te=G)}}function lr(e){var t=e,o=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(o=t.return),e=t.return;while(e)}return t.tag===3?o:null}function zt(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function ii(e){if(lr(e)!==e)throw Error(r(188))}function lo(e){var t=e.alternate;if(!t){if(t=lr(e),t===null)throw Error(r(188));return t!==e?null:e}for(var o=e,c=t;;){var f=o.return;if(f===null)break;var m=f.alternate;if(m===null){if(c=f.return,c!==null){o=c;continue}break}if(f.child===m.child){for(m=f.child;m;){if(m===o)return ii(f),e;if(m===c)return ii(f),t;m=m.sibling}throw Error(r(188))}if(o.return!==c.return)o=f,c=m;else{for(var b=!1,j=f.child;j;){if(j===o){b=!0,o=f,c=m;break}if(j===c){b=!0,c=f,o=m;break}j=j.sibling}if(!b){for(j=m.child;j;){if(j===o){b=!0,o=m,c=f;break}if(j===c){b=!0,c=m,o=f;break}j=j.sibling}if(!b)throw Error(r(189))}}if(o.alternate!==c)throw Error(r(190))}if(o.tag!==3)throw Error(r(188));return o.stateNode.current===o?e:t}function Al(e){return e=lo(e),e!==null?$l(e):null}function $l(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=$l(e);if(t!==null)return t;e=e.sibling}return null}var Ml=n.unstable_scheduleCallback,sn=n.unstable_cancelCallback,li=n.unstable_shouldYield,Or=n.unstable_requestPaint,qe=n.unstable_now,Ul=n.unstable_getCurrentPriorityLevel,oa=n.unstable_ImmediatePriority,bs=n.unstable_UserBlockingPriority,Pr=n.unstable_NormalPriority,co=n.unstable_LowPriority,aa=n.unstable_IdlePriority,ws=null,Dr=null;function ia(e){if(Dr&&typeof Dr.onCommitFiberRoot=="function")try{Dr.onCommitFiberRoot(ws,e,void 0,(e.current.flags&128)===128)}catch{}}var _r=Math.clz32?Math.clz32:la,ci=Math.log,uo=Math.LN2;function la(e){return e>>>=0,e===0?32:31-(ci(e)/uo|0)|0}var Ss=64,_s=4194304;function ho(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Bn(e,t){var o=e.pendingLanes;if(o===0)return 0;var c=0,f=e.suspendedLanes,m=e.pingedLanes,b=o&268435455;if(b!==0){var j=b&~f;j!==0?c=ho(j):(m&=b,m!==0&&(c=ho(m)))}else b=o&~f,b!==0?c=ho(b):m!==0&&(c=ho(m));if(c===0)return 0;if(t!==0&&t!==c&&(t&f)===0&&(f=c&-c,m=t&-t,f>=m||f===16&&(m&4194240)!==0))return t;if((c&4)!==0&&(c|=o&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=c;0<t;)o=31-_r(t),f=1<<o,c|=e[o],t&=~f;return c}function Fl(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function fo(e,t){for(var o=e.suspendedLanes,c=e.pingedLanes,f=e.expirationTimes,m=e.pendingLanes;0<m;){var b=31-_r(m),j=1<<b,I=f[b];I===-1?((j&o)===0||(j&c)!==0)&&(f[b]=Fl(j,t)):I<=t&&(e.expiredLanes|=j),m&=~j}}function rr(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function ca(){var e=Ss;return Ss<<=1,(Ss&4194240)===0&&(Ss=64),e}function Br(e){for(var t=[],o=0;31>o;o++)t.push(e);return t}function Es(e,t,o){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-_r(t),e[t]=o}function ua(e,t){var o=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var c=e.eventTimes;for(e=e.expirationTimes;0<o;){var f=31-_r(o),m=1<<f;t[f]=0,c[f]=-1,e[f]=-1,o&=~m}}function da(e,t){var o=e.entangledLanes|=t;for(e=e.entanglements;o;){var c=31-_r(o),f=1<<c;f&t|e[c]&t&&(e[c]|=t),o&=~f}}var xe=0;function Wt(e){return e&=-e,1<e?4<e?(e&268435455)!==0?16:536870912:4:1}var ks,Ns,We,ui,js,ha=!1,Ht=[],zr=null,Wr=null,qt=null,Kt=new Map,zn=new Map,nr=[],di="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Wn(e,t){switch(e){case"focusin":case"focusout":zr=null;break;case"dragenter":case"dragleave":Wr=null;break;case"mouseover":case"mouseout":qt=null;break;case"pointerover":case"pointerout":Kt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":zn.delete(t.pointerId)}}function Ts(e,t,o,c,f,m){return e===null||e.nativeEvent!==m?(e={blockedOn:t,domEventName:o,eventSystemFlags:c,nativeEvent:m,targetContainers:[f]},t!==null&&(t=Oa(t),t!==null&&Ns(t)),e):(e.eventSystemFlags|=c,t=e.targetContainers,f!==null&&t.indexOf(f)===-1&&t.push(f),e)}function hi(e,t,o,c,f){switch(t){case"focusin":return zr=Ts(zr,e,t,o,c,f),!0;case"dragenter":return Wr=Ts(Wr,e,t,o,c,f),!0;case"mouseover":return qt=Ts(qt,e,t,o,c,f),!0;case"pointerover":var m=f.pointerId;return Kt.set(m,Ts(Kt.get(m)||null,e,t,o,c,f)),!0;case"gotpointercapture":return m=f.pointerId,zn.set(m,Ts(zn.get(m)||null,e,t,o,c,f)),!0}return!1}function xn(e){var t=Vs(e.target);if(t!==null){var o=lr(t);if(o!==null){if(t=o.tag,t===13){if(t=zt(o),t!==null){e.blockedOn=t,js(e.priority,function(){We(o)});return}}else if(t===3&&o.stateNode.current.memoizedState.isDehydrated){e.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Er(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var o=on(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(o===null){o=e.nativeEvent;var c=new o.constructor(o.type,o);ir=c,o.target.dispatchEvent(c),ir=null}else return t=Oa(o),t!==null&&Ns(t),e.blockedOn=o,!1;t.shift()}return!0}function Cs(e,t,o){Er(e)&&o.delete(t)}function Vl(){ha=!1,zr!==null&&Er(zr)&&(zr=null),Wr!==null&&Er(Wr)&&(Wr=null),qt!==null&&Er(qt)&&(qt=null),Kt.forEach(Cs),zn.forEach(Cs)}function cr(e,t){e.blockedOn===t&&(e.blockedOn=null,ha||(ha=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,Vl)))}function yn(e){function t(f){return cr(f,e)}if(0<Ht.length){cr(Ht[0],e);for(var o=1;o<Ht.length;o++){var c=Ht[o];c.blockedOn===e&&(c.blockedOn=null)}}for(zr!==null&&cr(zr,e),Wr!==null&&cr(Wr,e),qt!==null&&cr(qt,e),Kt.forEach(t),zn.forEach(t),o=0;o<nr.length;o++)c=nr[o],c.blockedOn===e&&(c.blockedOn=null);for(;0<nr.length&&(o=nr[0],o.blockedOn===null);)xn(o),o.blockedOn===null&&nr.shift()}var Hr=K.ReactCurrentBatchConfig,mo=!0;function Bl(e,t,o,c){var f=xe,m=Hr.transition;Hr.transition=null;try{xe=1,Hn(e,t,o,c)}finally{xe=f,Hr.transition=m}}function fi(e,t,o,c){var f=xe,m=Hr.transition;Hr.transition=null;try{xe=4,Hn(e,t,o,c)}finally{xe=f,Hr.transition=m}}function Hn(e,t,o,c){if(mo){var f=on(e,t,o,c);if(f===null)Ca(e,t,c,qr,o),Wn(e,c);else if(hi(f,e,t,o,c))c.stopPropagation();else if(Wn(e,c),t&4&&-1<di.indexOf(e)){for(;f!==null;){var m=Oa(f);if(m!==null&&ks(m),m=on(e,t,o,c),m===null&&Ca(e,t,c,qr,o),m===f)break;f=m}f!==null&&c.stopPropagation()}else Ca(e,t,c,null,o)}}var qr=null;function on(e,t,o,c){if(qr=null,e=Le(c),e=Vs(e),e!==null)if(t=lr(e),t===null)e=null;else if(o=t.tag,o===13){if(e=zt(t),e!==null)return e;e=null}else if(o===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return qr=e,null}function Rs(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ul()){case oa:return 1;case bs:return 4;case Pr:case co:return 16;case aa:return 536870912;default:return 16}default:return 16}}var an=null,qn=null,go=null;function Is(){if(go)return go;var e,t=qn,o=t.length,c,f="value"in an?an.value:an.textContent,m=f.length;for(e=0;e<o&&t[e]===f[e];e++);var b=o-e;for(c=1;c<=b&&t[o-c]===f[m-c];c++);return go=f.slice(e,1<c?1-c:void 0)}function Kr(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function tt(){return!0}function Gt(){return!1}function Pt(e){function t(o,c,f,m,b){this._reactName=o,this._targetInst=f,this.type=c,this.nativeEvent=m,this.target=b,this.currentTarget=null;for(var j in e)e.hasOwnProperty(j)&&(o=e[j],this[j]=o?o(m):m[j]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?tt:Gt,this.isPropagationStopped=Gt,this}return V(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=tt)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=tt)},persist:function(){},isPersistent:tt}),t}var bn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},kt=Pt(bn),Os=V({},bn,{view:0,detail:0}),fa=Pt(Os),Ps,ma,Kn,po=V({},Os,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Jt,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Kn&&(Kn&&e.type==="mousemove"?(Ps=e.screenX-Kn.screenX,ma=e.screenY-Kn.screenY):ma=Ps=0,Kn=e),Ps)},movementY:function(e){return"movementY"in e?e.movementY:ma}}),mi=Pt(po),vo=V({},po,{dataTransfer:0}),zl=Pt(vo),Wl=V({},Os,{relatedTarget:0}),ga=Pt(Wl),Hl=V({},bn,{animationName:0,elapsedTime:0,pseudoElement:0}),xo=Pt(Hl),pa=V({},bn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),va=Pt(pa),ql=V({},bn,{data:0}),gi=Pt(ql),Qe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nt={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function yo(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=pi[e])?!!t[e]:!1}function Jt(){return yo}var vi=V({},Os,{key:function(e){if(e.key){var t=Qe[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Kr(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Nt[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Jt,charCode:function(e){return e.type==="keypress"?Kr(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Kr(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),xi=Pt(vi),et=V({},po,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),yi=Pt(et),Kl=V({},Os,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Jt}),Gl=Pt(Kl),bi=V({},bn,{propertyName:0,elapsedTime:0,pseudoElement:0}),wi=Pt(bi),Jl=V({},po,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Gn=Pt(Jl),Ql=[9,13,27,32],xa=p&&"CompositionEvent"in window,Ds=null;p&&"documentMode"in document&&(Ds=document.documentMode);var wn=p&&"TextEvent"in window&&!Ds,Si=p&&(!xa||Ds&&8<Ds&&11>=Ds),_i=" ",ya=!1;function bo(e,t){switch(e){case"keyup":return Ql.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ba(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Jn=!1;function Yl(e,t){switch(e){case"compositionend":return ba(t);case"keypress":return t.which!==32?null:(ya=!0,_i);case"textInput":return e=t.data,e===_i&&ya?null:e;default:return null}}function Ls(e,t){if(Jn)return e==="compositionend"||!xa&&bo(e,t)?(e=Is(),go=qn=an=null,Jn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Si&&t.locale!=="ko"?null:t.data;default:return null}}var Xl={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ei(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Xl[e.type]:t==="textarea"}function ki(e,t,o,c){Sr(c),t=Ii(t,"onChange"),0<t.length&&(o=new kt("onChange","change",null,o,c),e.push({event:o,listeners:t}))}var As=null,ln=null;function Ni(e){Ci(e,0)}function $s(e){var t=Eo(e);if(tn(t))return e}function Zl(e,t){if(e==="change")return t}var kr=!1;if(p){var wa;if(p){var Sa="oninput"in document;if(!Sa){var _a=document.createElement("div");_a.setAttribute("oninput","return;"),Sa=typeof _a.oninput=="function"}wa=Sa}else wa=!1;kr=wa&&(!document.documentMode||9<document.documentMode)}function wo(){As&&(As.detachEvent("onpropertychange",ji),ln=As=null)}function ji(e){if(e.propertyName==="value"&&$s(ln)){var t=[];ki(t,ln,e,Le(e)),xs(Ni,t)}}function ec(e,t,o){e==="focusin"?(wo(),As=t,ln=o,As.attachEvent("onpropertychange",ji)):e==="focusout"&&wo()}function tc(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return $s(ln)}function rc(e,t){if(e==="click")return $s(t)}function nc(e,t){if(e==="input"||e==="change")return $s(t)}function sc(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var ur=typeof Object.is=="function"?Object.is:sc;function Ms(e,t){if(ur(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var o=Object.keys(e),c=Object.keys(t);if(o.length!==c.length)return!1;for(c=0;c<o.length;c++){var f=o[c];if(!x.call(t,f)||!ur(e[f],t[f]))return!1}return!0}function lt(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Ea(e,t){var o=lt(e);e=0;for(var c;o;){if(o.nodeType===3){if(c=e+o.textContent.length,e<=t&&c>=t)return{node:o,offset:t-e};e=c}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=lt(o)}}function Qn(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Qn(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Ti(){for(var e=window,t=$n();t instanceof e.HTMLIFrameElement;){try{var o=typeof t.contentWindow.location.href=="string"}catch{o=!1}if(o)e=t.contentWindow;else break;t=$n(e.document)}return t}function ka(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function oc(e){var t=Ti(),o=e.focusedElem,c=e.selectionRange;if(t!==o&&o&&o.ownerDocument&&Qn(o.ownerDocument.documentElement,o)){if(c!==null&&ka(o)){if(t=c.start,e=c.end,e===void 0&&(e=t),"selectionStart"in o)o.selectionStart=t,o.selectionEnd=Math.min(e,o.value.length);else if(e=(t=o.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var f=o.textContent.length,m=Math.min(c.start,f);c=c.end===void 0?m:Math.min(c.end,f),!e.extend&&m>c&&(f=c,c=m,m=f),f=Ea(o,m);var b=Ea(o,c);f&&b&&(e.rangeCount!==1||e.anchorNode!==f.node||e.anchorOffset!==f.offset||e.focusNode!==b.node||e.focusOffset!==b.offset)&&(t=t.createRange(),t.setStart(f.node,f.offset),e.removeAllRanges(),m>c?(e.addRange(t),e.extend(b.node,b.offset)):(t.setEnd(b.node,b.offset),e.addRange(t)))}}for(t=[],e=o;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<t.length;o++)e=t[o],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var ac=p&&"documentMode"in document&&11>=document.documentMode,Sn=null,Na=null,_n=null,dr=!1;function l(e,t,o){var c=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;dr||Sn==null||Sn!==$n(c)||(c=Sn,"selectionStart"in c&&ka(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),_n&&Ms(_n,c)||(_n=c,c=Ii(Na,"onSelect"),0<c.length&&(t=new kt("onSelect","select",null,t,o),e.push({event:t,listeners:c}),t.target=Sn)))}function g(e,t){var o={};return o[e.toLowerCase()]=t.toLowerCase(),o["Webkit"+e]="webkit"+t,o["Moz"+e]="moz"+t,o}var v={animationend:g("Animation","AnimationEnd"),animationiteration:g("Animation","AnimationIteration"),animationstart:g("Animation","AnimationStart"),transitionend:g("Transition","TransitionEnd")},w={},k={};p&&(k=document.createElement("div").style,"AnimationEvent"in window||(delete v.animationend.animation,delete v.animationiteration.animation,delete v.animationstart.animation),"TransitionEvent"in window||delete v.transitionend.transition);function C(e){if(w[e])return w[e];if(!v[e])return e;var t=v[e],o;for(o in t)if(t.hasOwnProperty(o)&&o in k)return w[e]=t[o];return e}var L=C("animationend"),Q=C("animationiteration"),Z=C("animationstart"),he=C("transitionend"),be=new Map,ie="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ge(e,t){be.set(e,t),h(t,[e])}for(var Ie=0;Ie<ie.length;Ie++){var Xe=ie[Ie],ct=Xe.toLowerCase(),hr=Xe[0].toUpperCase()+Xe.slice(1);ge(ct,"on"+hr)}ge(L,"onAnimationEnd"),ge(Q,"onAnimationIteration"),ge(Z,"onAnimationStart"),ge("dblclick","onDoubleClick"),ge("focusin","onFocus"),ge("focusout","onBlur"),ge(he,"onTransitionEnd"),d("onMouseEnter",["mouseout","mouseover"]),d("onMouseLeave",["mouseout","mouseover"]),d("onPointerEnter",["pointerout","pointerover"]),d("onPointerLeave",["pointerout","pointerover"]),h("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),h("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),h("onBeforeInput",["compositionend","keypress","textInput","paste"]),h("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),h("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),h("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qt="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ja=new Set("cancel close invalid load scroll toggle".split(" ").concat(Qt));function Us(e,t,o){var c=e.type||"unknown-event";e.currentTarget=o,Ft(c,t,void 0,e),e.currentTarget=null}function Ci(e,t){t=(t&4)!==0;for(var o=0;o<e.length;o++){var c=e[o],f=c.event;c=c.listeners;e:{var m=void 0;if(t)for(var b=c.length-1;0<=b;b--){var j=c[b],I=j.instance,G=j.currentTarget;if(j=j.listener,I!==m&&f.isPropagationStopped())break e;Us(f,j,G),m=I}else for(b=0;b<c.length;b++){if(j=c[b],I=j.instance,G=j.currentTarget,j=j.listener,I!==m&&f.isPropagationStopped())break e;Us(f,j,G),m=I}}}if(io)throw e=Te,io=!1,Te=null,e}function nt(e,t){var o=t[hc];o===void 0&&(o=t[hc]=new Set);var c=e+"__bubble";o.has(c)||(Ri(t,e,2,!1),o.add(c))}function Ta(e,t,o){var c=0;t&&(c|=4),Ri(o,e,c,t)}var Yn="_reactListening"+Math.random().toString(36).slice(2);function Fs(e){if(!e[Yn]){e[Yn]=!0,a.forEach(function(o){o!=="selectionchange"&&(ja.has(o)||Ta(o,!1,e),Ta(o,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Yn]||(t[Yn]=!0,Ta("selectionchange",!1,t))}}function Ri(e,t,o,c){switch(Rs(t)){case 1:var f=Bl;break;case 4:f=fi;break;default:f=Hn}o=f.bind(null,t,o,e),f=void 0,!ao||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(f=!0),c?f!==void 0?e.addEventListener(t,o,{capture:!0,passive:f}):e.addEventListener(t,o,!0):f!==void 0?e.addEventListener(t,o,{passive:f}):e.addEventListener(t,o,!1)}function Ca(e,t,o,c,f){var m=c;if((t&1)===0&&(t&2)===0&&c!==null)e:for(;;){if(c===null)return;var b=c.tag;if(b===3||b===4){var j=c.stateNode.containerInfo;if(j===f||j.nodeType===8&&j.parentNode===f)break;if(b===4)for(b=c.return;b!==null;){var I=b.tag;if((I===3||I===4)&&(I=b.stateNode.containerInfo,I===f||I.nodeType===8&&I.parentNode===f))return;b=b.return}for(;j!==null;){if(b=Vs(j),b===null)return;if(I=b.tag,I===5||I===6){c=m=b;continue e}j=j.parentNode}}c=c.return}xs(function(){var G=m,oe=Le(o),le=[];e:{var se=be.get(e);if(se!==void 0){var Se=kt,ke=e;switch(e){case"keypress":if(Kr(o)===0)break e;case"keydown":case"keyup":Se=xi;break;case"focusin":ke="focus",Se=ga;break;case"focusout":ke="blur",Se=ga;break;case"beforeblur":case"afterblur":Se=ga;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Se=mi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Se=zl;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Se=Gl;break;case L:case Q:case Z:Se=xo;break;case he:Se=wi;break;case"scroll":Se=fa;break;case"wheel":Se=Gn;break;case"copy":case"cut":case"paste":Se=va;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Se=yi}var je=(t&4)!==0,St=!je&&e==="scroll",W=je?se!==null?se+"Capture":null:se;je=[];for(var M=G,H;M!==null;){H=M;var ue=H.stateNode;if(H.tag===5&&ue!==null&&(H=ue,W!==null&&(ue=Vn(M,W),ue!=null&&je.push(Ra(M,ue,H)))),St)break;M=M.return}0<je.length&&(se=new Se(se,ke,null,o,oe),le.push({event:se,listeners:je}))}}if((t&7)===0){e:{if(se=e==="mouseover"||e==="pointerover",Se=e==="mouseout"||e==="pointerout",se&&o!==ir&&(ke=o.relatedTarget||o.fromElement)&&(Vs(ke)||ke[En]))break e;if((Se||se)&&(se=oe.window===oe?oe:(se=oe.ownerDocument)?se.defaultView||se.parentWindow:window,Se?(ke=o.relatedTarget||o.toElement,Se=G,ke=ke?Vs(ke):null,ke!==null&&(St=lr(ke),ke!==St||ke.tag!==5&&ke.tag!==6)&&(ke=null)):(Se=null,ke=G),Se!==ke)){if(je=mi,ue="onMouseLeave",W="onMouseEnter",M="mouse",(e==="pointerout"||e==="pointerover")&&(je=yi,ue="onPointerLeave",W="onPointerEnter",M="pointer"),St=Se==null?se:Eo(Se),H=ke==null?se:Eo(ke),se=new je(ue,M+"leave",Se,o,oe),se.target=St,se.relatedTarget=H,ue=null,Vs(oe)===G&&(je=new je(W,M+"enter",ke,o,oe),je.target=H,je.relatedTarget=St,ue=je),St=ue,Se&&ke)t:{for(je=Se,W=ke,M=0,H=je;H;H=So(H))M++;for(H=0,ue=W;ue;ue=So(ue))H++;for(;0<M-H;)je=So(je),M--;for(;0<H-M;)W=So(W),H--;for(;M--;){if(je===W||W!==null&&je===W.alternate)break t;je=So(je),W=So(W)}je=null}else je=null;Se!==null&&sd(le,se,Se,je,!1),ke!==null&&St!==null&&sd(le,St,ke,je,!0)}}e:{if(se=G?Eo(G):window,Se=se.nodeName&&se.nodeName.toLowerCase(),Se==="select"||Se==="input"&&se.type==="file")var Ce=Zl;else if(Ei(se))if(kr)Ce=nc;else{Ce=tc;var Oe=ec}else(Se=se.nodeName)&&Se.toLowerCase()==="input"&&(se.type==="checkbox"||se.type==="radio")&&(Ce=rc);if(Ce&&(Ce=Ce(e,G))){ki(le,Ce,o,oe);break e}Oe&&Oe(e,se,G),e==="focusout"&&(Oe=se._wrapperState)&&Oe.controlled&&se.type==="number"&&bt(se,"number",se.value)}switch(Oe=G?Eo(G):window,e){case"focusin":(Ei(Oe)||Oe.contentEditable==="true")&&(Sn=Oe,Na=G,_n=null);break;case"focusout":_n=Na=Sn=null;break;case"mousedown":dr=!0;break;case"contextmenu":case"mouseup":case"dragend":dr=!1,l(le,o,oe);break;case"selectionchange":if(ac)break;case"keydown":case"keyup":l(le,o,oe)}var Pe;if(xa)e:{switch(e){case"compositionstart":var Ae="onCompositionStart";break e;case"compositionend":Ae="onCompositionEnd";break e;case"compositionupdate":Ae="onCompositionUpdate";break e}Ae=void 0}else Jn?bo(e,o)&&(Ae="onCompositionEnd"):e==="keydown"&&o.keyCode===229&&(Ae="onCompositionStart");Ae&&(Si&&o.locale!=="ko"&&(Jn||Ae!=="onCompositionStart"?Ae==="onCompositionEnd"&&Jn&&(Pe=Is()):(an=oe,qn="value"in an?an.value:an.textContent,Jn=!0)),Oe=Ii(G,Ae),0<Oe.length&&(Ae=new gi(Ae,e,null,o,oe),le.push({event:Ae,listeners:Oe}),Pe?Ae.data=Pe:(Pe=ba(o),Pe!==null&&(Ae.data=Pe)))),(Pe=wn?Yl(e,o):Ls(e,o))&&(G=Ii(G,"onBeforeInput"),0<G.length&&(oe=new gi("onBeforeInput","beforeinput",null,o,oe),le.push({event:oe,listeners:G}),oe.data=Pe))}Ci(le,t)})}function Ra(e,t,o){return{instance:e,listener:t,currentTarget:o}}function Ii(e,t){for(var o=t+"Capture",c=[];e!==null;){var f=e,m=f.stateNode;f.tag===5&&m!==null&&(f=m,m=Vn(e,o),m!=null&&c.unshift(Ra(e,m,f)),m=Vn(e,t),m!=null&&c.push(Ra(e,m,f))),e=e.return}return c}function So(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function sd(e,t,o,c,f){for(var m=t._reactName,b=[];o!==null&&o!==c;){var j=o,I=j.alternate,G=j.stateNode;if(I!==null&&I===c)break;j.tag===5&&G!==null&&(j=G,f?(I=Vn(o,m),I!=null&&b.unshift(Ra(o,I,j))):f||(I=Vn(o,m),I!=null&&b.push(Ra(o,I,j)))),o=o.return}b.length!==0&&e.push({event:t,listeners:b})}var dm=/\r\n?/g,hm=/\u0000|\uFFFD/g;function od(e){return(typeof e=="string"?e:""+e).replace(dm,`
`).replace(hm,"")}function Oi(e,t,o){if(t=od(t),od(e)!==t&&o)throw Error(r(425))}function Pi(){}var ic=null,lc=null;function cc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var uc=typeof setTimeout=="function"?setTimeout:void 0,fm=typeof clearTimeout=="function"?clearTimeout:void 0,ad=typeof Promise=="function"?Promise:void 0,mm=typeof queueMicrotask=="function"?queueMicrotask:typeof ad<"u"?function(e){return ad.resolve(null).then(e).catch(gm)}:uc;function gm(e){setTimeout(function(){throw e})}function dc(e,t){var o=t,c=0;do{var f=o.nextSibling;if(e.removeChild(o),f&&f.nodeType===8)if(o=f.data,o==="/$"){if(c===0){e.removeChild(f),yn(t);return}c--}else o!=="$"&&o!=="$?"&&o!=="$!"||c++;o=f}while(o);yn(t)}function Xn(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function id(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var o=e.data;if(o==="$"||o==="$!"||o==="$?"){if(t===0)return e;t--}else o==="/$"&&t++}e=e.previousSibling}return null}var _o=Math.random().toString(36).slice(2),cn="__reactFiber$"+_o,Ia="__reactProps$"+_o,En="__reactContainer$"+_o,hc="__reactEvents$"+_o,pm="__reactListeners$"+_o,vm="__reactHandles$"+_o;function Vs(e){var t=e[cn];if(t)return t;for(var o=e.parentNode;o;){if(t=o[En]||o[cn]){if(o=t.alternate,t.child!==null||o!==null&&o.child!==null)for(e=id(e);e!==null;){if(o=e[cn])return o;e=id(e)}return t}e=o,o=e.parentNode}return null}function Oa(e){return e=e[cn]||e[En],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Eo(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(r(33))}function Di(e){return e[Ia]||null}var fc=[],ko=-1;function Zn(e){return{current:e}}function ut(e){0>ko||(e.current=fc[ko],fc[ko]=null,ko--)}function st(e,t){ko++,fc[ko]=e.current,e.current=t}var es={},Yt=Zn(es),fr=Zn(!1),Bs=es;function No(e,t){var o=e.type.contextTypes;if(!o)return es;var c=e.stateNode;if(c&&c.__reactInternalMemoizedUnmaskedChildContext===t)return c.__reactInternalMemoizedMaskedChildContext;var f={},m;for(m in o)f[m]=t[m];return c&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=f),f}function mr(e){return e=e.childContextTypes,e!=null}function Li(){ut(fr),ut(Yt)}function ld(e,t,o){if(Yt.current!==es)throw Error(r(168));st(Yt,t),st(fr,o)}function cd(e,t,o){var c=e.stateNode;if(t=t.childContextTypes,typeof c.getChildContext!="function")return o;c=c.getChildContext();for(var f in c)if(!(f in t))throw Error(r(108,ze(e)||"Unknown",f));return V({},o,c)}function Ai(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||es,Bs=Yt.current,st(Yt,e),st(fr,fr.current),!0}function ud(e,t,o){var c=e.stateNode;if(!c)throw Error(r(169));o?(e=cd(e,t,Bs),c.__reactInternalMemoizedMergedChildContext=e,ut(fr),ut(Yt),st(Yt,e)):ut(fr),st(fr,o)}var kn=null,$i=!1,mc=!1;function dd(e){kn===null?kn=[e]:kn.push(e)}function xm(e){$i=!0,dd(e)}function ts(){if(!mc&&kn!==null){mc=!0;var e=0,t=xe;try{var o=kn;for(xe=1;e<o.length;e++){var c=o[e];do c=c(!0);while(c!==null)}kn=null,$i=!1}catch(f){throw kn!==null&&(kn=kn.slice(e+1)),Ml(oa,ts),f}finally{xe=t,mc=!1}}return null}var jo=[],To=0,Mi=null,Ui=0,Lr=[],Ar=0,zs=null,Nn=1,jn="";function Ws(e,t){jo[To++]=Ui,jo[To++]=Mi,Mi=e,Ui=t}function hd(e,t,o){Lr[Ar++]=Nn,Lr[Ar++]=jn,Lr[Ar++]=zs,zs=e;var c=Nn;e=jn;var f=32-_r(c)-1;c&=~(1<<f),o+=1;var m=32-_r(t)+f;if(30<m){var b=f-f%5;m=(c&(1<<b)-1).toString(32),c>>=b,f-=b,Nn=1<<32-_r(t)+f|o<<f|c,jn=m+e}else Nn=1<<m|o<<f|c,jn=e}function gc(e){e.return!==null&&(Ws(e,1),hd(e,1,0))}function pc(e){for(;e===Mi;)Mi=jo[--To],jo[To]=null,Ui=jo[--To],jo[To]=null;for(;e===zs;)zs=Lr[--Ar],Lr[Ar]=null,jn=Lr[--Ar],Lr[Ar]=null,Nn=Lr[--Ar],Lr[Ar]=null}var Nr=null,jr=null,ft=!1,Gr=null;function fd(e,t){var o=Fr(5,null,null,0);o.elementType="DELETED",o.stateNode=t,o.return=e,t=e.deletions,t===null?(e.deletions=[o],e.flags|=16):t.push(o)}function md(e,t){switch(e.tag){case 5:var o=e.type;return t=t.nodeType!==1||o.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Nr=e,jr=Xn(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Nr=e,jr=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(o=zs!==null?{id:Nn,overflow:jn}:null,e.memoizedState={dehydrated:t,treeContext:o,retryLane:1073741824},o=Fr(18,null,null,0),o.stateNode=t,o.return=e,e.child=o,Nr=e,jr=null,!0):!1;default:return!1}}function vc(e){return(e.mode&1)!==0&&(e.flags&128)===0}function xc(e){if(ft){var t=jr;if(t){var o=t;if(!md(e,t)){if(vc(e))throw Error(r(418));t=Xn(o.nextSibling);var c=Nr;t&&md(e,t)?fd(c,o):(e.flags=e.flags&-4097|2,ft=!1,Nr=e)}}else{if(vc(e))throw Error(r(418));e.flags=e.flags&-4097|2,ft=!1,Nr=e}}}function gd(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Nr=e}function Fi(e){if(e!==Nr)return!1;if(!ft)return gd(e),ft=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!cc(e.type,e.memoizedProps)),t&&(t=jr)){if(vc(e))throw pd(),Error(r(418));for(;t;)fd(e,t),t=Xn(t.nextSibling)}if(gd(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(r(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var o=e.data;if(o==="/$"){if(t===0){jr=Xn(e.nextSibling);break e}t--}else o!=="$"&&o!=="$!"&&o!=="$?"||t++}e=e.nextSibling}jr=null}}else jr=Nr?Xn(e.stateNode.nextSibling):null;return!0}function pd(){for(var e=jr;e;)e=Xn(e.nextSibling)}function Co(){jr=Nr=null,ft=!1}function yc(e){Gr===null?Gr=[e]:Gr.push(e)}var ym=K.ReactCurrentBatchConfig;function Pa(e,t,o){if(e=o.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(r(309));var c=o.stateNode}if(!c)throw Error(r(147,e));var f=c,m=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===m?t.ref:(t=function(b){var j=f.refs;b===null?delete j[m]:j[m]=b},t._stringRef=m,t)}if(typeof e!="string")throw Error(r(284));if(!o._owner)throw Error(r(290,e))}return e}function Vi(e,t){throw e=Object.prototype.toString.call(t),Error(r(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function vd(e){var t=e._init;return t(e._payload)}function xd(e){function t(W,M){if(e){var H=W.deletions;H===null?(W.deletions=[M],W.flags|=16):H.push(M)}}function o(W,M){if(!e)return null;for(;M!==null;)t(W,M),M=M.sibling;return null}function c(W,M){for(W=new Map;M!==null;)M.key!==null?W.set(M.key,M):W.set(M.index,M),M=M.sibling;return W}function f(W,M){return W=cs(W,M),W.index=0,W.sibling=null,W}function m(W,M,H){return W.index=H,e?(H=W.alternate,H!==null?(H=H.index,H<M?(W.flags|=2,M):H):(W.flags|=2,M)):(W.flags|=1048576,M)}function b(W){return e&&W.alternate===null&&(W.flags|=2),W}function j(W,M,H,ue){return M===null||M.tag!==6?(M=uu(H,W.mode,ue),M.return=W,M):(M=f(M,H),M.return=W,M)}function I(W,M,H,ue){var Ce=H.type;return Ce===B?oe(W,M,H.props.children,ue,H.key):M!==null&&(M.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===Ve&&vd(Ce)===M.type)?(ue=f(M,H.props),ue.ref=Pa(W,M,H),ue.return=W,ue):(ue=dl(H.type,H.key,H.props,null,W.mode,ue),ue.ref=Pa(W,M,H),ue.return=W,ue)}function G(W,M,H,ue){return M===null||M.tag!==4||M.stateNode.containerInfo!==H.containerInfo||M.stateNode.implementation!==H.implementation?(M=du(H,W.mode,ue),M.return=W,M):(M=f(M,H.children||[]),M.return=W,M)}function oe(W,M,H,ue,Ce){return M===null||M.tag!==7?(M=Xs(H,W.mode,ue,Ce),M.return=W,M):(M=f(M,H),M.return=W,M)}function le(W,M,H){if(typeof M=="string"&&M!==""||typeof M=="number")return M=uu(""+M,W.mode,H),M.return=W,M;if(typeof M=="object"&&M!==null){switch(M.$$typeof){case Y:return H=dl(M.type,M.key,M.props,null,W.mode,H),H.ref=Pa(W,null,M),H.return=W,H;case P:return M=du(M,W.mode,H),M.return=W,M;case Ve:var ue=M._init;return le(W,ue(M._payload),H)}if(at(M)||D(M))return M=Xs(M,W.mode,H,null),M.return=W,M;Vi(W,M)}return null}function se(W,M,H,ue){var Ce=M!==null?M.key:null;if(typeof H=="string"&&H!==""||typeof H=="number")return Ce!==null?null:j(W,M,""+H,ue);if(typeof H=="object"&&H!==null){switch(H.$$typeof){case Y:return H.key===Ce?I(W,M,H,ue):null;case P:return H.key===Ce?G(W,M,H,ue):null;case Ve:return Ce=H._init,se(W,M,Ce(H._payload),ue)}if(at(H)||D(H))return Ce!==null?null:oe(W,M,H,ue,null);Vi(W,H)}return null}function Se(W,M,H,ue,Ce){if(typeof ue=="string"&&ue!==""||typeof ue=="number")return W=W.get(H)||null,j(M,W,""+ue,Ce);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case Y:return W=W.get(ue.key===null?H:ue.key)||null,I(M,W,ue,Ce);case P:return W=W.get(ue.key===null?H:ue.key)||null,G(M,W,ue,Ce);case Ve:var Oe=ue._init;return Se(W,M,H,Oe(ue._payload),Ce)}if(at(ue)||D(ue))return W=W.get(H)||null,oe(M,W,ue,Ce,null);Vi(M,ue)}return null}function ke(W,M,H,ue){for(var Ce=null,Oe=null,Pe=M,Ae=M=0,At=null;Pe!==null&&Ae<H.length;Ae++){Pe.index>Ae?(At=Pe,Pe=null):At=Pe.sibling;var Je=se(W,Pe,H[Ae],ue);if(Je===null){Pe===null&&(Pe=At);break}e&&Pe&&Je.alternate===null&&t(W,Pe),M=m(Je,M,Ae),Oe===null?Ce=Je:Oe.sibling=Je,Oe=Je,Pe=At}if(Ae===H.length)return o(W,Pe),ft&&Ws(W,Ae),Ce;if(Pe===null){for(;Ae<H.length;Ae++)Pe=le(W,H[Ae],ue),Pe!==null&&(M=m(Pe,M,Ae),Oe===null?Ce=Pe:Oe.sibling=Pe,Oe=Pe);return ft&&Ws(W,Ae),Ce}for(Pe=c(W,Pe);Ae<H.length;Ae++)At=Se(Pe,W,Ae,H[Ae],ue),At!==null&&(e&&At.alternate!==null&&Pe.delete(At.key===null?Ae:At.key),M=m(At,M,Ae),Oe===null?Ce=At:Oe.sibling=At,Oe=At);return e&&Pe.forEach(function(us){return t(W,us)}),ft&&Ws(W,Ae),Ce}function je(W,M,H,ue){var Ce=D(H);if(typeof Ce!="function")throw Error(r(150));if(H=Ce.call(H),H==null)throw Error(r(151));for(var Oe=Ce=null,Pe=M,Ae=M=0,At=null,Je=H.next();Pe!==null&&!Je.done;Ae++,Je=H.next()){Pe.index>Ae?(At=Pe,Pe=null):At=Pe.sibling;var us=se(W,Pe,Je.value,ue);if(us===null){Pe===null&&(Pe=At);break}e&&Pe&&us.alternate===null&&t(W,Pe),M=m(us,M,Ae),Oe===null?Ce=us:Oe.sibling=us,Oe=us,Pe=At}if(Je.done)return o(W,Pe),ft&&Ws(W,Ae),Ce;if(Pe===null){for(;!Je.done;Ae++,Je=H.next())Je=le(W,Je.value,ue),Je!==null&&(M=m(Je,M,Ae),Oe===null?Ce=Je:Oe.sibling=Je,Oe=Je);return ft&&Ws(W,Ae),Ce}for(Pe=c(W,Pe);!Je.done;Ae++,Je=H.next())Je=Se(Pe,W,Ae,Je.value,ue),Je!==null&&(e&&Je.alternate!==null&&Pe.delete(Je.key===null?Ae:Je.key),M=m(Je,M,Ae),Oe===null?Ce=Je:Oe.sibling=Je,Oe=Je);return e&&Pe.forEach(function(Xm){return t(W,Xm)}),ft&&Ws(W,Ae),Ce}function St(W,M,H,ue){if(typeof H=="object"&&H!==null&&H.type===B&&H.key===null&&(H=H.props.children),typeof H=="object"&&H!==null){switch(H.$$typeof){case Y:e:{for(var Ce=H.key,Oe=M;Oe!==null;){if(Oe.key===Ce){if(Ce=H.type,Ce===B){if(Oe.tag===7){o(W,Oe.sibling),M=f(Oe,H.props.children),M.return=W,W=M;break e}}else if(Oe.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===Ve&&vd(Ce)===Oe.type){o(W,Oe.sibling),M=f(Oe,H.props),M.ref=Pa(W,Oe,H),M.return=W,W=M;break e}o(W,Oe);break}else t(W,Oe);Oe=Oe.sibling}H.type===B?(M=Xs(H.props.children,W.mode,ue,H.key),M.return=W,W=M):(ue=dl(H.type,H.key,H.props,null,W.mode,ue),ue.ref=Pa(W,M,H),ue.return=W,W=ue)}return b(W);case P:e:{for(Oe=H.key;M!==null;){if(M.key===Oe)if(M.tag===4&&M.stateNode.containerInfo===H.containerInfo&&M.stateNode.implementation===H.implementation){o(W,M.sibling),M=f(M,H.children||[]),M.return=W,W=M;break e}else{o(W,M);break}else t(W,M);M=M.sibling}M=du(H,W.mode,ue),M.return=W,W=M}return b(W);case Ve:return Oe=H._init,St(W,M,Oe(H._payload),ue)}if(at(H))return ke(W,M,H,ue);if(D(H))return je(W,M,H,ue);Vi(W,H)}return typeof H=="string"&&H!==""||typeof H=="number"?(H=""+H,M!==null&&M.tag===6?(o(W,M.sibling),M=f(M,H),M.return=W,W=M):(o(W,M),M=uu(H,W.mode,ue),M.return=W,W=M),b(W)):o(W,M)}return St}var Ro=xd(!0),yd=xd(!1),Bi=Zn(null),zi=null,Io=null,bc=null;function wc(){bc=Io=zi=null}function Sc(e){var t=Bi.current;ut(Bi),e._currentValue=t}function _c(e,t,o){for(;e!==null;){var c=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,c!==null&&(c.childLanes|=t)):c!==null&&(c.childLanes&t)!==t&&(c.childLanes|=t),e===o)break;e=e.return}}function Oo(e,t){zi=e,bc=Io=null,e=e.dependencies,e!==null&&e.firstContext!==null&&((e.lanes&t)!==0&&(gr=!0),e.firstContext=null)}function $r(e){var t=e._currentValue;if(bc!==e)if(e={context:e,memoizedValue:t,next:null},Io===null){if(zi===null)throw Error(r(308));Io=e,zi.dependencies={lanes:0,firstContext:e}}else Io=Io.next=e;return t}var Hs=null;function Ec(e){Hs===null?Hs=[e]:Hs.push(e)}function bd(e,t,o,c){var f=t.interleaved;return f===null?(o.next=o,Ec(t)):(o.next=f.next,f.next=o),t.interleaved=o,Tn(e,c)}function Tn(e,t){e.lanes|=t;var o=e.alternate;for(o!==null&&(o.lanes|=t),o=e,e=e.return;e!==null;)e.childLanes|=t,o=e.alternate,o!==null&&(o.childLanes|=t),o=e,e=e.return;return o.tag===3?o.stateNode:null}var rs=!1;function kc(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function wd(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Cn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function ns(e,t,o){var c=e.updateQueue;if(c===null)return null;if(c=c.shared,(Ke&2)!==0){var f=c.pending;return f===null?t.next=t:(t.next=f.next,f.next=t),c.pending=t,Tn(e,o)}return f=c.interleaved,f===null?(t.next=t,Ec(c)):(t.next=f.next,f.next=t),c.interleaved=t,Tn(e,o)}function Wi(e,t,o){if(t=t.updateQueue,t!==null&&(t=t.shared,(o&4194240)!==0)){var c=t.lanes;c&=e.pendingLanes,o|=c,t.lanes=o,da(e,o)}}function Sd(e,t){var o=e.updateQueue,c=e.alternate;if(c!==null&&(c=c.updateQueue,o===c)){var f=null,m=null;if(o=o.firstBaseUpdate,o!==null){do{var b={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};m===null?f=m=b:m=m.next=b,o=o.next}while(o!==null);m===null?f=m=t:m=m.next=t}else f=m=t;o={baseState:c.baseState,firstBaseUpdate:f,lastBaseUpdate:m,shared:c.shared,effects:c.effects},e.updateQueue=o;return}e=o.lastBaseUpdate,e===null?o.firstBaseUpdate=t:e.next=t,o.lastBaseUpdate=t}function Hi(e,t,o,c){var f=e.updateQueue;rs=!1;var m=f.firstBaseUpdate,b=f.lastBaseUpdate,j=f.shared.pending;if(j!==null){f.shared.pending=null;var I=j,G=I.next;I.next=null,b===null?m=G:b.next=G,b=I;var oe=e.alternate;oe!==null&&(oe=oe.updateQueue,j=oe.lastBaseUpdate,j!==b&&(j===null?oe.firstBaseUpdate=G:j.next=G,oe.lastBaseUpdate=I))}if(m!==null){var le=f.baseState;b=0,oe=G=I=null,j=m;do{var se=j.lane,Se=j.eventTime;if((c&se)===se){oe!==null&&(oe=oe.next={eventTime:Se,lane:0,tag:j.tag,payload:j.payload,callback:j.callback,next:null});e:{var ke=e,je=j;switch(se=t,Se=o,je.tag){case 1:if(ke=je.payload,typeof ke=="function"){le=ke.call(Se,le,se);break e}le=ke;break e;case 3:ke.flags=ke.flags&-65537|128;case 0:if(ke=je.payload,se=typeof ke=="function"?ke.call(Se,le,se):ke,se==null)break e;le=V({},le,se);break e;case 2:rs=!0}}j.callback!==null&&j.lane!==0&&(e.flags|=64,se=f.effects,se===null?f.effects=[j]:se.push(j))}else Se={eventTime:Se,lane:se,tag:j.tag,payload:j.payload,callback:j.callback,next:null},oe===null?(G=oe=Se,I=le):oe=oe.next=Se,b|=se;if(j=j.next,j===null){if(j=f.shared.pending,j===null)break;se=j,j=se.next,se.next=null,f.lastBaseUpdate=se,f.shared.pending=null}}while(!0);if(oe===null&&(I=le),f.baseState=I,f.firstBaseUpdate=G,f.lastBaseUpdate=oe,t=f.shared.interleaved,t!==null){f=t;do b|=f.lane,f=f.next;while(f!==t)}else m===null&&(f.shared.lanes=0);Gs|=b,e.lanes=b,e.memoizedState=le}}function _d(e,t,o){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var c=e[t],f=c.callback;if(f!==null){if(c.callback=null,c=o,typeof f!="function")throw Error(r(191,f));f.call(c)}}}var Da={},un=Zn(Da),La=Zn(Da),Aa=Zn(Da);function qs(e){if(e===Da)throw Error(r(174));return e}function Nc(e,t){switch(st(Aa,t),st(La,e),st(un,Da),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Ot(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Ot(t,e)}ut(un),st(un,t)}function Po(){ut(un),ut(La),ut(Aa)}function Ed(e){qs(Aa.current);var t=qs(un.current),o=Ot(t,e.type);t!==o&&(st(La,e),st(un,o))}function jc(e){La.current===e&&(ut(un),ut(La))}var pt=Zn(0);function qi(e){for(var t=e;t!==null;){if(t.tag===13){var o=t.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Tc=[];function Cc(){for(var e=0;e<Tc.length;e++)Tc[e]._workInProgressVersionPrimary=null;Tc.length=0}var Ki=K.ReactCurrentDispatcher,Rc=K.ReactCurrentBatchConfig,Ks=0,vt=null,jt=null,Dt=null,Gi=!1,$a=!1,Ma=0,bm=0;function Xt(){throw Error(r(321))}function Ic(e,t){if(t===null)return!1;for(var o=0;o<t.length&&o<e.length;o++)if(!ur(e[o],t[o]))return!1;return!0}function Oc(e,t,o,c,f,m){if(Ks=m,vt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Ki.current=e===null||e.memoizedState===null?Em:km,e=o(c,f),$a){m=0;do{if($a=!1,Ma=0,25<=m)throw Error(r(301));m+=1,Dt=jt=null,t.updateQueue=null,Ki.current=Nm,e=o(c,f)}while($a)}if(Ki.current=Yi,t=jt!==null&&jt.next!==null,Ks=0,Dt=jt=vt=null,Gi=!1,t)throw Error(r(300));return e}function Pc(){var e=Ma!==0;return Ma=0,e}function dn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Dt===null?vt.memoizedState=Dt=e:Dt=Dt.next=e,Dt}function Mr(){if(jt===null){var e=vt.alternate;e=e!==null?e.memoizedState:null}else e=jt.next;var t=Dt===null?vt.memoizedState:Dt.next;if(t!==null)Dt=t,jt=e;else{if(e===null)throw Error(r(310));jt=e,e={memoizedState:jt.memoizedState,baseState:jt.baseState,baseQueue:jt.baseQueue,queue:jt.queue,next:null},Dt===null?vt.memoizedState=Dt=e:Dt=Dt.next=e}return Dt}function Ua(e,t){return typeof t=="function"?t(e):t}function Dc(e){var t=Mr(),o=t.queue;if(o===null)throw Error(r(311));o.lastRenderedReducer=e;var c=jt,f=c.baseQueue,m=o.pending;if(m!==null){if(f!==null){var b=f.next;f.next=m.next,m.next=b}c.baseQueue=f=m,o.pending=null}if(f!==null){m=f.next,c=c.baseState;var j=b=null,I=null,G=m;do{var oe=G.lane;if((Ks&oe)===oe)I!==null&&(I=I.next={lane:0,action:G.action,hasEagerState:G.hasEagerState,eagerState:G.eagerState,next:null}),c=G.hasEagerState?G.eagerState:e(c,G.action);else{var le={lane:oe,action:G.action,hasEagerState:G.hasEagerState,eagerState:G.eagerState,next:null};I===null?(j=I=le,b=c):I=I.next=le,vt.lanes|=oe,Gs|=oe}G=G.next}while(G!==null&&G!==m);I===null?b=c:I.next=j,ur(c,t.memoizedState)||(gr=!0),t.memoizedState=c,t.baseState=b,t.baseQueue=I,o.lastRenderedState=c}if(e=o.interleaved,e!==null){f=e;do m=f.lane,vt.lanes|=m,Gs|=m,f=f.next;while(f!==e)}else f===null&&(o.lanes=0);return[t.memoizedState,o.dispatch]}function Lc(e){var t=Mr(),o=t.queue;if(o===null)throw Error(r(311));o.lastRenderedReducer=e;var c=o.dispatch,f=o.pending,m=t.memoizedState;if(f!==null){o.pending=null;var b=f=f.next;do m=e(m,b.action),b=b.next;while(b!==f);ur(m,t.memoizedState)||(gr=!0),t.memoizedState=m,t.baseQueue===null&&(t.baseState=m),o.lastRenderedState=m}return[m,c]}function kd(){}function Nd(e,t){var o=vt,c=Mr(),f=t(),m=!ur(c.memoizedState,f);if(m&&(c.memoizedState=f,gr=!0),c=c.queue,Ac(Cd.bind(null,o,c,e),[e]),c.getSnapshot!==t||m||Dt!==null&&Dt.memoizedState.tag&1){if(o.flags|=2048,Fa(9,Td.bind(null,o,c,f,t),void 0,null),Lt===null)throw Error(r(349));(Ks&30)!==0||jd(o,t,f)}return f}function jd(e,t,o){e.flags|=16384,e={getSnapshot:t,value:o},t=vt.updateQueue,t===null?(t={lastEffect:null,stores:null},vt.updateQueue=t,t.stores=[e]):(o=t.stores,o===null?t.stores=[e]:o.push(e))}function Td(e,t,o,c){t.value=o,t.getSnapshot=c,Rd(t)&&Id(e)}function Cd(e,t,o){return o(function(){Rd(t)&&Id(e)})}function Rd(e){var t=e.getSnapshot;e=e.value;try{var o=t();return!ur(e,o)}catch{return!0}}function Id(e){var t=Tn(e,1);t!==null&&Xr(t,e,1,-1)}function Od(e){var t=dn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ua,lastRenderedState:e},t.queue=e,e=e.dispatch=_m.bind(null,vt,e),[t.memoizedState,e]}function Fa(e,t,o,c){return e={tag:e,create:t,destroy:o,deps:c,next:null},t=vt.updateQueue,t===null?(t={lastEffect:null,stores:null},vt.updateQueue=t,t.lastEffect=e.next=e):(o=t.lastEffect,o===null?t.lastEffect=e.next=e:(c=o.next,o.next=e,e.next=c,t.lastEffect=e)),e}function Pd(){return Mr().memoizedState}function Ji(e,t,o,c){var f=dn();vt.flags|=e,f.memoizedState=Fa(1|t,o,void 0,c===void 0?null:c)}function Qi(e,t,o,c){var f=Mr();c=c===void 0?null:c;var m=void 0;if(jt!==null){var b=jt.memoizedState;if(m=b.destroy,c!==null&&Ic(c,b.deps)){f.memoizedState=Fa(t,o,m,c);return}}vt.flags|=e,f.memoizedState=Fa(1|t,o,m,c)}function Dd(e,t){return Ji(8390656,8,e,t)}function Ac(e,t){return Qi(2048,8,e,t)}function Ld(e,t){return Qi(4,2,e,t)}function Ad(e,t){return Qi(4,4,e,t)}function $d(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Md(e,t,o){return o=o!=null?o.concat([e]):null,Qi(4,4,$d.bind(null,t,e),o)}function $c(){}function Ud(e,t){var o=Mr();t=t===void 0?null:t;var c=o.memoizedState;return c!==null&&t!==null&&Ic(t,c[1])?c[0]:(o.memoizedState=[e,t],e)}function Fd(e,t){var o=Mr();t=t===void 0?null:t;var c=o.memoizedState;return c!==null&&t!==null&&Ic(t,c[1])?c[0]:(e=e(),o.memoizedState=[e,t],e)}function Vd(e,t,o){return(Ks&21)===0?(e.baseState&&(e.baseState=!1,gr=!0),e.memoizedState=o):(ur(o,t)||(o=ca(),vt.lanes|=o,Gs|=o,e.baseState=!0),t)}function wm(e,t){var o=xe;xe=o!==0&&4>o?o:4,e(!0);var c=Rc.transition;Rc.transition={};try{e(!1),t()}finally{xe=o,Rc.transition=c}}function Bd(){return Mr().memoizedState}function Sm(e,t,o){var c=is(e);if(o={lane:c,action:o,hasEagerState:!1,eagerState:null,next:null},zd(e))Wd(t,o);else if(o=bd(e,t,o,c),o!==null){var f=or();Xr(o,e,c,f),Hd(o,t,c)}}function _m(e,t,o){var c=is(e),f={lane:c,action:o,hasEagerState:!1,eagerState:null,next:null};if(zd(e))Wd(t,f);else{var m=e.alternate;if(e.lanes===0&&(m===null||m.lanes===0)&&(m=t.lastRenderedReducer,m!==null))try{var b=t.lastRenderedState,j=m(b,o);if(f.hasEagerState=!0,f.eagerState=j,ur(j,b)){var I=t.interleaved;I===null?(f.next=f,Ec(t)):(f.next=I.next,I.next=f),t.interleaved=f;return}}catch{}finally{}o=bd(e,t,f,c),o!==null&&(f=or(),Xr(o,e,c,f),Hd(o,t,c))}}function zd(e){var t=e.alternate;return e===vt||t!==null&&t===vt}function Wd(e,t){$a=Gi=!0;var o=e.pending;o===null?t.next=t:(t.next=o.next,o.next=t),e.pending=t}function Hd(e,t,o){if((o&4194240)!==0){var c=t.lanes;c&=e.pendingLanes,o|=c,t.lanes=o,da(e,o)}}var Yi={readContext:$r,useCallback:Xt,useContext:Xt,useEffect:Xt,useImperativeHandle:Xt,useInsertionEffect:Xt,useLayoutEffect:Xt,useMemo:Xt,useReducer:Xt,useRef:Xt,useState:Xt,useDebugValue:Xt,useDeferredValue:Xt,useTransition:Xt,useMutableSource:Xt,useSyncExternalStore:Xt,useId:Xt,unstable_isNewReconciler:!1},Em={readContext:$r,useCallback:function(e,t){return dn().memoizedState=[e,t===void 0?null:t],e},useContext:$r,useEffect:Dd,useImperativeHandle:function(e,t,o){return o=o!=null?o.concat([e]):null,Ji(4194308,4,$d.bind(null,t,e),o)},useLayoutEffect:function(e,t){return Ji(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ji(4,2,e,t)},useMemo:function(e,t){var o=dn();return t=t===void 0?null:t,e=e(),o.memoizedState=[e,t],e},useReducer:function(e,t,o){var c=dn();return t=o!==void 0?o(t):t,c.memoizedState=c.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},c.queue=e,e=e.dispatch=Sm.bind(null,vt,e),[c.memoizedState,e]},useRef:function(e){var t=dn();return e={current:e},t.memoizedState=e},useState:Od,useDebugValue:$c,useDeferredValue:function(e){return dn().memoizedState=e},useTransition:function(){var e=Od(!1),t=e[0];return e=wm.bind(null,e[1]),dn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,o){var c=vt,f=dn();if(ft){if(o===void 0)throw Error(r(407));o=o()}else{if(o=t(),Lt===null)throw Error(r(349));(Ks&30)!==0||jd(c,t,o)}f.memoizedState=o;var m={value:o,getSnapshot:t};return f.queue=m,Dd(Cd.bind(null,c,m,e),[e]),c.flags|=2048,Fa(9,Td.bind(null,c,m,o,t),void 0,null),o},useId:function(){var e=dn(),t=Lt.identifierPrefix;if(ft){var o=jn,c=Nn;o=(c&~(1<<32-_r(c)-1)).toString(32)+o,t=":"+t+"R"+o,o=Ma++,0<o&&(t+="H"+o.toString(32)),t+=":"}else o=bm++,t=":"+t+"r"+o.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},km={readContext:$r,useCallback:Ud,useContext:$r,useEffect:Ac,useImperativeHandle:Md,useInsertionEffect:Ld,useLayoutEffect:Ad,useMemo:Fd,useReducer:Dc,useRef:Pd,useState:function(){return Dc(Ua)},useDebugValue:$c,useDeferredValue:function(e){var t=Mr();return Vd(t,jt.memoizedState,e)},useTransition:function(){var e=Dc(Ua)[0],t=Mr().memoizedState;return[e,t]},useMutableSource:kd,useSyncExternalStore:Nd,useId:Bd,unstable_isNewReconciler:!1},Nm={readContext:$r,useCallback:Ud,useContext:$r,useEffect:Ac,useImperativeHandle:Md,useInsertionEffect:Ld,useLayoutEffect:Ad,useMemo:Fd,useReducer:Lc,useRef:Pd,useState:function(){return Lc(Ua)},useDebugValue:$c,useDeferredValue:function(e){var t=Mr();return jt===null?t.memoizedState=e:Vd(t,jt.memoizedState,e)},useTransition:function(){var e=Lc(Ua)[0],t=Mr().memoizedState;return[e,t]},useMutableSource:kd,useSyncExternalStore:Nd,useId:Bd,unstable_isNewReconciler:!1};function Jr(e,t){if(e&&e.defaultProps){t=V({},t),e=e.defaultProps;for(var o in e)t[o]===void 0&&(t[o]=e[o]);return t}return t}function Mc(e,t,o,c){t=e.memoizedState,o=o(c,t),o=o==null?t:V({},t,o),e.memoizedState=o,e.lanes===0&&(e.updateQueue.baseState=o)}var Xi={isMounted:function(e){return(e=e._reactInternals)?lr(e)===e:!1},enqueueSetState:function(e,t,o){e=e._reactInternals;var c=or(),f=is(e),m=Cn(c,f);m.payload=t,o!=null&&(m.callback=o),t=ns(e,m,f),t!==null&&(Xr(t,e,f,c),Wi(t,e,f))},enqueueReplaceState:function(e,t,o){e=e._reactInternals;var c=or(),f=is(e),m=Cn(c,f);m.tag=1,m.payload=t,o!=null&&(m.callback=o),t=ns(e,m,f),t!==null&&(Xr(t,e,f,c),Wi(t,e,f))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var o=or(),c=is(e),f=Cn(o,c);f.tag=2,t!=null&&(f.callback=t),t=ns(e,f,c),t!==null&&(Xr(t,e,c,o),Wi(t,e,c))}};function qd(e,t,o,c,f,m,b){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(c,m,b):t.prototype&&t.prototype.isPureReactComponent?!Ms(o,c)||!Ms(f,m):!0}function Kd(e,t,o){var c=!1,f=es,m=t.contextType;return typeof m=="object"&&m!==null?m=$r(m):(f=mr(t)?Bs:Yt.current,c=t.contextTypes,m=(c=c!=null)?No(e,f):es),t=new t(o,m),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Xi,e.stateNode=t,t._reactInternals=e,c&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=f,e.__reactInternalMemoizedMaskedChildContext=m),t}function Gd(e,t,o,c){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(o,c),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(o,c),t.state!==e&&Xi.enqueueReplaceState(t,t.state,null)}function Uc(e,t,o,c){var f=e.stateNode;f.props=o,f.state=e.memoizedState,f.refs={},kc(e);var m=t.contextType;typeof m=="object"&&m!==null?f.context=$r(m):(m=mr(t)?Bs:Yt.current,f.context=No(e,m)),f.state=e.memoizedState,m=t.getDerivedStateFromProps,typeof m=="function"&&(Mc(e,t,m,o),f.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof f.getSnapshotBeforeUpdate=="function"||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(t=f.state,typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount(),t!==f.state&&Xi.enqueueReplaceState(f,f.state,null),Hi(e,o,f,c),f.state=e.memoizedState),typeof f.componentDidMount=="function"&&(e.flags|=4194308)}function Do(e,t){try{var o="",c=t;do o+=$e(c),c=c.return;while(c);var f=o}catch(m){f=`
Error generating stack: `+m.message+`
`+m.stack}return{value:e,source:t,stack:f,digest:null}}function Fc(e,t,o){return{value:e,source:null,stack:o??null,digest:t??null}}function Vc(e,t){try{console.error(t.value)}catch(o){setTimeout(function(){throw o})}}var jm=typeof WeakMap=="function"?WeakMap:Map;function Jd(e,t,o){o=Cn(-1,o),o.tag=3,o.payload={element:null};var c=t.value;return o.callback=function(){ol||(ol=!0,ru=c),Vc(e,t)},o}function Qd(e,t,o){o=Cn(-1,o),o.tag=3;var c=e.type.getDerivedStateFromError;if(typeof c=="function"){var f=t.value;o.payload=function(){return c(f)},o.callback=function(){Vc(e,t)}}var m=e.stateNode;return m!==null&&typeof m.componentDidCatch=="function"&&(o.callback=function(){Vc(e,t),typeof c!="function"&&(os===null?os=new Set([this]):os.add(this));var b=t.stack;this.componentDidCatch(t.value,{componentStack:b!==null?b:""})}),o}function Yd(e,t,o){var c=e.pingCache;if(c===null){c=e.pingCache=new jm;var f=new Set;c.set(t,f)}else f=c.get(t),f===void 0&&(f=new Set,c.set(t,f));f.has(o)||(f.add(o),e=Vm.bind(null,e,t,o),t.then(e,e))}function Xd(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Zd(e,t,o,c,f){return(e.mode&1)===0?(e===t?e.flags|=65536:(e.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(t=Cn(-1,1),t.tag=2,ns(o,t,1))),o.lanes|=1),e):(e.flags|=65536,e.lanes=f,e)}var Tm=K.ReactCurrentOwner,gr=!1;function sr(e,t,o,c){t.child=e===null?yd(t,null,o,c):Ro(t,e.child,o,c)}function eh(e,t,o,c,f){o=o.render;var m=t.ref;return Oo(t,f),c=Oc(e,t,o,c,m,f),o=Pc(),e!==null&&!gr?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~f,Rn(e,t,f)):(ft&&o&&gc(t),t.flags|=1,sr(e,t,c,f),t.child)}function th(e,t,o,c,f){if(e===null){var m=o.type;return typeof m=="function"&&!cu(m)&&m.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(t.tag=15,t.type=m,rh(e,t,m,c,f)):(e=dl(o.type,null,c,t,t.mode,f),e.ref=t.ref,e.return=t,t.child=e)}if(m=e.child,(e.lanes&f)===0){var b=m.memoizedProps;if(o=o.compare,o=o!==null?o:Ms,o(b,c)&&e.ref===t.ref)return Rn(e,t,f)}return t.flags|=1,e=cs(m,c),e.ref=t.ref,e.return=t,t.child=e}function rh(e,t,o,c,f){if(e!==null){var m=e.memoizedProps;if(Ms(m,c)&&e.ref===t.ref)if(gr=!1,t.pendingProps=c=m,(e.lanes&f)!==0)(e.flags&131072)!==0&&(gr=!0);else return t.lanes=e.lanes,Rn(e,t,f)}return Bc(e,t,o,c,f)}function nh(e,t,o){var c=t.pendingProps,f=c.children,m=e!==null?e.memoizedState:null;if(c.mode==="hidden")if((t.mode&1)===0)t.memoizedState={baseLanes:0,cachePool:null,transitions:null},st(Ao,Tr),Tr|=o;else{if((o&1073741824)===0)return e=m!==null?m.baseLanes|o:o,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,st(Ao,Tr),Tr|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},c=m!==null?m.baseLanes:o,st(Ao,Tr),Tr|=c}else m!==null?(c=m.baseLanes|o,t.memoizedState=null):c=o,st(Ao,Tr),Tr|=c;return sr(e,t,f,o),t.child}function sh(e,t){var o=t.ref;(e===null&&o!==null||e!==null&&e.ref!==o)&&(t.flags|=512,t.flags|=2097152)}function Bc(e,t,o,c,f){var m=mr(o)?Bs:Yt.current;return m=No(t,m),Oo(t,f),o=Oc(e,t,o,c,m,f),c=Pc(),e!==null&&!gr?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~f,Rn(e,t,f)):(ft&&c&&gc(t),t.flags|=1,sr(e,t,o,f),t.child)}function oh(e,t,o,c,f){if(mr(o)){var m=!0;Ai(t)}else m=!1;if(Oo(t,f),t.stateNode===null)el(e,t),Kd(t,o,c),Uc(t,o,c,f),c=!0;else if(e===null){var b=t.stateNode,j=t.memoizedProps;b.props=j;var I=b.context,G=o.contextType;typeof G=="object"&&G!==null?G=$r(G):(G=mr(o)?Bs:Yt.current,G=No(t,G));var oe=o.getDerivedStateFromProps,le=typeof oe=="function"||typeof b.getSnapshotBeforeUpdate=="function";le||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(j!==c||I!==G)&&Gd(t,b,c,G),rs=!1;var se=t.memoizedState;b.state=se,Hi(t,c,b,f),I=t.memoizedState,j!==c||se!==I||fr.current||rs?(typeof oe=="function"&&(Mc(t,o,oe,c),I=t.memoizedState),(j=rs||qd(t,o,j,c,se,I,G))?(le||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(t.flags|=4194308)):(typeof b.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=c,t.memoizedState=I),b.props=c,b.state=I,b.context=G,c=j):(typeof b.componentDidMount=="function"&&(t.flags|=4194308),c=!1)}else{b=t.stateNode,wd(e,t),j=t.memoizedProps,G=t.type===t.elementType?j:Jr(t.type,j),b.props=G,le=t.pendingProps,se=b.context,I=o.contextType,typeof I=="object"&&I!==null?I=$r(I):(I=mr(o)?Bs:Yt.current,I=No(t,I));var Se=o.getDerivedStateFromProps;(oe=typeof Se=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(j!==le||se!==I)&&Gd(t,b,c,I),rs=!1,se=t.memoizedState,b.state=se,Hi(t,c,b,f);var ke=t.memoizedState;j!==le||se!==ke||fr.current||rs?(typeof Se=="function"&&(Mc(t,o,Se,c),ke=t.memoizedState),(G=rs||qd(t,o,G,c,se,ke,I)||!1)?(oe||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(c,ke,I),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(c,ke,I)),typeof b.componentDidUpdate=="function"&&(t.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof b.componentDidUpdate!="function"||j===e.memoizedProps&&se===e.memoizedState||(t.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||j===e.memoizedProps&&se===e.memoizedState||(t.flags|=1024),t.memoizedProps=c,t.memoizedState=ke),b.props=c,b.state=ke,b.context=I,c=G):(typeof b.componentDidUpdate!="function"||j===e.memoizedProps&&se===e.memoizedState||(t.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||j===e.memoizedProps&&se===e.memoizedState||(t.flags|=1024),c=!1)}return zc(e,t,o,c,m,f)}function zc(e,t,o,c,f,m){sh(e,t);var b=(t.flags&128)!==0;if(!c&&!b)return f&&ud(t,o,!1),Rn(e,t,m);c=t.stateNode,Tm.current=t;var j=b&&typeof o.getDerivedStateFromError!="function"?null:c.render();return t.flags|=1,e!==null&&b?(t.child=Ro(t,e.child,null,m),t.child=Ro(t,null,j,m)):sr(e,t,j,m),t.memoizedState=c.state,f&&ud(t,o,!0),t.child}function ah(e){var t=e.stateNode;t.pendingContext?ld(e,t.pendingContext,t.pendingContext!==t.context):t.context&&ld(e,t.context,!1),Nc(e,t.containerInfo)}function ih(e,t,o,c,f){return Co(),yc(f),t.flags|=256,sr(e,t,o,c),t.child}var Wc={dehydrated:null,treeContext:null,retryLane:0};function Hc(e){return{baseLanes:e,cachePool:null,transitions:null}}function lh(e,t,o){var c=t.pendingProps,f=pt.current,m=!1,b=(t.flags&128)!==0,j;if((j=b)||(j=e!==null&&e.memoizedState===null?!1:(f&2)!==0),j?(m=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(f|=1),st(pt,f&1),e===null)return xc(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?((t.mode&1)===0?t.lanes=1:e.data==="$!"?t.lanes=8:t.lanes=1073741824,null):(b=c.children,e=c.fallback,m?(c=t.mode,m=t.child,b={mode:"hidden",children:b},(c&1)===0&&m!==null?(m.childLanes=0,m.pendingProps=b):m=hl(b,c,0,null),e=Xs(e,c,o,null),m.return=t,e.return=t,m.sibling=e,t.child=m,t.child.memoizedState=Hc(o),t.memoizedState=Wc,e):qc(t,b));if(f=e.memoizedState,f!==null&&(j=f.dehydrated,j!==null))return Cm(e,t,b,c,j,f,o);if(m){m=c.fallback,b=t.mode,f=e.child,j=f.sibling;var I={mode:"hidden",children:c.children};return(b&1)===0&&t.child!==f?(c=t.child,c.childLanes=0,c.pendingProps=I,t.deletions=null):(c=cs(f,I),c.subtreeFlags=f.subtreeFlags&14680064),j!==null?m=cs(j,m):(m=Xs(m,b,o,null),m.flags|=2),m.return=t,c.return=t,c.sibling=m,t.child=c,c=m,m=t.child,b=e.child.memoizedState,b=b===null?Hc(o):{baseLanes:b.baseLanes|o,cachePool:null,transitions:b.transitions},m.memoizedState=b,m.childLanes=e.childLanes&~o,t.memoizedState=Wc,c}return m=e.child,e=m.sibling,c=cs(m,{mode:"visible",children:c.children}),(t.mode&1)===0&&(c.lanes=o),c.return=t,c.sibling=null,e!==null&&(o=t.deletions,o===null?(t.deletions=[e],t.flags|=16):o.push(e)),t.child=c,t.memoizedState=null,c}function qc(e,t){return t=hl({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Zi(e,t,o,c){return c!==null&&yc(c),Ro(t,e.child,null,o),e=qc(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Cm(e,t,o,c,f,m,b){if(o)return t.flags&256?(t.flags&=-257,c=Fc(Error(r(422))),Zi(e,t,b,c)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(m=c.fallback,f=t.mode,c=hl({mode:"visible",children:c.children},f,0,null),m=Xs(m,f,b,null),m.flags|=2,c.return=t,m.return=t,c.sibling=m,t.child=c,(t.mode&1)!==0&&Ro(t,e.child,null,b),t.child.memoizedState=Hc(b),t.memoizedState=Wc,m);if((t.mode&1)===0)return Zi(e,t,b,null);if(f.data==="$!"){if(c=f.nextSibling&&f.nextSibling.dataset,c)var j=c.dgst;return c=j,m=Error(r(419)),c=Fc(m,c,void 0),Zi(e,t,b,c)}if(j=(b&e.childLanes)!==0,gr||j){if(c=Lt,c!==null){switch(b&-b){case 4:f=2;break;case 16:f=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:f=32;break;case 536870912:f=268435456;break;default:f=0}f=(f&(c.suspendedLanes|b))!==0?0:f,f!==0&&f!==m.retryLane&&(m.retryLane=f,Tn(e,f),Xr(c,e,f,-1))}return lu(),c=Fc(Error(r(421))),Zi(e,t,b,c)}return f.data==="$?"?(t.flags|=128,t.child=e.child,t=Bm.bind(null,e),f._reactRetry=t,null):(e=m.treeContext,jr=Xn(f.nextSibling),Nr=t,ft=!0,Gr=null,e!==null&&(Lr[Ar++]=Nn,Lr[Ar++]=jn,Lr[Ar++]=zs,Nn=e.id,jn=e.overflow,zs=t),t=qc(t,c.children),t.flags|=4096,t)}function ch(e,t,o){e.lanes|=t;var c=e.alternate;c!==null&&(c.lanes|=t),_c(e.return,t,o)}function Kc(e,t,o,c,f){var m=e.memoizedState;m===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:c,tail:o,tailMode:f}:(m.isBackwards=t,m.rendering=null,m.renderingStartTime=0,m.last=c,m.tail=o,m.tailMode=f)}function uh(e,t,o){var c=t.pendingProps,f=c.revealOrder,m=c.tail;if(sr(e,t,c.children,o),c=pt.current,(c&2)!==0)c=c&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&ch(e,o,t);else if(e.tag===19)ch(e,o,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}c&=1}if(st(pt,c),(t.mode&1)===0)t.memoizedState=null;else switch(f){case"forwards":for(o=t.child,f=null;o!==null;)e=o.alternate,e!==null&&qi(e)===null&&(f=o),o=o.sibling;o=f,o===null?(f=t.child,t.child=null):(f=o.sibling,o.sibling=null),Kc(t,!1,f,o,m);break;case"backwards":for(o=null,f=t.child,t.child=null;f!==null;){if(e=f.alternate,e!==null&&qi(e)===null){t.child=f;break}e=f.sibling,f.sibling=o,o=f,f=e}Kc(t,!0,o,null,m);break;case"together":Kc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function el(e,t){(t.mode&1)===0&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Rn(e,t,o){if(e!==null&&(t.dependencies=e.dependencies),Gs|=t.lanes,(o&t.childLanes)===0)return null;if(e!==null&&t.child!==e.child)throw Error(r(153));if(t.child!==null){for(e=t.child,o=cs(e,e.pendingProps),t.child=o,o.return=t;e.sibling!==null;)e=e.sibling,o=o.sibling=cs(e,e.pendingProps),o.return=t;o.sibling=null}return t.child}function Rm(e,t,o){switch(t.tag){case 3:ah(t),Co();break;case 5:Ed(t);break;case 1:mr(t.type)&&Ai(t);break;case 4:Nc(t,t.stateNode.containerInfo);break;case 10:var c=t.type._context,f=t.memoizedProps.value;st(Bi,c._currentValue),c._currentValue=f;break;case 13:if(c=t.memoizedState,c!==null)return c.dehydrated!==null?(st(pt,pt.current&1),t.flags|=128,null):(o&t.child.childLanes)!==0?lh(e,t,o):(st(pt,pt.current&1),e=Rn(e,t,o),e!==null?e.sibling:null);st(pt,pt.current&1);break;case 19:if(c=(o&t.childLanes)!==0,(e.flags&128)!==0){if(c)return uh(e,t,o);t.flags|=128}if(f=t.memoizedState,f!==null&&(f.rendering=null,f.tail=null,f.lastEffect=null),st(pt,pt.current),c)break;return null;case 22:case 23:return t.lanes=0,nh(e,t,o)}return Rn(e,t,o)}var dh,Gc,hh,fh;dh=function(e,t){for(var o=t.child;o!==null;){if(o.tag===5||o.tag===6)e.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===t)break;for(;o.sibling===null;){if(o.return===null||o.return===t)return;o=o.return}o.sibling.return=o.return,o=o.sibling}},Gc=function(){},hh=function(e,t,o,c){var f=e.memoizedProps;if(f!==c){e=t.stateNode,qs(un.current);var m=null;switch(o){case"input":f=te(e,f),c=te(e,c),m=[];break;case"select":f=V({},f,{value:void 0}),c=V({},c,{value:void 0}),m=[];break;case"textarea":f=wt(e,f),c=wt(e,c),m=[];break;default:typeof f.onClick!="function"&&typeof c.onClick=="function"&&(e.onclick=Pi)}Fn(o,c);var b;o=null;for(G in f)if(!c.hasOwnProperty(G)&&f.hasOwnProperty(G)&&f[G]!=null)if(G==="style"){var j=f[G];for(b in j)j.hasOwnProperty(b)&&(o||(o={}),o[b]="")}else G!=="dangerouslySetInnerHTML"&&G!=="children"&&G!=="suppressContentEditableWarning"&&G!=="suppressHydrationWarning"&&G!=="autoFocus"&&(i.hasOwnProperty(G)?m||(m=[]):(m=m||[]).push(G,null));for(G in c){var I=c[G];if(j=f?.[G],c.hasOwnProperty(G)&&I!==j&&(I!=null||j!=null))if(G==="style")if(j){for(b in j)!j.hasOwnProperty(b)||I&&I.hasOwnProperty(b)||(o||(o={}),o[b]="");for(b in I)I.hasOwnProperty(b)&&j[b]!==I[b]&&(o||(o={}),o[b]=I[b])}else o||(m||(m=[]),m.push(G,o)),o=I;else G==="dangerouslySetInnerHTML"?(I=I?I.__html:void 0,j=j?j.__html:void 0,I!=null&&j!==I&&(m=m||[]).push(G,I)):G==="children"?typeof I!="string"&&typeof I!="number"||(m=m||[]).push(G,""+I):G!=="suppressContentEditableWarning"&&G!=="suppressHydrationWarning"&&(i.hasOwnProperty(G)?(I!=null&&G==="onScroll"&&nt("scroll",e),m||j===I||(m=[])):(m=m||[]).push(G,I))}o&&(m=m||[]).push("style",o);var G=m;(t.updateQueue=G)&&(t.flags|=4)}},fh=function(e,t,o,c){o!==c&&(t.flags|=4)};function Va(e,t){if(!ft)switch(e.tailMode){case"hidden":t=e.tail;for(var o=null;t!==null;)t.alternate!==null&&(o=t),t=t.sibling;o===null?e.tail=null:o.sibling=null;break;case"collapsed":o=e.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:c.sibling=null}}function Zt(e){var t=e.alternate!==null&&e.alternate.child===e.child,o=0,c=0;if(t)for(var f=e.child;f!==null;)o|=f.lanes|f.childLanes,c|=f.subtreeFlags&14680064,c|=f.flags&14680064,f.return=e,f=f.sibling;else for(f=e.child;f!==null;)o|=f.lanes|f.childLanes,c|=f.subtreeFlags,c|=f.flags,f.return=e,f=f.sibling;return e.subtreeFlags|=c,e.childLanes=o,t}function Im(e,t,o){var c=t.pendingProps;switch(pc(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Zt(t),null;case 1:return mr(t.type)&&Li(),Zt(t),null;case 3:return c=t.stateNode,Po(),ut(fr),ut(Yt),Cc(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(e===null||e.child===null)&&(Fi(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,Gr!==null&&(ou(Gr),Gr=null))),Gc(e,t),Zt(t),null;case 5:jc(t);var f=qs(Aa.current);if(o=t.type,e!==null&&t.stateNode!=null)hh(e,t,o,c,f),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!c){if(t.stateNode===null)throw Error(r(166));return Zt(t),null}if(e=qs(un.current),Fi(t)){c=t.stateNode,o=t.type;var m=t.memoizedProps;switch(c[cn]=t,c[Ia]=m,e=(t.mode&1)!==0,o){case"dialog":nt("cancel",c),nt("close",c);break;case"iframe":case"object":case"embed":nt("load",c);break;case"video":case"audio":for(f=0;f<Qt.length;f++)nt(Qt[f],c);break;case"source":nt("error",c);break;case"img":case"image":case"link":nt("error",c),nt("load",c);break;case"details":nt("toggle",c);break;case"input":pe(c,m),nt("invalid",c);break;case"select":c._wrapperState={wasMultiple:!!m.multiple},nt("invalid",c);break;case"textarea":it(c,m),nt("invalid",c)}Fn(o,m),f=null;for(var b in m)if(m.hasOwnProperty(b)){var j=m[b];b==="children"?typeof j=="string"?c.textContent!==j&&(m.suppressHydrationWarning!==!0&&Oi(c.textContent,j,e),f=["children",j]):typeof j=="number"&&c.textContent!==""+j&&(m.suppressHydrationWarning!==!0&&Oi(c.textContent,j,e),f=["children",""+j]):i.hasOwnProperty(b)&&j!=null&&b==="onScroll"&&nt("scroll",c)}switch(o){case"input":br(c),Ze(c,m,!0);break;case"textarea":br(c),gt(c);break;case"select":case"option":break;default:typeof m.onClick=="function"&&(c.onclick=Pi)}c=f,t.updateQueue=c,c!==null&&(t.flags|=4)}else{b=f.nodeType===9?f:f.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Mt(o)),e==="http://www.w3.org/1999/xhtml"?o==="script"?(e=b.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof c.is=="string"?e=b.createElement(o,{is:c.is}):(e=b.createElement(o),o==="select"&&(b=e,c.multiple?b.multiple=!0:c.size&&(b.size=c.size))):e=b.createElementNS(e,o),e[cn]=t,e[Ia]=c,dh(e,t,!1,!1),t.stateNode=e;e:{switch(b=Ut(o,c),o){case"dialog":nt("cancel",e),nt("close",e),f=c;break;case"iframe":case"object":case"embed":nt("load",e),f=c;break;case"video":case"audio":for(f=0;f<Qt.length;f++)nt(Qt[f],e);f=c;break;case"source":nt("error",e),f=c;break;case"img":case"image":case"link":nt("error",e),nt("load",e),f=c;break;case"details":nt("toggle",e),f=c;break;case"input":pe(e,c),f=te(e,c),nt("invalid",e);break;case"option":f=c;break;case"select":e._wrapperState={wasMultiple:!!c.multiple},f=V({},c,{value:void 0}),nt("invalid",e);break;case"textarea":it(e,c),f=wt(e,c),nt("invalid",e);break;default:f=c}Fn(o,f),j=f;for(m in j)if(j.hasOwnProperty(m)){var I=j[m];m==="style"?vs(e,I):m==="dangerouslySetInnerHTML"?(I=I?I.__html:void 0,I!=null&&oi(e,I)):m==="children"?typeof I=="string"?(o!=="textarea"||I!=="")&&Mn(e,I):typeof I=="number"&&Mn(e,""+I):m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&m!=="autoFocus"&&(i.hasOwnProperty(m)?I!=null&&m==="onScroll"&&nt("scroll",e):I!=null&&q(e,m,I,b))}switch(o){case"input":br(e),Ze(e,c,!1);break;case"textarea":br(e),gt(e);break;case"option":c.value!=null&&e.setAttribute("value",""+Fe(c.value));break;case"select":e.multiple=!!c.multiple,m=c.value,m!=null?dt(e,!!c.multiple,m,!1):c.defaultValue!=null&&dt(e,!!c.multiple,c.defaultValue,!0);break;default:typeof f.onClick=="function"&&(e.onclick=Pi)}switch(o){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}}c&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Zt(t),null;case 6:if(e&&t.stateNode!=null)fh(e,t,e.memoizedProps,c);else{if(typeof c!="string"&&t.stateNode===null)throw Error(r(166));if(o=qs(Aa.current),qs(un.current),Fi(t)){if(c=t.stateNode,o=t.memoizedProps,c[cn]=t,(m=c.nodeValue!==o)&&(e=Nr,e!==null))switch(e.tag){case 3:Oi(c.nodeValue,o,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Oi(c.nodeValue,o,(e.mode&1)!==0)}m&&(t.flags|=4)}else c=(o.nodeType===9?o:o.ownerDocument).createTextNode(c),c[cn]=t,t.stateNode=c}return Zt(t),null;case 13:if(ut(pt),c=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(ft&&jr!==null&&(t.mode&1)!==0&&(t.flags&128)===0)pd(),Co(),t.flags|=98560,m=!1;else if(m=Fi(t),c!==null&&c.dehydrated!==null){if(e===null){if(!m)throw Error(r(318));if(m=t.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(r(317));m[cn]=t}else Co(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Zt(t),m=!1}else Gr!==null&&(ou(Gr),Gr=null),m=!0;if(!m)return t.flags&65536?t:null}return(t.flags&128)!==0?(t.lanes=o,t):(c=c!==null,c!==(e!==null&&e.memoizedState!==null)&&c&&(t.child.flags|=8192,(t.mode&1)!==0&&(e===null||(pt.current&1)!==0?Tt===0&&(Tt=3):lu())),t.updateQueue!==null&&(t.flags|=4),Zt(t),null);case 4:return Po(),Gc(e,t),e===null&&Fs(t.stateNode.containerInfo),Zt(t),null;case 10:return Sc(t.type._context),Zt(t),null;case 17:return mr(t.type)&&Li(),Zt(t),null;case 19:if(ut(pt),m=t.memoizedState,m===null)return Zt(t),null;if(c=(t.flags&128)!==0,b=m.rendering,b===null)if(c)Va(m,!1);else{if(Tt!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(b=qi(e),b!==null){for(t.flags|=128,Va(m,!1),c=b.updateQueue,c!==null&&(t.updateQueue=c,t.flags|=4),t.subtreeFlags=0,c=o,o=t.child;o!==null;)m=o,e=c,m.flags&=14680066,b=m.alternate,b===null?(m.childLanes=0,m.lanes=e,m.child=null,m.subtreeFlags=0,m.memoizedProps=null,m.memoizedState=null,m.updateQueue=null,m.dependencies=null,m.stateNode=null):(m.childLanes=b.childLanes,m.lanes=b.lanes,m.child=b.child,m.subtreeFlags=0,m.deletions=null,m.memoizedProps=b.memoizedProps,m.memoizedState=b.memoizedState,m.updateQueue=b.updateQueue,m.type=b.type,e=b.dependencies,m.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),o=o.sibling;return st(pt,pt.current&1|2),t.child}e=e.sibling}m.tail!==null&&qe()>$o&&(t.flags|=128,c=!0,Va(m,!1),t.lanes=4194304)}else{if(!c)if(e=qi(b),e!==null){if(t.flags|=128,c=!0,o=e.updateQueue,o!==null&&(t.updateQueue=o,t.flags|=4),Va(m,!0),m.tail===null&&m.tailMode==="hidden"&&!b.alternate&&!ft)return Zt(t),null}else 2*qe()-m.renderingStartTime>$o&&o!==1073741824&&(t.flags|=128,c=!0,Va(m,!1),t.lanes=4194304);m.isBackwards?(b.sibling=t.child,t.child=b):(o=m.last,o!==null?o.sibling=b:t.child=b,m.last=b)}return m.tail!==null?(t=m.tail,m.rendering=t,m.tail=t.sibling,m.renderingStartTime=qe(),t.sibling=null,o=pt.current,st(pt,c?o&1|2:o&1),t):(Zt(t),null);case 22:case 23:return iu(),c=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==c&&(t.flags|=8192),c&&(t.mode&1)!==0?(Tr&1073741824)!==0&&(Zt(t),t.subtreeFlags&6&&(t.flags|=8192)):Zt(t),null;case 24:return null;case 25:return null}throw Error(r(156,t.tag))}function Om(e,t){switch(pc(t),t.tag){case 1:return mr(t.type)&&Li(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Po(),ut(fr),ut(Yt),Cc(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 5:return jc(t),null;case 13:if(ut(pt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(r(340));Co()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return ut(pt),null;case 4:return Po(),null;case 10:return Sc(t.type._context),null;case 22:case 23:return iu(),null;case 24:return null;default:return null}}var tl=!1,er=!1,Pm=typeof WeakSet=="function"?WeakSet:Set,Ee=null;function Lo(e,t){var o=e.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(c){yt(e,t,c)}else o.current=null}function Jc(e,t,o){try{o()}catch(c){yt(e,t,c)}}var mh=!1;function Dm(e,t){if(ic=mo,e=Ti(),ka(e)){if("selectionStart"in e)var o={start:e.selectionStart,end:e.selectionEnd};else e:{o=(o=e.ownerDocument)&&o.defaultView||window;var c=o.getSelection&&o.getSelection();if(c&&c.rangeCount!==0){o=c.anchorNode;var f=c.anchorOffset,m=c.focusNode;c=c.focusOffset;try{o.nodeType,m.nodeType}catch{o=null;break e}var b=0,j=-1,I=-1,G=0,oe=0,le=e,se=null;t:for(;;){for(var Se;le!==o||f!==0&&le.nodeType!==3||(j=b+f),le!==m||c!==0&&le.nodeType!==3||(I=b+c),le.nodeType===3&&(b+=le.nodeValue.length),(Se=le.firstChild)!==null;)se=le,le=Se;for(;;){if(le===e)break t;if(se===o&&++G===f&&(j=b),se===m&&++oe===c&&(I=b),(Se=le.nextSibling)!==null)break;le=se,se=le.parentNode}le=Se}o=j===-1||I===-1?null:{start:j,end:I}}else o=null}o=o||{start:0,end:0}}else o=null;for(lc={focusedElem:e,selectionRange:o},mo=!1,Ee=t;Ee!==null;)if(t=Ee,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Ee=e;else for(;Ee!==null;){t=Ee;try{var ke=t.alternate;if((t.flags&1024)!==0)switch(t.tag){case 0:case 11:case 15:break;case 1:if(ke!==null){var je=ke.memoizedProps,St=ke.memoizedState,W=t.stateNode,M=W.getSnapshotBeforeUpdate(t.elementType===t.type?je:Jr(t.type,je),St);W.__reactInternalSnapshotBeforeUpdate=M}break;case 3:var H=t.stateNode.containerInfo;H.nodeType===1?H.textContent="":H.nodeType===9&&H.documentElement&&H.removeChild(H.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(ue){yt(t,t.return,ue)}if(e=t.sibling,e!==null){e.return=t.return,Ee=e;break}Ee=t.return}return ke=mh,mh=!1,ke}function Ba(e,t,o){var c=t.updateQueue;if(c=c!==null?c.lastEffect:null,c!==null){var f=c=c.next;do{if((f.tag&e)===e){var m=f.destroy;f.destroy=void 0,m!==void 0&&Jc(t,o,m)}f=f.next}while(f!==c)}}function rl(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var o=t=t.next;do{if((o.tag&e)===e){var c=o.create;o.destroy=c()}o=o.next}while(o!==t)}}function Qc(e){var t=e.ref;if(t!==null){var o=e.stateNode;switch(e.tag){case 5:e=o;break;default:e=o}typeof t=="function"?t(e):t.current=e}}function gh(e){var t=e.alternate;t!==null&&(e.alternate=null,gh(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[cn],delete t[Ia],delete t[hc],delete t[pm],delete t[vm])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ph(e){return e.tag===5||e.tag===3||e.tag===4}function vh(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||ph(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Yc(e,t,o){var c=e.tag;if(c===5||c===6)e=e.stateNode,t?o.nodeType===8?o.parentNode.insertBefore(e,t):o.insertBefore(e,t):(o.nodeType===8?(t=o.parentNode,t.insertBefore(e,o)):(t=o,t.appendChild(e)),o=o._reactRootContainer,o!=null||t.onclick!==null||(t.onclick=Pi));else if(c!==4&&(e=e.child,e!==null))for(Yc(e,t,o),e=e.sibling;e!==null;)Yc(e,t,o),e=e.sibling}function Xc(e,t,o){var c=e.tag;if(c===5||c===6)e=e.stateNode,t?o.insertBefore(e,t):o.appendChild(e);else if(c!==4&&(e=e.child,e!==null))for(Xc(e,t,o),e=e.sibling;e!==null;)Xc(e,t,o),e=e.sibling}var Vt=null,Qr=!1;function ss(e,t,o){for(o=o.child;o!==null;)xh(e,t,o),o=o.sibling}function xh(e,t,o){if(Dr&&typeof Dr.onCommitFiberUnmount=="function")try{Dr.onCommitFiberUnmount(ws,o)}catch{}switch(o.tag){case 5:er||Lo(o,t);case 6:var c=Vt,f=Qr;Vt=null,ss(e,t,o),Vt=c,Qr=f,Vt!==null&&(Qr?(e=Vt,o=o.stateNode,e.nodeType===8?e.parentNode.removeChild(o):e.removeChild(o)):Vt.removeChild(o.stateNode));break;case 18:Vt!==null&&(Qr?(e=Vt,o=o.stateNode,e.nodeType===8?dc(e.parentNode,o):e.nodeType===1&&dc(e,o),yn(e)):dc(Vt,o.stateNode));break;case 4:c=Vt,f=Qr,Vt=o.stateNode.containerInfo,Qr=!0,ss(e,t,o),Vt=c,Qr=f;break;case 0:case 11:case 14:case 15:if(!er&&(c=o.updateQueue,c!==null&&(c=c.lastEffect,c!==null))){f=c=c.next;do{var m=f,b=m.destroy;m=m.tag,b!==void 0&&((m&2)!==0||(m&4)!==0)&&Jc(o,t,b),f=f.next}while(f!==c)}ss(e,t,o);break;case 1:if(!er&&(Lo(o,t),c=o.stateNode,typeof c.componentWillUnmount=="function"))try{c.props=o.memoizedProps,c.state=o.memoizedState,c.componentWillUnmount()}catch(j){yt(o,t,j)}ss(e,t,o);break;case 21:ss(e,t,o);break;case 22:o.mode&1?(er=(c=er)||o.memoizedState!==null,ss(e,t,o),er=c):ss(e,t,o);break;default:ss(e,t,o)}}function yh(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var o=e.stateNode;o===null&&(o=e.stateNode=new Pm),t.forEach(function(c){var f=zm.bind(null,e,c);o.has(c)||(o.add(c),c.then(f,f))})}}function Yr(e,t){var o=t.deletions;if(o!==null)for(var c=0;c<o.length;c++){var f=o[c];try{var m=e,b=t,j=b;e:for(;j!==null;){switch(j.tag){case 5:Vt=j.stateNode,Qr=!1;break e;case 3:Vt=j.stateNode.containerInfo,Qr=!0;break e;case 4:Vt=j.stateNode.containerInfo,Qr=!0;break e}j=j.return}if(Vt===null)throw Error(r(160));xh(m,b,f),Vt=null,Qr=!1;var I=f.alternate;I!==null&&(I.return=null),f.return=null}catch(G){yt(f,t,G)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)bh(t,e),t=t.sibling}function bh(e,t){var o=e.alternate,c=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Yr(t,e),hn(e),c&4){try{Ba(3,e,e.return),rl(3,e)}catch(je){yt(e,e.return,je)}try{Ba(5,e,e.return)}catch(je){yt(e,e.return,je)}}break;case 1:Yr(t,e),hn(e),c&512&&o!==null&&Lo(o,o.return);break;case 5:if(Yr(t,e),hn(e),c&512&&o!==null&&Lo(o,o.return),e.flags&32){var f=e.stateNode;try{Mn(f,"")}catch(je){yt(e,e.return,je)}}if(c&4&&(f=e.stateNode,f!=null)){var m=e.memoizedProps,b=o!==null?o.memoizedProps:m,j=e.type,I=e.updateQueue;if(e.updateQueue=null,I!==null)try{j==="input"&&m.type==="radio"&&m.name!=null&&_e(f,m),Ut(j,b);var G=Ut(j,m);for(b=0;b<I.length;b+=2){var oe=I[b],le=I[b+1];oe==="style"?vs(f,le):oe==="dangerouslySetInnerHTML"?oi(f,le):oe==="children"?Mn(f,le):q(f,oe,le,G)}switch(j){case"input":De(f,m);break;case"textarea":Et(f,m);break;case"select":var se=f._wrapperState.wasMultiple;f._wrapperState.wasMultiple=!!m.multiple;var Se=m.value;Se!=null?dt(f,!!m.multiple,Se,!1):se!==!!m.multiple&&(m.defaultValue!=null?dt(f,!!m.multiple,m.defaultValue,!0):dt(f,!!m.multiple,m.multiple?[]:"",!1))}f[Ia]=m}catch(je){yt(e,e.return,je)}}break;case 6:if(Yr(t,e),hn(e),c&4){if(e.stateNode===null)throw Error(r(162));f=e.stateNode,m=e.memoizedProps;try{f.nodeValue=m}catch(je){yt(e,e.return,je)}}break;case 3:if(Yr(t,e),hn(e),c&4&&o!==null&&o.memoizedState.isDehydrated)try{yn(t.containerInfo)}catch(je){yt(e,e.return,je)}break;case 4:Yr(t,e),hn(e);break;case 13:Yr(t,e),hn(e),f=e.child,f.flags&8192&&(m=f.memoizedState!==null,f.stateNode.isHidden=m,!m||f.alternate!==null&&f.alternate.memoizedState!==null||(tu=qe())),c&4&&yh(e);break;case 22:if(oe=o!==null&&o.memoizedState!==null,e.mode&1?(er=(G=er)||oe,Yr(t,e),er=G):Yr(t,e),hn(e),c&8192){if(G=e.memoizedState!==null,(e.stateNode.isHidden=G)&&!oe&&(e.mode&1)!==0)for(Ee=e,oe=e.child;oe!==null;){for(le=Ee=oe;Ee!==null;){switch(se=Ee,Se=se.child,se.tag){case 0:case 11:case 14:case 15:Ba(4,se,se.return);break;case 1:Lo(se,se.return);var ke=se.stateNode;if(typeof ke.componentWillUnmount=="function"){c=se,o=se.return;try{t=c,ke.props=t.memoizedProps,ke.state=t.memoizedState,ke.componentWillUnmount()}catch(je){yt(c,o,je)}}break;case 5:Lo(se,se.return);break;case 22:if(se.memoizedState!==null){_h(le);continue}}Se!==null?(Se.return=se,Ee=Se):_h(le)}oe=oe.sibling}e:for(oe=null,le=e;;){if(le.tag===5){if(oe===null){oe=le;try{f=le.stateNode,G?(m=f.style,typeof m.setProperty=="function"?m.setProperty("display","none","important"):m.display="none"):(j=le.stateNode,I=le.memoizedProps.style,b=I!=null&&I.hasOwnProperty("display")?I.display:null,j.style.display=ps("display",b))}catch(je){yt(e,e.return,je)}}}else if(le.tag===6){if(oe===null)try{le.stateNode.nodeValue=G?"":le.memoizedProps}catch(je){yt(e,e.return,je)}}else if((le.tag!==22&&le.tag!==23||le.memoizedState===null||le===e)&&le.child!==null){le.child.return=le,le=le.child;continue}if(le===e)break e;for(;le.sibling===null;){if(le.return===null||le.return===e)break e;oe===le&&(oe=null),le=le.return}oe===le&&(oe=null),le.sibling.return=le.return,le=le.sibling}}break;case 19:Yr(t,e),hn(e),c&4&&yh(e);break;case 21:break;default:Yr(t,e),hn(e)}}function hn(e){var t=e.flags;if(t&2){try{e:{for(var o=e.return;o!==null;){if(ph(o)){var c=o;break e}o=o.return}throw Error(r(160))}switch(c.tag){case 5:var f=c.stateNode;c.flags&32&&(Mn(f,""),c.flags&=-33);var m=vh(e);Xc(e,m,f);break;case 3:case 4:var b=c.stateNode.containerInfo,j=vh(e);Yc(e,j,b);break;default:throw Error(r(161))}}catch(I){yt(e,e.return,I)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Lm(e,t,o){Ee=e,wh(e)}function wh(e,t,o){for(var c=(e.mode&1)!==0;Ee!==null;){var f=Ee,m=f.child;if(f.tag===22&&c){var b=f.memoizedState!==null||tl;if(!b){var j=f.alternate,I=j!==null&&j.memoizedState!==null||er;j=tl;var G=er;if(tl=b,(er=I)&&!G)for(Ee=f;Ee!==null;)b=Ee,I=b.child,b.tag===22&&b.memoizedState!==null?Eh(f):I!==null?(I.return=b,Ee=I):Eh(f);for(;m!==null;)Ee=m,wh(m),m=m.sibling;Ee=f,tl=j,er=G}Sh(e)}else(f.subtreeFlags&8772)!==0&&m!==null?(m.return=f,Ee=m):Sh(e)}}function Sh(e){for(;Ee!==null;){var t=Ee;if((t.flags&8772)!==0){var o=t.alternate;try{if((t.flags&8772)!==0)switch(t.tag){case 0:case 11:case 15:er||rl(5,t);break;case 1:var c=t.stateNode;if(t.flags&4&&!er)if(o===null)c.componentDidMount();else{var f=t.elementType===t.type?o.memoizedProps:Jr(t.type,o.memoizedProps);c.componentDidUpdate(f,o.memoizedState,c.__reactInternalSnapshotBeforeUpdate)}var m=t.updateQueue;m!==null&&_d(t,m,c);break;case 3:var b=t.updateQueue;if(b!==null){if(o=null,t.child!==null)switch(t.child.tag){case 5:o=t.child.stateNode;break;case 1:o=t.child.stateNode}_d(t,b,o)}break;case 5:var j=t.stateNode;if(o===null&&t.flags&4){o=j;var I=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":I.autoFocus&&o.focus();break;case"img":I.src&&(o.src=I.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var G=t.alternate;if(G!==null){var oe=G.memoizedState;if(oe!==null){var le=oe.dehydrated;le!==null&&yn(le)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}er||t.flags&512&&Qc(t)}catch(se){yt(t,t.return,se)}}if(t===e){Ee=null;break}if(o=t.sibling,o!==null){o.return=t.return,Ee=o;break}Ee=t.return}}function _h(e){for(;Ee!==null;){var t=Ee;if(t===e){Ee=null;break}var o=t.sibling;if(o!==null){o.return=t.return,Ee=o;break}Ee=t.return}}function Eh(e){for(;Ee!==null;){var t=Ee;try{switch(t.tag){case 0:case 11:case 15:var o=t.return;try{rl(4,t)}catch(I){yt(t,o,I)}break;case 1:var c=t.stateNode;if(typeof c.componentDidMount=="function"){var f=t.return;try{c.componentDidMount()}catch(I){yt(t,f,I)}}var m=t.return;try{Qc(t)}catch(I){yt(t,m,I)}break;case 5:var b=t.return;try{Qc(t)}catch(I){yt(t,b,I)}}}catch(I){yt(t,t.return,I)}if(t===e){Ee=null;break}var j=t.sibling;if(j!==null){j.return=t.return,Ee=j;break}Ee=t.return}}var Am=Math.ceil,nl=K.ReactCurrentDispatcher,Zc=K.ReactCurrentOwner,Ur=K.ReactCurrentBatchConfig,Ke=0,Lt=null,_t=null,Bt=0,Tr=0,Ao=Zn(0),Tt=0,za=null,Gs=0,sl=0,eu=0,Wa=null,pr=null,tu=0,$o=1/0,In=null,ol=!1,ru=null,os=null,al=!1,as=null,il=0,Ha=0,nu=null,ll=-1,cl=0;function or(){return(Ke&6)!==0?qe():ll!==-1?ll:ll=qe()}function is(e){return(e.mode&1)===0?1:(Ke&2)!==0&&Bt!==0?Bt&-Bt:ym.transition!==null?(cl===0&&(cl=ca()),cl):(e=xe,e!==0||(e=window.event,e=e===void 0?16:Rs(e.type)),e)}function Xr(e,t,o,c){if(50<Ha)throw Ha=0,nu=null,Error(r(185));Es(e,o,c),((Ke&2)===0||e!==Lt)&&(e===Lt&&((Ke&2)===0&&(sl|=o),Tt===4&&ls(e,Bt)),vr(e,c),o===1&&Ke===0&&(t.mode&1)===0&&($o=qe()+500,$i&&ts()))}function vr(e,t){var o=e.callbackNode;fo(e,t);var c=Bn(e,e===Lt?Bt:0);if(c===0)o!==null&&sn(o),e.callbackNode=null,e.callbackPriority=0;else if(t=c&-c,e.callbackPriority!==t){if(o!=null&&sn(o),t===1)e.tag===0?xm(Nh.bind(null,e)):dd(Nh.bind(null,e)),mm(function(){(Ke&6)===0&&ts()}),o=null;else{switch(Wt(c)){case 1:o=oa;break;case 4:o=bs;break;case 16:o=Pr;break;case 536870912:o=aa;break;default:o=Pr}o=Dh(o,kh.bind(null,e))}e.callbackPriority=t,e.callbackNode=o}}function kh(e,t){if(ll=-1,cl=0,(Ke&6)!==0)throw Error(r(327));var o=e.callbackNode;if(Mo()&&e.callbackNode!==o)return null;var c=Bn(e,e===Lt?Bt:0);if(c===0)return null;if((c&30)!==0||(c&e.expiredLanes)!==0||t)t=ul(e,c);else{t=c;var f=Ke;Ke|=2;var m=Th();(Lt!==e||Bt!==t)&&(In=null,$o=qe()+500,Qs(e,t));do try{Um();break}catch(j){jh(e,j)}while(!0);wc(),nl.current=m,Ke=f,_t!==null?t=0:(Lt=null,Bt=0,t=Tt)}if(t!==0){if(t===2&&(f=rr(e),f!==0&&(c=f,t=su(e,f))),t===1)throw o=za,Qs(e,0),ls(e,c),vr(e,qe()),o;if(t===6)ls(e,c);else{if(f=e.current.alternate,(c&30)===0&&!$m(f)&&(t=ul(e,c),t===2&&(m=rr(e),m!==0&&(c=m,t=su(e,m))),t===1))throw o=za,Qs(e,0),ls(e,c),vr(e,qe()),o;switch(e.finishedWork=f,e.finishedLanes=c,t){case 0:case 1:throw Error(r(345));case 2:Ys(e,pr,In);break;case 3:if(ls(e,c),(c&130023424)===c&&(t=tu+500-qe(),10<t)){if(Bn(e,0)!==0)break;if(f=e.suspendedLanes,(f&c)!==c){or(),e.pingedLanes|=e.suspendedLanes&f;break}e.timeoutHandle=uc(Ys.bind(null,e,pr,In),t);break}Ys(e,pr,In);break;case 4:if(ls(e,c),(c&4194240)===c)break;for(t=e.eventTimes,f=-1;0<c;){var b=31-_r(c);m=1<<b,b=t[b],b>f&&(f=b),c&=~m}if(c=f,c=qe()-c,c=(120>c?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*Am(c/1960))-c,10<c){e.timeoutHandle=uc(Ys.bind(null,e,pr,In),c);break}Ys(e,pr,In);break;case 5:Ys(e,pr,In);break;default:throw Error(r(329))}}}return vr(e,qe()),e.callbackNode===o?kh.bind(null,e):null}function su(e,t){var o=Wa;return e.current.memoizedState.isDehydrated&&(Qs(e,t).flags|=256),e=ul(e,t),e!==2&&(t=pr,pr=o,t!==null&&ou(t)),e}function ou(e){pr===null?pr=e:pr.push.apply(pr,e)}function $m(e){for(var t=e;;){if(t.flags&16384){var o=t.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var c=0;c<o.length;c++){var f=o[c],m=f.getSnapshot;f=f.value;try{if(!ur(m(),f))return!1}catch{return!1}}}if(o=t.child,t.subtreeFlags&16384&&o!==null)o.return=t,t=o;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ls(e,t){for(t&=~eu,t&=~sl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var o=31-_r(t),c=1<<o;e[o]=-1,t&=~c}}function Nh(e){if((Ke&6)!==0)throw Error(r(327));Mo();var t=Bn(e,0);if((t&1)===0)return vr(e,qe()),null;var o=ul(e,t);if(e.tag!==0&&o===2){var c=rr(e);c!==0&&(t=c,o=su(e,c))}if(o===1)throw o=za,Qs(e,0),ls(e,t),vr(e,qe()),o;if(o===6)throw Error(r(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Ys(e,pr,In),vr(e,qe()),null}function au(e,t){var o=Ke;Ke|=1;try{return e(t)}finally{Ke=o,Ke===0&&($o=qe()+500,$i&&ts())}}function Js(e){as!==null&&as.tag===0&&(Ke&6)===0&&Mo();var t=Ke;Ke|=1;var o=Ur.transition,c=xe;try{if(Ur.transition=null,xe=1,e)return e()}finally{xe=c,Ur.transition=o,Ke=t,(Ke&6)===0&&ts()}}function iu(){Tr=Ao.current,ut(Ao)}function Qs(e,t){e.finishedWork=null,e.finishedLanes=0;var o=e.timeoutHandle;if(o!==-1&&(e.timeoutHandle=-1,fm(o)),_t!==null)for(o=_t.return;o!==null;){var c=o;switch(pc(c),c.tag){case 1:c=c.type.childContextTypes,c!=null&&Li();break;case 3:Po(),ut(fr),ut(Yt),Cc();break;case 5:jc(c);break;case 4:Po();break;case 13:ut(pt);break;case 19:ut(pt);break;case 10:Sc(c.type._context);break;case 22:case 23:iu()}o=o.return}if(Lt=e,_t=e=cs(e.current,null),Bt=Tr=t,Tt=0,za=null,eu=sl=Gs=0,pr=Wa=null,Hs!==null){for(t=0;t<Hs.length;t++)if(o=Hs[t],c=o.interleaved,c!==null){o.interleaved=null;var f=c.next,m=o.pending;if(m!==null){var b=m.next;m.next=f,c.next=b}o.pending=c}Hs=null}return e}function jh(e,t){do{var o=_t;try{if(wc(),Ki.current=Yi,Gi){for(var c=vt.memoizedState;c!==null;){var f=c.queue;f!==null&&(f.pending=null),c=c.next}Gi=!1}if(Ks=0,Dt=jt=vt=null,$a=!1,Ma=0,Zc.current=null,o===null||o.return===null){Tt=1,za=t,_t=null;break}e:{var m=e,b=o.return,j=o,I=t;if(t=Bt,j.flags|=32768,I!==null&&typeof I=="object"&&typeof I.then=="function"){var G=I,oe=j,le=oe.tag;if((oe.mode&1)===0&&(le===0||le===11||le===15)){var se=oe.alternate;se?(oe.updateQueue=se.updateQueue,oe.memoizedState=se.memoizedState,oe.lanes=se.lanes):(oe.updateQueue=null,oe.memoizedState=null)}var Se=Xd(b);if(Se!==null){Se.flags&=-257,Zd(Se,b,j,m,t),Se.mode&1&&Yd(m,G,t),t=Se,I=G;var ke=t.updateQueue;if(ke===null){var je=new Set;je.add(I),t.updateQueue=je}else ke.add(I);break e}else{if((t&1)===0){Yd(m,G,t),lu();break e}I=Error(r(426))}}else if(ft&&j.mode&1){var St=Xd(b);if(St!==null){(St.flags&65536)===0&&(St.flags|=256),Zd(St,b,j,m,t),yc(Do(I,j));break e}}m=I=Do(I,j),Tt!==4&&(Tt=2),Wa===null?Wa=[m]:Wa.push(m),m=b;do{switch(m.tag){case 3:m.flags|=65536,t&=-t,m.lanes|=t;var W=Jd(m,I,t);Sd(m,W);break e;case 1:j=I;var M=m.type,H=m.stateNode;if((m.flags&128)===0&&(typeof M.getDerivedStateFromError=="function"||H!==null&&typeof H.componentDidCatch=="function"&&(os===null||!os.has(H)))){m.flags|=65536,t&=-t,m.lanes|=t;var ue=Qd(m,j,t);Sd(m,ue);break e}}m=m.return}while(m!==null)}Rh(o)}catch(Ce){t=Ce,_t===o&&o!==null&&(_t=o=o.return);continue}break}while(!0)}function Th(){var e=nl.current;return nl.current=Yi,e===null?Yi:e}function lu(){(Tt===0||Tt===3||Tt===2)&&(Tt=4),Lt===null||(Gs&268435455)===0&&(sl&268435455)===0||ls(Lt,Bt)}function ul(e,t){var o=Ke;Ke|=2;var c=Th();(Lt!==e||Bt!==t)&&(In=null,Qs(e,t));do try{Mm();break}catch(f){jh(e,f)}while(!0);if(wc(),Ke=o,nl.current=c,_t!==null)throw Error(r(261));return Lt=null,Bt=0,Tt}function Mm(){for(;_t!==null;)Ch(_t)}function Um(){for(;_t!==null&&!li();)Ch(_t)}function Ch(e){var t=Ph(e.alternate,e,Tr);e.memoizedProps=e.pendingProps,t===null?Rh(e):_t=t,Zc.current=null}function Rh(e){var t=e;do{var o=t.alternate;if(e=t.return,(t.flags&32768)===0){if(o=Im(o,t,Tr),o!==null){_t=o;return}}else{if(o=Om(o,t),o!==null){o.flags&=32767,_t=o;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Tt=6,_t=null;return}}if(t=t.sibling,t!==null){_t=t;return}_t=t=e}while(t!==null);Tt===0&&(Tt=5)}function Ys(e,t,o){var c=xe,f=Ur.transition;try{Ur.transition=null,xe=1,Fm(e,t,o,c)}finally{Ur.transition=f,xe=c}return null}function Fm(e,t,o,c){do Mo();while(as!==null);if((Ke&6)!==0)throw Error(r(327));o=e.finishedWork;var f=e.finishedLanes;if(o===null)return null;if(e.finishedWork=null,e.finishedLanes=0,o===e.current)throw Error(r(177));e.callbackNode=null,e.callbackPriority=0;var m=o.lanes|o.childLanes;if(ua(e,m),e===Lt&&(_t=Lt=null,Bt=0),(o.subtreeFlags&2064)===0&&(o.flags&2064)===0||al||(al=!0,Dh(Pr,function(){return Mo(),null})),m=(o.flags&15990)!==0,(o.subtreeFlags&15990)!==0||m){m=Ur.transition,Ur.transition=null;var b=xe;xe=1;var j=Ke;Ke|=4,Zc.current=null,Dm(e,o),bh(o,e),oc(lc),mo=!!ic,lc=ic=null,e.current=o,Lm(o),Or(),Ke=j,xe=b,Ur.transition=m}else e.current=o;if(al&&(al=!1,as=e,il=f),m=e.pendingLanes,m===0&&(os=null),ia(o.stateNode),vr(e,qe()),t!==null)for(c=e.onRecoverableError,o=0;o<t.length;o++)f=t[o],c(f.value,{componentStack:f.stack,digest:f.digest});if(ol)throw ol=!1,e=ru,ru=null,e;return(il&1)!==0&&e.tag!==0&&Mo(),m=e.pendingLanes,(m&1)!==0?e===nu?Ha++:(Ha=0,nu=e):Ha=0,ts(),null}function Mo(){if(as!==null){var e=Wt(il),t=Ur.transition,o=xe;try{if(Ur.transition=null,xe=16>e?16:e,as===null)var c=!1;else{if(e=as,as=null,il=0,(Ke&6)!==0)throw Error(r(331));var f=Ke;for(Ke|=4,Ee=e.current;Ee!==null;){var m=Ee,b=m.child;if((Ee.flags&16)!==0){var j=m.deletions;if(j!==null){for(var I=0;I<j.length;I++){var G=j[I];for(Ee=G;Ee!==null;){var oe=Ee;switch(oe.tag){case 0:case 11:case 15:Ba(8,oe,m)}var le=oe.child;if(le!==null)le.return=oe,Ee=le;else for(;Ee!==null;){oe=Ee;var se=oe.sibling,Se=oe.return;if(gh(oe),oe===G){Ee=null;break}if(se!==null){se.return=Se,Ee=se;break}Ee=Se}}}var ke=m.alternate;if(ke!==null){var je=ke.child;if(je!==null){ke.child=null;do{var St=je.sibling;je.sibling=null,je=St}while(je!==null)}}Ee=m}}if((m.subtreeFlags&2064)!==0&&b!==null)b.return=m,Ee=b;else e:for(;Ee!==null;){if(m=Ee,(m.flags&2048)!==0)switch(m.tag){case 0:case 11:case 15:Ba(9,m,m.return)}var W=m.sibling;if(W!==null){W.return=m.return,Ee=W;break e}Ee=m.return}}var M=e.current;for(Ee=M;Ee!==null;){b=Ee;var H=b.child;if((b.subtreeFlags&2064)!==0&&H!==null)H.return=b,Ee=H;else e:for(b=M;Ee!==null;){if(j=Ee,(j.flags&2048)!==0)try{switch(j.tag){case 0:case 11:case 15:rl(9,j)}}catch(Ce){yt(j,j.return,Ce)}if(j===b){Ee=null;break e}var ue=j.sibling;if(ue!==null){ue.return=j.return,Ee=ue;break e}Ee=j.return}}if(Ke=f,ts(),Dr&&typeof Dr.onPostCommitFiberRoot=="function")try{Dr.onPostCommitFiberRoot(ws,e)}catch{}c=!0}return c}finally{xe=o,Ur.transition=t}}return!1}function Ih(e,t,o){t=Do(o,t),t=Jd(e,t,1),e=ns(e,t,1),t=or(),e!==null&&(Es(e,1,t),vr(e,t))}function yt(e,t,o){if(e.tag===3)Ih(e,e,o);else for(;t!==null;){if(t.tag===3){Ih(t,e,o);break}else if(t.tag===1){var c=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(os===null||!os.has(c))){e=Do(o,e),e=Qd(t,e,1),t=ns(t,e,1),e=or(),t!==null&&(Es(t,1,e),vr(t,e));break}}t=t.return}}function Vm(e,t,o){var c=e.pingCache;c!==null&&c.delete(t),t=or(),e.pingedLanes|=e.suspendedLanes&o,Lt===e&&(Bt&o)===o&&(Tt===4||Tt===3&&(Bt&130023424)===Bt&&500>qe()-tu?Qs(e,0):eu|=o),vr(e,t)}function Oh(e,t){t===0&&((e.mode&1)===0?t=1:(t=_s,_s<<=1,(_s&130023424)===0&&(_s=4194304)));var o=or();e=Tn(e,t),e!==null&&(Es(e,t,o),vr(e,o))}function Bm(e){var t=e.memoizedState,o=0;t!==null&&(o=t.retryLane),Oh(e,o)}function zm(e,t){var o=0;switch(e.tag){case 13:var c=e.stateNode,f=e.memoizedState;f!==null&&(o=f.retryLane);break;case 19:c=e.stateNode;break;default:throw Error(r(314))}c!==null&&c.delete(t),Oh(e,o)}var Ph;Ph=function(e,t,o){if(e!==null)if(e.memoizedProps!==t.pendingProps||fr.current)gr=!0;else{if((e.lanes&o)===0&&(t.flags&128)===0)return gr=!1,Rm(e,t,o);gr=(e.flags&131072)!==0}else gr=!1,ft&&(t.flags&1048576)!==0&&hd(t,Ui,t.index);switch(t.lanes=0,t.tag){case 2:var c=t.type;el(e,t),e=t.pendingProps;var f=No(t,Yt.current);Oo(t,o),f=Oc(null,t,c,e,f,o);var m=Pc();return t.flags|=1,typeof f=="object"&&f!==null&&typeof f.render=="function"&&f.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,mr(c)?(m=!0,Ai(t)):m=!1,t.memoizedState=f.state!==null&&f.state!==void 0?f.state:null,kc(t),f.updater=Xi,t.stateNode=f,f._reactInternals=t,Uc(t,c,e,o),t=zc(null,t,c,!0,m,o)):(t.tag=0,ft&&m&&gc(t),sr(null,t,f,o),t=t.child),t;case 16:c=t.elementType;e:{switch(el(e,t),e=t.pendingProps,f=c._init,c=f(c._payload),t.type=c,f=t.tag=Hm(c),e=Jr(c,e),f){case 0:t=Bc(null,t,c,e,o);break e;case 1:t=oh(null,t,c,e,o);break e;case 11:t=eh(null,t,c,e,o);break e;case 14:t=th(null,t,c,Jr(c.type,e),o);break e}throw Error(r(306,c,""))}return t;case 0:return c=t.type,f=t.pendingProps,f=t.elementType===c?f:Jr(c,f),Bc(e,t,c,f,o);case 1:return c=t.type,f=t.pendingProps,f=t.elementType===c?f:Jr(c,f),oh(e,t,c,f,o);case 3:e:{if(ah(t),e===null)throw Error(r(387));c=t.pendingProps,m=t.memoizedState,f=m.element,wd(e,t),Hi(t,c,null,o);var b=t.memoizedState;if(c=b.element,m.isDehydrated)if(m={element:c,isDehydrated:!1,cache:b.cache,pendingSuspenseBoundaries:b.pendingSuspenseBoundaries,transitions:b.transitions},t.updateQueue.baseState=m,t.memoizedState=m,t.flags&256){f=Do(Error(r(423)),t),t=ih(e,t,c,o,f);break e}else if(c!==f){f=Do(Error(r(424)),t),t=ih(e,t,c,o,f);break e}else for(jr=Xn(t.stateNode.containerInfo.firstChild),Nr=t,ft=!0,Gr=null,o=yd(t,null,c,o),t.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(Co(),c===f){t=Rn(e,t,o);break e}sr(e,t,c,o)}t=t.child}return t;case 5:return Ed(t),e===null&&xc(t),c=t.type,f=t.pendingProps,m=e!==null?e.memoizedProps:null,b=f.children,cc(c,f)?b=null:m!==null&&cc(c,m)&&(t.flags|=32),sh(e,t),sr(e,t,b,o),t.child;case 6:return e===null&&xc(t),null;case 13:return lh(e,t,o);case 4:return Nc(t,t.stateNode.containerInfo),c=t.pendingProps,e===null?t.child=Ro(t,null,c,o):sr(e,t,c,o),t.child;case 11:return c=t.type,f=t.pendingProps,f=t.elementType===c?f:Jr(c,f),eh(e,t,c,f,o);case 7:return sr(e,t,t.pendingProps,o),t.child;case 8:return sr(e,t,t.pendingProps.children,o),t.child;case 12:return sr(e,t,t.pendingProps.children,o),t.child;case 10:e:{if(c=t.type._context,f=t.pendingProps,m=t.memoizedProps,b=f.value,st(Bi,c._currentValue),c._currentValue=b,m!==null)if(ur(m.value,b)){if(m.children===f.children&&!fr.current){t=Rn(e,t,o);break e}}else for(m=t.child,m!==null&&(m.return=t);m!==null;){var j=m.dependencies;if(j!==null){b=m.child;for(var I=j.firstContext;I!==null;){if(I.context===c){if(m.tag===1){I=Cn(-1,o&-o),I.tag=2;var G=m.updateQueue;if(G!==null){G=G.shared;var oe=G.pending;oe===null?I.next=I:(I.next=oe.next,oe.next=I),G.pending=I}}m.lanes|=o,I=m.alternate,I!==null&&(I.lanes|=o),_c(m.return,o,t),j.lanes|=o;break}I=I.next}}else if(m.tag===10)b=m.type===t.type?null:m.child;else if(m.tag===18){if(b=m.return,b===null)throw Error(r(341));b.lanes|=o,j=b.alternate,j!==null&&(j.lanes|=o),_c(b,o,t),b=m.sibling}else b=m.child;if(b!==null)b.return=m;else for(b=m;b!==null;){if(b===t){b=null;break}if(m=b.sibling,m!==null){m.return=b.return,b=m;break}b=b.return}m=b}sr(e,t,f.children,o),t=t.child}return t;case 9:return f=t.type,c=t.pendingProps.children,Oo(t,o),f=$r(f),c=c(f),t.flags|=1,sr(e,t,c,o),t.child;case 14:return c=t.type,f=Jr(c,t.pendingProps),f=Jr(c.type,f),th(e,t,c,f,o);case 15:return rh(e,t,t.type,t.pendingProps,o);case 17:return c=t.type,f=t.pendingProps,f=t.elementType===c?f:Jr(c,f),el(e,t),t.tag=1,mr(c)?(e=!0,Ai(t)):e=!1,Oo(t,o),Kd(t,c,f),Uc(t,c,f,o),zc(null,t,c,!0,e,o);case 19:return uh(e,t,o);case 22:return nh(e,t,o)}throw Error(r(156,t.tag))};function Dh(e,t){return Ml(e,t)}function Wm(e,t,o,c){this.tag=e,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Fr(e,t,o,c){return new Wm(e,t,o,c)}function cu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Hm(e){if(typeof e=="function")return cu(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Ne)return 11;if(e===ve)return 14}return 2}function cs(e,t){var o=e.alternate;return o===null?(o=Fr(e.tag,t,e.key,e.mode),o.elementType=e.elementType,o.type=e.type,o.stateNode=e.stateNode,o.alternate=e,e.alternate=o):(o.pendingProps=t,o.type=e.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=e.flags&14680064,o.childLanes=e.childLanes,o.lanes=e.lanes,o.child=e.child,o.memoizedProps=e.memoizedProps,o.memoizedState=e.memoizedState,o.updateQueue=e.updateQueue,t=e.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},o.sibling=e.sibling,o.index=e.index,o.ref=e.ref,o}function dl(e,t,o,c,f,m){var b=2;if(c=e,typeof e=="function")cu(e)&&(b=1);else if(typeof e=="string")b=5;else e:switch(e){case B:return Xs(o.children,f,m,t);case ne:b=8,f|=8;break;case T:return e=Fr(12,o,t,f|2),e.elementType=T,e.lanes=m,e;case fe:return e=Fr(13,o,t,f),e.elementType=fe,e.lanes=m,e;case me:return e=Fr(19,o,t,f),e.elementType=me,e.lanes=m,e;case we:return hl(o,f,m,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case re:b=10;break e;case de:b=9;break e;case Ne:b=11;break e;case ve:b=14;break e;case Ve:b=16,c=null;break e}throw Error(r(130,e==null?e:typeof e,""))}return t=Fr(b,o,t,f),t.elementType=e,t.type=c,t.lanes=m,t}function Xs(e,t,o,c){return e=Fr(7,e,c,t),e.lanes=o,e}function hl(e,t,o,c){return e=Fr(22,e,c,t),e.elementType=we,e.lanes=o,e.stateNode={isHidden:!1},e}function uu(e,t,o){return e=Fr(6,e,null,t),e.lanes=o,e}function du(e,t,o){return t=Fr(4,e.children!==null?e.children:[],e.key,t),t.lanes=o,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function qm(e,t,o,c,f){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Br(0),this.expirationTimes=Br(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Br(0),this.identifierPrefix=c,this.onRecoverableError=f,this.mutableSourceEagerHydrationData=null}function hu(e,t,o,c,f,m,b,j,I){return e=new qm(e,t,o,j,I),t===1?(t=1,m===!0&&(t|=8)):t=0,m=Fr(3,null,null,t),e.current=m,m.stateNode=e,m.memoizedState={element:c,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},kc(m),e}function Km(e,t,o){var c=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:P,key:c==null?null:""+c,children:e,containerInfo:t,implementation:o}}function Lh(e){if(!e)return es;e=e._reactInternals;e:{if(lr(e)!==e||e.tag!==1)throw Error(r(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(mr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(r(171))}if(e.tag===1){var o=e.type;if(mr(o))return cd(e,o,t)}return t}function Ah(e,t,o,c,f,m,b,j,I){return e=hu(o,c,!0,e,f,m,b,j,I),e.context=Lh(null),o=e.current,c=or(),f=is(o),m=Cn(c,f),m.callback=t??null,ns(o,m,f),e.current.lanes=f,Es(e,f,c),vr(e,c),e}function fl(e,t,o,c){var f=t.current,m=or(),b=is(f);return o=Lh(o),t.context===null?t.context=o:t.pendingContext=o,t=Cn(m,b),t.payload={element:e},c=c===void 0?null:c,c!==null&&(t.callback=c),e=ns(f,t,b),e!==null&&(Xr(e,f,b,m),Wi(e,f,b)),b}function ml(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function $h(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var o=e.retryLane;e.retryLane=o!==0&&o<t?o:t}}function fu(e,t){$h(e,t),(e=e.alternate)&&$h(e,t)}function Gm(){return null}var Mh=typeof reportError=="function"?reportError:function(e){console.error(e)};function mu(e){this._internalRoot=e}gl.prototype.render=mu.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(r(409));fl(e,t,null,null)},gl.prototype.unmount=mu.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Js(function(){fl(null,e,null,null)}),t[En]=null}};function gl(e){this._internalRoot=e}gl.prototype.unstable_scheduleHydration=function(e){if(e){var t=ui();e={blockedOn:null,target:e,priority:t};for(var o=0;o<nr.length&&t!==0&&t<nr[o].priority;o++);nr.splice(o,0,e),o===0&&xn(e)}};function gu(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function pl(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Uh(){}function Jm(e,t,o,c,f){if(f){if(typeof c=="function"){var m=c;c=function(){var G=ml(b);m.call(G)}}var b=Ah(t,c,e,0,null,!1,!1,"",Uh);return e._reactRootContainer=b,e[En]=b.current,Fs(e.nodeType===8?e.parentNode:e),Js(),b}for(;f=e.lastChild;)e.removeChild(f);if(typeof c=="function"){var j=c;c=function(){var G=ml(I);j.call(G)}}var I=hu(e,0,!1,null,null,!1,!1,"",Uh);return e._reactRootContainer=I,e[En]=I.current,Fs(e.nodeType===8?e.parentNode:e),Js(function(){fl(t,I,o,c)}),I}function vl(e,t,o,c,f){var m=o._reactRootContainer;if(m){var b=m;if(typeof f=="function"){var j=f;f=function(){var I=ml(b);j.call(I)}}fl(t,b,e,f)}else b=Jm(o,t,e,f,c);return ml(b)}ks=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var o=ho(t.pendingLanes);o!==0&&(da(t,o|1),vr(t,qe()),(Ke&6)===0&&($o=qe()+500,ts()))}break;case 13:Js(function(){var c=Tn(e,1);if(c!==null){var f=or();Xr(c,e,1,f)}}),fu(e,1)}},Ns=function(e){if(e.tag===13){var t=Tn(e,134217728);if(t!==null){var o=or();Xr(t,e,134217728,o)}fu(e,134217728)}},We=function(e){if(e.tag===13){var t=is(e),o=Tn(e,t);if(o!==null){var c=or();Xr(o,e,t,c)}fu(e,t)}},ui=function(){return xe},js=function(e,t){var o=xe;try{return xe=e,t()}finally{xe=o}},wr=function(e,t,o){switch(t){case"input":if(De(e,o),t=o.name,o.type==="radio"&&t!=null){for(o=e;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<o.length;t++){var c=o[t];if(c!==e&&c.form===e.form){var f=Di(c);if(!f)throw Error(r(90));tn(c),De(c,f)}}}break;case"textarea":Et(e,o);break;case"select":t=o.value,t!=null&&dt(e,!!o.multiple,t,!1)}},Rr=au,ht=Js;var Qm={usingClientEntryPoint:!1,Events:[Oa,Eo,Di,Sr,na,au]},qa={findFiberByHostInstance:Vs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ym={bundleType:qa.bundleType,version:qa.version,rendererPackageName:qa.rendererPackageName,rendererConfig:qa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:K.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Al(e),e===null?null:e.stateNode},findFiberByHostInstance:qa.findFiberByHostInstance||Gm,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var xl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xl.isDisabled&&xl.supportsFiber)try{ws=xl.inject(Ym),Dr=xl}catch{}}return xr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Qm,xr.createPortal=function(e,t){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!gu(t))throw Error(r(200));return Km(e,t,null,o)},xr.createRoot=function(e,t){if(!gu(e))throw Error(r(299));var o=!1,c="",f=Mh;return t!=null&&(t.unstable_strictMode===!0&&(o=!0),t.identifierPrefix!==void 0&&(c=t.identifierPrefix),t.onRecoverableError!==void 0&&(f=t.onRecoverableError)),t=hu(e,1,!1,null,null,o,!1,c,f),e[En]=t.current,Fs(e.nodeType===8?e.parentNode:e),new mu(t)},xr.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(r(188)):(e=Object.keys(e).join(","),Error(r(268,e)));return e=Al(t),e=e===null?null:e.stateNode,e},xr.flushSync=function(e){return Js(e)},xr.hydrate=function(e,t,o){if(!pl(t))throw Error(r(200));return vl(null,e,t,!0,o)},xr.hydrateRoot=function(e,t,o){if(!gu(e))throw Error(r(405));var c=o!=null&&o.hydratedSources||null,f=!1,m="",b=Mh;if(o!=null&&(o.unstable_strictMode===!0&&(f=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onRecoverableError!==void 0&&(b=o.onRecoverableError)),t=Ah(t,null,e,1,o??null,f,!1,m,b),e[En]=t.current,Fs(e),c)for(e=0;e<c.length;e++)o=c[e],f=o._getVersion,f=f(o._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[o,f]:t.mutableSourceEagerHydrationData.push(o,f);return new gl(t)},xr.render=function(e,t,o){if(!pl(t))throw Error(r(200));return vl(null,e,t,!1,o)},xr.unmountComponentAtNode=function(e){if(!pl(e))throw Error(r(40));return e._reactRootContainer?(Js(function(){vl(null,null,e,!1,function(){e._reactRootContainer=null,e[En]=null})}),!0):!1},xr.unstable_batchedUpdates=au,xr.unstable_renderSubtreeIntoContainer=function(e,t,o,c){if(!pl(o))throw Error(r(200));if(e==null||e._reactInternals===void 0)throw Error(r(38));return vl(e,t,o,!1,c)},xr.version="18.3.1-next-f1338f8080-20240426",xr}var Kh;function ag(){if(Kh)return xu.exports;Kh=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(n){console.error(n)}}return u(),xu.exports=og(),xu.exports}var Gh;function ig(){if(Gh)return yl;Gh=1;var u=ag();return yl.createRoot=u.createRoot,yl.hydrateRoot=u.hydrateRoot,yl}var lg=ig();const cg=Hu(lg);/**
 * react-router v7.8.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Jh="popstate";function ug(u={}){function n(a,i){let{pathname:h,search:d,hash:p}=a.location;return Iu("",{pathname:h,search:d,hash:p},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(a,i){return typeof i=="string"?i:Za(i)}return hg(n,r,null,u)}function xt(u,n){if(u===!1||u===null||typeof u>"u")throw new Error(n)}function gn(u,n){if(!u){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function dg(){return Math.random().toString(36).substring(2,10)}function Qh(u,n){return{usr:u.state,key:u.key,idx:n}}function Iu(u,n,r=null,a){return{pathname:typeof u=="string"?u:u.pathname,search:"",hash:"",...typeof n=="string"?Xo(n):n,state:r,key:n&&n.key||a||dg()}}function Za({pathname:u="/",search:n="",hash:r=""}){return n&&n!=="?"&&(u+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(u+=r.charAt(0)==="#"?r:"#"+r),u}function Xo(u){let n={};if(u){let r=u.indexOf("#");r>=0&&(n.hash=u.substring(r),u=u.substring(0,r));let a=u.indexOf("?");a>=0&&(n.search=u.substring(a),u=u.substring(0,a)),u&&(n.pathname=u)}return n}function hg(u,n,r,a={}){let{window:i=document.defaultView,v5Compat:h=!1}=a,d=i.history,p="POP",x=null,y=S();y==null&&(y=0,d.replaceState({...d.state,idx:y},""));function S(){return(d.state||{idx:null}).idx}function N(){p="POP";let O=S(),J=O==null?null:O-y;y=O,x&&x({action:p,location:$.location,delta:J})}function R(O,J){p="PUSH";let X=Iu($.location,O,J);y=S()+1;let q=Qh(X,y),K=$.createHref(X);try{d.pushState(q,"",K)}catch(Y){if(Y instanceof DOMException&&Y.name==="DataCloneError")throw Y;i.location.assign(K)}h&&x&&x({action:p,location:$.location,delta:1})}function A(O,J){p="REPLACE";let X=Iu($.location,O,J);y=S();let q=Qh(X,y),K=$.createHref(X);d.replaceState(q,"",K),h&&x&&x({action:p,location:$.location,delta:0})}function U(O){return fg(O)}let $={get action(){return p},get location(){return u(i,d)},listen(O){if(x)throw new Error("A history only accepts one active listener");return i.addEventListener(Jh,N),x=O,()=>{i.removeEventListener(Jh,N),x=null}},createHref(O){return n(i,O)},createURL:U,encodeLocation(O){let J=U(O);return{pathname:J.pathname,search:J.search,hash:J.hash}},push:R,replace:A,go(O){return d.go(O)}};return $}function fg(u,n=!1){let r="http://localhost";typeof window<"u"&&(r=window.location.origin!=="null"?window.location.origin:window.location.href),xt(r,"No window.location.(origin|href) available to create URL");let a=typeof u=="string"?u:Za(u);return a=a.replace(/ $/,"%20"),!n&&a.startsWith("//")&&(a=r+a),new URL(a,r)}function Nf(u,n,r="/"){return mg(u,n,r,!1)}function mg(u,n,r,a){let i=typeof n=="string"?Xo(n):n,h=Ln(i.pathname||"/",r);if(h==null)return null;let d=jf(u);gg(d);let p=null;for(let x=0;p==null&&x<d.length;++x){let y=Ng(h);p=Eg(d[x],y,a)}return p}function jf(u,n=[],r=[],a="",i=!1){let h=(d,p,x=i,y)=>{let S={relativePath:y===void 0?d.path||"":y,caseSensitive:d.caseSensitive===!0,childrenIndex:p,route:d};if(S.relativePath.startsWith("/")){if(!S.relativePath.startsWith(a)&&x)return;xt(S.relativePath.startsWith(a),`Absolute route path "${S.relativePath}" nested under path "${a}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),S.relativePath=S.relativePath.slice(a.length)}let N=Dn([a,S.relativePath]),R=r.concat(S);d.children&&d.children.length>0&&(xt(d.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${N}".`),jf(d.children,n,R,N,x)),!(d.path==null&&!d.index)&&n.push({path:N,score:Sg(N,d.index),routesMeta:R})};return u.forEach((d,p)=>{if(d.path===""||!d.path?.includes("?"))h(d,p);else for(let x of Tf(d.path))h(d,p,!0,x)}),n}function Tf(u){let n=u.split("/");if(n.length===0)return[];let[r,...a]=n,i=r.endsWith("?"),h=r.replace(/\?$/,"");if(a.length===0)return i?[h,""]:[h];let d=Tf(a.join("/")),p=[];return p.push(...d.map(x=>x===""?h:[h,x].join("/"))),i&&p.push(...d),p.map(x=>u.startsWith("/")&&x===""?"/":x)}function gg(u){u.sort((n,r)=>n.score!==r.score?r.score-n.score:_g(n.routesMeta.map(a=>a.childrenIndex),r.routesMeta.map(a=>a.childrenIndex)))}var pg=/^:[\w-]+$/,vg=3,xg=2,yg=1,bg=10,wg=-2,Yh=u=>u==="*";function Sg(u,n){let r=u.split("/"),a=r.length;return r.some(Yh)&&(a+=wg),n&&(a+=xg),r.filter(i=>!Yh(i)).reduce((i,h)=>i+(pg.test(h)?vg:h===""?yg:bg),a)}function _g(u,n){return u.length===n.length&&u.slice(0,-1).every((a,i)=>a===n[i])?u[u.length-1]-n[n.length-1]:0}function Eg(u,n,r=!1){let{routesMeta:a}=u,i={},h="/",d=[];for(let p=0;p<a.length;++p){let x=a[p],y=p===a.length-1,S=h==="/"?n:n.slice(h.length)||"/",N=Rl({path:x.relativePath,caseSensitive:x.caseSensitive,end:y},S),R=x.route;if(!N&&y&&r&&!a[a.length-1].route.index&&(N=Rl({path:x.relativePath,caseSensitive:x.caseSensitive,end:!1},S)),!N)return null;Object.assign(i,N.params),d.push({params:i,pathname:Dn([h,N.pathname]),pathnameBase:Rg(Dn([h,N.pathnameBase])),route:R}),N.pathnameBase!=="/"&&(h=Dn([h,N.pathnameBase]))}return d}function Rl(u,n){typeof u=="string"&&(u={path:u,caseSensitive:!1,end:!0});let[r,a]=kg(u.path,u.caseSensitive,u.end),i=n.match(r);if(!i)return null;let h=i[0],d=h.replace(/(.)\/+$/,"$1"),p=i.slice(1);return{params:a.reduce((y,{paramName:S,isOptional:N},R)=>{if(S==="*"){let U=p[R]||"";d=h.slice(0,h.length-U.length).replace(/(.)\/+$/,"$1")}const A=p[R];return N&&!A?y[S]=void 0:y[S]=(A||"").replace(/%2F/g,"/"),y},{}),pathname:h,pathnameBase:d,pattern:u}}function kg(u,n=!1,r=!0){gn(u==="*"||!u.endsWith("*")||u.endsWith("/*"),`Route path "${u}" will be treated as if it were "${u.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${u.replace(/\*$/,"/*")}".`);let a=[],i="^"+u.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(d,p,x)=>(a.push({paramName:p,isOptional:x!=null}),x?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return u.endsWith("*")?(a.push({paramName:"*"}),i+=u==="*"||u==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":u!==""&&u!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,n?void 0:"i"),a]}function Ng(u){try{return u.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return gn(!1,`The URL path "${u}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${n}).`),u}}function Ln(u,n){if(n==="/")return u;if(!u.toLowerCase().startsWith(n.toLowerCase()))return null;let r=n.endsWith("/")?n.length-1:n.length,a=u.charAt(r);return a&&a!=="/"?null:u.slice(r)||"/"}function jg(u,n="/"){let{pathname:r,search:a="",hash:i=""}=typeof u=="string"?Xo(u):u;return{pathname:r?r.startsWith("/")?r:Tg(r,n):n,search:Ig(a),hash:Og(i)}}function Tg(u,n){let r=n.replace(/\/+$/,"").split("/");return u.split("/").forEach(i=>{i===".."?r.length>1&&r.pop():i!=="."&&r.push(i)}),r.length>1?r.join("/"):"/"}function wu(u,n,r,a){return`Cannot include a '${u}' character in a manually specified \`to.${n}\` field [${JSON.stringify(a)}].  Please separate it out to the \`to.${r}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Cg(u){return u.filter((n,r)=>r===0||n.route.path&&n.route.path.length>0)}function Cf(u){let n=Cg(u);return n.map((r,a)=>a===n.length-1?r.pathname:r.pathnameBase)}function Rf(u,n,r,a=!1){let i;typeof u=="string"?i=Xo(u):(i={...u},xt(!i.pathname||!i.pathname.includes("?"),wu("?","pathname","search",i)),xt(!i.pathname||!i.pathname.includes("#"),wu("#","pathname","hash",i)),xt(!i.search||!i.search.includes("#"),wu("#","search","hash",i)));let h=u===""||i.pathname==="",d=h?"/":i.pathname,p;if(d==null)p=r;else{let N=n.length-1;if(!a&&d.startsWith("..")){let R=d.split("/");for(;R[0]==="..";)R.shift(),N-=1;i.pathname=R.join("/")}p=N>=0?n[N]:"/"}let x=jg(i,p),y=d&&d!=="/"&&d.endsWith("/"),S=(h||d===".")&&r.endsWith("/");return!x.pathname.endsWith("/")&&(y||S)&&(x.pathname+="/"),x}var Dn=u=>u.join("/").replace(/\/\/+/g,"/"),Rg=u=>u.replace(/\/+$/,"").replace(/^\/*/,"/"),Ig=u=>!u||u==="?"?"":u.startsWith("?")?u:"?"+u,Og=u=>!u||u==="#"?"":u.startsWith("#")?u:"#"+u;function Pg(u){return u!=null&&typeof u.status=="number"&&typeof u.statusText=="string"&&typeof u.internal=="boolean"&&"data"in u}var If=["POST","PUT","PATCH","DELETE"];new Set(If);var Dg=["GET",...If];new Set(Dg);var Zo=_.createContext(null);Zo.displayName="DataRouter";var Pl=_.createContext(null);Pl.displayName="DataRouterState";_.createContext(!1);var Of=_.createContext({isTransitioning:!1});Of.displayName="ViewTransition";var Lg=_.createContext(new Map);Lg.displayName="Fetchers";var Ag=_.createContext(null);Ag.displayName="Await";var pn=_.createContext(null);pn.displayName="Navigation";var ti=_.createContext(null);ti.displayName="Location";var An=_.createContext({outlet:null,matches:[],isDataRoute:!1});An.displayName="Route";var Ku=_.createContext(null);Ku.displayName="RouteError";function $g(u,{relative:n}={}){xt(ri(),"useHref() may be used only in the context of a <Router> component.");let{basename:r,navigator:a}=_.useContext(pn),{hash:i,pathname:h,search:d}=ni(u,{relative:n}),p=h;return r!=="/"&&(p=h==="/"?r:Dn([r,h])),a.createHref({pathname:p,search:d,hash:i})}function ri(){return _.useContext(ti)!=null}function yr(){return xt(ri(),"useLocation() may be used only in the context of a <Router> component."),_.useContext(ti).location}var Pf="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Df(u){_.useContext(pn).static||_.useLayoutEffect(u)}function ea(){let{isDataRoute:u}=_.useContext(An);return u?Qg():Mg()}function Mg(){xt(ri(),"useNavigate() may be used only in the context of a <Router> component.");let u=_.useContext(Zo),{basename:n,navigator:r}=_.useContext(pn),{matches:a}=_.useContext(An),{pathname:i}=yr(),h=JSON.stringify(Cf(a)),d=_.useRef(!1);return Df(()=>{d.current=!0}),_.useCallback((x,y={})=>{if(gn(d.current,Pf),!d.current)return;if(typeof x=="number"){r.go(x);return}let S=Rf(x,JSON.parse(h),i,y.relative==="path");u==null&&n!=="/"&&(S.pathname=S.pathname==="/"?n:Dn([n,S.pathname])),(y.replace?r.replace:r.push)(S,y.state,y)},[n,r,h,i,u])}_.createContext(null);function ni(u,{relative:n}={}){let{matches:r}=_.useContext(An),{pathname:a}=yr(),i=JSON.stringify(Cf(r));return _.useMemo(()=>Rf(u,JSON.parse(i),a,n==="path"),[u,i,a,n])}function Ug(u,n){return Lf(u,n)}function Lf(u,n,r,a,i){xt(ri(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:h}=_.useContext(pn),{matches:d}=_.useContext(An),p=d[d.length-1],x=p?p.params:{},y=p?p.pathname:"/",S=p?p.pathnameBase:"/",N=p&&p.route;{let X=N&&N.path||"";Af(y,!N||X.endsWith("*")||X.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${y}" (under <Route path="${X}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${X}"> to <Route path="${X==="/"?"*":`${X}/*`}">.`)}let R=yr(),A;if(n){let X=typeof n=="string"?Xo(n):n;xt(S==="/"||X.pathname?.startsWith(S),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${S}" but pathname "${X.pathname}" was given in the \`location\` prop.`),A=X}else A=R;let U=A.pathname||"/",$=U;if(S!=="/"){let X=S.replace(/^\//,"").split("/");$="/"+U.replace(/^\//,"").split("/").slice(X.length).join("/")}let O=Nf(u,{pathname:$});gn(N||O!=null,`No routes matched location "${A.pathname}${A.search}${A.hash}" `),gn(O==null||O[O.length-1].route.element!==void 0||O[O.length-1].route.Component!==void 0||O[O.length-1].route.lazy!==void 0,`Matched leaf route at location "${A.pathname}${A.search}${A.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let J=Wg(O&&O.map(X=>Object.assign({},X,{params:Object.assign({},x,X.params),pathname:Dn([S,h.encodeLocation?h.encodeLocation(X.pathname).pathname:X.pathname]),pathnameBase:X.pathnameBase==="/"?S:Dn([S,h.encodeLocation?h.encodeLocation(X.pathnameBase).pathname:X.pathnameBase])})),d,r,a,i);return n&&J?_.createElement(ti.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...A},navigationType:"POP"}},J):J}function Fg(){let u=Jg(),n=Pg(u)?`${u.status} ${u.statusText}`:u instanceof Error?u.message:JSON.stringify(u),r=u instanceof Error?u.stack:null,a="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:a},h={padding:"2px 4px",backgroundColor:a},d=null;return console.error("Error handled by React Router default ErrorBoundary:",u),d=_.createElement(_.Fragment,null,_.createElement("p",null,"💿 Hey developer 👋"),_.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",_.createElement("code",{style:h},"ErrorBoundary")," or"," ",_.createElement("code",{style:h},"errorElement")," prop on your route.")),_.createElement(_.Fragment,null,_.createElement("h2",null,"Unexpected Application Error!"),_.createElement("h3",{style:{fontStyle:"italic"}},n),r?_.createElement("pre",{style:i},r):null,d)}var Vg=_.createElement(Fg,null),Bg=class extends _.Component{constructor(u){super(u),this.state={location:u.location,revalidation:u.revalidation,error:u.error}}static getDerivedStateFromError(u){return{error:u}}static getDerivedStateFromProps(u,n){return n.location!==u.location||n.revalidation!=="idle"&&u.revalidation==="idle"?{error:u.error,location:u.location,revalidation:u.revalidation}:{error:u.error!==void 0?u.error:n.error,location:n.location,revalidation:u.revalidation||n.revalidation}}componentDidCatch(u,n){this.props.unstable_onError?this.props.unstable_onError(u,n):console.error("React Router caught the following error during render",u)}render(){return this.state.error!==void 0?_.createElement(An.Provider,{value:this.props.routeContext},_.createElement(Ku.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function zg({routeContext:u,match:n,children:r}){let a=_.useContext(Zo);return a&&a.static&&a.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=n.route.id),_.createElement(An.Provider,{value:u},r)}function Wg(u,n=[],r=null,a=null,i=null){if(u==null){if(!r)return null;if(r.errors)u=r.matches;else if(n.length===0&&!r.initialized&&r.matches.length>0)u=r.matches;else return null}let h=u,d=r?.errors;if(d!=null){let y=h.findIndex(S=>S.route.id&&d?.[S.route.id]!==void 0);xt(y>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(d).join(",")}`),h=h.slice(0,Math.min(h.length,y+1))}let p=!1,x=-1;if(r)for(let y=0;y<h.length;y++){let S=h[y];if((S.route.HydrateFallback||S.route.hydrateFallbackElement)&&(x=y),S.route.id){let{loaderData:N,errors:R}=r,A=S.route.loader&&!N.hasOwnProperty(S.route.id)&&(!R||R[S.route.id]===void 0);if(S.route.lazy||A){p=!0,x>=0?h=h.slice(0,x+1):h=[h[0]];break}}}return h.reduceRight((y,S,N)=>{let R,A=!1,U=null,$=null;r&&(R=d&&S.route.id?d[S.route.id]:void 0,U=S.route.errorElement||Vg,p&&(x<0&&N===0?(Af("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),A=!0,$=null):x===N&&(A=!0,$=S.route.hydrateFallbackElement||null)));let O=n.concat(h.slice(0,N+1)),J=()=>{let X;return R?X=U:A?X=$:S.route.Component?X=_.createElement(S.route.Component,null):S.route.element?X=S.route.element:X=y,_.createElement(zg,{match:S,routeContext:{outlet:y,matches:O,isDataRoute:r!=null},children:X})};return r&&(S.route.ErrorBoundary||S.route.errorElement||N===0)?_.createElement(Bg,{location:r.location,revalidation:r.revalidation,component:U,error:R,children:J(),routeContext:{outlet:null,matches:O,isDataRoute:!0},unstable_onError:a}):J()},null)}function Gu(u){return`${u} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Hg(u){let n=_.useContext(Zo);return xt(n,Gu(u)),n}function qg(u){let n=_.useContext(Pl);return xt(n,Gu(u)),n}function Kg(u){let n=_.useContext(An);return xt(n,Gu(u)),n}function Ju(u){let n=Kg(u),r=n.matches[n.matches.length-1];return xt(r.route.id,`${u} can only be used on routes that contain a unique "id"`),r.route.id}function Gg(){return Ju("useRouteId")}function Jg(){let u=_.useContext(Ku),n=qg("useRouteError"),r=Ju("useRouteError");return u!==void 0?u:n.errors?.[r]}function Qg(){let{router:u}=Hg("useNavigate"),n=Ju("useNavigate"),r=_.useRef(!1);return Df(()=>{r.current=!0}),_.useCallback(async(i,h={})=>{gn(r.current,Pf),r.current&&(typeof i=="number"?u.navigate(i):await u.navigate(i,{fromRouteId:n,...h}))},[u,n])}var Xh={};function Af(u,n,r){!n&&!Xh[u]&&(Xh[u]=!0,gn(!1,r))}_.memo(Yg);function Yg({routes:u,future:n,state:r,unstable_onError:a}){return Lf(u,void 0,r,a,n)}function hs(u){xt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Xg({basename:u="/",children:n=null,location:r,navigationType:a="POP",navigator:i,static:h=!1}){xt(!ri(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let d=u.replace(/^\/*/,"/"),p=_.useMemo(()=>({basename:d,navigator:i,static:h,future:{}}),[d,i,h]);typeof r=="string"&&(r=Xo(r));let{pathname:x="/",search:y="",hash:S="",state:N=null,key:R="default"}=r,A=_.useMemo(()=>{let U=Ln(x,d);return U==null?null:{location:{pathname:U,search:y,hash:S,state:N,key:R},navigationType:a}},[d,x,y,S,N,R,a]);return gn(A!=null,`<Router basename="${d}"> is not able to match the URL "${x}${y}${S}" because it does not start with the basename, so the <Router> won't render anything.`),A==null?null:_.createElement(pn.Provider,{value:p},_.createElement(ti.Provider,{children:n,value:A}))}function Zg({children:u,location:n}){return Ug(Ou(u),n)}function Ou(u,n=[]){let r=[];return _.Children.forEach(u,(a,i)=>{if(!_.isValidElement(a))return;let h=[...n,i];if(a.type===_.Fragment){r.push.apply(r,Ou(a.props.children,h));return}xt(a.type===hs,`[${typeof a.type=="string"?a.type:a.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),xt(!a.props.index||!a.props.children,"An index route cannot have child routes.");let d={id:a.props.id||h.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,hydrateFallbackElement:a.props.hydrateFallbackElement,HydrateFallback:a.props.HydrateFallback,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.hasErrorBoundary===!0||a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(d.children=Ou(a.props.children,h)),r.push(d)}),r}var jl="get",Tl="application/x-www-form-urlencoded";function Dl(u){return u!=null&&typeof u.tagName=="string"}function ep(u){return Dl(u)&&u.tagName.toLowerCase()==="button"}function tp(u){return Dl(u)&&u.tagName.toLowerCase()==="form"}function rp(u){return Dl(u)&&u.tagName.toLowerCase()==="input"}function np(u){return!!(u.metaKey||u.altKey||u.ctrlKey||u.shiftKey)}function sp(u,n){return u.button===0&&(!n||n==="_self")&&!np(u)}var bl=null;function op(){if(bl===null)try{new FormData(document.createElement("form"),0),bl=!1}catch{bl=!0}return bl}var ap=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Su(u){return u!=null&&!ap.has(u)?(gn(!1,`"${u}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Tl}"`),null):u}function ip(u,n){let r,a,i,h,d;if(tp(u)){let p=u.getAttribute("action");a=p?Ln(p,n):null,r=u.getAttribute("method")||jl,i=Su(u.getAttribute("enctype"))||Tl,h=new FormData(u)}else if(ep(u)||rp(u)&&(u.type==="submit"||u.type==="image")){let p=u.form;if(p==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let x=u.getAttribute("formaction")||p.getAttribute("action");if(a=x?Ln(x,n):null,r=u.getAttribute("formmethod")||p.getAttribute("method")||jl,i=Su(u.getAttribute("formenctype"))||Su(p.getAttribute("enctype"))||Tl,h=new FormData(p,u),!op()){let{name:y,type:S,value:N}=u;if(S==="image"){let R=y?`${y}.`:"";h.append(`${R}x`,"0"),h.append(`${R}y`,"0")}else y&&h.append(y,N)}}else{if(Dl(u))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');r=jl,a=null,i=Tl,d=u}return h&&i==="text/plain"&&(d=h,h=void 0),{action:a,method:r.toLowerCase(),encType:i,formData:h,body:d}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Qu(u,n){if(u===!1||u===null||typeof u>"u")throw new Error(n)}function lp(u,n,r){let a=typeof u=="string"?new URL(u,typeof window>"u"?"server://singlefetch/":window.location.origin):u;return a.pathname==="/"?a.pathname=`_root.${r}`:n&&Ln(a.pathname,n)==="/"?a.pathname=`${n.replace(/\/$/,"")}/_root.${r}`:a.pathname=`${a.pathname.replace(/\/$/,"")}.${r}`,a}async function cp(u,n){if(u.id in n)return n[u.id];try{let r=await import(u.module);return n[u.id]=r,r}catch(r){return console.error(`Error loading route module \`${u.module}\`, reloading page...`),console.error(r),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function up(u){return u==null?!1:u.href==null?u.rel==="preload"&&typeof u.imageSrcSet=="string"&&typeof u.imageSizes=="string":typeof u.rel=="string"&&typeof u.href=="string"}async function dp(u,n,r){let a=await Promise.all(u.map(async i=>{let h=n.routes[i.route.id];if(h){let d=await cp(h,r);return d.links?d.links():[]}return[]}));return gp(a.flat(1).filter(up).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function Zh(u,n,r,a,i,h){let d=(x,y)=>r[y]?x.route.id!==r[y].route.id:!0,p=(x,y)=>r[y].pathname!==x.pathname||r[y].route.path?.endsWith("*")&&r[y].params["*"]!==x.params["*"];return h==="assets"?n.filter((x,y)=>d(x,y)||p(x,y)):h==="data"?n.filter((x,y)=>{let S=a.routes[x.route.id];if(!S||!S.hasLoader)return!1;if(d(x,y)||p(x,y))return!0;if(x.route.shouldRevalidate){let N=x.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:r[0]?.params||{},nextUrl:new URL(u,window.origin),nextParams:x.params,defaultShouldRevalidate:!0});if(typeof N=="boolean")return N}return!0}):[]}function hp(u,n,{includeHydrateFallback:r}={}){return fp(u.map(a=>{let i=n.routes[a.route.id];if(!i)return[];let h=[i.module];return i.clientActionModule&&(h=h.concat(i.clientActionModule)),i.clientLoaderModule&&(h=h.concat(i.clientLoaderModule)),r&&i.hydrateFallbackModule&&(h=h.concat(i.hydrateFallbackModule)),i.imports&&(h=h.concat(i.imports)),h}).flat(1))}function fp(u){return[...new Set(u)]}function mp(u){let n={},r=Object.keys(u).sort();for(let a of r)n[a]=u[a];return n}function gp(u,n){let r=new Set;return new Set(n),u.reduce((a,i)=>{let h=JSON.stringify(mp(i));return r.has(h)||(r.add(h),a.push({key:h,link:i})),a},[])}function $f(){let u=_.useContext(Zo);return Qu(u,"You must render this element inside a <DataRouterContext.Provider> element"),u}function pp(){let u=_.useContext(Pl);return Qu(u,"You must render this element inside a <DataRouterStateContext.Provider> element"),u}var Yu=_.createContext(void 0);Yu.displayName="FrameworkContext";function Mf(){let u=_.useContext(Yu);return Qu(u,"You must render this element inside a <HydratedRouter> element"),u}function vp(u,n){let r=_.useContext(Yu),[a,i]=_.useState(!1),[h,d]=_.useState(!1),{onFocus:p,onBlur:x,onMouseEnter:y,onMouseLeave:S,onTouchStart:N}=n,R=_.useRef(null);_.useEffect(()=>{if(u==="render"&&d(!0),u==="viewport"){let $=J=>{J.forEach(X=>{d(X.isIntersecting)})},O=new IntersectionObserver($,{threshold:.5});return R.current&&O.observe(R.current),()=>{O.disconnect()}}},[u]),_.useEffect(()=>{if(a){let $=setTimeout(()=>{d(!0)},100);return()=>{clearTimeout($)}}},[a]);let A=()=>{i(!0)},U=()=>{i(!1),d(!1)};return r?u!=="intent"?[h,R,{}]:[h,R,{onFocus:Ga(p,A),onBlur:Ga(x,U),onMouseEnter:Ga(y,A),onMouseLeave:Ga(S,U),onTouchStart:Ga(N,A)}]:[!1,R,{}]}function Ga(u,n){return r=>{u&&u(r),r.defaultPrevented||n(r)}}function xp({page:u,...n}){let{router:r}=$f(),a=_.useMemo(()=>Nf(r.routes,u,r.basename),[r.routes,u,r.basename]);return a?_.createElement(bp,{page:u,matches:a,...n}):null}function yp(u){let{manifest:n,routeModules:r}=Mf(),[a,i]=_.useState([]);return _.useEffect(()=>{let h=!1;return dp(u,n,r).then(d=>{h||i(d)}),()=>{h=!0}},[u,n,r]),a}function bp({page:u,matches:n,...r}){let a=yr(),{manifest:i,routeModules:h}=Mf(),{basename:d}=$f(),{loaderData:p,matches:x}=pp(),y=_.useMemo(()=>Zh(u,n,x,i,a,"data"),[u,n,x,i,a]),S=_.useMemo(()=>Zh(u,n,x,i,a,"assets"),[u,n,x,i,a]),N=_.useMemo(()=>{if(u===a.pathname+a.search+a.hash)return[];let U=new Set,$=!1;if(n.forEach(J=>{let X=i.routes[J.route.id];!X||!X.hasLoader||(!y.some(q=>q.route.id===J.route.id)&&J.route.id in p&&h[J.route.id]?.shouldRevalidate||X.hasClientLoader?$=!0:U.add(J.route.id))}),U.size===0)return[];let O=lp(u,d,"data");return $&&U.size>0&&O.searchParams.set("_routes",n.filter(J=>U.has(J.route.id)).map(J=>J.route.id).join(",")),[O.pathname+O.search]},[d,p,a,i,y,n,u,h]),R=_.useMemo(()=>hp(S,i),[S,i]),A=yp(S);return _.createElement(_.Fragment,null,N.map(U=>_.createElement("link",{key:U,rel:"prefetch",as:"fetch",href:U,...r})),R.map(U=>_.createElement("link",{key:U,rel:"modulepreload",href:U,...r})),A.map(({key:U,link:$})=>_.createElement("link",{key:U,nonce:r.nonce,...$})))}function wp(...u){return n=>{u.forEach(r=>{typeof r=="function"?r(n):r!=null&&(r.current=n)})}}var Uf=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Uf&&(window.__reactRouterVersion="7.8.2")}catch{}function Sp({basename:u,children:n,window:r}){let a=_.useRef();a.current==null&&(a.current=ug({window:r,v5Compat:!0}));let i=a.current,[h,d]=_.useState({action:i.action,location:i.location}),p=_.useCallback(x=>{_.startTransition(()=>d(x))},[d]);return _.useLayoutEffect(()=>i.listen(p),[i,p]),_.createElement(Xg,{basename:u,children:n,location:h.location,navigationType:h.action,navigator:i})}var Ff=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Vf=_.forwardRef(function({onClick:n,discover:r="render",prefetch:a="none",relative:i,reloadDocument:h,replace:d,state:p,target:x,to:y,preventScrollReset:S,viewTransition:N,...R},A){let{basename:U}=_.useContext(pn),$=typeof y=="string"&&Ff.test(y),O,J=!1;if(typeof y=="string"&&$&&(O=y,Uf))try{let T=new URL(window.location.href),re=y.startsWith("//")?new URL(T.protocol+y):new URL(y),de=Ln(re.pathname,U);re.origin===T.origin&&de!=null?y=de+re.search+re.hash:J=!0}catch{gn(!1,`<Link to="${y}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let X=$g(y,{relative:i}),[q,K,Y]=vp(a,R),P=Np(y,{replace:d,state:p,target:x,preventScrollReset:S,relative:i,viewTransition:N});function B(T){n&&n(T),T.defaultPrevented||P(T)}let ne=_.createElement("a",{...R,...Y,href:O||X,onClick:J||h?n:B,ref:wp(A,K),target:x,"data-discover":!$&&r==="render"?"true":void 0});return q&&!$?_.createElement(_.Fragment,null,ne,_.createElement(xp,{page:X})):ne});Vf.displayName="Link";var _p=_.forwardRef(function({"aria-current":n="page",caseSensitive:r=!1,className:a="",end:i=!1,style:h,to:d,viewTransition:p,children:x,...y},S){let N=ni(d,{relative:y.relative}),R=yr(),A=_.useContext(Pl),{navigator:U,basename:$}=_.useContext(pn),O=A!=null&&Ip(N)&&p===!0,J=U.encodeLocation?U.encodeLocation(N).pathname:N.pathname,X=R.pathname,q=A&&A.navigation&&A.navigation.location?A.navigation.location.pathname:null;r||(X=X.toLowerCase(),q=q?q.toLowerCase():null,J=J.toLowerCase()),q&&$&&(q=Ln(q,$)||q);const K=J!=="/"&&J.endsWith("/")?J.length-1:J.length;let Y=X===J||!i&&X.startsWith(J)&&X.charAt(K)==="/",P=q!=null&&(q===J||!i&&q.startsWith(J)&&q.charAt(J.length)==="/"),B={isActive:Y,isPending:P,isTransitioning:O},ne=Y?n:void 0,T;typeof a=="function"?T=a(B):T=[a,Y?"active":null,P?"pending":null,O?"transitioning":null].filter(Boolean).join(" ");let re=typeof h=="function"?h(B):h;return _.createElement(Vf,{...y,"aria-current":ne,className:T,ref:S,style:re,to:d,viewTransition:p},typeof x=="function"?x(B):x)});_p.displayName="NavLink";var Ep=_.forwardRef(({discover:u="render",fetcherKey:n,navigate:r,reloadDocument:a,replace:i,state:h,method:d=jl,action:p,onSubmit:x,relative:y,preventScrollReset:S,viewTransition:N,...R},A)=>{let U=Cp(),$=Rp(p,{relative:y}),O=d.toLowerCase()==="get"?"get":"post",J=typeof p=="string"&&Ff.test(p),X=q=>{if(x&&x(q),q.defaultPrevented)return;q.preventDefault();let K=q.nativeEvent.submitter,Y=K?.getAttribute("formmethod")||d;U(K||q.currentTarget,{fetcherKey:n,method:Y,navigate:r,replace:i,state:h,relative:y,preventScrollReset:S,viewTransition:N})};return _.createElement("form",{ref:A,method:O,action:$,onSubmit:a?x:X,...R,"data-discover":!J&&u==="render"?"true":void 0})});Ep.displayName="Form";function kp(u){return`${u} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Bf(u){let n=_.useContext(Zo);return xt(n,kp(u)),n}function Np(u,{target:n,replace:r,state:a,preventScrollReset:i,relative:h,viewTransition:d}={}){let p=ea(),x=yr(),y=ni(u,{relative:h});return _.useCallback(S=>{if(sp(S,n)){S.preventDefault();let N=r!==void 0?r:Za(x)===Za(y);p(u,{replace:N,state:a,preventScrollReset:i,relative:h,viewTransition:d})}},[x,p,y,r,a,n,u,i,h,d])}var jp=0,Tp=()=>`__${String(++jp)}__`;function Cp(){let{router:u}=Bf("useSubmit"),{basename:n}=_.useContext(pn),r=Gg();return _.useCallback(async(a,i={})=>{let{action:h,method:d,encType:p,formData:x,body:y}=ip(a,n);if(i.navigate===!1){let S=i.fetcherKey||Tp();await u.fetch(S,r,i.action||h,{preventScrollReset:i.preventScrollReset,formData:x,body:y,formMethod:i.method||d,formEncType:i.encType||p,flushSync:i.flushSync})}else await u.navigate(i.action||h,{preventScrollReset:i.preventScrollReset,formData:x,body:y,formMethod:i.method||d,formEncType:i.encType||p,replace:i.replace,state:i.state,fromRouteId:r,flushSync:i.flushSync,viewTransition:i.viewTransition})},[u,n,r])}function Rp(u,{relative:n}={}){let{basename:r}=_.useContext(pn),a=_.useContext(An);xt(a,"useFormAction must be used inside a RouteContext");let[i]=a.matches.slice(-1),h={...ni(u||".",{relative:n})},d=yr();if(u==null){h.search=d.search;let p=new URLSearchParams(h.search),x=p.getAll("index");if(x.some(S=>S==="")){p.delete("index"),x.filter(N=>N).forEach(N=>p.append("index",N));let S=p.toString();h.search=S?`?${S}`:""}}return(!u||u===".")&&i.route.index&&(h.search=h.search?h.search.replace(/^\?/,"?index&"):"?index"),r!=="/"&&(h.pathname=h.pathname==="/"?r:Dn([r,h.pathname])),Za(h)}function Ip(u,{relative:n}={}){let r=_.useContext(Of);xt(r!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:a}=Bf("useViewTransitionState"),i=ni(u,{relative:n});if(!r.isTransitioning)return!1;let h=Ln(r.currentLocation.pathname,a)||r.currentLocation.pathname,d=Ln(r.nextLocation.pathname,a)||r.nextLocation.pathname;return Rl(i.pathname,d)!=null||Rl(i.pathname,h)!=null}const Op="modulepreload",Pp=function(u){return"/"+u},ef={},ta=function(n,r,a){let i=Promise.resolve();if(r&&r.length>0){let y=function(S){return Promise.all(S.map(N=>Promise.resolve(N).then(R=>({status:"fulfilled",value:R}),R=>({status:"rejected",reason:R}))))};var d=y;document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),x=p?.nonce||p?.getAttribute("nonce");i=y(r.map(S=>{if(S=Pp(S),S in ef)return;ef[S]=!0;const N=S.endsWith(".css"),R=N?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${S}"]${R}`))return;const A=document.createElement("link");if(A.rel=N?"stylesheet":Op,N||(A.as="script"),A.crossOrigin="",A.href=S,x&&A.setAttribute("nonce",x),document.head.appendChild(A),N)return new Promise((U,$)=>{A.addEventListener("load",U),A.addEventListener("error",()=>$(new Error(`Unable to preload CSS for ${S}`)))})}))}function h(p){const x=new Event("vite:preloadError",{cancelable:!0});if(x.payload=p,window.dispatchEvent(x),!x.defaultPrevented)throw p}return i.then(p=>{for(const x of p||[])x.status==="rejected"&&h(x.reason);return n().catch(h)})},Dp=u=>{let n;return u?n=u:typeof fetch>"u"?n=(...r)=>ta(async()=>{const{default:a}=await Promise.resolve().then(()=>ra);return{default:a}},[]).then(({default:a})=>a(...r)):n=fetch,(...r)=>n(...r)};class Xu extends Error{constructor(n,r="FunctionsError",a){super(n),this.name=r,this.context=a}}class Lp extends Xu{constructor(n){super("Failed to send a request to the Edge Function","FunctionsFetchError",n)}}class tf extends Xu{constructor(n){super("Relay Error invoking the Edge Function","FunctionsRelayError",n)}}class rf extends Xu{constructor(n){super("Edge Function returned a non-2xx status code","FunctionsHttpError",n)}}var Pu;(function(u){u.Any="any",u.ApNortheast1="ap-northeast-1",u.ApNortheast2="ap-northeast-2",u.ApSouth1="ap-south-1",u.ApSoutheast1="ap-southeast-1",u.ApSoutheast2="ap-southeast-2",u.CaCentral1="ca-central-1",u.EuCentral1="eu-central-1",u.EuWest1="eu-west-1",u.EuWest2="eu-west-2",u.EuWest3="eu-west-3",u.SaEast1="sa-east-1",u.UsEast1="us-east-1",u.UsWest1="us-west-1",u.UsWest2="us-west-2"})(Pu||(Pu={}));var Ap=function(u,n,r,a){function i(h){return h instanceof r?h:new r(function(d){d(h)})}return new(r||(r=Promise))(function(h,d){function p(S){try{y(a.next(S))}catch(N){d(N)}}function x(S){try{y(a.throw(S))}catch(N){d(N)}}function y(S){S.done?h(S.value):i(S.value).then(p,x)}y((a=a.apply(u,n||[])).next())})};class $p{constructor(n,{headers:r={},customFetch:a,region:i=Pu.Any}={}){this.url=n,this.headers=r,this.region=i,this.fetch=Dp(a)}setAuth(n){this.headers.Authorization=`Bearer ${n}`}invoke(n,r={}){var a;return Ap(this,void 0,void 0,function*(){try{const{headers:i,method:h,body:d}=r;let p={},{region:x}=r;x||(x=this.region);const y=new URL(`${this.url}/${n}`);x&&x!=="any"&&(p["x-region"]=x,y.searchParams.set("forceFunctionRegion",x));let S;d&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&d instanceof Blob||d instanceof ArrayBuffer?(p["Content-Type"]="application/octet-stream",S=d):typeof d=="string"?(p["Content-Type"]="text/plain",S=d):typeof FormData<"u"&&d instanceof FormData?S=d:(p["Content-Type"]="application/json",S=JSON.stringify(d)));const N=yield this.fetch(y.toString(),{method:h||"POST",headers:Object.assign(Object.assign(Object.assign({},p),this.headers),i),body:S}).catch($=>{throw new Lp($)}),R=N.headers.get("x-relay-error");if(R&&R==="true")throw new tf(N);if(!N.ok)throw new rf(N);let A=((a=N.headers.get("Content-Type"))!==null&&a!==void 0?a:"text/plain").split(";")[0].trim(),U;return A==="application/json"?U=yield N.json():A==="application/octet-stream"?U=yield N.blob():A==="text/event-stream"?U=N:A==="multipart/form-data"?U=yield N.formData():U=yield N.text(),{data:U,error:null,response:N}}catch(i){return{data:null,error:i,response:i instanceof rf||i instanceof tf?i.context:void 0}}})}}var $t={},Uo={},Fo={},Vo={},Bo={},zo={},Mp=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Yo=Mp();const Up=Yo.fetch,zf=Yo.fetch.bind(Yo),Wf=Yo.Headers,Fp=Yo.Request,Vp=Yo.Response,ra=Object.freeze(Object.defineProperty({__proto__:null,Headers:Wf,Request:Fp,Response:Vp,default:zf,fetch:Up},Symbol.toStringTag,{value:"Module"})),Bp=Zm(ra);var wl={},nf;function Hf(){if(nf)return wl;nf=1,Object.defineProperty(wl,"__esModule",{value:!0});class u extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}}return wl.default=u,wl}var sf;function qf(){if(sf)return zo;sf=1;var u=zo&&zo.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(zo,"__esModule",{value:!0});const n=u(Bp),r=u(Hf());class a{constructor(h){var d,p;this.shouldThrowOnError=!1,this.method=h.method,this.url=h.url,this.headers=new Headers(h.headers),this.schema=h.schema,this.body=h.body,this.shouldThrowOnError=(d=h.shouldThrowOnError)!==null&&d!==void 0?d:!1,this.signal=h.signal,this.isMaybeSingle=(p=h.isMaybeSingle)!==null&&p!==void 0?p:!1,h.fetch?this.fetch=h.fetch:typeof fetch>"u"?this.fetch=n.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(h,d){return this.headers=new Headers(this.headers),this.headers.set(h,d),this}then(h,d){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const p=this.fetch;let x=p(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async y=>{var S,N,R,A;let U=null,$=null,O=null,J=y.status,X=y.statusText;if(y.ok){if(this.method!=="HEAD"){const P=await y.text();P===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((S=this.headers.get("Accept"))===null||S===void 0)&&S.includes("application/vnd.pgrst.plan+text"))?$=P:$=JSON.parse(P))}const K=(N=this.headers.get("Prefer"))===null||N===void 0?void 0:N.match(/count=(exact|planned|estimated)/),Y=(R=y.headers.get("content-range"))===null||R===void 0?void 0:R.split("/");K&&Y&&Y.length>1&&(O=parseInt(Y[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray($)&&($.length>1?(U={code:"PGRST116",details:`Results contain ${$.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},$=null,O=null,J=406,X="Not Acceptable"):$.length===1?$=$[0]:$=null)}else{const K=await y.text();try{U=JSON.parse(K),Array.isArray(U)&&y.status===404&&($=[],U=null,J=200,X="OK")}catch{y.status===404&&K===""?(J=204,X="No Content"):U={message:K}}if(U&&this.isMaybeSingle&&(!((A=U?.details)===null||A===void 0)&&A.includes("0 rows"))&&(U=null,J=200,X="OK"),U&&this.shouldThrowOnError)throw new r.default(U)}return{error:U,data:$,count:O,status:J,statusText:X}});return this.shouldThrowOnError||(x=x.catch(y=>{var S,N,R;return{error:{message:`${(S=y?.name)!==null&&S!==void 0?S:"FetchError"}: ${y?.message}`,details:`${(N=y?.stack)!==null&&N!==void 0?N:""}`,hint:"",code:`${(R=y?.code)!==null&&R!==void 0?R:""}`},data:null,count:null,status:0,statusText:""}})),x.then(h,d)}returns(){return this}overrideTypes(){return this}}return zo.default=a,zo}var of;function Kf(){if(of)return Bo;of=1;var u=Bo&&Bo.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Bo,"__esModule",{value:!0});const n=u(qf());class r extends n.default{select(i){let h=!1;const d=(i??"*").split("").map(p=>/\s/.test(p)&&!h?"":(p==='"'&&(h=!h),p)).join("");return this.url.searchParams.set("select",d),this.headers.append("Prefer","return=representation"),this}order(i,{ascending:h=!0,nullsFirst:d,foreignTable:p,referencedTable:x=p}={}){const y=x?`${x}.order`:"order",S=this.url.searchParams.get(y);return this.url.searchParams.set(y,`${S?`${S},`:""}${i}.${h?"asc":"desc"}${d===void 0?"":d?".nullsfirst":".nullslast"}`),this}limit(i,{foreignTable:h,referencedTable:d=h}={}){const p=typeof d>"u"?"limit":`${d}.limit`;return this.url.searchParams.set(p,`${i}`),this}range(i,h,{foreignTable:d,referencedTable:p=d}={}){const x=typeof p>"u"?"offset":`${p}.offset`,y=typeof p>"u"?"limit":`${p}.limit`;return this.url.searchParams.set(x,`${i}`),this.url.searchParams.set(y,`${h-i+1}`),this}abortSignal(i){return this.signal=i,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:i=!1,verbose:h=!1,settings:d=!1,buffers:p=!1,wal:x=!1,format:y="text"}={}){var S;const N=[i?"analyze":null,h?"verbose":null,d?"settings":null,p?"buffers":null,x?"wal":null].filter(Boolean).join("|"),R=(S=this.headers.get("Accept"))!==null&&S!==void 0?S:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${y}; for="${R}"; options=${N};`),y==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(i){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${i}`),this}}return Bo.default=r,Bo}var af;function Zu(){if(af)return Vo;af=1;var u=Vo&&Vo.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Vo,"__esModule",{value:!0});const n=u(Kf());class r extends n.default{eq(i,h){return this.url.searchParams.append(i,`eq.${h}`),this}neq(i,h){return this.url.searchParams.append(i,`neq.${h}`),this}gt(i,h){return this.url.searchParams.append(i,`gt.${h}`),this}gte(i,h){return this.url.searchParams.append(i,`gte.${h}`),this}lt(i,h){return this.url.searchParams.append(i,`lt.${h}`),this}lte(i,h){return this.url.searchParams.append(i,`lte.${h}`),this}like(i,h){return this.url.searchParams.append(i,`like.${h}`),this}likeAllOf(i,h){return this.url.searchParams.append(i,`like(all).{${h.join(",")}}`),this}likeAnyOf(i,h){return this.url.searchParams.append(i,`like(any).{${h.join(",")}}`),this}ilike(i,h){return this.url.searchParams.append(i,`ilike.${h}`),this}ilikeAllOf(i,h){return this.url.searchParams.append(i,`ilike(all).{${h.join(",")}}`),this}ilikeAnyOf(i,h){return this.url.searchParams.append(i,`ilike(any).{${h.join(",")}}`),this}is(i,h){return this.url.searchParams.append(i,`is.${h}`),this}in(i,h){const d=Array.from(new Set(h)).map(p=>typeof p=="string"&&new RegExp("[,()]").test(p)?`"${p}"`:`${p}`).join(",");return this.url.searchParams.append(i,`in.(${d})`),this}contains(i,h){return typeof h=="string"?this.url.searchParams.append(i,`cs.${h}`):Array.isArray(h)?this.url.searchParams.append(i,`cs.{${h.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(h)}`),this}containedBy(i,h){return typeof h=="string"?this.url.searchParams.append(i,`cd.${h}`):Array.isArray(h)?this.url.searchParams.append(i,`cd.{${h.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(h)}`),this}rangeGt(i,h){return this.url.searchParams.append(i,`sr.${h}`),this}rangeGte(i,h){return this.url.searchParams.append(i,`nxl.${h}`),this}rangeLt(i,h){return this.url.searchParams.append(i,`sl.${h}`),this}rangeLte(i,h){return this.url.searchParams.append(i,`nxr.${h}`),this}rangeAdjacent(i,h){return this.url.searchParams.append(i,`adj.${h}`),this}overlaps(i,h){return typeof h=="string"?this.url.searchParams.append(i,`ov.${h}`):this.url.searchParams.append(i,`ov.{${h.join(",")}}`),this}textSearch(i,h,{config:d,type:p}={}){let x="";p==="plain"?x="pl":p==="phrase"?x="ph":p==="websearch"&&(x="w");const y=d===void 0?"":`(${d})`;return this.url.searchParams.append(i,`${x}fts${y}.${h}`),this}match(i){return Object.entries(i).forEach(([h,d])=>{this.url.searchParams.append(h,`eq.${d}`)}),this}not(i,h,d){return this.url.searchParams.append(i,`not.${h}.${d}`),this}or(i,{foreignTable:h,referencedTable:d=h}={}){const p=d?`${d}.or`:"or";return this.url.searchParams.append(p,`(${i})`),this}filter(i,h,d){return this.url.searchParams.append(i,`${h}.${d}`),this}}return Vo.default=r,Vo}var lf;function Gf(){if(lf)return Fo;lf=1;var u=Fo&&Fo.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Fo,"__esModule",{value:!0});const n=u(Zu());class r{constructor(i,{headers:h={},schema:d,fetch:p}){this.url=i,this.headers=new Headers(h),this.schema=d,this.fetch=p}select(i,{head:h=!1,count:d}={}){const p=h?"HEAD":"GET";let x=!1;const y=(i??"*").split("").map(S=>/\s/.test(S)&&!x?"":(S==='"'&&(x=!x),S)).join("");return this.url.searchParams.set("select",y),d&&this.headers.append("Prefer",`count=${d}`),new n.default({method:p,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(i,{count:h,defaultToNull:d=!0}={}){var p;const x="POST";if(h&&this.headers.append("Prefer",`count=${h}`),d||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const y=i.reduce((S,N)=>S.concat(Object.keys(N)),[]);if(y.length>0){const S=[...new Set(y)].map(N=>`"${N}"`);this.url.searchParams.set("columns",S.join(","))}}return new n.default({method:x,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(p=this.fetch)!==null&&p!==void 0?p:fetch})}upsert(i,{onConflict:h,ignoreDuplicates:d=!1,count:p,defaultToNull:x=!0}={}){var y;const S="POST";if(this.headers.append("Prefer",`resolution=${d?"ignore":"merge"}-duplicates`),h!==void 0&&this.url.searchParams.set("on_conflict",h),p&&this.headers.append("Prefer",`count=${p}`),x||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const N=i.reduce((R,A)=>R.concat(Object.keys(A)),[]);if(N.length>0){const R=[...new Set(N)].map(A=>`"${A}"`);this.url.searchParams.set("columns",R.join(","))}}return new n.default({method:S,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(y=this.fetch)!==null&&y!==void 0?y:fetch})}update(i,{count:h}={}){var d;const p="PATCH";return h&&this.headers.append("Prefer",`count=${h}`),new n.default({method:p,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}delete({count:i}={}){var h;const d="DELETE";return i&&this.headers.append("Prefer",`count=${i}`),new n.default({method:d,url:this.url,headers:this.headers,schema:this.schema,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}}return Fo.default=r,Fo}var cf;function zp(){if(cf)return Uo;cf=1;var u=Uo&&Uo.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Uo,"__esModule",{value:!0});const n=u(Gf()),r=u(Zu());class a{constructor(h,{headers:d={},schema:p,fetch:x}={}){this.url=h,this.headers=new Headers(d),this.schemaName=p,this.fetch=x}from(h){const d=new URL(`${this.url}/${h}`);return new n.default(d,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(h){return new a(this.url,{headers:this.headers,schema:h,fetch:this.fetch})}rpc(h,d={},{head:p=!1,get:x=!1,count:y}={}){var S;let N;const R=new URL(`${this.url}/rpc/${h}`);let A;p||x?(N=p?"HEAD":"GET",Object.entries(d).filter(([$,O])=>O!==void 0).map(([$,O])=>[$,Array.isArray(O)?`{${O.join(",")}}`:`${O}`]).forEach(([$,O])=>{R.searchParams.append($,O)})):(N="POST",A=d);const U=new Headers(this.headers);return y&&U.set("Prefer",`count=${y}`),new r.default({method:N,url:R,headers:U,schema:this.schemaName,body:A,fetch:(S=this.fetch)!==null&&S!==void 0?S:fetch})}}return Uo.default=a,Uo}var uf;function Wp(){if(uf)return $t;uf=1;var u=$t&&$t.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty($t,"__esModule",{value:!0}),$t.PostgrestError=$t.PostgrestBuilder=$t.PostgrestTransformBuilder=$t.PostgrestFilterBuilder=$t.PostgrestQueryBuilder=$t.PostgrestClient=void 0;const n=u(zp());$t.PostgrestClient=n.default;const r=u(Gf());$t.PostgrestQueryBuilder=r.default;const a=u(Zu());$t.PostgrestFilterBuilder=a.default;const i=u(Kf());$t.PostgrestTransformBuilder=i.default;const h=u(qf());$t.PostgrestBuilder=h.default;const d=u(Hf());return $t.PostgrestError=d.default,$t.default={PostgrestClient:n.default,PostgrestQueryBuilder:r.default,PostgrestFilterBuilder:a.default,PostgrestTransformBuilder:i.default,PostgrestBuilder:h.default,PostgrestError:d.default},$t}var Hp=Wp();const qp=Hu(Hp),{PostgrestClient:Kp,PostgrestQueryBuilder:ex,PostgrestFilterBuilder:tx,PostgrestTransformBuilder:rx,PostgrestBuilder:nx,PostgrestError:sx}=qp;class Gp{static detectEnvironment(){var n;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((n=navigator.userAgent)===null||n===void 0)&&n.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const r=parseInt(process.versions.node.split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const n=this.detectEnvironment();if(n.constructor)return n.constructor;let r=n.error||"WebSocket not supported in this environment.";throw n.workaround&&(r+=`

Suggested solution: ${n.workaround}`),new Error(r)}static createWebSocket(n,r){const a=this.getWebSocketConstructor();return new a(n,r)}static isWebSocketSupported(){try{const n=this.detectEnvironment();return n.type==="native"||n.type==="ws"}catch{return!1}}}const Jp="2.15.4",Qp=`realtime-js/${Jp}`,Yp="1.0.0",Du=1e4,Xp=1e3,Zp=100;var Qa;(function(u){u[u.connecting=0]="connecting",u[u.open=1]="open",u[u.closing=2]="closing",u[u.closed=3]="closed"})(Qa||(Qa={}));var Rt;(function(u){u.closed="closed",u.errored="errored",u.joined="joined",u.joining="joining",u.leaving="leaving"})(Rt||(Rt={}));var en;(function(u){u.close="phx_close",u.error="phx_error",u.join="phx_join",u.reply="phx_reply",u.leave="phx_leave",u.access_token="access_token"})(en||(en={}));var Lu;(function(u){u.websocket="websocket"})(Lu||(Lu={}));var no;(function(u){u.Connecting="connecting",u.Open="open",u.Closing="closing",u.Closed="closed"})(no||(no={}));class e0{constructor(){this.HEADER_LENGTH=1}decode(n,r){return n.constructor===ArrayBuffer?r(this._binaryDecode(n)):r(typeof n=="string"?JSON.parse(n):{})}_binaryDecode(n){const r=new DataView(n),a=new TextDecoder;return this._decodeBroadcast(n,r,a)}_decodeBroadcast(n,r,a){const i=r.getUint8(1),h=r.getUint8(2);let d=this.HEADER_LENGTH+2;const p=a.decode(n.slice(d,d+i));d=d+i;const x=a.decode(n.slice(d,d+h));d=d+h;const y=JSON.parse(a.decode(n.slice(d,n.byteLength)));return{ref:null,topic:p,event:x,payload:y}}}class Jf{constructor(n,r){this.callback=n,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=n,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ot;(function(u){u.abstime="abstime",u.bool="bool",u.date="date",u.daterange="daterange",u.float4="float4",u.float8="float8",u.int2="int2",u.int4="int4",u.int4range="int4range",u.int8="int8",u.int8range="int8range",u.json="json",u.jsonb="jsonb",u.money="money",u.numeric="numeric",u.oid="oid",u.reltime="reltime",u.text="text",u.time="time",u.timestamp="timestamp",u.timestamptz="timestamptz",u.timetz="timetz",u.tsrange="tsrange",u.tstzrange="tstzrange"})(ot||(ot={}));const df=(u,n,r={})=>{var a;const i=(a=r.skipTypes)!==null&&a!==void 0?a:[];return Object.keys(n).reduce((h,d)=>(h[d]=t0(d,u,n,i),h),{})},t0=(u,n,r,a)=>{const i=n.find(p=>p.name===u),h=i?.type,d=r[u];return h&&!a.includes(h)?Qf(h,d):Au(d)},Qf=(u,n)=>{if(u.charAt(0)==="_"){const r=u.slice(1,u.length);return o0(n,r)}switch(u){case ot.bool:return r0(n);case ot.float4:case ot.float8:case ot.int2:case ot.int4:case ot.int8:case ot.numeric:case ot.oid:return n0(n);case ot.json:case ot.jsonb:return s0(n);case ot.timestamp:return a0(n);case ot.abstime:case ot.date:case ot.daterange:case ot.int4range:case ot.int8range:case ot.money:case ot.reltime:case ot.text:case ot.time:case ot.timestamptz:case ot.timetz:case ot.tsrange:case ot.tstzrange:return Au(n);default:return Au(n)}},Au=u=>u,r0=u=>{switch(u){case"t":return!0;case"f":return!1;default:return u}},n0=u=>{if(typeof u=="string"){const n=parseFloat(u);if(!Number.isNaN(n))return n}return u},s0=u=>{if(typeof u=="string")try{return JSON.parse(u)}catch(n){return console.log(`JSON parse error: ${n}`),u}return u},o0=(u,n)=>{if(typeof u!="string")return u;const r=u.length-1,a=u[r];if(u[0]==="{"&&a==="}"){let h;const d=u.slice(1,r);try{h=JSON.parse("["+d+"]")}catch{h=d?d.split(","):[]}return h.map(p=>Qf(n,p))}return u},a0=u=>typeof u=="string"?u.replace(" ","T"):u,Yf=u=>{let n=u;return n=n.replace(/^ws/i,"http"),n=n.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),n.replace(/\/+$/,"")+"/api/broadcast"};class _u{constructor(n,r,a={},i=Du){this.channel=n,this.event=r,this.payload=a,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(n){this.timeout=n,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(n){this.payload=Object.assign(Object.assign({},this.payload),n)}receive(n,r){var a;return this._hasReceived(n)&&r((a=this.receivedResp)===null||a===void 0?void 0:a.response),this.recHooks.push({status:n,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const n=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},n),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(n,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:n,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:n,response:r}){this.recHooks.filter(a=>a.status===n).forEach(a=>a.callback(r))}_hasReceived(n){return this.receivedResp&&this.receivedResp.status===n}}var hf;(function(u){u.SYNC="sync",u.JOIN="join",u.LEAVE="leave"})(hf||(hf={}));class Ya{constructor(n,r){this.channel=n,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const a=r?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(a.state,{},i=>{const{onJoin:h,onLeave:d,onSync:p}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ya.syncState(this.state,i,h,d),this.pendingDiffs.forEach(x=>{this.state=Ya.syncDiff(this.state,x,h,d)}),this.pendingDiffs=[],p()}),this.channel._on(a.diff,{},i=>{const{onJoin:h,onLeave:d,onSync:p}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=Ya.syncDiff(this.state,i,h,d),p())}),this.onJoin((i,h,d)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:h,newPresences:d})}),this.onLeave((i,h,d)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:h,leftPresences:d})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(n,r,a,i){const h=this.cloneDeep(n),d=this.transformState(r),p={},x={};return this.map(h,(y,S)=>{d[y]||(x[y]=S)}),this.map(d,(y,S)=>{const N=h[y];if(N){const R=S.map(O=>O.presence_ref),A=N.map(O=>O.presence_ref),U=S.filter(O=>A.indexOf(O.presence_ref)<0),$=N.filter(O=>R.indexOf(O.presence_ref)<0);U.length>0&&(p[y]=U),$.length>0&&(x[y]=$)}else p[y]=S}),this.syncDiff(h,{joins:p,leaves:x},a,i)}static syncDiff(n,r,a,i){const{joins:h,leaves:d}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return a||(a=()=>{}),i||(i=()=>{}),this.map(h,(p,x)=>{var y;const S=(y=n[p])!==null&&y!==void 0?y:[];if(n[p]=this.cloneDeep(x),S.length>0){const N=n[p].map(A=>A.presence_ref),R=S.filter(A=>N.indexOf(A.presence_ref)<0);n[p].unshift(...R)}a(p,S,x)}),this.map(d,(p,x)=>{let y=n[p];if(!y)return;const S=x.map(N=>N.presence_ref);y=y.filter(N=>S.indexOf(N.presence_ref)<0),n[p]=y,i(p,y,x),y.length===0&&delete n[p]}),n}static map(n,r){return Object.getOwnPropertyNames(n).map(a=>r(a,n[a]))}static transformState(n){return n=this.cloneDeep(n),Object.getOwnPropertyNames(n).reduce((r,a)=>{const i=n[a];return"metas"in i?r[a]=i.metas.map(h=>(h.presence_ref=h.phx_ref,delete h.phx_ref,delete h.phx_ref_prev,h)):r[a]=i,r},{})}static cloneDeep(n){return JSON.parse(JSON.stringify(n))}onJoin(n){this.caller.onJoin=n}onLeave(n){this.caller.onLeave=n}onSync(n){this.caller.onSync=n}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ff;(function(u){u.ALL="*",u.INSERT="INSERT",u.UPDATE="UPDATE",u.DELETE="DELETE"})(ff||(ff={}));var Xa;(function(u){u.BROADCAST="broadcast",u.PRESENCE="presence",u.POSTGRES_CHANGES="postgres_changes",u.SYSTEM="system"})(Xa||(Xa={}));var Pn;(function(u){u.SUBSCRIBED="SUBSCRIBED",u.TIMED_OUT="TIMED_OUT",u.CLOSED="CLOSED",u.CHANNEL_ERROR="CHANNEL_ERROR"})(Pn||(Pn={}));class ed{constructor(n,r={config:{}},a){this.topic=n,this.params=r,this.socket=a,this.bindings={},this.state=Rt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=n.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new _u(this,en.join,this.params,this.timeout),this.rejoinTimer=new Jf(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Rt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Rt.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=Rt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Rt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=Rt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(en.reply,{},(i,h)=>{this._trigger(this._replyEventName(h),i)}),this.presence=new Ya(this),this.broadcastEndpointURL=Yf(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(n,r=this.timeout){var a,i,h;if(this.socket.isConnected()||this.socket.connect(),this.state==Rt.closed){const{config:{broadcast:d,presence:p,private:x}}=this.params,y=(i=(a=this.bindings.postgres_changes)===null||a===void 0?void 0:a.map(A=>A.filter))!==null&&i!==void 0?i:[],S=!!this.bindings[Xa.PRESENCE]&&this.bindings[Xa.PRESENCE].length>0||((h=this.params.config.presence)===null||h===void 0?void 0:h.enabled)===!0,N={},R={broadcast:d,presence:Object.assign(Object.assign({},p),{enabled:S}),postgres_changes:y,private:x};this.socket.accessTokenValue&&(N.access_token=this.socket.accessTokenValue),this._onError(A=>n?.(Pn.CHANNEL_ERROR,A)),this._onClose(()=>n?.(Pn.CLOSED)),this.updateJoinPayload(Object.assign({config:R},N)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:A})=>{var U;if(this.socket.setAuth(),A===void 0){n?.(Pn.SUBSCRIBED);return}else{const $=this.bindings.postgres_changes,O=(U=$?.length)!==null&&U!==void 0?U:0,J=[];for(let X=0;X<O;X++){const q=$[X],{filter:{event:K,schema:Y,table:P,filter:B}}=q,ne=A&&A[X];if(ne&&ne.event===K&&ne.schema===Y&&ne.table===P&&ne.filter===B)J.push(Object.assign(Object.assign({},q),{id:ne.id}));else{this.unsubscribe(),this.state=Rt.errored,n?.(Pn.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=J,n&&n(Pn.SUBSCRIBED);return}}).receive("error",A=>{this.state=Rt.errored,n?.(Pn.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(A).join(", ")||"error")))}).receive("timeout",()=>{n?.(Pn.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(n,r={}){return await this.send({type:"presence",event:"track",payload:n},r.timeout||this.timeout)}async untrack(n={}){return await this.send({type:"presence",event:"untrack"},n)}on(n,r,a){return this.state===Rt.joined&&n===Xa.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(n,r,a)}async send(n,r={}){var a,i;if(!this._canPush()&&n.type==="broadcast"){const{event:h,payload:d}=n,x={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:h,payload:d,private:this.private}]})};try{const y=await this._fetchWithTimeout(this.broadcastEndpointURL,x,(a=r.timeout)!==null&&a!==void 0?a:this.timeout);return await((i=y.body)===null||i===void 0?void 0:i.cancel()),y.ok?"ok":"error"}catch(y){return y.name==="AbortError"?"timed out":"error"}}else return new Promise(h=>{var d,p,x;const y=this._push(n.type,n,r.timeout||this.timeout);n.type==="broadcast"&&!(!((x=(p=(d=this.params)===null||d===void 0?void 0:d.config)===null||p===void 0?void 0:p.broadcast)===null||x===void 0)&&x.ack)&&h("ok"),y.receive("ok",()=>h("ok")),y.receive("error",()=>h("error")),y.receive("timeout",()=>h("timed out"))})}updateJoinPayload(n){this.joinPush.updatePayload(n)}unsubscribe(n=this.timeout){this.state=Rt.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(en.close,"leave",this._joinRef())};this.joinPush.destroy();let a=null;return new Promise(i=>{a=new _u(this,en.leave,{},n),a.receive("ok",()=>{r(),i("ok")}).receive("timeout",()=>{r(),i("timed out")}).receive("error",()=>{i("error")}),a.send(),this._canPush()||a.trigger("ok",{})}).finally(()=>{a?.destroy()})}teardown(){this.pushBuffer.forEach(n=>n.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Rt.closed,this.bindings={}}async _fetchWithTimeout(n,r,a){const i=new AbortController,h=setTimeout(()=>i.abort(),a),d=await this.socket.fetch(n,Object.assign(Object.assign({},r),{signal:i.signal}));return clearTimeout(h),d}_push(n,r,a=this.timeout){if(!this.joinedOnce)throw`tried to push '${n}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new _u(this,n,r,a);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(n){if(n.startTimeout(),this.pushBuffer.push(n),this.pushBuffer.length>Zp){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(n,r,a){return r}_isMember(n){return this.topic===n}_joinRef(){return this.joinPush.ref}_trigger(n,r,a){var i,h;const d=n.toLocaleLowerCase(),{close:p,error:x,leave:y,join:S}=en;if(a&&[p,x,y,S].indexOf(d)>=0&&a!==this._joinRef())return;let R=this._onMessage(d,r,a);if(r&&!R)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(d)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(A=>{var U,$,O;return((U=A.filter)===null||U===void 0?void 0:U.event)==="*"||((O=($=A.filter)===null||$===void 0?void 0:$.event)===null||O===void 0?void 0:O.toLocaleLowerCase())===d}).map(A=>A.callback(R,a)):(h=this.bindings[d])===null||h===void 0||h.filter(A=>{var U,$,O,J,X,q;if(["broadcast","presence","postgres_changes"].includes(d))if("id"in A){const K=A.id,Y=(U=A.filter)===null||U===void 0?void 0:U.event;return K&&(($=r.ids)===null||$===void 0?void 0:$.includes(K))&&(Y==="*"||Y?.toLocaleLowerCase()===((O=r.data)===null||O===void 0?void 0:O.type.toLocaleLowerCase()))}else{const K=(X=(J=A?.filter)===null||J===void 0?void 0:J.event)===null||X===void 0?void 0:X.toLocaleLowerCase();return K==="*"||K===((q=r?.event)===null||q===void 0?void 0:q.toLocaleLowerCase())}else return A.type.toLocaleLowerCase()===d}).map(A=>{if(typeof R=="object"&&"ids"in R){const U=R.data,{schema:$,table:O,commit_timestamp:J,type:X,errors:q}=U;R=Object.assign(Object.assign({},{schema:$,table:O,commit_timestamp:J,eventType:X,new:{},old:{},errors:q}),this._getPayloadRecords(U))}A.callback(R,a)})}_isClosed(){return this.state===Rt.closed}_isJoined(){return this.state===Rt.joined}_isJoining(){return this.state===Rt.joining}_isLeaving(){return this.state===Rt.leaving}_replyEventName(n){return`chan_reply_${n}`}_on(n,r,a){const i=n.toLocaleLowerCase(),h={type:i,filter:r,callback:a};return this.bindings[i]?this.bindings[i].push(h):this.bindings[i]=[h],this}_off(n,r){const a=n.toLocaleLowerCase();return this.bindings[a]&&(this.bindings[a]=this.bindings[a].filter(i=>{var h;return!(((h=i.type)===null||h===void 0?void 0:h.toLocaleLowerCase())===a&&ed.isEqual(i.filter,r))})),this}static isEqual(n,r){if(Object.keys(n).length!==Object.keys(r).length)return!1;for(const a in n)if(n[a]!==r[a])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(n){this._on(en.close,{},n)}_onError(n){this._on(en.error,{},r=>n(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(n=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Rt.joining,this.joinPush.resend(n))}_getPayloadRecords(n){const r={new:{},old:{}};return(n.type==="INSERT"||n.type==="UPDATE")&&(r.new=df(n.columns,n.record)),(n.type==="UPDATE"||n.type==="DELETE")&&(r.old=df(n.columns,n.old_record)),r}}const Eu=()=>{},Sl={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},i0=[1e3,2e3,5e3,1e4],l0=1e4,c0=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class u0{constructor(n,r){var a;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Du,this.transport=null,this.heartbeatIntervalMs=Sl.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Eu,this.ref=0,this.reconnectTimer=null,this.logger=Eu,this.conn=null,this.sendBuffer=[],this.serializer=new e0,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=i=>{let h;return i?h=i:typeof fetch>"u"?h=(...d)=>ta(async()=>{const{default:p}=await Promise.resolve().then(()=>ra);return{default:p}},void 0).then(({default:p})=>p(...d)).catch(p=>{throw new Error(`Failed to load @supabase/node-fetch: ${p.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):h=fetch,(...d)=>h(...d)},!(!((a=r?.params)===null||a===void 0)&&a.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${n}/${Lu.websocket}`,this.httpEndpoint=Yf(n),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Gp.createWebSocket(this.endpointURL())}catch(n){this._setConnectionState("disconnected");const r=n.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Yp}))}disconnect(n,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const a=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(a),this._setConnectionState("disconnected")},n?this.conn.close(n,r??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(n){const r=await n.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const n=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),n}log(n,r,a){this.logger(n,r,a)}connectionState(){switch(this.conn&&this.conn.readyState){case Qa.connecting:return no.Connecting;case Qa.open:return no.Open;case Qa.closing:return no.Closing;default:return no.Closed}}isConnected(){return this.connectionState()===no.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(n,r={config:{}}){const a=`realtime:${n}`,i=this.getChannels().find(h=>h.topic===a);if(i)return i;{const h=new ed(`realtime:${n}`,r,this);return this.channels.push(h),h}}push(n){const{topic:r,event:a,payload:i,ref:h}=n,d=()=>{this.encode(n,p=>{var x;(x=this.conn)===null||x===void 0||x.send(p)})};this.log("push",`${r} ${a} (${h})`,i),this.isConnected()?d():this.sendBuffer.push(d)}async setAuth(n=null){this._authPromise=this._performAuth(n);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var n;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(n=this.conn)===null||n===void 0||n.close(Xp,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},Sl.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(n){this.heartbeatCallback=n}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(n=>n()),this.sendBuffer=[])}_makeRef(){let n=this.ref+1;return n===this.ref?this.ref=0:this.ref=n,this.ref.toString()}_leaveOpenTopic(n){let r=this.channels.find(a=>a.topic===n&&(a._isJoined()||a._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${n}"`),r.unsubscribe())}_remove(n){this.channels=this.channels.filter(r=>r.topic!==n.topic)}_onConnMessage(n){this.decode(n.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply")try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error")}catch(y){this.log("error","error in heartbeat callback",y)}r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:a,event:i,payload:h,ref:d}=r,p=d?`(${d})`:"",x=h.status||"";this.log("receive",`${x} ${a} ${i} ${p}`.trim(),h),this.channels.filter(y=>y._isMember(a)).forEach(y=>y._trigger(i,h,d)),this._triggerStateCallbacks("message",r)})}_clearTimer(n){var r;n==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):n==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=n=>this._onConnError(n),this.conn.onmessage=n=>this._onConnMessage(n),this.conn.onclose=n=>this._onConnClose(n))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(n=>n.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const n=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(n),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(n){var r;this._setConnectionState("disconnected"),this.log("transport","close",n),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",n)}_onConnError(n){this._setConnectionState("disconnected"),this.log("transport",`${n}`),this._triggerChanError(),this._triggerStateCallbacks("error",n)}_triggerChanError(){this.channels.forEach(n=>n._trigger(en.error))}_appendParams(n,r){if(Object.keys(r).length===0)return n;const a=n.match(/\?/)?"&":"?",i=new URLSearchParams(r);return`${n}${a}${i}`}_workerObjectUrl(n){let r;if(n)r=n;else{const a=new Blob([c0],{type:"application/javascript"});r=URL.createObjectURL(a)}return r}_setConnectionState(n,r=!1){this._connectionState=n,n==="connecting"?this._wasManualDisconnect=!1:n==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(n=null){let r;n?r=n:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(a=>{const i={access_token:r,version:Qp};r&&a.updateJoinPayload(i),a.joinedOnce&&a._isJoined()&&a._push(en.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(n="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${n}`,r)})}_triggerStateCallbacks(n,r){try{this.stateChangeCallbacks[n].forEach(a=>{try{a(r)}catch(i){this.log("error",`error in ${n} callback`,i)}})}catch(a){this.log("error",`error triggering ${n} callbacks`,a)}}_setupReconnectionTimer(){this.reconnectTimer=new Jf(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Sl.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(n){var r,a,i,h,d,p,x,y,S;if(this.transport=(r=n?.transport)!==null&&r!==void 0?r:null,this.timeout=(a=n?.timeout)!==null&&a!==void 0?a:Du,this.heartbeatIntervalMs=(i=n?.heartbeatIntervalMs)!==null&&i!==void 0?i:Sl.HEARTBEAT_INTERVAL,this.worker=(h=n?.worker)!==null&&h!==void 0?h:!1,this.accessToken=(d=n?.accessToken)!==null&&d!==void 0?d:null,this.heartbeatCallback=(p=n?.heartbeatCallback)!==null&&p!==void 0?p:Eu,n?.params&&(this.params=n.params),n?.logger&&(this.logger=n.logger),(n?.logLevel||n?.log_level)&&(this.logLevel=n.logLevel||n.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(x=n?.reconnectAfterMs)!==null&&x!==void 0?x:(N=>i0[N-1]||l0),this.encode=(y=n?.encode)!==null&&y!==void 0?y:((N,R)=>R(JSON.stringify(N))),this.decode=(S=n?.decode)!==null&&S!==void 0?S:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=n?.workerUrl}}}class td extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}}function It(u){return typeof u=="object"&&u!==null&&"__isStorageError"in u}class d0 extends td{constructor(n,r,a){super(n),this.name="StorageApiError",this.status=r,this.statusCode=a}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class $u extends td{constructor(n,r){super(n),this.name="StorageUnknownError",this.originalError=r}}var h0=function(u,n,r,a){function i(h){return h instanceof r?h:new r(function(d){d(h)})}return new(r||(r=Promise))(function(h,d){function p(S){try{y(a.next(S))}catch(N){d(N)}}function x(S){try{y(a.throw(S))}catch(N){d(N)}}function y(S){S.done?h(S.value):i(S.value).then(p,x)}y((a=a.apply(u,n||[])).next())})};const Xf=u=>{let n;return u?n=u:typeof fetch>"u"?n=(...r)=>ta(async()=>{const{default:a}=await Promise.resolve().then(()=>ra);return{default:a}},void 0).then(({default:a})=>a(...r)):n=fetch,(...r)=>n(...r)},f0=()=>h0(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield ta(()=>Promise.resolve().then(()=>ra),void 0)).Response:Response}),Mu=u=>{if(Array.isArray(u))return u.map(r=>Mu(r));if(typeof u=="function"||u!==Object(u))return u;const n={};return Object.entries(u).forEach(([r,a])=>{const i=r.replace(/([-_][a-z])/gi,h=>h.toUpperCase().replace(/[-_]/g,""));n[i]=Mu(a)}),n},m0=u=>{if(typeof u!="object"||u===null)return!1;const n=Object.getPrototypeOf(u);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(Symbol.toStringTag in u)&&!(Symbol.iterator in u)};var so=function(u,n,r,a){function i(h){return h instanceof r?h:new r(function(d){d(h)})}return new(r||(r=Promise))(function(h,d){function p(S){try{y(a.next(S))}catch(N){d(N)}}function x(S){try{y(a.throw(S))}catch(N){d(N)}}function y(S){S.done?h(S.value):i(S.value).then(p,x)}y((a=a.apply(u,n||[])).next())})};const ku=u=>u.msg||u.message||u.error_description||u.error||JSON.stringify(u),g0=(u,n,r)=>so(void 0,void 0,void 0,function*(){const a=yield f0();u instanceof a&&!r?.noResolveJson?u.json().then(i=>{const h=u.status||500,d=i?.statusCode||h+"";n(new d0(ku(i),h,d))}).catch(i=>{n(new $u(ku(i),i))}):n(new $u(ku(u),u))}),p0=(u,n,r,a)=>{const i={method:u,headers:n?.headers||{}};return u==="GET"||!a?i:(m0(a)?(i.headers=Object.assign({"Content-Type":"application/json"},n?.headers),i.body=JSON.stringify(a)):i.body=a,n?.duplex&&(i.duplex=n.duplex),Object.assign(Object.assign({},i),r))};function si(u,n,r,a,i,h){return so(this,void 0,void 0,function*(){return new Promise((d,p)=>{u(r,p0(n,a,i,h)).then(x=>{if(!x.ok)throw x;return a?.noResolveJson?x:x.json()}).then(x=>d(x)).catch(x=>g0(x,p,a))})})}function Il(u,n,r,a){return so(this,void 0,void 0,function*(){return si(u,"GET",n,r,a)})}function mn(u,n,r,a,i){return so(this,void 0,void 0,function*(){return si(u,"POST",n,a,i,r)})}function Uu(u,n,r,a,i){return so(this,void 0,void 0,function*(){return si(u,"PUT",n,a,i,r)})}function v0(u,n,r,a){return so(this,void 0,void 0,function*(){return si(u,"HEAD",n,Object.assign(Object.assign({},r),{noResolveJson:!0}),a)})}function Zf(u,n,r,a,i){return so(this,void 0,void 0,function*(){return si(u,"DELETE",n,a,i,r)})}var ar=function(u,n,r,a){function i(h){return h instanceof r?h:new r(function(d){d(h)})}return new(r||(r=Promise))(function(h,d){function p(S){try{y(a.next(S))}catch(N){d(N)}}function x(S){try{y(a.throw(S))}catch(N){d(N)}}function y(S){S.done?h(S.value):i(S.value).then(p,x)}y((a=a.apply(u,n||[])).next())})};const x0={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},mf={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class y0{constructor(n,r={},a,i){this.url=n,this.headers=r,this.bucketId=a,this.fetch=Xf(i)}uploadOrUpdate(n,r,a,i){return ar(this,void 0,void 0,function*(){try{let h;const d=Object.assign(Object.assign({},mf),i);let p=Object.assign(Object.assign({},this.headers),n==="POST"&&{"x-upsert":String(d.upsert)});const x=d.metadata;typeof Blob<"u"&&a instanceof Blob?(h=new FormData,h.append("cacheControl",d.cacheControl),x&&h.append("metadata",this.encodeMetadata(x)),h.append("",a)):typeof FormData<"u"&&a instanceof FormData?(h=a,h.append("cacheControl",d.cacheControl),x&&h.append("metadata",this.encodeMetadata(x))):(h=a,p["cache-control"]=`max-age=${d.cacheControl}`,p["content-type"]=d.contentType,x&&(p["x-metadata"]=this.toBase64(this.encodeMetadata(x)))),i?.headers&&(p=Object.assign(Object.assign({},p),i.headers));const y=this._removeEmptyFolders(r),S=this._getFinalPath(y),N=yield(n=="PUT"?Uu:mn)(this.fetch,`${this.url}/object/${S}`,h,Object.assign({headers:p},d?.duplex?{duplex:d.duplex}:{}));return{data:{path:y,id:N.Id,fullPath:N.Key},error:null}}catch(h){if(It(h))return{data:null,error:h};throw h}})}upload(n,r,a){return ar(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",n,r,a)})}uploadToSignedUrl(n,r,a,i){return ar(this,void 0,void 0,function*(){const h=this._removeEmptyFolders(n),d=this._getFinalPath(h),p=new URL(this.url+`/object/upload/sign/${d}`);p.searchParams.set("token",r);try{let x;const y=Object.assign({upsert:mf.upsert},i),S=Object.assign(Object.assign({},this.headers),{"x-upsert":String(y.upsert)});typeof Blob<"u"&&a instanceof Blob?(x=new FormData,x.append("cacheControl",y.cacheControl),x.append("",a)):typeof FormData<"u"&&a instanceof FormData?(x=a,x.append("cacheControl",y.cacheControl)):(x=a,S["cache-control"]=`max-age=${y.cacheControl}`,S["content-type"]=y.contentType);const N=yield Uu(this.fetch,p.toString(),x,{headers:S});return{data:{path:h,fullPath:N.Key},error:null}}catch(x){if(It(x))return{data:null,error:x};throw x}})}createSignedUploadUrl(n,r){return ar(this,void 0,void 0,function*(){try{let a=this._getFinalPath(n);const i=Object.assign({},this.headers);r?.upsert&&(i["x-upsert"]="true");const h=yield mn(this.fetch,`${this.url}/object/upload/sign/${a}`,{},{headers:i}),d=new URL(this.url+h.url),p=d.searchParams.get("token");if(!p)throw new td("No token returned by API");return{data:{signedUrl:d.toString(),path:n,token:p},error:null}}catch(a){if(It(a))return{data:null,error:a};throw a}})}update(n,r,a){return ar(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",n,r,a)})}move(n,r,a){return ar(this,void 0,void 0,function*(){try{return{data:yield mn(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:n,destinationKey:r,destinationBucket:a?.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(It(i))return{data:null,error:i};throw i}})}copy(n,r,a){return ar(this,void 0,void 0,function*(){try{return{data:{path:(yield mn(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:n,destinationKey:r,destinationBucket:a?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(It(i))return{data:null,error:i};throw i}})}createSignedUrl(n,r,a){return ar(this,void 0,void 0,function*(){try{let i=this._getFinalPath(n),h=yield mn(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:r},a?.transform?{transform:a.transform}:{}),{headers:this.headers});const d=a?.download?`&download=${a.download===!0?"":a.download}`:"";return h={signedUrl:encodeURI(`${this.url}${h.signedURL}${d}`)},{data:h,error:null}}catch(i){if(It(i))return{data:null,error:i};throw i}})}createSignedUrls(n,r,a){return ar(this,void 0,void 0,function*(){try{const i=yield mn(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:n},{headers:this.headers}),h=a?.download?`&download=${a.download===!0?"":a.download}`:"";return{data:i.map(d=>Object.assign(Object.assign({},d),{signedUrl:d.signedURL?encodeURI(`${this.url}${d.signedURL}${h}`):null})),error:null}}catch(i){if(It(i))return{data:null,error:i};throw i}})}download(n,r){return ar(this,void 0,void 0,function*(){const i=typeof r?.transform<"u"?"render/image/authenticated":"object",h=this.transformOptsToQueryString(r?.transform||{}),d=h?`?${h}`:"";try{const p=this._getFinalPath(n);return{data:yield(yield Il(this.fetch,`${this.url}/${i}/${p}${d}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(p){if(It(p))return{data:null,error:p};throw p}})}info(n){return ar(this,void 0,void 0,function*(){const r=this._getFinalPath(n);try{const a=yield Il(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:Mu(a),error:null}}catch(a){if(It(a))return{data:null,error:a};throw a}})}exists(n){return ar(this,void 0,void 0,function*(){const r=this._getFinalPath(n);try{return yield v0(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(a){if(It(a)&&a instanceof $u){const i=a.originalError;if([400,404].includes(i?.status))return{data:!1,error:a}}throw a}})}getPublicUrl(n,r){const a=this._getFinalPath(n),i=[],h=r?.download?`download=${r.download===!0?"":r.download}`:"";h!==""&&i.push(h);const p=typeof r?.transform<"u"?"render/image":"object",x=this.transformOptsToQueryString(r?.transform||{});x!==""&&i.push(x);let y=i.join("&");return y!==""&&(y=`?${y}`),{data:{publicUrl:encodeURI(`${this.url}/${p}/public/${a}${y}`)}}}remove(n){return ar(this,void 0,void 0,function*(){try{return{data:yield Zf(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:n},{headers:this.headers}),error:null}}catch(r){if(It(r))return{data:null,error:r};throw r}})}list(n,r,a){return ar(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},x0),r),{prefix:n||""});return{data:yield mn(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},a),error:null}}catch(i){if(It(i))return{data:null,error:i};throw i}})}listV2(n,r){return ar(this,void 0,void 0,function*(){try{const a=Object.assign({},n);return{data:yield mn(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,a,{headers:this.headers},r),error:null}}catch(a){if(It(a))return{data:null,error:a};throw a}})}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const r=[];return n.width&&r.push(`width=${n.width}`),n.height&&r.push(`height=${n.height}`),n.resize&&r.push(`resize=${n.resize}`),n.format&&r.push(`format=${n.format}`),n.quality&&r.push(`quality=${n.quality}`),r.join("&")}}const b0="2.11.1",w0={"X-Client-Info":`storage-js/${b0}`};var Wo=function(u,n,r,a){function i(h){return h instanceof r?h:new r(function(d){d(h)})}return new(r||(r=Promise))(function(h,d){function p(S){try{y(a.next(S))}catch(N){d(N)}}function x(S){try{y(a.throw(S))}catch(N){d(N)}}function y(S){S.done?h(S.value):i(S.value).then(p,x)}y((a=a.apply(u,n||[])).next())})};class S0{constructor(n,r={},a,i){const h=new URL(n);i?.useNewHostname&&/supabase\.(co|in|red)$/.test(h.hostname)&&!h.hostname.includes("storage.supabase.")&&(h.hostname=h.hostname.replace("supabase.","storage.supabase.")),this.url=h.href,this.headers=Object.assign(Object.assign({},w0),r),this.fetch=Xf(a)}listBuckets(){return Wo(this,void 0,void 0,function*(){try{return{data:yield Il(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(n){if(It(n))return{data:null,error:n};throw n}})}getBucket(n){return Wo(this,void 0,void 0,function*(){try{return{data:yield Il(this.fetch,`${this.url}/bucket/${n}`,{headers:this.headers}),error:null}}catch(r){if(It(r))return{data:null,error:r};throw r}})}createBucket(n,r={public:!1}){return Wo(this,void 0,void 0,function*(){try{return{data:yield mn(this.fetch,`${this.url}/bucket`,{id:n,name:n,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(It(a))return{data:null,error:a};throw a}})}updateBucket(n,r){return Wo(this,void 0,void 0,function*(){try{return{data:yield Uu(this.fetch,`${this.url}/bucket/${n}`,{id:n,name:n,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(It(a))return{data:null,error:a};throw a}})}emptyBucket(n){return Wo(this,void 0,void 0,function*(){try{return{data:yield mn(this.fetch,`${this.url}/bucket/${n}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(It(r))return{data:null,error:r};throw r}})}deleteBucket(n){return Wo(this,void 0,void 0,function*(){try{return{data:yield Zf(this.fetch,`${this.url}/bucket/${n}`,{},{headers:this.headers}),error:null}}catch(r){if(It(r))return{data:null,error:r};throw r}})}}class _0 extends S0{constructor(n,r={},a,i){super(n,r,a,i)}from(n){return new y0(this.url,this.headers,n,this.fetch)}}const E0="2.57.0";let Ja="";typeof Deno<"u"?Ja="deno":typeof document<"u"?Ja="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ja="react-native":Ja="node";const k0={"X-Client-Info":`supabase-js-${Ja}/${E0}`},N0={headers:k0},j0={schema:"public"},T0={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},C0={};var R0=function(u,n,r,a){function i(h){return h instanceof r?h:new r(function(d){d(h)})}return new(r||(r=Promise))(function(h,d){function p(S){try{y(a.next(S))}catch(N){d(N)}}function x(S){try{y(a.throw(S))}catch(N){d(N)}}function y(S){S.done?h(S.value):i(S.value).then(p,x)}y((a=a.apply(u,n||[])).next())})};const I0=u=>{let n;return u?n=u:typeof fetch>"u"?n=zf:n=fetch,(...r)=>n(...r)},O0=()=>typeof Headers>"u"?Wf:Headers,P0=(u,n,r)=>{const a=I0(r),i=O0();return(h,d)=>R0(void 0,void 0,void 0,function*(){var p;const x=(p=yield n())!==null&&p!==void 0?p:u;let y=new i(d?.headers);return y.has("apikey")||y.set("apikey",u),y.has("Authorization")||y.set("Authorization",`Bearer ${x}`),a(h,Object.assign(Object.assign({},d),{headers:y}))})};var D0=function(u,n,r,a){function i(h){return h instanceof r?h:new r(function(d){d(h)})}return new(r||(r=Promise))(function(h,d){function p(S){try{y(a.next(S))}catch(N){d(N)}}function x(S){try{y(a.throw(S))}catch(N){d(N)}}function y(S){S.done?h(S.value):i(S.value).then(p,x)}y((a=a.apply(u,n||[])).next())})};function L0(u){return u.endsWith("/")?u:u+"/"}function A0(u,n){var r,a;const{db:i,auth:h,realtime:d,global:p}=u,{db:x,auth:y,realtime:S,global:N}=n,R={db:Object.assign(Object.assign({},x),i),auth:Object.assign(Object.assign({},y),h),realtime:Object.assign(Object.assign({},S),d),storage:{},global:Object.assign(Object.assign(Object.assign({},N),p),{headers:Object.assign(Object.assign({},(r=N?.headers)!==null&&r!==void 0?r:{}),(a=p?.headers)!==null&&a!==void 0?a:{})}),accessToken:()=>D0(this,void 0,void 0,function*(){return""})};return u.accessToken?R.accessToken=u.accessToken:delete R.accessToken,R}const em="2.71.1",Jo=30*1e3,Fu=3,Nu=Fu*Jo,$0="http://localhost:9999",M0="supabase.auth.token",U0={"X-Client-Info":`gotrue-js/${em}`},Vu="X-Supabase-Api-Version",tm={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},F0=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,V0=600*1e3;class rd extends Error{constructor(n,r,a){super(n),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=a}}function Ue(u){return typeof u=="object"&&u!==null&&"__isAuthError"in u}class B0 extends rd{constructor(n,r,a){super(n,r,a),this.name="AuthApiError",this.status=r,this.code=a}}function z0(u){return Ue(u)&&u.name==="AuthApiError"}class rm extends rd{constructor(n,r){super(n),this.name="AuthUnknownError",this.originalError=r}}class gs extends rd{constructor(n,r,a,i){super(n,a,i),this.name=r,this.status=a}}class fs extends gs{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function W0(u){return Ue(u)&&u.name==="AuthSessionMissingError"}class _l extends gs{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class El extends gs{constructor(n){super(n,"AuthInvalidCredentialsError",400,void 0)}}class kl extends gs{constructor(n,r=null){super(n,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function H0(u){return Ue(u)&&u.name==="AuthImplicitGrantRedirectError"}class gf extends gs{constructor(n,r=null){super(n,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Bu extends gs{constructor(n,r){super(n,"AuthRetryableFetchError",r,void 0)}}function ju(u){return Ue(u)&&u.name==="AuthRetryableFetchError"}class pf extends gs{constructor(n,r,a){super(n,"AuthWeakPasswordError",r,"weak_password"),this.reasons=a}}class zu extends gs{constructor(n){super(n,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ol="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),vf=` 	
\r=`.split(""),q0=(()=>{const u=new Array(128);for(let n=0;n<u.length;n+=1)u[n]=-1;for(let n=0;n<vf.length;n+=1)u[vf[n].charCodeAt(0)]=-2;for(let n=0;n<Ol.length;n+=1)u[Ol[n].charCodeAt(0)]=n;return u})();function xf(u,n,r){if(u!==null)for(n.queue=n.queue<<8|u,n.queuedBits+=8;n.queuedBits>=6;){const a=n.queue>>n.queuedBits-6&63;r(Ol[a]),n.queuedBits-=6}else if(n.queuedBits>0)for(n.queue=n.queue<<6-n.queuedBits,n.queuedBits=6;n.queuedBits>=6;){const a=n.queue>>n.queuedBits-6&63;r(Ol[a]),n.queuedBits-=6}}function nm(u,n,r){const a=q0[u];if(a>-1)for(n.queue=n.queue<<6|a,n.queuedBits+=6;n.queuedBits>=8;)r(n.queue>>n.queuedBits-8&255),n.queuedBits-=8;else{if(a===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(u)}"`)}}function yf(u){const n=[],r=d=>{n.push(String.fromCodePoint(d))},a={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},h=d=>{J0(d,a,r)};for(let d=0;d<u.length;d+=1)nm(u.charCodeAt(d),i,h);return n.join("")}function K0(u,n){if(u<=127){n(u);return}else if(u<=2047){n(192|u>>6),n(128|u&63);return}else if(u<=65535){n(224|u>>12),n(128|u>>6&63),n(128|u&63);return}else if(u<=1114111){n(240|u>>18),n(128|u>>12&63),n(128|u>>6&63),n(128|u&63);return}throw new Error(`Unrecognized Unicode codepoint: ${u.toString(16)}`)}function G0(u,n){for(let r=0;r<u.length;r+=1){let a=u.charCodeAt(r);if(a>55295&&a<=56319){const i=(a-55296)*1024&65535;a=(u.charCodeAt(r+1)-56320&65535|i)+65536,r+=1}K0(a,n)}}function J0(u,n,r){if(n.utf8seq===0){if(u<=127){r(u);return}for(let a=1;a<6;a+=1)if((u>>7-a&1)===0){n.utf8seq=a;break}if(n.utf8seq===2)n.codepoint=u&31;else if(n.utf8seq===3)n.codepoint=u&15;else if(n.utf8seq===4)n.codepoint=u&7;else throw new Error("Invalid UTF-8 sequence");n.utf8seq-=1}else if(n.utf8seq>0){if(u<=127)throw new Error("Invalid UTF-8 sequence");n.codepoint=n.codepoint<<6|u&63,n.utf8seq-=1,n.utf8seq===0&&r(n.codepoint)}}function Q0(u){const n=[],r={queue:0,queuedBits:0},a=i=>{n.push(i)};for(let i=0;i<u.length;i+=1)nm(u.charCodeAt(i),r,a);return new Uint8Array(n)}function Y0(u){const n=[];return G0(u,r=>n.push(r)),new Uint8Array(n)}function X0(u){const n=[],r={queue:0,queuedBits:0},a=i=>{n.push(i)};return u.forEach(i=>xf(i,r,a)),xf(null,r,a),n.join("")}function Z0(u){return Math.round(Date.now()/1e3)+u}function ev(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){const n=Math.random()*16|0;return(u=="x"?n:n&3|8).toString(16)})}const Zr=()=>typeof window<"u"&&typeof document<"u",Zs={tested:!1,writable:!1},sm=()=>{if(!Zr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Zs.tested)return Zs.writable;const u=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(u,u),globalThis.localStorage.removeItem(u),Zs.tested=!0,Zs.writable=!0}catch{Zs.tested=!0,Zs.writable=!1}return Zs.writable};function tv(u){const n={},r=new URL(u);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((i,h)=>{n[h]=i})}catch{}return r.searchParams.forEach((a,i)=>{n[i]=a}),n}const om=u=>{let n;return u?n=u:typeof fetch>"u"?n=(...r)=>ta(async()=>{const{default:a}=await Promise.resolve().then(()=>ra);return{default:a}},void 0).then(({default:a})=>a(...r)):n=fetch,(...r)=>n(...r)},rv=u=>typeof u=="object"&&u!==null&&"status"in u&&"ok"in u&&"json"in u&&typeof u.json=="function",Qo=async(u,n,r)=>{await u.setItem(n,JSON.stringify(r))},eo=async(u,n)=>{const r=await u.getItem(n);if(!r)return null;try{return JSON.parse(r)}catch{return r}},ds=async(u,n)=>{await u.removeItem(n)};class Ll{constructor(){this.promise=new Ll.promiseConstructor((n,r)=>{this.resolve=n,this.reject=r})}}Ll.promiseConstructor=Promise;function Tu(u){const n=u.split(".");if(n.length!==3)throw new zu("Invalid JWT structure");for(let a=0;a<n.length;a++)if(!F0.test(n[a]))throw new zu("JWT not in base64url format");return{header:JSON.parse(yf(n[0])),payload:JSON.parse(yf(n[1])),signature:Q0(n[2]),raw:{header:n[0],payload:n[1]}}}async function nv(u){return await new Promise(n=>{setTimeout(()=>n(null),u)})}function sv(u,n){return new Promise((a,i)=>{(async()=>{for(let h=0;h<1/0;h++)try{const d=await u(h);if(!n(h,null,d)){a(d);return}}catch(d){if(!n(h,d)){i(d);return}}})()})}function ov(u){return("0"+u.toString(16)).substr(-2)}function av(){const n=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",a=r.length;let i="";for(let h=0;h<56;h++)i+=r.charAt(Math.floor(Math.random()*a));return i}return crypto.getRandomValues(n),Array.from(n,ov).join("")}async function iv(u){const r=new TextEncoder().encode(u),a=await crypto.subtle.digest("SHA-256",r),i=new Uint8Array(a);return Array.from(i).map(h=>String.fromCharCode(h)).join("")}async function lv(u){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),u;const r=await iv(u);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ho(u,n,r=!1){const a=av();let i=a;r&&(i+="/PASSWORD_RECOVERY"),await Qo(u,`${n}-code-verifier`,i);const h=await lv(a);return[h,a===h?"plain":"s256"]}const cv=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function uv(u){const n=u.headers.get(Vu);if(!n||!n.match(cv))return null;try{return new Date(`${n}T00:00:00.0Z`)}catch{return null}}function dv(u){if(!u)throw new Error("Missing exp claim");const n=Math.floor(Date.now()/1e3);if(u<=n)throw new Error("JWT has expired")}function hv(u){switch(u){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const fv=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function qo(u){if(!fv.test(u))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Cu(){const u={};return new Proxy(u,{get:(n,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const a=r.toString();if(a==="Symbol(Symbol.toPrimitive)"||a==="Symbol(Symbol.toStringTag)"||a==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(n,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(n,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function bf(u){return JSON.parse(JSON.stringify(u))}var mv=function(u,n){var r={};for(var a in u)Object.prototype.hasOwnProperty.call(u,a)&&n.indexOf(a)<0&&(r[a]=u[a]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,a=Object.getOwnPropertySymbols(u);i<a.length;i++)n.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(u,a[i])&&(r[a[i]]=u[a[i]]);return r};const ro=u=>u.msg||u.message||u.error_description||u.error||JSON.stringify(u),gv=[502,503,504];async function wf(u){var n;if(!rv(u))throw new Bu(ro(u),0);if(gv.includes(u.status))throw new Bu(ro(u),u.status);let r;try{r=await u.json()}catch(h){throw new rm(ro(h),h)}let a;const i=uv(u);if(i&&i.getTime()>=tm["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?a=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(a=r.error_code),a){if(a==="weak_password")throw new pf(ro(r),u.status,((n=r.weak_password)===null||n===void 0?void 0:n.reasons)||[]);if(a==="session_not_found")throw new fs}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((h,d)=>h&&typeof d=="string",!0))throw new pf(ro(r),u.status,r.weak_password.reasons);throw new B0(ro(r),u.status||500,a)}const pv=(u,n,r,a)=>{const i={method:u,headers:n?.headers||{}};return u==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},n?.headers),i.body=JSON.stringify(a),Object.assign(Object.assign({},i),r))};async function He(u,n,r,a){var i;const h=Object.assign({},a?.headers);h[Vu]||(h[Vu]=tm["2024-01-01"].name),a?.jwt&&(h.Authorization=`Bearer ${a.jwt}`);const d=(i=a?.query)!==null&&i!==void 0?i:{};a?.redirectTo&&(d.redirect_to=a.redirectTo);const p=Object.keys(d).length?"?"+new URLSearchParams(d).toString():"",x=await vv(u,n,r+p,{headers:h,noResolveJson:a?.noResolveJson},{},a?.body);return a?.xform?a?.xform(x):{data:Object.assign({},x),error:null}}async function vv(u,n,r,a,i,h){const d=pv(n,a,i,h);let p;try{p=await u(r,Object.assign({},d))}catch(x){throw console.error(x),new Bu(ro(x),0)}if(p.ok||await wf(p),a?.noResolveJson)return p;try{return await p.json()}catch(x){await wf(x)}}function On(u){var n;let r=null;wv(u)&&(r=Object.assign({},u),u.expires_at||(r.expires_at=Z0(u.expires_in)));const a=(n=u.user)!==null&&n!==void 0?n:u;return{data:{session:r,user:a},error:null}}function Sf(u){const n=On(u);return!n.error&&u.weak_password&&typeof u.weak_password=="object"&&Array.isArray(u.weak_password.reasons)&&u.weak_password.reasons.length&&u.weak_password.message&&typeof u.weak_password.message=="string"&&u.weak_password.reasons.reduce((r,a)=>r&&typeof a=="string",!0)&&(n.data.weak_password=u.weak_password),n}function ms(u){var n;return{data:{user:(n=u.user)!==null&&n!==void 0?n:u},error:null}}function xv(u){return{data:u,error:null}}function yv(u){const{action_link:n,email_otp:r,hashed_token:a,redirect_to:i,verification_type:h}=u,d=mv(u,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),p={action_link:n,email_otp:r,hashed_token:a,redirect_to:i,verification_type:h},x=Object.assign({},d);return{data:{properties:p,user:x},error:null}}function bv(u){return u}function wv(u){return u.access_token&&u.refresh_token&&u.expires_in}const Ru=["global","local","others"];var Sv=function(u,n){var r={};for(var a in u)Object.prototype.hasOwnProperty.call(u,a)&&n.indexOf(a)<0&&(r[a]=u[a]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,a=Object.getOwnPropertySymbols(u);i<a.length;i++)n.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(u,a[i])&&(r[a[i]]=u[a[i]]);return r};class _v{constructor({url:n="",headers:r={},fetch:a}){this.url=n,this.headers=r,this.fetch=om(a),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(n,r=Ru[0]){if(Ru.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Ru.join(", ")}`);try{return await He(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:n,noResolveJson:!0}),{data:null,error:null}}catch(a){if(Ue(a))return{data:null,error:a};throw a}}async inviteUserByEmail(n,r={}){try{return await He(this.fetch,"POST",`${this.url}/invite`,{body:{email:n,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:ms})}catch(a){if(Ue(a))return{data:{user:null},error:a};throw a}}async generateLink(n){try{const{options:r}=n,a=Sv(n,["options"]),i=Object.assign(Object.assign({},a),r);return"newEmail"in a&&(i.new_email=a?.newEmail,delete i.newEmail),await He(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:yv,redirectTo:r?.redirectTo})}catch(r){if(Ue(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(n){try{return await He(this.fetch,"POST",`${this.url}/admin/users`,{body:n,headers:this.headers,xform:ms})}catch(r){if(Ue(r))return{data:{user:null},error:r};throw r}}async listUsers(n){var r,a,i,h,d,p,x;try{const y={nextPage:null,lastPage:0,total:0},S=await He(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(r=n?.page)===null||r===void 0?void 0:r.toString())!==null&&a!==void 0?a:"",per_page:(h=(i=n?.perPage)===null||i===void 0?void 0:i.toString())!==null&&h!==void 0?h:""},xform:bv});if(S.error)throw S.error;const N=await S.json(),R=(d=S.headers.get("x-total-count"))!==null&&d!==void 0?d:0,A=(x=(p=S.headers.get("link"))===null||p===void 0?void 0:p.split(","))!==null&&x!==void 0?x:[];return A.length>0&&(A.forEach(U=>{const $=parseInt(U.split(";")[0].split("=")[1].substring(0,1)),O=JSON.parse(U.split(";")[1].split("=")[1]);y[`${O}Page`]=$}),y.total=parseInt(R)),{data:Object.assign(Object.assign({},N),y),error:null}}catch(y){if(Ue(y))return{data:{users:[]},error:y};throw y}}async getUserById(n){qo(n);try{return await He(this.fetch,"GET",`${this.url}/admin/users/${n}`,{headers:this.headers,xform:ms})}catch(r){if(Ue(r))return{data:{user:null},error:r};throw r}}async updateUserById(n,r){qo(n);try{return await He(this.fetch,"PUT",`${this.url}/admin/users/${n}`,{body:r,headers:this.headers,xform:ms})}catch(a){if(Ue(a))return{data:{user:null},error:a};throw a}}async deleteUser(n,r=!1){qo(n);try{return await He(this.fetch,"DELETE",`${this.url}/admin/users/${n}`,{headers:this.headers,body:{should_soft_delete:r},xform:ms})}catch(a){if(Ue(a))return{data:{user:null},error:a};throw a}}async _listFactors(n){qo(n.userId);try{const{data:r,error:a}=await He(this.fetch,"GET",`${this.url}/admin/users/${n.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:r,error:a}}catch(r){if(Ue(r))return{data:null,error:r};throw r}}async _deleteFactor(n){qo(n.userId),qo(n.id);try{return{data:await He(this.fetch,"DELETE",`${this.url}/admin/users/${n.userId}/factors/${n.id}`,{headers:this.headers}),error:null}}catch(r){if(Ue(r))return{data:null,error:r};throw r}}}function _f(u={}){return{getItem:n=>u[n]||null,setItem:(n,r)=>{u[n]=r},removeItem:n=>{delete u[n]}}}function Ev(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Ko={debug:!!(globalThis&&sm()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class am extends Error{constructor(n){super(n),this.isAcquireTimeout=!0}}class kv extends am{}async function Nv(u,n,r){Ko.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",u,n);const a=new globalThis.AbortController;return n>0&&setTimeout(()=>{a.abort(),Ko.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",u)},n),await Promise.resolve().then(()=>globalThis.navigator.locks.request(u,n===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:a.signal},async i=>{if(i){Ko.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",u,i.name);try{return await r()}finally{Ko.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",u,i.name)}}else{if(n===0)throw Ko.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",u),new kv(`Acquiring an exclusive Navigator LockManager lock "${u}" immediately failed`);if(Ko.debug)try{const h=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(h,null,"  "))}catch(h){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",h)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}Ev();const jv={url:$0,storageKey:M0,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:U0,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Ef(u,n,r){return await r()}const Go={};class ei{constructor(n){var r,a;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ei.nextInstanceID,ei.nextInstanceID+=1,this.instanceID>0&&Zr()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},jv),n);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new _v({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=om(i.fetch),this.lock=i.lock||Ef,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:Zr()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=Nv:this.lock=Ef,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:sm()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=_f(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=_f(this.memoryStorage)),Zr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(h){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",h)}(a=this.broadcastChannel)===null||a===void 0||a.addEventListener("message",async h=>{this._debug("received broadcast notification from other tab or client",h),await this._notifyAllSubscribers(h.data.event,h.data.session,!1)})}this.initialize()}get jwks(){var n,r;return(r=(n=Go[this.storageKey])===null||n===void 0?void 0:n.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(n){Go[this.storageKey]=Object.assign(Object.assign({},Go[this.storageKey]),{jwks:n})}get jwks_cached_at(){var n,r;return(r=(n=Go[this.storageKey])===null||n===void 0?void 0:n.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(n){Go[this.storageKey]=Object.assign(Object.assign({},Go[this.storageKey]),{cachedAt:n})}_debug(...n){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${em}) ${new Date().toISOString()}`,...n),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var n;try{const r=tv(window.location.href);let a="none";if(this._isImplicitGrantCallback(r)?a="implicit":await this._isPKCECallback(r)&&(a="pkce"),Zr()&&this.detectSessionInUrl&&a!=="none"){const{data:i,error:h}=await this._getSessionFromURL(r,a);if(h){if(this._debug("#_initialize()","error detecting session from URL",h),H0(h)){const x=(n=h.details)===null||n===void 0?void 0:n.code;if(x==="identity_already_exists"||x==="identity_not_found"||x==="single_identity_not_deletable")return{error:h}}return await this._removeSession(),{error:h}}const{session:d,redirectType:p}=i;return this._debug("#_initialize()","detected session in URL",d,"redirect type",p),await this._saveSession(d),setTimeout(async()=>{p==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",d):await this._notifyAllSubscribers("SIGNED_IN",d)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return Ue(r)?{error:r}:{error:new rm("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(n){var r,a,i;try{const h=await He(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(a=(r=n?.options)===null||r===void 0?void 0:r.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:(i=n?.options)===null||i===void 0?void 0:i.captchaToken}},xform:On}),{data:d,error:p}=h;if(p||!d)return{data:{user:null,session:null},error:p};const x=d.session,y=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",x)),{data:{user:y,session:x},error:null}}catch(h){if(Ue(h))return{data:{user:null,session:null},error:h};throw h}}async signUp(n){var r,a,i;try{let h;if("email"in n){const{email:S,password:N,options:R}=n;let A=null,U=null;this.flowType==="pkce"&&([A,U]=await Ho(this.storage,this.storageKey)),h=await He(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:R?.emailRedirectTo,body:{email:S,password:N,data:(r=R?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:R?.captchaToken},code_challenge:A,code_challenge_method:U},xform:On})}else if("phone"in n){const{phone:S,password:N,options:R}=n;h=await He(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:S,password:N,data:(a=R?.data)!==null&&a!==void 0?a:{},channel:(i=R?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:R?.captchaToken}},xform:On})}else throw new El("You must provide either an email or phone number and a password");const{data:d,error:p}=h;if(p||!d)return{data:{user:null,session:null},error:p};const x=d.session,y=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",x)),{data:{user:y,session:x},error:null}}catch(h){if(Ue(h))return{data:{user:null,session:null},error:h};throw h}}async signInWithPassword(n){try{let r;if("email"in n){const{email:h,password:d,options:p}=n;r=await He(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:h,password:d,gotrue_meta_security:{captcha_token:p?.captchaToken}},xform:Sf})}else if("phone"in n){const{phone:h,password:d,options:p}=n;r=await He(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:h,password:d,gotrue_meta_security:{captcha_token:p?.captchaToken}},xform:Sf})}else throw new El("You must provide either an email or phone number and a password");const{data:a,error:i}=r;return i?{data:{user:null,session:null},error:i}:!a||!a.session||!a.user?{data:{user:null,session:null},error:new _l}:(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:Object.assign({user:a.user,session:a.session},a.weak_password?{weakPassword:a.weak_password}:null),error:i})}catch(r){if(Ue(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(n){var r,a,i,h;return await this._handleProviderSignIn(n.provider,{redirectTo:(r=n.options)===null||r===void 0?void 0:r.redirectTo,scopes:(a=n.options)===null||a===void 0?void 0:a.scopes,queryParams:(i=n.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(h=n.options)===null||h===void 0?void 0:h.skipBrowserRedirect})}async exchangeCodeForSession(n){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(n))}async signInWithWeb3(n){const{chain:r}=n;if(r==="solana")return await this.signInWithSolana(n);throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}async signInWithSolana(n){var r,a,i,h,d,p,x,y,S,N,R,A;let U,$;if("message"in n)U=n.message,$=n.signature;else{const{chain:O,wallet:J,statement:X,options:q}=n;let K;if(Zr())if(typeof J=="object")K=J;else{const P=window;if("solana"in P&&typeof P.solana=="object"&&("signIn"in P.solana&&typeof P.solana.signIn=="function"||"signMessage"in P.solana&&typeof P.solana.signMessage=="function"))K=P.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof J!="object"||!q?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");K=J}const Y=new URL((r=q?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in K&&K.signIn){const P=await K.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},q?.signInWithSolana),{version:"1",domain:Y.host,uri:Y.href}),X?{statement:X}:null));let B;if(Array.isArray(P)&&P[0]&&typeof P[0]=="object")B=P[0];else if(P&&typeof P=="object"&&"signedMessage"in P&&"signature"in P)B=P;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in B&&"signature"in B&&(typeof B.signedMessage=="string"||B.signedMessage instanceof Uint8Array)&&B.signature instanceof Uint8Array)U=typeof B.signedMessage=="string"?B.signedMessage:new TextDecoder().decode(B.signedMessage),$=B.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in K)||typeof K.signMessage!="function"||!("publicKey"in K)||typeof K!="object"||!K.publicKey||!("toBase58"in K.publicKey)||typeof K.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");U=[`${Y.host} wants you to sign in with your Solana account:`,K.publicKey.toBase58(),...X?["",X,""]:[""],"Version: 1",`URI: ${Y.href}`,`Issued At: ${(i=(a=q?.signInWithSolana)===null||a===void 0?void 0:a.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((h=q?.signInWithSolana)===null||h===void 0)&&h.notBefore?[`Not Before: ${q.signInWithSolana.notBefore}`]:[],...!((d=q?.signInWithSolana)===null||d===void 0)&&d.expirationTime?[`Expiration Time: ${q.signInWithSolana.expirationTime}`]:[],...!((p=q?.signInWithSolana)===null||p===void 0)&&p.chainId?[`Chain ID: ${q.signInWithSolana.chainId}`]:[],...!((x=q?.signInWithSolana)===null||x===void 0)&&x.nonce?[`Nonce: ${q.signInWithSolana.nonce}`]:[],...!((y=q?.signInWithSolana)===null||y===void 0)&&y.requestId?[`Request ID: ${q.signInWithSolana.requestId}`]:[],...!((N=(S=q?.signInWithSolana)===null||S===void 0?void 0:S.resources)===null||N===void 0)&&N.length?["Resources",...q.signInWithSolana.resources.map(B=>`- ${B}`)]:[]].join(`
`);const P=await K.signMessage(new TextEncoder().encode(U),"utf8");if(!P||!(P instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");$=P}}try{const{data:O,error:J}=await He(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:U,signature:X0($)},!((R=n.options)===null||R===void 0)&&R.captchaToken?{gotrue_meta_security:{captcha_token:(A=n.options)===null||A===void 0?void 0:A.captchaToken}}:null),xform:On});if(J)throw J;return!O||!O.session||!O.user?{data:{user:null,session:null},error:new _l}:(O.session&&(await this._saveSession(O.session),await this._notifyAllSubscribers("SIGNED_IN",O.session)),{data:Object.assign({},O),error:J})}catch(O){if(Ue(O))return{data:{user:null,session:null},error:O};throw O}}async _exchangeCodeForSession(n){const r=await eo(this.storage,`${this.storageKey}-code-verifier`),[a,i]=(r??"").split("/");try{const{data:h,error:d}=await He(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:n,code_verifier:a},xform:On});if(await ds(this.storage,`${this.storageKey}-code-verifier`),d)throw d;return!h||!h.session||!h.user?{data:{user:null,session:null,redirectType:null},error:new _l}:(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),{data:Object.assign(Object.assign({},h),{redirectType:i??null}),error:d})}catch(h){if(Ue(h))return{data:{user:null,session:null,redirectType:null},error:h};throw h}}async signInWithIdToken(n){try{const{options:r,provider:a,token:i,access_token:h,nonce:d}=n,p=await He(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:a,id_token:i,access_token:h,nonce:d,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:On}),{data:x,error:y}=p;return y?{data:{user:null,session:null},error:y}:!x||!x.session||!x.user?{data:{user:null,session:null},error:new _l}:(x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("SIGNED_IN",x.session)),{data:x,error:y})}catch(r){if(Ue(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(n){var r,a,i,h,d;try{if("email"in n){const{email:p,options:x}=n;let y=null,S=null;this.flowType==="pkce"&&([y,S]=await Ho(this.storage,this.storageKey));const{error:N}=await He(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:p,data:(r=x?.data)!==null&&r!==void 0?r:{},create_user:(a=x?.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:x?.captchaToken},code_challenge:y,code_challenge_method:S},redirectTo:x?.emailRedirectTo});return{data:{user:null,session:null},error:N}}if("phone"in n){const{phone:p,options:x}=n,{data:y,error:S}=await He(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:p,data:(i=x?.data)!==null&&i!==void 0?i:{},create_user:(h=x?.shouldCreateUser)!==null&&h!==void 0?h:!0,gotrue_meta_security:{captcha_token:x?.captchaToken},channel:(d=x?.channel)!==null&&d!==void 0?d:"sms"}});return{data:{user:null,session:null,messageId:y?.message_id},error:S}}throw new El("You must provide either an email or phone number.")}catch(p){if(Ue(p))return{data:{user:null,session:null},error:p};throw p}}async verifyOtp(n){var r,a;try{let i,h;"options"in n&&(i=(r=n.options)===null||r===void 0?void 0:r.redirectTo,h=(a=n.options)===null||a===void 0?void 0:a.captchaToken);const{data:d,error:p}=await He(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},n),{gotrue_meta_security:{captcha_token:h}}),redirectTo:i,xform:On});if(p)throw p;if(!d)throw new Error("An error occurred on token verification.");const x=d.session,y=d.user;return x?.access_token&&(await this._saveSession(x),await this._notifyAllSubscribers(n.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",x)),{data:{user:y,session:x},error:null}}catch(i){if(Ue(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(n){var r,a,i;try{let h=null,d=null;return this.flowType==="pkce"&&([h,d]=await Ho(this.storage,this.storageKey)),await He(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in n?{provider_id:n.providerId}:null),"domain"in n?{domain:n.domain}:null),{redirect_to:(a=(r=n.options)===null||r===void 0?void 0:r.redirectTo)!==null&&a!==void 0?a:void 0}),!((i=n?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:n.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:h,code_challenge_method:d}),headers:this.headers,xform:xv})}catch(h){if(Ue(h))return{data:null,error:h};throw h}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async n=>{const{data:{session:r},error:a}=n;if(a)throw a;if(!r)throw new fs;const{error:i}=await He(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:i}})}catch(n){if(Ue(n))return{data:{user:null,session:null},error:n};throw n}}async resend(n){try{const r=`${this.url}/resend`;if("email"in n){const{email:a,type:i,options:h}=n,{error:d}=await He(this.fetch,"POST",r,{headers:this.headers,body:{email:a,type:i,gotrue_meta_security:{captcha_token:h?.captchaToken}},redirectTo:h?.emailRedirectTo});return{data:{user:null,session:null},error:d}}else if("phone"in n){const{phone:a,type:i,options:h}=n,{data:d,error:p}=await He(this.fetch,"POST",r,{headers:this.headers,body:{phone:a,type:i,gotrue_meta_security:{captcha_token:h?.captchaToken}}});return{data:{user:null,session:null,messageId:d?.message_id},error:p}}throw new El("You must provide either an email or phone number and a type")}catch(r){if(Ue(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(n,r){this._debug("#_acquireLock","begin",n);try{if(this.lockAcquired){const a=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await a,await r()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,n,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const a=r();for(this.pendingInLock.push((async()=>{try{await a}catch{}})()),await a;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await a}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(n){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await n(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let n=null;const r=await eo(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?n=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!n)return{data:{session:null},error:null};const a=n.expires_at?n.expires_at*1e3-Date.now()<Nu:!1;if(this._debug("#__loadSession()",`session has${a?"":" not"} expired`,"expires_at",n.expires_at),!a){if(this.userStorage){const d=await eo(this.userStorage,this.storageKey+"-user");d?.user?n.user=d.user:n.user=Cu()}if(this.storage.isServer&&n.user){let d=this.suppressGetSessionWarning;n=new Proxy(n,{get:(x,y,S)=>(!d&&y==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),d=!0,this.suppressGetSessionWarning=!0),Reflect.get(x,y,S))})}return{data:{session:n},error:null}}const{session:i,error:h}=await this._callRefreshToken(n.refresh_token);return h?{data:{session:null},error:h}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(n){return n?await this._getUser(n):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(n){try{return n?await He(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:n,xform:ms}):await this._useSession(async r=>{var a,i,h;const{data:d,error:p}=r;if(p)throw p;return!(!((a=d.session)===null||a===void 0)&&a.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new fs}:await He(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(h=(i=d.session)===null||i===void 0?void 0:i.access_token)!==null&&h!==void 0?h:void 0,xform:ms})})}catch(r){if(Ue(r))return W0(r)&&(await this._removeSession(),await ds(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(n,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(n,r))}async _updateUser(n,r={}){try{return await this._useSession(async a=>{const{data:i,error:h}=a;if(h)throw h;if(!i.session)throw new fs;const d=i.session;let p=null,x=null;this.flowType==="pkce"&&n.email!=null&&([p,x]=await Ho(this.storage,this.storageKey));const{data:y,error:S}=await He(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},n),{code_challenge:p,code_challenge_method:x}),jwt:d.access_token,xform:ms});if(S)throw S;return d.user=y.user,await this._saveSession(d),await this._notifyAllSubscribers("USER_UPDATED",d),{data:{user:d.user},error:null}})}catch(a){if(Ue(a))return{data:{user:null},error:a};throw a}}async setSession(n){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(n))}async _setSession(n){try{if(!n.access_token||!n.refresh_token)throw new fs;const r=Date.now()/1e3;let a=r,i=!0,h=null;const{payload:d}=Tu(n.access_token);if(d.exp&&(a=d.exp,i=a<=r),i){const{session:p,error:x}=await this._callRefreshToken(n.refresh_token);if(x)return{data:{user:null,session:null},error:x};if(!p)return{data:{user:null,session:null},error:null};h=p}else{const{data:p,error:x}=await this._getUser(n.access_token);if(x)throw x;h={access_token:n.access_token,refresh_token:n.refresh_token,user:p.user,token_type:"bearer",expires_in:a-r,expires_at:a},await this._saveSession(h),await this._notifyAllSubscribers("SIGNED_IN",h)}return{data:{user:h.user,session:h},error:null}}catch(r){if(Ue(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(n){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(n))}async _refreshSession(n){try{return await this._useSession(async r=>{var a;if(!n){const{data:d,error:p}=r;if(p)throw p;n=(a=d.session)!==null&&a!==void 0?a:void 0}if(!n?.refresh_token)throw new fs;const{session:i,error:h}=await this._callRefreshToken(n.refresh_token);return h?{data:{user:null,session:null},error:h}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(Ue(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(n,r){try{if(!Zr())throw new kl("No browser detected.");if(n.error||n.error_description||n.error_code)throw new kl(n.error_description||"Error in URL with unspecified error_description",{error:n.error||"unspecified_error",code:n.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new gf("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new kl("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!n.code)throw new gf("No code detected.");const{data:X,error:q}=await this._exchangeCodeForSession(n.code);if(q)throw q;const K=new URL(window.location.href);return K.searchParams.delete("code"),window.history.replaceState(window.history.state,"",K.toString()),{data:{session:X.session,redirectType:null},error:null}}const{provider_token:a,provider_refresh_token:i,access_token:h,refresh_token:d,expires_in:p,expires_at:x,token_type:y}=n;if(!h||!p||!d||!y)throw new kl("No session defined in URL");const S=Math.round(Date.now()/1e3),N=parseInt(p);let R=S+N;x&&(R=parseInt(x));const A=R-S;A*1e3<=Jo&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${A}s, should have been closer to ${N}s`);const U=R-N;S-U>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",U,R,S):S-U<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",U,R,S);const{data:$,error:O}=await this._getUser(h);if(O)throw O;const J={provider_token:a,provider_refresh_token:i,access_token:h,expires_in:N,expires_at:R,refresh_token:d,token_type:y,user:$.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:J,redirectType:n.type},error:null}}catch(a){if(Ue(a))return{data:{session:null,redirectType:null},error:a};throw a}}_isImplicitGrantCallback(n){return!!(n.access_token||n.error_description)}async _isPKCECallback(n){const r=await eo(this.storage,`${this.storageKey}-code-verifier`);return!!(n.code&&r)}async signOut(n={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(n))}async _signOut({scope:n}={scope:"global"}){return await this._useSession(async r=>{var a;const{data:i,error:h}=r;if(h)return{error:h};const d=(a=i.session)===null||a===void 0?void 0:a.access_token;if(d){const{error:p}=await this.admin.signOut(d,n);if(p&&!(z0(p)&&(p.status===404||p.status===401||p.status===403)))return{error:p}}return n!=="others"&&(await this._removeSession(),await ds(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(n){const r=ev(),a={id:r,callback:n,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,a),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:a}}}async _emitInitialSession(n){return await this._useSession(async r=>{var a,i;try{const{data:{session:h},error:d}=r;if(d)throw d;await((a=this.stateChangeEmitters.get(n))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",h)),this._debug("INITIAL_SESSION","callback id",n,"session",h)}catch(h){await((i=this.stateChangeEmitters.get(n))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",n,"error",h),console.error(h)}})}async resetPasswordForEmail(n,r={}){let a=null,i=null;this.flowType==="pkce"&&([a,i]=await Ho(this.storage,this.storageKey,!0));try{return await He(this.fetch,"POST",`${this.url}/recover`,{body:{email:n,code_challenge:a,code_challenge_method:i,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(h){if(Ue(h))return{data:null,error:h};throw h}}async getUserIdentities(){var n;try{const{data:r,error:a}=await this.getUser();if(a)throw a;return{data:{identities:(n=r.user.identities)!==null&&n!==void 0?n:[]},error:null}}catch(r){if(Ue(r))return{data:null,error:r};throw r}}async linkIdentity(n){var r;try{const{data:a,error:i}=await this._useSession(async h=>{var d,p,x,y,S;const{data:N,error:R}=h;if(R)throw R;const A=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,n.provider,{redirectTo:(d=n.options)===null||d===void 0?void 0:d.redirectTo,scopes:(p=n.options)===null||p===void 0?void 0:p.scopes,queryParams:(x=n.options)===null||x===void 0?void 0:x.queryParams,skipBrowserRedirect:!0});return await He(this.fetch,"GET",A,{headers:this.headers,jwt:(S=(y=N.session)===null||y===void 0?void 0:y.access_token)!==null&&S!==void 0?S:void 0})});if(i)throw i;return Zr()&&!(!((r=n.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(a?.url),{data:{provider:n.provider,url:a?.url},error:null}}catch(a){if(Ue(a))return{data:{provider:n.provider,url:null},error:a};throw a}}async unlinkIdentity(n){try{return await this._useSession(async r=>{var a,i;const{data:h,error:d}=r;if(d)throw d;return await He(this.fetch,"DELETE",`${this.url}/user/identities/${n.identity_id}`,{headers:this.headers,jwt:(i=(a=h.session)===null||a===void 0?void 0:a.access_token)!==null&&i!==void 0?i:void 0})})}catch(r){if(Ue(r))return{data:null,error:r};throw r}}async _refreshAccessToken(n){const r=`#_refreshAccessToken(${n.substring(0,5)}...)`;this._debug(r,"begin");try{const a=Date.now();return await sv(async i=>(i>0&&await nv(200*Math.pow(2,i-1)),this._debug(r,"refreshing attempt",i),await He(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:n},headers:this.headers,xform:On})),(i,h)=>{const d=200*Math.pow(2,i);return h&&ju(h)&&Date.now()+d-a<Jo})}catch(a){if(this._debug(r,"error",a),Ue(a))return{data:{session:null,user:null},error:a};throw a}finally{this._debug(r,"end")}}_isValidSession(n){return typeof n=="object"&&n!==null&&"access_token"in n&&"refresh_token"in n&&"expires_at"in n}async _handleProviderSignIn(n,r){const a=await this._getUrlForProvider(`${this.url}/authorize`,n,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",n,"options",r,"url",a),Zr()&&!r.skipBrowserRedirect&&window.location.assign(a),{data:{provider:n,url:a},error:null}}async _recoverAndRefresh(){var n,r;const a="#_recoverAndRefresh()";this._debug(a,"begin");try{const i=await eo(this.storage,this.storageKey);if(i&&this.userStorage){let d=await eo(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!d&&(d={user:i.user},await Qo(this.userStorage,this.storageKey+"-user",d)),i.user=(n=d?.user)!==null&&n!==void 0?n:Cu()}else if(i&&!i.user&&!i.user){const d=await eo(this.storage,this.storageKey+"-user");d&&d?.user?(i.user=d.user,await ds(this.storage,this.storageKey+"-user"),await Qo(this.storage,this.storageKey,i)):i.user=Cu()}if(this._debug(a,"session from storage",i),!this._isValidSession(i)){this._debug(a,"session is not valid"),i!==null&&await this._removeSession();return}const h=((r=i.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<Nu;if(this._debug(a,`session has${h?"":" not"} expired with margin of ${Nu}s`),h){if(this.autoRefreshToken&&i.refresh_token){const{error:d}=await this._callRefreshToken(i.refresh_token);d&&(console.error(d),ju(d)||(this._debug(a,"refresh failed with a non-retryable error, removing the session",d),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:d,error:p}=await this._getUser(i.access_token);!p&&d?.user?(i.user=d.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(a,"could not get user data, skipping SIGNED_IN notification")}catch(d){console.error("Error getting user data:",d),this._debug(a,"error getting user data, skipping SIGNED_IN notification",d)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(a,"error",i),console.error(i);return}finally{this._debug(a,"end")}}async _callRefreshToken(n){var r,a;if(!n)throw new fs;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${n.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Ll;const{data:h,error:d}=await this._refreshAccessToken(n);if(d)throw d;if(!h.session)throw new fs;await this._saveSession(h.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",h.session);const p={session:h.session,error:null};return this.refreshingDeferred.resolve(p),p}catch(h){if(this._debug(i,"error",h),Ue(h)){const d={session:null,error:h};return ju(h)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(d),d}throw(a=this.refreshingDeferred)===null||a===void 0||a.reject(h),h}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(n,r,a=!0){const i=`#_notifyAllSubscribers(${n})`;this._debug(i,"begin",r,`broadcast = ${a}`);try{this.broadcastChannel&&a&&this.broadcastChannel.postMessage({event:n,session:r});const h=[],d=Array.from(this.stateChangeEmitters.values()).map(async p=>{try{await p.callback(n,r)}catch(x){h.push(x)}});if(await Promise.all(d),h.length>0){for(let p=0;p<h.length;p+=1)console.error(h[p]);throw h[0]}}finally{this._debug(i,"end")}}async _saveSession(n){this._debug("#_saveSession()",n),this.suppressGetSessionWarning=!0;const r=Object.assign({},n),a=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!a&&r.user&&await Qo(this.userStorage,this.storageKey+"-user",{user:r.user});const i=Object.assign({},r);delete i.user;const h=bf(i);await Qo(this.storage,this.storageKey,h)}else{const i=bf(r);await Qo(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),await ds(this.storage,this.storageKey),await ds(this.storage,this.storageKey+"-code-verifier"),await ds(this.storage,this.storageKey+"-user"),this.userStorage&&await ds(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const n=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{n&&Zr()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",n)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const n=setInterval(()=>this._autoRefreshTokenTick(),Jo);this.autoRefreshTicker=n,n&&typeof n=="object"&&typeof n.unref=="function"?n.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(n),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const n=this.autoRefreshTicker;this.autoRefreshTicker=null,n&&clearInterval(n)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const n=Date.now();try{return await this._useSession(async r=>{const{data:{session:a}}=r;if(!a||!a.refresh_token||!a.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((a.expires_at*1e3-n)/Jo);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Jo}ms, refresh threshold is ${Fu} ticks`),i<=Fu&&await this._callRefreshToken(a.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(n){if(n.isAcquireTimeout||n instanceof am)this._debug("auto refresh token tick lock not available");else throw n}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Zr()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(n){console.error("_handleVisibilityChange",n)}}async _onVisibilityChanged(n){const r=`#_onVisibilityChanged(${n})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),n||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(n,r,a){const i=[`provider=${encodeURIComponent(r)}`];if(a?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(a.redirectTo)}`),a?.scopes&&i.push(`scopes=${encodeURIComponent(a.scopes)}`),this.flowType==="pkce"){const[h,d]=await Ho(this.storage,this.storageKey),p=new URLSearchParams({code_challenge:`${encodeURIComponent(h)}`,code_challenge_method:`${encodeURIComponent(d)}`});i.push(p.toString())}if(a?.queryParams){const h=new URLSearchParams(a.queryParams);i.push(h.toString())}return a?.skipBrowserRedirect&&i.push(`skip_http_redirect=${a.skipBrowserRedirect}`),`${n}?${i.join("&")}`}async _unenroll(n){try{return await this._useSession(async r=>{var a;const{data:i,error:h}=r;return h?{data:null,error:h}:await He(this.fetch,"DELETE",`${this.url}/factors/${n.factorId}`,{headers:this.headers,jwt:(a=i?.session)===null||a===void 0?void 0:a.access_token})})}catch(r){if(Ue(r))return{data:null,error:r};throw r}}async _enroll(n){try{return await this._useSession(async r=>{var a,i;const{data:h,error:d}=r;if(d)return{data:null,error:d};const p=Object.assign({friendly_name:n.friendlyName,factor_type:n.factorType},n.factorType==="phone"?{phone:n.phone}:{issuer:n.issuer}),{data:x,error:y}=await He(this.fetch,"POST",`${this.url}/factors`,{body:p,headers:this.headers,jwt:(a=h?.session)===null||a===void 0?void 0:a.access_token});return y?{data:null,error:y}:(n.factorType==="totp"&&(!((i=x?.totp)===null||i===void 0)&&i.qr_code)&&(x.totp.qr_code=`data:image/svg+xml;utf-8,${x.totp.qr_code}`),{data:x,error:null})})}catch(r){if(Ue(r))return{data:null,error:r};throw r}}async _verify(n){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var a;const{data:i,error:h}=r;if(h)return{data:null,error:h};const{data:d,error:p}=await He(this.fetch,"POST",`${this.url}/factors/${n.factorId}/verify`,{body:{code:n.code,challenge_id:n.challengeId},headers:this.headers,jwt:(a=i?.session)===null||a===void 0?void 0:a.access_token});return p?{data:null,error:p}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+d.expires_in},d)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",d),{data:d,error:p})})}catch(r){if(Ue(r))return{data:null,error:r};throw r}})}async _challenge(n){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var a;const{data:i,error:h}=r;return h?{data:null,error:h}:await He(this.fetch,"POST",`${this.url}/factors/${n.factorId}/challenge`,{body:{channel:n.channel},headers:this.headers,jwt:(a=i?.session)===null||a===void 0?void 0:a.access_token})})}catch(r){if(Ue(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(n){const{data:r,error:a}=await this._challenge({factorId:n.factorId});return a?{data:null,error:a}:await this._verify({factorId:n.factorId,challengeId:r.id,code:n.code})}async _listFactors(){const{data:{user:n},error:r}=await this.getUser();if(r)return{data:null,error:r};const a=n?.factors||[],i=a.filter(d=>d.factor_type==="totp"&&d.status==="verified"),h=a.filter(d=>d.factor_type==="phone"&&d.status==="verified");return{data:{all:a,totp:i,phone:h},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async n=>{var r,a;const{data:{session:i},error:h}=n;if(h)return{data:null,error:h};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:d}=Tu(i.access_token);let p=null;d.aal&&(p=d.aal);let x=p;((a=(r=i.user.factors)===null||r===void 0?void 0:r.filter(N=>N.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(x="aal2");const S=d.amr||[];return{data:{currentLevel:p,nextLevel:x,currentAuthenticationMethods:S},error:null}}))}async fetchJwk(n,r={keys:[]}){let a=r.keys.find(p=>p.kid===n);if(a)return a;const i=Date.now();if(a=this.jwks.keys.find(p=>p.kid===n),a&&this.jwks_cached_at+V0>i)return a;const{data:h,error:d}=await He(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(d)throw d;return!h.keys||h.keys.length===0||(this.jwks=h,this.jwks_cached_at=i,a=h.keys.find(p=>p.kid===n),!a)?null:a}async getClaims(n,r={}){try{let a=n;if(!a){const{data:A,error:U}=await this.getSession();if(U||!A.session)return{data:null,error:U};a=A.session.access_token}const{header:i,payload:h,signature:d,raw:{header:p,payload:x}}=Tu(a);r?.allowExpired||dv(h.exp);const y=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,r?.keys?{keys:r.keys}:r?.jwks);if(!y){const{error:A}=await this.getUser(a);if(A)throw A;return{data:{claims:h,header:i,signature:d},error:null}}const S=hv(i.alg),N=await crypto.subtle.importKey("jwk",y,S,!0,["verify"]);if(!await crypto.subtle.verify(S,N,d,Y0(`${p}.${x}`)))throw new zu("Invalid JWT signature");return{data:{claims:h,header:i,signature:d},error:null}}catch(a){if(Ue(a))return{data:null,error:a};throw a}}}ei.nextInstanceID=0;const Tv=ei;class Cv extends Tv{constructor(n){super(n)}}var Rv=function(u,n,r,a){function i(h){return h instanceof r?h:new r(function(d){d(h)})}return new(r||(r=Promise))(function(h,d){function p(S){try{y(a.next(S))}catch(N){d(N)}}function x(S){try{y(a.throw(S))}catch(N){d(N)}}function y(S){S.done?h(S.value):i(S.value).then(p,x)}y((a=a.apply(u,n||[])).next())})};class Iv{constructor(n,r,a){var i,h,d;if(this.supabaseUrl=n,this.supabaseKey=r,!n)throw new Error("supabaseUrl is required.");if(!r)throw new Error("supabaseKey is required.");const p=L0(n),x=new URL(p);this.realtimeUrl=new URL("realtime/v1",x),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",x),this.storageUrl=new URL("storage/v1",x),this.functionsUrl=new URL("functions/v1",x);const y=`sb-${x.hostname.split(".")[0]}-auth-token`,S={db:j0,realtime:C0,auth:Object.assign(Object.assign({},T0),{storageKey:y}),global:N0},N=A0(a??{},S);this.storageKey=(i=N.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(h=N.global.headers)!==null&&h!==void 0?h:{},N.accessToken?(this.accessToken=N.accessToken,this.auth=new Proxy({},{get:(R,A)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(A)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((d=N.auth)!==null&&d!==void 0?d:{},this.headers,N.global.fetch),this.fetch=P0(r,this._getAccessToken.bind(this),N.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},N.realtime)),this.rest=new Kp(new URL("rest/v1",x).href,{headers:this.headers,schema:N.db.schema,fetch:this.fetch}),this.storage=new _0(this.storageUrl.href,this.headers,this.fetch,a?.storage),N.accessToken||this._listenForAuthEvents()}get functions(){return new $p(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,r={},a={}){return this.rest.rpc(n,r,a)}channel(n,r={config:{}}){return this.realtime.channel(n,r)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var n,r;return Rv(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:a}=yield this.auth.getSession();return(r=(n=a.session)===null||n===void 0?void 0:n.access_token)!==null&&r!==void 0?r:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:r,detectSessionInUrl:a,storage:i,userStorage:h,storageKey:d,flowType:p,lock:x,debug:y},S,N){const R={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Cv({url:this.authUrl.href,headers:Object.assign(Object.assign({},R),S),storageKey:d,autoRefreshToken:n,persistSession:r,detectSessionInUrl:a,storage:i,userStorage:h,flowType:p,lock:x,debug:y,fetch:N,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(n){return new u0(this.realtimeUrl.href,Object.assign(Object.assign({},n),{params:Object.assign({apikey:this.supabaseKey},n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,a)=>{this._handleTokenChanged(r,"CLIENT",a?.access_token)})}_handleTokenChanged(n,r,a){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==a?this.changedAccessToken=a:n==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Ov=(u,n,r)=>new Iv(u,n,r);function Pv(){if(typeof window<"u"||typeof process>"u")return!1;const u=process.version;if(u==null)return!1;const n=u.match(/^v(\d+)\./);return n?parseInt(n[1],10)<=18:!1}Pv()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Dv="https://huqijhevmtgardkyeowa.supabase.co",im="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh1cWlqaGV2bXRnYXJka3llb3dhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcyNDgyNTQsImV4cCI6MjA3MjgyNDI1NH0.1G81Zif1YWQwISEGJw4XMzY89Rlvh6Jda1-j-roPZBk",ae=Ov(Dv,im),Re=im!=="YOUR_SUPABASE_ANON_KEY",Lv=Object.freeze(Object.defineProperty({__proto__:null,isSupabaseConfigured:Re,supabase:ae},Symbol.toStringTag,{value:"Module"})),lm=_.createContext(void 0),oo=()=>{const u=_.useContext(lm);if(u===void 0)throw new Error("useAuth must be used within an AuthProvider");return u},Av=({children:u})=>{const[n,r]=_.useState(null),[a,i]=_.useState(null),[h,d]=_.useState(!0);_.useEffect(()=>{ae.auth.getSession().then(({data:{session:A}})=>{i(A),r(A?.user??null),d(!1)});const{data:{subscription:R}}=ae.auth.onAuthStateChange((A,U)=>{i(U),r(U?.user??null),d(!1)});return()=>R.unsubscribe()},[]);const N={user:n,session:a,loading:h,signUp:async(R,A,U)=>{try{const{data:$,error:O}=await ae.auth.signUp({email:R,password:A,options:{data:{full_name:U}}});if(O)return{error:O};if($.user){const{error:J}=await ae.from("user_profiles").insert([{user_id:$.user.id,full_name:U,role:"VIEWER"}]);J&&console.error("Error creating user profile:",J)}return{error:null}}catch($){return{error:$}}},signIn:async(R,A)=>{const{error:U}=await ae.auth.signInWithPassword({email:R,password:A});return{error:U}},signOut:async()=>{Object.keys(localStorage).forEach(U=>{U.startsWith("user_role_")&&localStorage.removeItem(U)});const{error:A}=await ae.auth.signOut();A&&console.error("Sign out error:",A)},updateProfile:async R=>{if(!n)return{error:new Error("No user logged in")};const{error:A}=await ae.from("user_profiles").update(R).eq("user_id",n.id);return{error:A}}};return s.jsx(lm.Provider,{value:N,children:u})},$v=({isOpen:u,onClose:n,onSuccess:r})=>{const[a,i]=_.useState(!1),[h,d]=_.useState(""),[p,x]=_.useState(""),[y,S]=_.useState(""),[N,R]=_.useState(!1),[A,U]=_.useState(null),{signUp:$,signIn:O}=oo(),J=async K=>{K.preventDefault(),R(!0),U(null);try{let Y;a?Y=await $(h,p,y):Y=await O(h,p),Y.error?U(Y.error.message||"An error occurred"):(r(),n())}catch{U("An unexpected error occurred")}finally{R(!1)}},X=()=>{d(""),x(""),S(""),U(null)},q=()=>{i(!a),X()};return u?s.jsxs("div",{className:"bg-slate-800 p-8 rounded-xl shadow-2xl max-w-md w-full border border-slate-700",children:[s.jsx("div",{className:"mb-6",children:s.jsx("h2",{className:"text-2xl font-bold text-white text-center",children:a?"Create Account":"Sign In"})}),s.jsxs("form",{onSubmit:J,className:"space-y-4",children:[a&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Full Name"}),s.jsx("input",{type:"text",value:y,onChange:K=>S(K.target.value),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500",placeholder:"Enter your full name",required:a})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Email"}),s.jsx("input",{type:"email",value:h,onChange:K=>d(K.target.value),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500",placeholder:"Enter your email",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Password"}),s.jsx("input",{type:"password",value:p,onChange:K=>x(K.target.value),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500",placeholder:"Enter your password",required:!0,minLength:6})]}),A&&s.jsx("div",{className:"bg-red-900 border border-red-700 text-red-200 px-3 py-2 rounded text-sm",children:A}),s.jsx("button",{type:"submit",disabled:N,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-500 disabled:bg-slate-600 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors",children:N?"Loading...":a?"Create Account":"Sign In"})]}),s.jsx("div",{className:"mt-4 text-center",children:s.jsx("button",{onClick:q,className:"text-blue-400 hover:text-blue-300 text-sm",children:a?"Already have an account? Sign in":"Don't have an account? Sign up"})}),!a&&s.jsx("div",{className:"mt-3 text-center",children:s.jsx("button",{onClick:()=>{i(!0),X()},className:"text-green-400 hover:text-green-300 text-sm",children:"Create a new account"})}),a&&s.jsx("div",{className:"mt-4 p-3 bg-blue-900 rounded-lg",children:s.jsxs("p",{className:"text-blue-200 text-sm",children:[s.jsx("strong",{children:"Note:"})," After signing up, you'll be able to access the app immediately."]})})]}):null},Mv=({onClose:u})=>{const{user:n,signOut:r,updateProfile:a}=oo(),[i,h]=_.useState(null),[d,p]=_.useState(!0),[x,y]=_.useState(!1),[S,N]=_.useState(""),[R,A]=_.useState("VIEWER"),[U,$]=_.useState(!1),O=[{value:"VIEWER",label:"Viewer (Read Only)"},{value:"OPERATOR",label:"Operator (Limited Edit)"},{value:"EDITOR",label:"Editor (Full Access)"}];_.useEffect(()=>{n&&J()},[n]);const J=async()=>{if(n)try{const{data:K,error:Y}=await ae.from("user_profiles").select("*").eq("user_id",n.id).single();if(Y){console.log("No profile found in database, using user metadata:",Y);const P={id:n.id,full_name:n.user_metadata?.full_name||n.email||"Unknown",role:n.user_metadata?.role||"VIEWER",email:n.email||"",created_at:n.created_at||new Date().toISOString()};h(P),N(P.full_name),A(P.role)}else h(K),N(K.full_name||""),A(K.role||"VIEWER")}catch(K){console.error("Error fetching profile:",K);const Y={id:n.id,full_name:n.user_metadata?.full_name||n.email||"Unknown",role:n.user_metadata?.role||"VIEWER",email:n.email||"",created_at:n.created_at||new Date().toISOString()};h(Y),N(Y.full_name),A(Y.role)}finally{p(!1)}},X=async()=>{if(n){$(!0);try{const{error:K}=await a({full_name:S,role:R});if(K)console.error("Error updating profile:",K),alert("Error updating profile");else{h(P=>P?{...P,full_name:S,role:R}:null),y(!1);const Y=new URLSearchParams(window.location.search).get("eventId")||window.location.pathname.includes("/run-of-show")?"current":null;Y&&localStorage.setItem(`user_role_${Y}_${n.id}`,R),u&&u()}}catch(K){console.error("Error updating profile:",K),alert("Error updating profile")}finally{$(!1)}}},q=async()=>{confirm("Are you sure you want to sign out?")&&await r()};return d?s.jsxs("div",{className:"flex items-center gap-2 text-slate-300",children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"}),"Loading..."]}):i?s.jsxs("div",{className:"bg-slate-800 p-4 rounded-lg shadow-2xl w-80 border border-slate-700",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-bold text-white",children:"Profile"}),u&&s.jsx("button",{onClick:u,className:"text-slate-400 hover:text-white transition-colors",children:"✕"})]}),x?s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Full Name"}),s.jsx("input",{type:"text",value:S,onChange:K=>N(K.target.value),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white text-sm",placeholder:"Enter your full name"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Role"}),s.jsx("select",{value:R,onChange:K=>A(K.target.value),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white text-sm",children:O.map(K=>s.jsx("option",{value:K.value,children:K.label},K.value))})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:X,disabled:U,className:"flex-1 px-3 py-2 bg-green-600 hover:bg-green-500 disabled:bg-slate-600 text-white text-sm rounded transition-colors",children:U?"Saving...":"Save"}),s.jsx("button",{onClick:()=>y(!1),className:"px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white text-sm rounded transition-colors",children:"Cancel"})]})]}):s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white font-medium",children:(i.full_name||"U").charAt(0).toUpperCase()}),s.jsxs("div",{children:[s.jsx("div",{className:"text-white font-medium",children:i.full_name}),s.jsx("div",{className:"text-slate-400 text-sm",children:i.role}),s.jsx("div",{className:"text-slate-500 text-xs",children:n?.email})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>y(!0),className:"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white text-sm rounded transition-colors",children:"Edit Profile"}),s.jsx("button",{onClick:q,className:"px-3 py-2 bg-red-600 hover:bg-red-500 text-white text-sm rounded transition-colors",title:"Sign out",children:"Sign Out"})]})]})]}):s.jsx("div",{className:"text-slate-300",children:"Profile not found"})},Wu=()=>{const{user:u,signOut:n}=oo(),[r,a]=_.useState(!1);return s.jsx("header",{className:"fixed top-0 left-0 right-0 z-50 bg-slate-800 border-b border-slate-700 px-6 py-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex items-center gap-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:s.jsx("span",{className:"text-white font-bold text-lg",children:"R"})}),s.jsx("h1",{className:"text-xl font-bold text-white",children:"Run of Show"})]})}),u?s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-white font-semibold text-base",children:u.user_metadata?.full_name||u.email}),s.jsx("p",{className:"text-slate-300 text-xs",children:u.email})]}),s.jsx("button",{onClick:()=>{confirm("Are you sure you want to sign out?")&&n()},className:"px-3 py-1.5 bg-red-600 hover:bg-red-500 text-white text-sm rounded-md transition-colors",title:"Sign out",children:"Sign Out"})]}):s.jsx("div",{className:"flex items-center gap-4",children:s.jsx("div",{className:"text-slate-400 text-sm",children:"Please sign in to continue"})}),r&&s.jsx("div",{className:"absolute top-16 right-6 z-50",children:s.jsx(Mv,{onClose:()=>a(!1)})})]})})},Uv=({children:u})=>{const{user:n,loading:r}=oo(),[a,i]=Cl.useState(!1);return Cl.useEffect(()=>{!r&&!n?i(!0):n&&i(!1)},[n,r]),r?s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 pt-16",children:[s.jsx(Wu,{}),s.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-80px)]",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),s.jsx("p",{className:"text-slate-300",children:"Loading..."})]})})]}):n?s.jsx(s.Fragment,{children:u}):s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 pt-16",children:[s.jsx(Wu,{}),s.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-80px)]",children:s.jsxs("div",{className:"text-center max-w-md mx-auto p-8",children:[s.jsxs("div",{className:"mb-8",children:[s.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[s.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center",children:s.jsx("span",{className:"text-white font-bold text-2xl",children:"R"})}),s.jsx("h1",{className:"text-4xl font-bold text-white",children:"Run of Show"})]}),s.jsx("p",{className:"text-slate-300 text-lg",children:"Please sign in to access the Run of Show application."})]}),s.jsx($v,{isOpen:a,onClose:()=>{},onSuccess:()=>{i(!1)}}),s.jsx("div",{className:"mt-4 text-center",children:s.jsx("button",{onClick:()=>i(!0),className:"text-blue-400 hover:text-blue-300 text-sm underline",children:"Already have an account? Sign in here"})})]})})]})},Nl=[{value:"Great Hall",label:"Great Hall",color:"bg-blue-600"},{value:"Briefing Center",label:"Briefing Center",color:"bg-green-600"},{value:"Lee Anderson",label:"Lee Anderson",color:"bg-purple-600"},{value:"Virtual Show",label:"Virtual Show",color:"bg-orange-600"},{value:"Off Site",label:"Off Site",color:"bg-red-600"}],kf=[1,2,3,4,5];class ye{static async saveCalendarEvent(n){try{console.log("🔄 Saving calendar event to Supabase:",n);const{data:r,error:a}=await ae.from("calendar_events").insert([n]).select().single();return a?(console.error("Error saving calendar event:",a),this.saveCalendarToLocalStorage(n)):(console.log("✅ Calendar event saved to Supabase:",r),r)}catch(r){return console.error("Error saving calendar event:",r),this.saveCalendarToLocalStorage(n)}}static async updateCalendarEvent(n,r){try{console.log("🔄 Updating calendar event in Supabase:",n,r);const{data:a,error:i}=await ae.from("calendar_events").update({name:r.name,date:r.date,schedule_data:r.schedule_data,updated_at:new Date().toISOString()}).eq("id",n).select().single();return i?(console.error("❌ Error updating calendar event:",i),null):(console.log("✅ Calendar event updated successfully:",a),a)}catch(a){return console.error("❌ Exception updating calendar event:",a),null}}static async getCalendarEvents(){try{console.log("🔄 Loading calendar events from Supabase...");const{data:n,error:r}=await ae.from("calendar_events").select("*").order("date",{ascending:!1});return r?(console.error("Error fetching calendar events:",r),this.getCalendarFromLocalStorage()):(console.log("✅ Calendar events loaded from Supabase:",n?.length||0),n||[])}catch(n){return console.error("Error fetching calendar events:",n),this.getCalendarFromLocalStorage()}}static async getCalendarEvent(n){try{const{data:r,error:a}=await ae.from("calendar_events").select("*").eq("id",n).single();return a?(console.error("Error fetching calendar event:",a),this.getCalendarFromLocalStorageById(n)):r}catch(r){return console.error("Error fetching calendar event:",r),this.getCalendarFromLocalStorageById(n)}}static async deleteCalendarEvent(n){try{const{error:r}=await ae.from("calendar_events").delete().eq("id",n);return r?(console.error("Error deleting calendar event:",r),this.deleteCalendarFromLocalStorage(n)):!0}catch(r){return console.error("Error deleting calendar event:",r),this.deleteCalendarFromLocalStorage(n)}}static async logChange(n,r,a,i,h,d,p,x,y,S,N,R,A,U){try{console.log("Calling log_change with parameters:",{p_event_id:n,p_user_id:r,p_user_name:a,p_user_role:i,p_action:h,p_table_name:d,p_record_id:p,p_field_name:x,p_row_number:R,p_cue_number:A});const $={p_event_id:n,p_user_id:r,p_user_name:a,p_user_role:i,p_action:h,p_table_name:d,p_record_id:p||null,p_field_name:x||null,p_old_value:y?JSON.stringify(y):null,p_new_value:S?JSON.stringify(S):null,p_description:N||null,p_metadata:U||{},p_row_number:R||null,p_cue_number:A?typeof A=="string"?parseInt(A,10):A:null};console.log("Calling log_change with cleaned parameters:",$);const{data:O,error:J}=await ae.rpc("log_change",$);return J?(console.error("❌ Error logging change:",J),console.error("❌ Parameters that caused error:",$),null):(console.log("✅ Change logged:",{action:h,tableName:d,recordId:p,changeId:O}),O)}catch($){return console.error("Error logging change:",$),null}}static async logFieldChanges(n,r,a,i,h,d,p,x){try{for(const y of p)await this.logChange(n,r,a,i,"UPDATE",h,d,y.fieldName,y.oldValue,y.newValue,x)}catch(y){console.error("Error logging field changes:",y)}}static async getChangeLog(n,r=50,a=0){try{const{data:i,error:h}=await ae.rpc("get_change_log",{p_event_id:n,p_limit:r,p_offset:a});return h?(console.error("❌ Error fetching change log:",h),[]):i||[]}catch(i){return console.error("Error fetching change log:",i),[]}}static async getRecordChangeLog(n,r,a,i=20){try{const{data:h,error:d}=await ae.rpc("get_record_change_log",{p_event_id:n,p_table_name:r,p_record_id:a,p_limit:i});return d?(console.error("❌ Error fetching record change log:",d),[]):h||[]}catch(h){return console.error("Error fetching record change log:",h),[]}}static async getChangeLogSummary(n){try{const{data:r,error:a}=await ae.rpc("get_change_log_summary",{p_event_id:n});return a?(console.error("❌ Error fetching change log summary:",a),null):r?.[0]||null}catch(r){return console.error("Error fetching change log summary:",r),null}}static async cleanupOldChangeLogs(){try{const{data:n,error:r}=await ae.rpc("cleanup_old_change_logs");return r?(console.error("❌ Error cleaning up old change logs:",r),0):(console.log("🧹 Cleaned up old change logs:",n),n||0)}catch(n){return console.error("Error cleaning up old change logs:",n),0}}static async saveRunOfShowData(n,r){try{console.log("🔄 Saving run of show data to Supabase:",{eventId:n.event_id,scheduleItemsCount:n.schedule_items?.length||0,customColumnsCount:n.custom_columns?.length||0,settingsKeys:Object.keys(n.settings||{}),userInfo:r?`${r.userName} (${r.userRole})`:"No user info"});const a=new Date().toISOString(),i={...n,last_modified_by:r?.userId,last_modified_by_name:r?.userName,last_modified_by_role:r?.userRole,updated_at:a},{data:h,error:d}=await ae.from("run_of_show_data").select("*").eq("event_id",n.event_id).single();let p;if(h&&!d){console.log("📝 Updating existing record for event:",n.event_id);const x=h.last_change_at||a,{data:y,error:S}=await ae.from("run_of_show_data").update({event_name:i.event_name,event_date:i.event_date,schedule_items:i.schedule_items,custom_columns:i.custom_columns,settings:i.settings,last_modified_by:i.last_modified_by,last_modified_by_name:i.last_modified_by_name,last_modified_by_role:i.last_modified_by_role,updated_at:i.updated_at,last_change_at:x}).eq("event_id",n.event_id).select().single();if(S)throw console.error("❌ Error updating run of show data:",S),S;p=y}else{console.log("➕ Inserting new record for event:",n.event_id);const x={...i,last_change_at:a},{data:y,error:S}=await ae.from("run_of_show_data").insert([x]).select().single();if(S)throw console.error("❌ Error inserting run of show data:",S),S;p=y}return console.log("✅ Run of show data saved to Supabase successfully"),p}catch(a){console.error("❌ Error saving run of show data:",a),console.error("❌ Error details:",a.message,a.details,a.hint);const i={...n,last_modified_by:r?.userId,last_modified_by_name:r?.userName,last_modified_by_role:r?.userRole,updated_at:new Date().toISOString()};return this.saveRunOfShowToLocalStorage(i)}}static async updateRunOfShowData(n,r){try{console.log("🔄 Updating run of show data in Supabase for event:",n,r);const{data:a,error:i}=await ae.from("run_of_show_data").update({...r,updated_at:new Date().toISOString()}).eq("event_id",n).select().single();return i?(console.error("❌ Error updating run of show data:",i),null):(console.log("✅ Run of show data updated successfully:",a),a)}catch(a){return console.error("❌ Exception updating run of show data:",a),null}}static async getRunOfShowData(n){try{console.log("🔄 Loading run of show data from Supabase for event:",n),console.log("🔍 Supabase configured:",Re),console.log("🔍 Executing Supabase query...");const{data:r,error:a}=await ae.from("run_of_show_data").select("*").eq("event_id",n).single();return console.log("🔍 Supabase query completed. Error:",a),console.log("🔍 Supabase query data:",r),a?(console.error("❌ Error fetching run of show data:",a),console.error("❌ Error details:",{message:a.message,details:a.details,hint:a.hint,code:a.code}),console.log("🔄 Falling back to localStorage..."),this.getRunOfShowFromLocalStorageById(n)):(console.log("✅ Run of show data loaded from Supabase:",r?"Found":"Not found"),r&&console.log("🔍 Data structure:",{hasScheduleItems:!!r.schedule_items,scheduleItemsLength:r.schedule_items?.length||0,hasCustomColumns:!!r.custom_columns,customColumnsLength:r.custom_columns?.length||0,hasSettings:!!r.settings}),r)}catch(r){return console.error("❌ Exception in getRunOfShowData:",r),console.error("❌ Exception details:",{message:r.message,stack:r.stack,eventId:n}),console.log("🔄 Falling back to localStorage due to exception..."),this.getRunOfShowFromLocalStorageById(n)}}static async deleteRunOfShowData(n){try{const{error:r}=await ae.from("run_of_show_data").delete().eq("event_id",n);return r?(console.error("Error deleting run of show data:",r),this.deleteRunOfShowFromLocalStorage(n)):!0}catch(r){return console.error("Error deleting run of show data:",r),this.deleteRunOfShowFromLocalStorage(n)}}static saveCalendarToLocalStorage(n){const r=this.getCalendarFromLocalStorage(),a={...n,id:Date.now().toString(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return r.unshift(a),localStorage.setItem("calendar_events",JSON.stringify(r)),console.log("✅ Calendar event saved to localStorage"),a}static getCalendarFromLocalStorage(){try{const n=localStorage.getItem("calendar_events"),r=n?JSON.parse(n):[];return console.log("✅ Calendar events loaded from localStorage:",r.length),r}catch(n){return console.error("Error reading from localStorage:",n),[]}}static getCalendarFromLocalStorageById(n){return this.getCalendarFromLocalStorage().find(a=>a.id===n)||null}static deleteCalendarFromLocalStorage(n){try{const a=this.getCalendarFromLocalStorage().filter(i=>i.id!==n);return localStorage.setItem("calendar_events",JSON.stringify(a)),!0}catch(r){return console.error("Error deleting from localStorage:",r),!1}}static saveRunOfShowToLocalStorage(n){const r=this.getAllRunOfShowFromLocalStorage(),a=new Date().toISOString(),i=r.findIndex(d=>d.event_id===n.event_id);let h;if(i>=0){const d=r[i],p=d.last_change_at||a;h={...n,id:d.id,created_at:d.created_at,updated_at:a,last_change_at:p},r[i]=h}else h={...n,id:Date.now().toString(),created_at:a,updated_at:a,last_change_at:a},r.push(h);return localStorage.setItem("run_of_show_data",JSON.stringify(r)),console.log("✅ Run of show data saved to localStorage"),h}static getAllRunOfShowFromLocalStorage(){try{const n=localStorage.getItem("run_of_show_data");return n?JSON.parse(n):[]}catch(n){return console.error("Error reading run of show data from localStorage:",n),[]}}static getRunOfShowFromLocalStorageById(n){console.log("🔄 Loading from localStorage for event:",n);const r=this.getAllRunOfShowFromLocalStorage();console.log("🔍 All localStorage data:",r);const a=r.find(i=>i.event_id===n);return console.log("🔍 Found data for event:",a?"Yes":"No"),a&&console.log("🔍 Found data structure:",{hasScheduleItems:!!a.schedule_items,scheduleItemsLength:a.schedule_items?.length||0,hasCustomColumns:!!a.custom_columns,customColumnsLength:a.custom_columns?.length||0,hasSettings:!!a.settings}),a||null}static deleteRunOfShowFromLocalStorage(n){try{const a=this.getAllRunOfShowFromLocalStorage().filter(i=>i.event_id!==n);return localStorage.setItem("run_of_show_data",JSON.stringify(a)),!0}catch(r){return console.error("Error deleting run of show data from localStorage:",r),!1}}static async checkForChanges(n,r){try{console.log("🔍 Checking for changes:",{eventId:n,localLastChangeAt:r,isSupabaseConfigured:Re});const{data:a,error:i}=await ae.from("run_of_show_data").select("updated_at, last_change_at, last_modified_by, last_modified_by_name").eq("event_id",n).single();if(i||!a)return console.error("❌ Error checking for changes:",i),console.error("❌ Event ID:",n),console.error("❌ Supabase configured:",Re),{hasChanges:!1};if(console.log("🔍 Change check data:",a),!r)return{hasChanges:!0,lastChangeAt:a.last_change_at,updatedAt:a.updated_at,lastModifiedBy:a.last_modified_by,lastModifiedByName:a.last_modified_by_name};const h=r?a.updated_at!==r:!1;return console.log("🔍 Change detection:",{localLastChangeAt:r,serverUpdatedAt:a.updated_at,hasChanges:h,lastChangeAt:a.last_change_at}),{hasChanges:h,lastChangeAt:a.last_change_at,updatedAt:a.updated_at,lastModifiedBy:a.last_modified_by,lastModifiedByName:a.last_modified_by_name}}catch(a){return console.error("❌ Error checking for changes:",a),{hasChanges:!1}}}static async loadChangesDynamically(n){try{console.log("🔄 Loading changes dynamically for event:",n);const{data:r,error:a}=await ae.from("run_of_show_data").select("*").eq("event_id",n).single();return a?(console.error("❌ Error loading changes:",a),null):(console.log("✅ Changes loaded successfully"),r)}catch(r){return console.error("❌ Error loading changes dynamically:",r),null}}static async saveUserSession(n,r,a,i){try{console.log("🔄 Saving authenticated user session:",{eventId:n,userId:r,username:a,role:i});const{data:h,error:d}=await ae.rpc("get_or_create_user_session",{p_user_id:r,p_event_id:n,p_user_role:i});return d?(console.error("❌ Supabase error saving user session:",d),console.error("❌ Error details:",d.message,d.details,d.hint),this.saveUserSessionToLocalStorage(n,a,i)):(console.log("✅ Authenticated user session saved to Supabase:",h),!0)}catch(h){return console.error("Error saving user session:",h),this.saveUserSessionToLocalStorage(n,a,i)}}static async getCurrentUserSession(n){try{const{data:r,error:a}=await ae.from("user_sessions").select("id, event_id, user_role").eq("user_id",n).order("created_at",{ascending:!1}).limit(1);return a?(console.error("❌ Error getting current user session:",a),this.getCurrentUserSessionFromLocalStorage()):r?.[0]||null}catch(r){return console.error("Error getting current user session:",r),this.getCurrentUserSessionFromLocalStorage()}}static async updateUserActivity(n){try{const{error:r}=await ae.rpc("update_user_activity",{p_user_id:n});r&&console.error("❌ Error updating user activity:",r)}catch(r){console.error("Error updating user activity:",r)}}static async cleanupInactiveSessions(){try{const{data:n,error:r}=await ae.rpc("cleanup_inactive_sessions");r?console.error("❌ Error cleaning up inactive sessions:",r):console.log("🧹 Cleaned up inactive sessions:",n)}catch(n){console.error("Error cleaning up inactive sessions:",n)}}static saveUserSessionToLocalStorage(n,r,a){try{const i={event_id:n,username:r,role:a,session_started_at:new Date().toISOString(),last_activity_at:new Date().toISOString(),is_active:!0};return localStorage.setItem(`current_user_session_${r}`,JSON.stringify(i)),localStorage.setItem(`user_role_${n}_${r}`,a),console.log("✅ User session saved to localStorage"),!0}catch(i){return console.error("Error saving user session to localStorage:",i),!1}}static getCurrentUserSessionFromLocalStorage(){try{const n=Object.keys(localStorage);let r=null,a=0;for(const i of n)if(i.startsWith("current_user_session_")){const h=JSON.parse(localStorage.getItem(i)||"{}");if(h.is_active&&h.last_activity_at){const d=new Date(h.last_activity_at).getTime();d>a&&(a=d,r=h)}}return r}catch(n){return console.error("Error getting current user session from localStorage:",n),null}}static async loadCue(n,r,a,i,h,d,p){try{const{data:x,error:y}=await ae.rpc("load_cue_for_event",{p_event_id:n,p_item_id:r.toString(),p_user_id:a,p_duration_seconds:i,p_row_is:h||null,p_cue_is:d||null,p_timer_id:p||null});return y?(console.error("❌ Error loading CUE in Supabase:",y),console.error("❌ Error details:",y.message,y.details,y.hint),console.error("❌ Error code:",y.code),(y.code==="PGRST204"||y.message.includes("Could not find"))&&console.warn("⚠️ Timer functions do not exist. Please run the optimized-timer-schema.sql migration script first."),!1):(console.log("✅ CUE loaded in Supabase:",x),x)}catch(x){return console.error("❌ Error loading CUE:",x),!1}}static async startTimer(n,r,a,i,h,d,p,x){try{const{data:y,error:S}=await ae.rpc("start_timer_for_event",{p_event_id:n,p_item_id:r.toString(),p_user_id:a,p_row_is:d||null,p_cue_is:p||null,p_timer_id:x||null});return S?(console.error("❌ Error starting timer in Supabase:",S),console.error("❌ Error details:",S.message,S.details,S.hint),console.error("❌ Error code:",S.code),!1):(console.log("✅ Timer started in Supabase (UPSERT):",y),!0)}catch(y){return console.error("Error starting timer:",y),!1}}static async stopTimer(n,r,a){try{const{data:i,error:h}=await ae.from("active_timers").update({is_running:!1,is_active:!1,timer_state:"stopped"}).eq("event_id",n).select();return h?(console.error("❌ Error stopping timer in Supabase:",h),!1):(console.log("✅ Timer stopped in Supabase:",i),!0)}catch(i){return console.error("Error stopping timer:",i),!1}}static async updateTimerDuration(n,r,a){try{console.log(`🔄 Updating timer duration for event ${n}, item ${r} to ${a}s`);const{data:i,error:h}=await ae.from("active_timers").update({duration_seconds:a}).eq("event_id",n).eq("item_id",r);return h?(console.error("❌ Error updating timer duration in Supabase:",h),!1):(console.log("✅ Timer duration updated in Supabase:",i),!0)}catch(i){return console.error("Error updating timer duration:",i),!1}}static async stopAllTimersForEvent(n,r){try{const{data:a,error:i}=await ae.rpc("stop_timer_for_event",{p_event_id:n});return i?(console.error("❌ Error stopping all timers in Supabase:",i),!1):(console.log("✅ All timers stopped in Supabase"),!0)}catch(a){return console.error("Error stopping all timers:",a),!1}}static async getActiveTimer(n){try{const{data:r,error:a}=await ae.rpc("get_active_timer_for_event",{p_event_id:n});return a?(console.error("❌ Error getting active timer from Supabase:",a),null):r?.[0]||null}catch(r){return console.error("Error getting active timer:",r),null}}static subscribeToTimerChanges(n,r){return ae.channel("active_timers_changes").on("postgres_changes",{event:"*",schema:"public",table:"active_timers",filter:`event_id=eq.${n}`},r).subscribe()}static async hasActiveSubCueTimer(n){try{if(!Re||!ae)return console.warn("⚠️ Supabase client not initialized, skipping has active sub-cue timer check"),{data:!1,error:null};const{data:r,error:a}=await ae.rpc("has_active_sub_cue_timer_for_event",{p_event_id:n});return a?(console.error("❌ Error checking active sub-cue timer:",a),{data:!1,error:a}):{data:r||!1,error:null}}catch(r){return console.error("❌ Error checking active sub-cue timer:",r),{data:!1,error:r}}}static async getActiveSubCueTimer(n){try{if(!Re||!ae)return console.warn("⚠️ Supabase client not initialized, skipping get active sub-cue timer"),{data:null,error:null};const{data:r,error:a}=await ae.rpc("get_active_sub_cue_timers_for_event",{p_event_id:n});return a?(console.error("❌ Error getting active sub-cue timer:",a),{data:null,error:a}):{data:r?.[0]||null,error:null}}catch(r){return console.error("❌ Error getting active sub-cue timer:",r),{data:null,error:r}}}static async getActiveSubCueTimers(n){try{if(!Re||!ae)return console.warn("⚠️ Supabase client not initialized, skipping get active sub-cue timers"),{data:null,error:null};const{data:r,error:a}=await ae.rpc("get_active_sub_cue_timers_for_event",{p_event_id:n});return a?(console.error("❌ Error getting active sub-cue timers:",a),{data:null,error:a}):{data:r,error:null}}catch(r){return console.error("❌ Error getting active sub-cue timers:",r),{data:null,error:r}}}static async startSubCueTimer(n,r,a,i,h,d,p){try{if(!Re||!ae)return console.warn("⚠️ Supabase client not initialized, skipping start sub-cue timer"),{data:null,error:null};console.log("🔄 Calling start_sub_cue_timer_for_event with params:",{p_event_id:n,p_item_id:r.toString(),p_user_id:a,p_duration_seconds:i,p_row_is:h,p_cue_is:d,p_timer_id:p}),console.log("🔄 About to call RPC function...");const{data:x,error:y}=await ae.rpc("start_sub_cue_timer_for_event",{p_event_id:n,p_item_id:r.toString(),p_user_id:a,p_duration_seconds:i,p_row_is:h||null,p_cue_is:d||null,p_timer_id:p||null});return console.log("🔄 RPC response:",{data:x,error:y}),y?(console.error("❌ Error starting sub-cue timer:",y),console.error("❌ Error details:",JSON.stringify(y,null,2)),{data:null,error:y}):{data:x,error:null}}catch(x){return console.error("❌ Error starting sub-cue timer:",x),{data:null,error:x}}}static async expireCompletedSubCueTimers(){try{if(!Re||!ae)return console.warn("⚠️ Supabase client not initialized, skipping expire completed sub-cue timers"),{data:0,error:null};const{data:n,error:r}=await ae.rpc("expire_completed_sub_cue_timers");return r?(console.error("❌ Error expiring completed sub-cue timers:",r),{data:0,error:r}):{data:n||0,error:null}}catch(n){return console.error("❌ Error expiring completed sub-cue timers:",n),{data:0,error:n}}}static async stopSubCueTimer(n,r){try{if(!Re||!ae)return console.warn("⚠️ Supabase client not initialized, skipping stop sub-cue timer"),{data:null,error:null};const{data:a,error:i}=await ae.rpc("stop_sub_cue_timer_for_event",{p_event_id:n,p_item_id:null});return i?(console.error("❌ Error stopping sub-cue timer:",i),console.error("❌ Error details:",JSON.stringify(i,null,2)),{data:null,error:i}):{data:a,error:null}}catch(a){return console.error("❌ Error stopping sub-cue timer:",a),{data:null,error:a}}}static async getActiveSecondaryTimer(n){try{if(!Re||!ae)return console.warn("⚠️ Supabase client not initialized, skipping get active secondary timer"),{data:null,error:null};const{data:r,error:a}=await ae.rpc("get_active_secondary_timer_for_event",{p_event_id:n});return a?(console.error("❌ Error getting active secondary timer:",a),{data:null,error:a}):{data:r&&r.length>0?r[0]:null,error:null}}catch(r){return console.error("❌ Error getting active secondary timer:",r),{data:null,error:r}}}static async startSecondaryTimer(n,r,a,i){try{if(!Re||!ae)return console.warn("⚠️ Supabase client not initialized, skipping start secondary timer"),{data:null,error:null};const{data:h,error:d}=await ae.rpc("start_secondary_timer_for_event",{p_event_id:n,p_item_id:r,p_user_id:a,p_duration_seconds:i});return d?(console.error("❌ Error starting secondary timer:",d),{data:null,error:d}):{data:h,error:null}}catch(h){return console.error("❌ Error starting secondary timer:",h),{data:null,error:h}}}static async stopSecondaryTimer(n){try{if(!Re||!ae)return console.warn("⚠️ Supabase client not initialized, skipping stop secondary timer"),{data:null,error:null};const{data:r,error:a}=await ae.rpc("stop_secondary_timer_for_event",{p_event_id:n});return a?(console.error("❌ Error stopping secondary timer:",a),{data:null,error:a}):{data:r,error:null}}catch(r){return console.error("❌ Error stopping secondary timer:",r),{data:null,error:r}}}static async updateSecondaryTimerRemaining(n,r){try{if(!Re||!ae)return console.warn("⚠️ Supabase client not initialized, skipping update secondary timer remaining"),{data:null,error:null};const{data:a,error:i}=await ae.rpc("update_secondary_timer_remaining",{p_event_id:n,p_remaining_seconds:r});return i?(console.error("❌ Error updating secondary timer remaining:",i),{data:null,error:i}):{data:a,error:null}}catch(a){return console.error("❌ Error updating secondary timer remaining:",a),{data:null,error:a}}}static async updateSubCueTimerRemaining(n,r,a){try{if(!Re||!ae)return console.warn("⚠️ Supabase client not initialized, skipping update sub-cue timer remaining"),!1;const{error:i}=await ae.from("sub_cue_timers").update({remaining_seconds:a,updated_at:new Date().toISOString()}).eq("event_id",n).eq("item_id",r.toString()).eq("is_active",!0);return i?(console.error("❌ Error updating sub-cue timer remaining time:",i),!1):!0}catch(i){return console.error("Error updating sub-cue timer remaining time:",i),!1}}static async clearAllActiveTimersForEvent(n){try{if(!Re||!ae)return console.warn("⚠️ Supabase client not initialized, skipping clear all active timers"),!1;console.log("🔄 Clearing all active timers for event:",n);const{error:r}=await ae.from("active_timers").delete().eq("event_id",n);return r?(console.error("❌ Error clearing all active timers:",r),!1):(console.log("✅ All active timers cleared for event:",n),!0)}catch(r){return console.error("❌ Error clearing all active timers:",r),!1}}static async getCompletedCues(n){try{if(!Re||!ae)return console.warn("⚠️ Supabase client not initialized, skipping get completed cues"),null;const{data:r,error:a}=await ae.rpc("get_completed_cues_for_event",{p_event_id:n});if(a)throw a;return r}catch(r){return console.error("❌ Error getting completed cues:",r),null}}static async markCueCompleted(n,r,a,i,h,d){try{if(!Re||!ae)return console.warn("⚠️ Supabase client not initialized, skipping mark cue completed"),!1;console.log("🟣 Calling mark_cue_completed RPC with:",{p_event_id:n,p_item_id:r,p_user_id:i});const{data:p,error:x}=await ae.from("completed_cues").insert({event_id:n,item_id:r,user_id:i,cue_id:a,user_name:h,user_role:d,completed_at:new Date().toISOString()});if(x)throw console.error("❌ Insert error:",x),console.error("❌ Error details:",x.message,x.details,x.hint),x;return console.log("✅ Cue marked as completed successfully:",{eventId:n,itemId:r,data:p}),!0}catch(p){return console.error("❌ Error marking cue as completed:",p),!1}}static async unmarkCueCompleted(n,r){try{if(!Re||!ae)return console.warn("⚠️ Supabase client not initialized, skipping unmark cue completed"),!1;const{data:a,error:i}=await ae.rpc("unmark_cue_completed",{p_event_id:n,p_item_id:r});if(i)throw i;return console.log("✅ Cue unmarked as completed:",{eventId:n,itemId:r}),!0}catch(a){return console.error("❌ Error unmarking cue as completed:",a),!1}}static async clearCompletedCues(n){try{if(!Re||!ae)return console.warn("⚠️ Supabase client not initialized, skipping clear completed cues"),!1;const{data:r,error:a}=await ae.rpc("clear_completed_cues_for_event",{p_event_id:n});if(a)throw a;return console.log("✅ Cleared all completed cues for event:",n),!0}catch(r){return console.error("❌ Error clearing completed cues:",r),!1}}static subscribeToTableChanges(n,r,a){try{if(!Re||!ae)return console.error("❌ Supabase client not initialized"),null;const i=a?`event_id=eq.${a}`:void 0;return ae.channel(`${n}_changes`).on("postgres_changes",{event:"*",schema:"public",table:n,filter:i},r).subscribe()}catch(i){return console.error(`❌ Error setting up ${n} subscription:`,i),null}}static async updateLastLoadedCue(n,r,a){try{if(!Re||!ae)return console.warn("⚠️ Supabase client not initialized, skipping update last loaded CUE"),{data:null,error:null};const{data:i,error:h}=await ae.rpc("update_last_loaded_cue",{p_event_id:n,p_cue_id:r,p_state:a});return h?(console.error("❌ Error updating last loaded CUE:",h),{data:null,error:h}):{data:i,error:null}}catch(i){return console.error("❌ Error updating last loaded CUE:",i),{data:null,error:i}}}static async getLastLoadedCue(n){try{if(!Re||!ae)return console.warn("⚠️ Supabase client not initialized, skipping get last loaded CUE"),{data:null,error:null};const{data:r,error:a}=await ae.rpc("get_last_loaded_cue",{p_event_id:n});return a?(console.error("❌ Error getting last loaded CUE:",a),{data:null,error:a}):{data:r,error:null}}catch(r){return console.error("❌ Error getting last loaded CUE:",r),{data:null,error:r}}}static async saveTimerMessage(n){try{console.log("🔄 Saving timer message to Supabase:",n);const{data:r,error:a}=await ae.from("timer_messages").insert([n]).select().single();return a?(console.error("Error saving timer message:",a),this.saveTimerMessageToLocalStorage(n)):(console.log("✅ Timer message saved to Supabase:",r),r)}catch(r){return console.error("❌ Error saving timer message:",r),this.saveTimerMessageToLocalStorage(n)}}static async getTimerMessage(n){try{const{data:r,error:a}=await ae.rpc("get_latest_timer_message",{p_event_id:n});return a?(console.error("Error loading timer message:",a),this.getTimerMessageFromLocalStorage(n)):r?.[0]||null}catch(r){return console.error("❌ Error loading timer message:",r),this.getTimerMessageFromLocalStorage(n)}}static async updateTimerMessage(n,r){try{const{error:a}=await ae.from("timer_messages").update(r).eq("id",n);return a?(console.error("Error updating timer message:",a),this.updateTimerMessageInLocalStorage(n,r)):!0}catch(a){return console.error("❌ Error updating timer message:",a),this.updateTimerMessageInLocalStorage(n,r)}}static async disableTimerMessage(n){return this.updateTimerMessage(n,{enabled:!1})}static async getTimerMessagesForEvent(n){try{const{data:r,error:a}=await ae.from("timer_messages").select("*").eq("event_id",n).order("created_at",{ascending:!1});return a?(console.error("Error loading timer messages:",a),this.getTimerMessagesFromLocalStorage().filter(i=>i.event_id===n)):r||[]}catch(r){return console.error("❌ Error loading timer messages:",r),this.getTimerMessagesFromLocalStorage().filter(a=>a.event_id===n)}}static saveTimerMessageToLocalStorage(n){const r=this.getTimerMessagesFromLocalStorage(),a={...n,id:`local_${Date.now()}`,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return r.push(a),localStorage.setItem("timer_messages",JSON.stringify(r)),a}static getTimerMessagesFromLocalStorage(){try{const n=localStorage.getItem("timer_messages");return n?JSON.parse(n):[]}catch(n){return console.error("Error loading timer messages from localStorage:",n),[]}}static getTimerMessageFromLocalStorage(n){return this.getTimerMessagesFromLocalStorage().find(a=>a.event_id===n&&a.enabled)||null}static updateTimerMessageInLocalStorage(n,r){try{const a=this.getTimerMessagesFromLocalStorage(),i=a.findIndex(h=>h.id===n);return i!==-1?(a[i]={...a[i],...r,updated_at:new Date().toISOString()},localStorage.setItem("timer_messages",JSON.stringify(a)),!0):!1}catch(a){return console.error("Error updating timer message in localStorage:",a),!1}}}const cm=({isOpen:u,onClose:n,onRoleSelected:r,eventId:a})=>{const{user:i}=oo(),[h,d]=_.useState("VIEWER"),[p,x]=_.useState(!1);_.useEffect(()=>{if(u&&i?.id&&a){const N=localStorage.getItem(`user_role_${a}_${i.id}`);N&&["VIEWER","EDITOR","OPERATOR"].includes(N)&&d(N)}},[u,i?.id,a]);const y=[{value:"VIEWER",label:"Viewer (Read Only)",description:"Can view but cannot edit any content",icon:"👁️"},{value:"OPERATOR",label:"Operator (Limited Edit)",description:"Can control timers and view data",icon:"🎮"},{value:"EDITOR",label:"Editor (Full Access)",description:"Can edit all content and settings",icon:"✏️"}],S=async()=>{if(!(!i||!a)){x(!0);try{await ye.saveUserSession(a,i.id,i.user_metadata?.full_name||i.email||"Unknown",h)?(r(h),n()):alert("Failed to save user session. Please try again.")}catch(N){console.error("Error saving user session:",N),alert("Error saving user session. Please try again.")}finally{x(!1)}}};return u?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[9999] p-4",children:s.jsxs("div",{className:"bg-slate-800 p-8 rounded-xl shadow-2xl max-w-2xl w-full",children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"Select Your Role"}),s.jsxs("p",{className:"text-slate-300 text-lg",children:["Welcome, ",i?.user_metadata?.full_name||i?.email,"! Please select your role for this session."]})]}),s.jsx("div",{className:"space-y-4 mb-8",children:y.map(N=>s.jsxs("label",{className:`flex items-start gap-4 cursor-pointer p-4 rounded-lg border-2 transition-colors ${h===N.value?"border-blue-500 bg-blue-900/20":"border-slate-600 hover:border-blue-400"}`,children:[s.jsx("input",{type:"radio",name:"role",value:N.value,checked:h===N.value,onChange:R=>d(R.target.value),className:"w-5 h-5 text-blue-600 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("span",{className:"text-2xl",children:N.icon}),s.jsx("span",{className:"text-white font-bold text-lg",children:N.label})]}),s.jsx("p",{className:"text-slate-300 text-sm",children:N.description})]})]},N.value))}),s.jsxs("div",{className:"flex gap-4",children:[s.jsx("button",{onClick:S,disabled:p,className:"flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-500 disabled:bg-slate-600 disabled:cursor-not-allowed text-white font-semibold rounded-lg transition-colors",children:p?"Loading...":"Continue with Selected Role"}),s.jsx("button",{onClick:n,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white font-semibold rounded-lg transition-colors",children:"Cancel"})]}),s.jsx("div",{className:"mt-4 p-3 bg-blue-900 rounded-lg",children:s.jsxs("p",{className:"text-blue-200 text-sm",children:[s.jsx("strong",{children:"Note:"})," You can change your role later from your profile menu."]})})]})}):null},Fv=()=>{const u=ea(),{user:n}=oo(),[r,a]=_.useState([]),[i,h]=_.useState("upcoming"),[d,p]=_.useState(!1),[x,y]=_.useState("all"),[S,N]=_.useState("all"),[R,A]=_.useState(""),[U,$]=_.useState(null),[O,J]=_.useState({name:"",date:"",location:"Great Hall",numberOfDays:1}),[X,q]=_.useState({name:"",date:"",location:"Great Hall",numberOfDays:1}),[K,Y]=_.useState(!1),[P,B]=_.useState(null);_.useEffect(()=>{ne()},[]);const ne=async()=>{try{console.log("🔄 Loading events from Supabase...");const D=await ye.getCalendarEvents();if(D&&D.length>0){const V=D.map(E=>({id:E.id||Date.now().toString(),name:E.name,date:E.date,location:E.schedule_data?.location||"Great Hall",numberOfDays:E.schedule_data?.numberOfDays||1,created_at:E.created_at||new Date().toISOString(),updated_at:E.updated_at||new Date().toISOString()}));a(V),console.log("✅ Loaded events from Supabase:",V.length)}else{console.log("ℹ️ No events found in Supabase, trying localStorage...");const V=localStorage.getItem("events");if(V)try{const E=JSON.parse(V);a(E),console.log("Loaded events from localStorage:",E.length)}catch(E){console.error("Error loading events from localStorage:",E)}}}catch(D){console.error("Error loading events from Supabase:",D);const V=localStorage.getItem("events");if(V)try{const E=JSON.parse(V);a(E)}catch(E){console.error("Error loading events from localStorage:",E)}}};_.useEffect(()=>{localStorage.setItem("events",JSON.stringify(r))},[r]);const T=async()=>{if(!X.name||!X.date||!X.location){alert("Please fill in all fields");return}const V={id:`event-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:X.name,date:X.date,location:X.location,numberOfDays:X.numberOfDays,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};p(!1),q({name:"",date:"",location:"Great Hall",numberOfDays:1}),a(E=>[...E,V]);try{const E={name:V.name,date:V.date,schedule_data:{location:V.location,numberOfDays:V.numberOfDays,eventId:V.id}};await ye.saveCalendarEvent(E),console.log("Calendar event saved to Supabase with ID:",V.id),await ye.saveRunOfShowData({event_id:V.id,event_name:V.name,event_date:V.date,schedule_items:[],custom_columns:[],settings:{eventName:V.name,masterStartTime:"",lastSaved:new Date().toISOString()}},{userId:n?.id||"unknown",userName:n?.user_metadata?.full_name||n?.email||"Unknown User",userRole:"EDITOR"}),console.log("Run of Show data created in Supabase with ID:",V.id)}catch(E){console.error("Error auto-saving event to Supabase:",E)}},re=async()=>{if(!U||!O.name||!O.date||!O.location){alert("Please fill in all fields");return}const D={...U,name:O.name,date:O.date,location:O.location,numberOfDays:O.numberOfDays,updated_at:new Date().toISOString()};$(null),J({name:"",date:"",location:"Great Hall",numberOfDays:1}),a(V=>V.map(E=>E.id===U.id?D:E));try{const E=(await ye.getCalendarEvents()).find(F=>F.schedule_data?.eventId===U.id||F.name===U.name);if(E?.id){const F={name:D.name,date:D.date,schedule_data:{location:D.location,numberOfDays:D.numberOfDays,eventId:D.id}};await ye.updateCalendarEvent(E.id,F),console.log("Calendar event updated in Supabase")}await ye.updateRunOfShowData(U.id,{event_name:D.name,event_date:D.date,settings:{eventName:D.name,lastSaved:new Date().toISOString()}}),console.log("Run of Show data updated in Supabase")}catch(V){console.error("Error auto-updating event in Supabase:",V)}},de=async D=>{if(window.confirm("Are you sure you want to delete this event?")){a(V=>V.filter(E=>E.id!==D));try{const V=r.find(E=>E.id===D);if(V){await ye.deleteRunOfShowData(D),console.log("Run of Show data deleted from Supabase automatically");const F=(await ye.getCalendarEvents()).find(ee=>ee.schedule_data?.eventId===D||ee.name===V.name);F?.id&&(await ye.deleteCalendarEvent(F.id),console.log("Calendar event deleted from Supabase automatically"))}}catch(V){console.error("Error auto-deleting event from Supabase:",V)}}},Ne=D=>{$(D),J({name:D.name,date:D.date,location:D.location,numberOfDays:D.numberOfDays})},fe=D=>{B(D),Y(!0)},me=async D=>{if(P&&n?.id){try{const V=n.user_metadata?.full_name||n.email||"Unknown";await ye.saveUserSession(P.id,n.id,V,D),console.log("✅ Role saved to Supabase from EventListPage:",D)}catch(V){console.error("❌ Failed to save role to Supabase from EventListPage:",V)}u("/run-of-show",{state:{event:P,userRole:D}}),Y(!1),B(null)}},ve=D=>{const V=Nl.find(E=>E.value===D);return V?V.color:"bg-gray-600"},Ve=D=>new Date(D).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),z=(()=>{const D=new Date;return r.filter(V=>{const E=new Date(V.date),F=i==="upcoming"?E>=D:E<D,ee=x==="all"||V.location===x,ce=S==="all"||V.numberOfDays.toString()===S,$e=R===""||V.name.toLowerCase().includes(R.toLowerCase())||V.location.toLowerCase().includes(R.toLowerCase());return F&&ee&&ce&&$e}).sort((V,E)=>{const F=new Date(V.date),ee=new Date(E.date);return i==="upcoming"?F.getTime()-ee.getTime():ee.getTime()-F.getTime()})})();return s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-slate-200 pt-16",children:[s.jsxs("div",{className:"text-center py-8",children:[s.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"📅 Event List Calendar"}),s.jsx("p",{className:"text-xl text-slate-400 mb-4",children:"Manage your events and schedules"}),n&&s.jsx("div",{className:"text-center mb-6",children:s.jsxs("p",{className:"text-white font-medium text-lg",children:["Welcome back, ",n.user_metadata?.full_name||n.email,"!"]})})]}),s.jsxs("div",{className:"max-w-6xl mx-auto px-6",children:[s.jsx("div",{className:"flex justify-center mb-8",children:s.jsxs("div",{className:"bg-slate-800 rounded-lg p-1 flex",children:[s.jsx("button",{onClick:()=>h("upcoming"),className:`px-6 py-3 rounded-md font-semibold transition-colors ${i==="upcoming"?"bg-green-600 text-white":"text-slate-400 hover:text-white"}`,children:"📅 Upcoming Events"}),s.jsx("button",{onClick:()=>h("past"),className:`px-6 py-3 rounded-md font-semibold transition-colors ${i==="past"?"bg-orange-600 text-white":"text-slate-400 hover:text-white"}`,children:"📋 Past Events"})]})}),s.jsx("div",{className:"flex justify-center mb-6",children:s.jsx("div",{className:"bg-slate-800 rounded-lg p-4 w-full max-w-4xl",children:s.jsxs("div",{className:"flex items-center gap-6",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-white font-semibold",children:"🔍 Search:"}),s.jsx("input",{type:"text",value:R,onChange:D=>A(D.target.value),placeholder:"Search events by name or location...",className:"w-80 px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:border-blue-500 focus:outline-none text-sm"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-white font-semibold",children:"📍 Filter by location:"}),s.jsxs("select",{value:x,onChange:D=>y(D.target.value),className:"px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:border-blue-500 focus:outline-none text-sm",children:[s.jsx("option",{value:"all",children:"All Locations"}),Nl.map(D=>s.jsx("option",{value:D.value,children:D.label},D.value))]})]})]})})}),s.jsx("div",{className:"flex justify-center mb-8",children:s.jsx("button",{onClick:()=>p(!0),className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors",children:"+ Add New Event"})}),s.jsx("div",{className:"bg-slate-800 rounded-xl p-6 shadow-2xl",children:s.jsx("div",{className:"bg-slate-800 rounded-lg overflow-hidden border border-slate-600",children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-slate-700",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left text-slate-300 font-semibold border-r border-slate-600",children:"Event Name"}),s.jsx("th",{className:"px-4 py-3 text-left text-slate-300 font-semibold border-r border-slate-600",children:"Date"}),s.jsx("th",{className:"px-4 py-3 text-left text-slate-300 font-semibold border-r border-slate-600",children:"Location"}),s.jsx("th",{className:"px-4 py-3 text-left text-slate-300 font-semibold border-r border-slate-600",children:"Duration"}),s.jsx("th",{className:"px-4 py-3 text-center text-slate-300 font-semibold",children:"Actions"})]})}),s.jsx("tbody",{children:z.length===0?s.jsx("tr",{children:s.jsxs("td",{colSpan:5,className:"px-4 py-12 text-center",children:[s.jsx("div",{className:"text-6xl mb-4",children:i==="upcoming"?"📅":"📋"}),s.jsxs("h3",{className:"text-2xl font-bold text-white mb-2",children:["No ",i," events"]}),s.jsx("p",{className:"text-slate-400",children:i==="upcoming"?"Add your first upcoming event to get started!":"Past events will appear here once you have some."})]})}):z.map(D=>s.jsxs("tr",{className:"border-b border-slate-600",children:[s.jsx("td",{className:"px-4 py-3 text-white font-medium border-r border-slate-600",children:D.name}),s.jsx("td",{className:"px-4 py-3 text-slate-300 border-r border-slate-600",children:Ve(D.date)}),s.jsx("td",{className:"px-4 py-3 border-r border-slate-600",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`w-3 h-3 rounded-full ${ve(D.location)}`}),s.jsx("span",{className:"text-slate-300",children:D.location})]})}),s.jsxs("td",{className:"px-4 py-3 text-slate-300 border-r border-slate-600",children:[D.numberOfDays," day",D.numberOfDays>1?"s":""]}),s.jsx("td",{className:"px-4 py-3",children:s.jsxs("div",{className:"flex gap-2 justify-center",children:[s.jsx("button",{onClick:()=>fe(D),className:"px-3 py-1 bg-blue-600 hover:bg-blue-500 text-white text-sm font-medium rounded transition-colors",children:"Launch"}),s.jsx("button",{onClick:()=>Ne(D),className:"px-3 py-1 bg-green-600 hover:bg-green-500 text-white text-sm font-medium rounded transition-colors",children:"Edit"}),s.jsx("button",{onClick:()=>de(D.id),className:"px-3 py-1 bg-red-600 hover:bg-red-500 text-white text-sm font-medium rounded transition-colors",children:"Delete"})]})})]},D.id))})]})})})})]}),d&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-slate-800 rounded-lg p-4 max-w-sm w-full",children:[s.jsxs("h2",{className:"text-lg font-bold text-white mb-4",children:[s.jsx("span",{style:{filter:"brightness(0) invert(1)"},children:"📅"})," Add New Event"]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Event Name"}),s.jsx("input",{type:"text",value:X.name,onChange:D=>q(V=>({...V,name:D.target.value})),placeholder:"Enter event name",className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:border-blue-500 focus:outline-none text-sm"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Date"}),s.jsx("input",{type:"date",value:X.date,onChange:D=>q(V=>({...V,date:D.target.value})),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:border-blue-500 focus:outline-none text-sm",style:{colorScheme:"dark"}})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Location"}),s.jsx("select",{value:X.location,onChange:D=>q(V=>({...V,location:D.target.value})),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:border-blue-500 focus:outline-none text-sm",children:Nl.map(D=>s.jsx("option",{value:D.value,children:D.label},D.value))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Duration"}),s.jsx("select",{value:X.numberOfDays,onChange:D=>q(V=>({...V,numberOfDays:parseInt(D.target.value)})),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:border-blue-500 focus:outline-none text-sm",children:kf.map(D=>s.jsxs("option",{value:D,children:[D," day",D>1?"s":""]},D))})]})]}),s.jsxs("div",{className:"flex gap-2 mt-4",children:[s.jsx("button",{onClick:()=>{p(!1),q({name:"",date:"",location:"Great Hall",numberOfDays:1})},className:"flex-1 px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded text-sm font-medium",children:"Cancel"}),s.jsx("button",{onClick:T,className:"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded text-sm font-medium",children:"Add Event"})]})]})}),U&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-slate-800 rounded-lg p-4 max-w-sm w-full",children:[s.jsxs("h2",{className:"text-lg font-bold text-white mb-4",children:[s.jsx("span",{style:{filter:"brightness(0) invert(1)"},children:"✏️"})," Edit Event"]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Event Name"}),s.jsx("input",{type:"text",value:O.name,onChange:D=>J(V=>({...V,name:D.target.value})),placeholder:"Enter event name",className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:border-blue-500 focus:outline-none text-sm"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Date"}),s.jsx("input",{type:"date",value:O.date,onChange:D=>J(V=>({...V,date:D.target.value})),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:border-blue-500 focus:outline-none text-sm",style:{colorScheme:"dark"}})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Location"}),s.jsx("select",{value:O.location,onChange:D=>J(V=>({...V,location:D.target.value})),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:border-blue-500 focus:outline-none text-sm",children:Nl.map(D=>s.jsx("option",{value:D.value,children:D.label},D.value))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Duration"}),s.jsx("select",{value:O.numberOfDays,onChange:D=>J(V=>({...V,numberOfDays:parseInt(D.target.value)})),className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:border-blue-500 focus:outline-none text-sm",children:kf.map(D=>s.jsxs("option",{value:D,children:[D," day",D>1?"s":""]},D))})]})]}),s.jsxs("div",{className:"flex gap-2 mt-4",children:[s.jsx("button",{onClick:()=>{$(null),J({name:"",date:"",location:"Great Hall",numberOfDays:1})},className:"flex-1 px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded text-sm font-medium",children:"Cancel"}),s.jsx("button",{onClick:re,className:"flex-1 px-3 py-2 bg-green-600 hover:bg-green-500 text-white rounded text-sm font-medium",children:"Update Event"})]})]})}),s.jsx(cm,{isOpen:K,onClose:()=>{Y(!1),B(null)},onRoleSelected:me,eventId:P?.id||""})]})};class Vv{constructor(){this.localChanges=[],this.syncTimer=null,this.SYNC_DELAY=5e3,this.MAX_BATCH_SIZE=10,this.MAX_SYNC_ATTEMPTS=3,this.loadLocalChanges(),this.startSyncTimer()}addChange(n){const r={...n,id:`change_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date,synced:!1};this.localChanges.push(r),this.saveLocalChanges(),console.log("📝 Change added to local buffer:",r.description),this.localChanges.filter(a=>!a.synced).length>=this.MAX_BATCH_SIZE&&this.syncChanges()}getLocalChanges(){return[...this.localChanges]}getUnsyncedChanges(){return this.localChanges.filter(n=>!n.synced)}getChangesCount(){const n=this.localChanges.length,r=this.localChanges.filter(a=>!a.synced).length;return{total:n,unsynced:r}}reloadLocalChanges(){this.loadLocalChanges(),console.log("🔄 Reloaded local changes:",this.localChanges.length)}startSyncTimer(){this.syncTimer&&clearInterval(this.syncTimer),this.syncTimer=setInterval(()=>{const n=this.getUnsyncedChanges();n.length>0&&(console.log(`🔄 Auto-syncing ${n.length} changes...`),this.syncChanges())},this.SYNC_DELAY)}stopSyncTimer(){this.syncTimer&&(clearInterval(this.syncTimer),this.syncTimer=null)}async syncChanges(){const n=this.getUnsyncedChanges();if(n.length===0)return!0;console.log(`🔄 Syncing ${n.length} changes to Supabase...`);try{const r=this.groupChangesByEvent(n);for(const[a,i]of r)await this.syncEventChanges(a,i);return this.localChanges=this.localChanges.map(a=>({...a,synced:!0})),this.saveLocalChanges(),console.log("✅ All changes synced successfully"),!0}catch(r){return console.error("❌ Error syncing changes:",r),!1}}groupChangesByEvent(n){const r=new Map;for(const a of n)r.has(a.eventId)||r.set(a.eventId,[]),r.get(a.eventId).push(a);return r}async syncEventChanges(n,r){console.log(`📤 Syncing ${r.length} changes for event ${n}`);const a={event_id:n,changes:r.map(h=>({id:h.id,timestamp:h.timestamp.toISOString(),user_id:h.userId,user_name:h.userName,user_role:h.userRole,action:h.action,description:h.description,details:h.details,row_number:h.rowNumber,cue_number:h.cueNumber,segment_name:h.segmentName})),created_at:new Date().toISOString(),synced:!0},{error:i}=await ae.from("change_log_batches").insert([a]);if(i)throw new Error(`Failed to sync batch: ${i.message}`);for(const h of r)await ye.logChange(h.eventId,h.userId,h.userName,h.userRole,h.action,"schedule_items",h.details?.itemId,h.details?.fieldName,h.details?.oldValue,h.details?.newValue,h.description,h.rowNumber,h.cueNumber,h.details)}loadLocalChanges(){try{const n=localStorage.getItem("runofshow_local_changes");if(n){const r=JSON.parse(n);this.localChanges=r.map(a=>({...a,timestamp:new Date(a.timestamp)})),console.log(`📂 Loaded ${this.localChanges.length} local changes from localStorage`)}else console.log("📂 No local changes found in localStorage"),this.localChanges=[]}catch(n){console.error("Error loading local changes:",n),this.localChanges=[]}}saveLocalChanges(){try{localStorage.setItem("runofshow_local_changes",JSON.stringify(this.localChanges))}catch(n){console.error("Error saving local changes:",n)}}clearLocalChanges(){this.localChanges=[],this.saveLocalChanges(),console.log("🗑️ Local changes cleared")}async clearMasterChangeLog(n){try{console.log("🗑️ Clearing master change log for event:",n);let r=0,a=[];const{data:{user:i},error:h}=await ae.auth.getUser();if(console.log("🔄 Authenticated user:",i?.id,i?.email),h||!i)return console.error("❌ Authentication error:",h),{success:!1,error:"Not authenticated",deletedCount:0};console.log("🔄 Attempting to delete from change_log_batches table...");try{const{data:S,error:N}=await ae.from("change_log_batches").select("id").eq("event_id",n);if(N)console.log("⚠️ Cannot access change_log_batches table:",N.message),a.push(`change_log_batches: ${N.message}`);else if(console.log(`📊 Found ${S?.length||0} batches to delete`),S&&S.length>0){const{data:R,error:A}=await ae.from("change_log_batches").delete().eq("event_id",n).select("id");if(A)console.error("❌ Error deleting from change_log_batches:",A),a.push(`change_log_batches delete: ${A.message}`);else{const U=R?.length||0;console.log(`✅ Deleted ${U} batch records`),r+=U}}}catch(S){console.log("⚠️ change_log_batches table not accessible:",S),a.push(`change_log_batches: ${S.message}`)}console.log("🔄 Deleting from change_log table...");const{data:d,error:p}=await ae.from("change_log").select("id").eq("event_id",n);if(p)console.error("❌ Error checking change_log records:",p),a.push(`change_log check: ${p.message}`);else if(console.log(`📊 Found ${d?.length||0} log records to delete`),d&&d.length>0){const{data:S,error:N}=await ae.from("change_log").delete().eq("event_id",n).select("id");if(N)console.error("❌ Error deleting from change_log:",N),a.push(`change_log delete: ${N.message}`);else{const R=S?.length||0;console.log(`✅ Deleted ${R} log records`),r+=R}}const x=a.length===0||r>0,y=a.length>0?a.join("; "):void 0;return console.log(x?`✅ Master change log cleared: ${r} total records deleted`:`⚠️ Master change log clearing failed: ${y}`),{success:x,error:y,deletedCount:r}}catch(r){return console.error("❌ Unexpected error clearing master change log:",r),{success:!1,error:r.message||"Unexpected error",deletedCount:0}}}async getMasterChangeLog(n,r=100){try{console.log("🔄 Fetching master change log from Supabase for event:",n);const{data:a,error:i}=await ae.from("change_log_batches").select("*").eq("event_id",n).order("created_at",{ascending:!1}).limit(r);if(i){console.error("❌ Error fetching change batches:",i),console.log("🔄 Falling back to regular change_log table...");const{data:p,error:x}=await ae.from("change_log").select("*").eq("event_id",n).order("created_at",{ascending:!1}).limit(r);return x?(console.error("❌ Error fetching regular change log:",x),[]):(console.log("📊 Loaded regular change log:",p?.length||0,"changes"),p||[])}console.log("📊 Loaded change batches:",a?.length||0,"batches");const h=[];for(const p of a||[])if(p.changes&&Array.isArray(p.changes))for(const x of p.changes)h.push({...x,batch_id:p.id,batch_created_at:p.created_at});console.log("📊 Flattened changes from batches:",h.length,"changes");const d=h.sort((p,x)=>new Date(x.timestamp).getTime()-new Date(p.timestamp).getTime()).slice(0,r);return console.log("📊 Final sorted changes:",d.length,"changes"),d}catch(a){return console.error("❌ Error getting master change log:",a),[]}}exportChangesAsJSON(){return JSON.stringify(this.localChanges,null,2)}exportChangesAsCSV(){if(this.localChanges.length===0)return"No changes to export";const n=["Timestamp","User","Role","Action","Description","Row","Cue","Segment","Synced"],r=this.localChanges.map(a=>[a.timestamp.toISOString(),a.userName,a.userRole,a.action,a.description,a.rowNumber||"",a.cueNumber||"",a.segmentName||"",a.synced?"Yes":"No"]);return[n,...r].map(a=>a.join(",")).join(`
`)}}const Ct=new Vv;window.addEventListener("beforeunload",()=>{Ct.stopSyncTimer()});class to{static async testBackupTable(){try{console.log("🔄 Testing backup table access...");const{data:n,error:r}=await ae.from("run_of_show_backups").select("id").limit(1);return r?(console.error("❌ Backup table test failed:",r),!1):(console.log("✅ Backup table is accessible"),!0)}catch(n){return console.error("❌ Backup table test error:",n),!1}}static async createBackup(n,r,a,i,h="auto",d){try{console.log(`🔄 Creating/updating ${h} backup for event: ${n}`);const{data:{user:p}}=await ae.auth.getUser();if(!p)throw new Error("User not authenticated");const x=i?.name||"Unknown Event",y=i?.date?new Date(i.date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],S=i?.location||null,N=new Date().toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),R=d||`${h==="auto"?"Auto Backup":"Manual Backup"} - ${N}`,{data:A,error:U}=await ae.from("run_of_show_backups").select("*").eq("event_id",n).eq("event_date",y).single();if(U&&U.code!=="PGRST116")throw U;let $;if(A){console.log(`🔄 Updating existing backup for ${x} on ${y}`);const{data:O,error:J}=await ae.from("run_of_show_backups").update({backup_name:R,schedule_data:r,custom_columns_data:a,event_data:i,backup_type:h,event_name:x,event_location:S,schedule_items_count:r?.length||0,custom_columns_count:a?.length||0,updated_at:new Date().toISOString()}).eq("id",A.id).select().single();if(J)throw J;$=O,console.log(`✅ Backup updated successfully: ${O.backup_name}`)}else{console.log(`🔄 Creating new backup for ${x} on ${y}`);const{data:O,error:J}=await ae.from("run_of_show_backups").insert({event_id:n,backup_name:R,schedule_data:r,custom_columns_data:a,event_data:i,backup_type:h,event_name:x,event_date:y,event_location:S,schedule_items_count:r?.length||0,custom_columns_count:a?.length||0,created_by:p.id}).select().single();if(J)throw J;$=O,console.log(`✅ Backup created successfully: ${O.backup_name}`)}return $}catch(p){throw console.error("❌ Error creating/updating backup:",p),new Error(`Failed to create/update backup: ${p.message}`)}}static async getBackupsForEvent(n){try{console.log(`🔄 Fetching backups for event: ${n}`),console.log("🔄 Supabase client status:",ae?"Connected":"Not connected");const{data:r,error:a}=await ae.from("run_of_show_backups").select("*").eq("event_id",n).order("backup_timestamp",{ascending:!1});if(console.log("🔄 Supabase query result:",{data:r,error:a}),a)throw console.error("❌ Supabase error details:",{code:a.code,message:a.message,details:a.details,hint:a.hint}),a;return console.log(`✅ Found ${r?.length||0} backups for event: ${n}`),console.log("📊 Backup data:",r),r||[]}catch(r){throw console.error("❌ Error fetching backups:",r),console.error("❌ Error type:",typeof r),console.error("❌ Error message:",r.message),new Error(`Failed to fetch backups: ${r.message}`)}}static async getBackupsWithFilters(n={}){try{console.log("🔄 Fetching backups with filters:",n);let r=ae.from("run_of_show_backups").select("*");switch(n.eventId&&(r=r.eq("event_id",n.eventId)),n.eventName&&(r=r.ilike("event_name",`%${n.eventName}%`)),n.eventDate&&(r=r.eq("event_date",n.eventDate)),n.backupType&&(r=r.eq("backup_type",n.backupType)),n.sortBy){case"oldest":r=r.order("backup_timestamp",{ascending:!0});break;case"event":r=r.order("event_name",{ascending:!0});break;case"type":r=r.order("backup_type",{ascending:!0});break;case"newest":default:r=r.order("backup_timestamp",{ascending:!1});break}n.limit&&(r=r.limit(n.limit));const{data:a,error:i}=await r;if(i)throw i;return console.log(`✅ Found ${a?.length||0} backups with filters`),a||[]}catch(r){throw console.error("❌ Error fetching backups with filters:",r),new Error(`Failed to fetch backups: ${r.message}`)}}static async restoreFromBackup(n){try{console.log(`🔄 Restoring from backup: ${n}`);const{data:r,error:a}=await ae.from("run_of_show_backups").select("*").eq("id",n).single();if(a)throw a;if(!r)throw new Error("Backup not found");return console.log(`✅ Restored from backup: ${r.backup_name}`),{scheduleData:r.schedule_data||[],customColumnsData:r.custom_columns_data||[],eventData:r.event_data||{},backupName:r.backup_name,backupTimestamp:r.backup_timestamp}}catch(r){throw console.error("❌ Error restoring from backup:",r),new Error(`Failed to restore from backup: ${r.message}`)}}static async deleteBackup(n){try{console.log(`🔄 Deleting backup: ${n}`);const{error:r}=await ae.from("run_of_show_backups").delete().eq("id",n);if(r)throw r;return console.log(`✅ Backup deleted successfully: ${n}`),!0}catch(r){throw console.error("❌ Error deleting backup:",r),new Error(`Failed to delete backup: ${r.message}`)}}static async getBackupStats(n){try{const r=await this.getBackupsForEvent(n),a=r.filter(d=>d.backup_type==="auto").length,i=r.filter(d=>d.backup_type==="manual").length,h=r.length>0?r[0].backup_timestamp:null;return{totalBackups:r.length,lastBackup:h,autoBackups:a,manualBackups:i}}catch(r){throw console.error("❌ Error getting backup stats:",r),new Error(`Failed to get backup stats: ${r.message}`)}}}class Bv{constructor(n){this.activeTimers=new Map,this.checkInterval=null,this.syncCallbacks=new Map,this.isRunning=!1,this.config={checkInterval:3e4,maxDriftThreshold:5,forceSyncInterval:3e4,minTimerDuration:0,...n}}startMonitoring(n,r,a,i){if(console.log(`🔄 DriftDetector: Starting monitoring for timer ${n}`,{startedAt:r.toISOString(),duration:a,minDuration:this.config.minTimerDuration}),a<this.config.minTimerDuration){console.log(`⏭️ DriftDetector: Skipping timer ${n} - duration too short (${a}s < ${this.config.minTimerDuration}s)`);return}const h={itemId:n,startedAt:r,duration:a,lastSyncAt:new Date,localElapsed:0,serverElapsed:0};this.activeTimers.set(n,h),this.syncCallbacks.set(n,i),this.isRunning||this.startMonitoringLoop()}stopMonitoring(n){console.log(`🔄 DriftDetector: Stopping monitoring for timer ${n}`),this.activeTimers.delete(n),this.syncCallbacks.delete(n),this.activeTimers.size===0&&this.isRunning&&this.stopMonitoringLoop()}updateLocalElapsed(n,r){const a=this.activeTimers.get(n);a&&(a.localElapsed=r)}async forceSync(n,r){const a=this.activeTimers.get(n);if(a)try{const i=await r(),h=Math.abs(i-a.localElapsed);console.log(`🔄 DriftDetector: Force sync for timer ${n}`,{localElapsed:a.localElapsed,serverElapsed:i,drift:h.toFixed(2)}),a.serverElapsed=i,a.lastSyncAt=new Date;const d=this.syncCallbacks.get(n);d&&d(i)}catch(i){console.error(`❌ DriftDetector: Error during force sync for timer ${n}:`,i)}}startMonitoringLoop(){this.isRunning||(console.log("🔄 DriftDetector: Starting monitoring loop"),this.isRunning=!0,this.checkInterval=setInterval(()=>{this.checkAllTimers()},this.config.checkInterval))}stopMonitoringLoop(){this.isRunning&&(console.log("🔄 DriftDetector: Stopping monitoring loop"),this.isRunning=!1,this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null))}async checkAllTimers(){const n=new Date,r=[];for(const[a,i]of this.activeTimers)r.push(this.checkTimerDrift(a,i,n));await Promise.all(r)}async checkTimerDrift(n,r,a){try{const i=a.getTime()-r.lastSyncAt.getTime();if(i>=this.config.forceSyncInterval){console.log(`🔄 DriftDetector: Force sync needed for timer ${n} (${i}ms since last sync)`);return}const d=Math.floor((a.getTime()-r.startedAt.getTime())/1e3),p=Math.abs(d-r.localElapsed);p>this.config.maxDriftThreshold&&console.log(`⚠️ DriftDetector: Significant drift detected for timer ${n}`,{localElapsed:r.localElapsed,expectedElapsed:d,drift:p.toFixed(2),threshold:this.config.maxDriftThreshold})}catch(i){console.error(`❌ DriftDetector: Error checking drift for timer ${n}:`,i)}}getConfig(){return{...this.config}}updateConfig(n){this.config={...this.config,...n},console.log("🔄 DriftDetector: Configuration updated",this.config)}getStatus(){const n=new Date;return Array.from(this.activeTimers.entries()).map(([r,a])=>{const i=Math.abs(a.serverElapsed-a.localElapsed),h=n.getTime()-a.lastSyncAt.getTime();return{itemId:r,drift:i,timeSinceLastSync:h}})}getStatusForTimer(n){const r=this.activeTimers.get(n);if(!r)return{itemId:n,drift:0,timeSinceLastSync:0};const a=new Date,i=Math.abs(r.serverElapsed-r.localElapsed),h=a.getTime()-r.lastSyncAt.getTime();return{itemId:n,drift:i,timeSinceLastSync:h}}destroy(){console.log("🔄 DriftDetector: Destroying drift detector"),this.stopMonitoringLoop(),this.activeTimers.clear(),this.syncCallbacks.clear()}}const fn=new Bv,um=({itemId:u,className:n=""})=>{const[r,a]=_.useState(null);if(_.useEffect(()=>{console.log(`🔄 DriftStatusIndicator: Starting for itemId ${u}`);const x=()=>{const S=fn.getStatusForTimer(u);console.log(`🔄 DriftStatusIndicator: Status for itemId ${u}:`,S),S?(console.log(`🔄 DriftStatusIndicator: Found status for itemId ${u}:`,S),a({drift:S.drift,timeSinceLastSync:S.timeSinceLastSync})):(console.log(`🔄 DriftStatusIndicator: No status found for itemId ${u}`),a(null))};x();const y=setInterval(x,5e3);return()=>clearInterval(y)},[u]),!r)return console.log(`🔄 DriftStatusIndicator: No drift info for itemId ${u}, showing blue dot (starting up)`),s.jsx("div",{className:`drift-status ${n}`,children:s.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500",title:`Drift detection starting up for timer ${u}`})});const{drift:i,timeSinceLastSync:h}=r,d=i>5,p=h>6e4;return s.jsx("div",{className:`drift-status ${n}`,children:s.jsx("div",{className:`w-2 h-2 rounded-full ${d?"bg-red-500":p?"bg-yellow-500":"bg-green-500"}`,title:`Drift: ${i.toFixed(1)}s, Last sync: ${Math.round(h/1e3)}s ago`})})},zv=({isOpen:u,onClose:n,event:r,schedule:a,activeItemId:i,activeTimers:h,onLoadCue:d,onStartTimer:p,onStopTimer:x,onResetTimer:y})=>{const[S,N]=_.useState({isConnected:!1,serverPort:57121}),[R,A]=_.useState([]),[U,$]=_.useState(""),[O,J]=_.useState(""),[X,q]=_.useState(!0),[K,Y]=_.useState(null),P=_.useRef(null),B=()=>{P.current?.scrollIntoView({behavior:"smooth"})};_.useEffect(()=>{B()},[R]);const ne=(E,F)=>{if(console.log("🎯 Handling OSC response:",E,F),E==="/cue/loaded"&&F.length>=1){const ee=F[0];console.log("🎯 Cue loaded, finding item for cue ID:",ee);const ce=T(ee);ce&&d?(console.log("🎯 Found item for cue, calling onLoadCue:",ce.id),d(ce.id.toString())):console.log("❌ Could not find item for cue ID:",ee)}else if(E==="/timer/started")console.log("🎯 Generic timer started - controlling currently loaded cue"),p&&p("generic");else if(E==="/timer/stopped")console.log("🎯 Generic timer stopped - controlling currently loaded cue"),x&&x("generic");else if(E==="/timer/reset")console.log("🎯 Generic timer reset - using resetAllStates"),y&&y("generic");else if(E==="/subtimer/started"&&F.length>=1){const ee=F[0];console.log("🎯 Sub-timer started, finding item for sub-timer ID:",ee);const ce=re(ee);ce&&p?(console.log("🎯 Found item for sub-timer, calling onStartTimer:",ce.id),p(ce.id.toString())):console.log("❌ Could not find item for sub-timer ID:",ee)}else if(E==="/subtimer/stopped"&&F.length>=1){const ee=F[0];console.log("🎯 Sub-timer stopped, finding item for sub-timer ID:",ee);const ce=re(ee);ce&&x?(console.log("🎯 Found item for sub-timer, calling onStopTimer:",ce.id),x(ce.id.toString())):console.log("❌ Could not find item for sub-timer ID:",ee)}},T=E=>a.length?a.find(F=>{const ee=F.customFields?.cue||"";return ee===E||ee===`CUE ${E}`||ee===`CUE${E}`}):null,re=E=>a.length?a.find(F=>F.isIndented&&(F.timerId===E||F.id.toString()===E)):null;_.useEffect(()=>u?((()=>{try{const F=new WebSocket("ws://localhost:57121/osc");F.onopen=()=>{console.log("🔌 OSC WebSocket connected"),N(ee=>({...ee,isConnected:!0,error:void 0})),de({address:"/system/connected",args:[],direction:"outgoing"})},F.onmessage=ee=>{try{console.log("📨 OSC WebSocket message received:",ee.data);const ce=JSON.parse(ee.data);ce.type==="connected"?console.log("✅ OSC Server:",ce.message):ce.type==="osc_response"?(console.log("📥 OSC Response:",ce.address,ce.args),de({address:ce.address,args:ce.args,direction:"incoming"}),ne(ce.address,ce.args)):ce.type==="pong"&&(console.log("🏓 Pong received"),de({address:"/pong",args:["server","alive"],direction:"incoming"}))}catch(ce){console.error("❌ Error parsing WebSocket message:",ce)}},F.onerror=ee=>{console.error("❌ WebSocket error:",ee),N(ce=>({...ce,isConnected:!1,error:"OSC server not running - start osc-websocket-server.js"}))},F.onclose=()=>{console.log("🔌 OSC WebSocket disconnected"),N(ee=>({...ee,isConnected:!1,error:"Connection closed"}))},Y(F),setTimeout(()=>{F.readyState===WebSocket.OPEN?(console.log("🏓 Sending ping to OSC server..."),F.send(JSON.stringify({type:"osc",address:"/ping",args:[]}))):console.log("❌ WebSocket not ready for ping")},1e3)}catch(F){console.error("❌ Failed to initialize OSC WebSocket:",F),N(ee=>({...ee,isConnected:!1,error:"Failed to create WebSocket connection"}))}})(),()=>{K&&K.readyState===WebSocket.OPEN&&K.close()}):void 0,[u]);const de=E=>{if(!X)return;const F={...E,id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:new Date};A(ee=>[...ee.slice(-99),F])},Ne=(E,F=[])=>{if(!K||!S.isConnected){console.log("❌ OSC server not connected - cannot send message"),alert("OSC server not connected");return}try{const ee={type:"osc",address:E,args:F};console.log("📤 Sending OSC message:",ee),K.send(JSON.stringify(ee)),de({address:E,args:F,direction:"outgoing"})}catch(ee){console.error("❌ Error sending OSC message:",ee),alert("Failed to send OSC message")}},fe=()=>{if(!U.trim()){alert("Please enter a cue name");return}const E=U.trim();Ne(`/cue/${E}/load`,[])},me=()=>{i?(console.log("🎯 Generic start - controlling currently loaded item:",i),Ne("/timer/start",[])):alert("No cue is currently loaded. Please load a cue first.")},ve=()=>{const E=Object.keys(h);if(E.length>0){const F=parseInt(E[0]);console.log("🎯 Generic stop - controlling currently running timer:",F),Ne("/timer/stop",[])}else alert("No timer is currently running.")},Ve=()=>{console.log("🎯 Generic reset - using resetAllStates (same as Reset button)"),Ne("/timer/reset",[])},we=()=>{if(!O.trim()){alert("Please enter a sub-timer ID");return}Ne(`/subtimer/${O.trim()}/start`,[])},z=()=>{if(!O.trim()){alert("Please enter a sub-timer ID");return}Ne(`/subtimer/${O.trim()}/stop`,[])},D=()=>{A([])},V=E=>E.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3});return u?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-xl font-semibold text-white",children:"OSC Control Panel"}),s.jsx("button",{onClick:n,className:"text-slate-400 hover:text-white transition-colors",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsxs("div",{className:"flex-1 overflow-hidden",children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-full",children:[s.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Connection Status"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`w-3 h-3 rounded-full ${S.isConnected?"bg-green-500":"bg-red-500"}`}),s.jsx("span",{className:"text-sm",children:S.isConnected?"Connected":"Disconnected"})]}),s.jsxs("div",{className:"text-sm text-slate-400",children:["Server: 127.0.0.1:",S.serverPort]}),s.jsxs("div",{className:"border-t border-slate-600 pt-3",children:[s.jsx("div",{className:"text-sm font-medium text-slate-300 mb-2",children:"Current State:"}),s.jsxs("div",{className:"text-xs text-slate-400 space-y-1",children:[s.jsxs("div",{children:["Loaded Cue: ",i?`Item ${i}`:"None"]}),s.jsxs("div",{children:["Running Timers: ",Object.keys(h).length]}),Object.keys(h).length>0&&s.jsxs("div",{className:"text-green-400",children:["Active: ",Object.keys(h).map(E=>`Item ${E}`).join(", ")]})]})]}),S.error&&s.jsxs("div",{className:"text-sm text-red-400",children:["Error: ",S.error]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>{K&&K.readyState===WebSocket.OPEN&&K.send(JSON.stringify({type:"osc",address:"/ping",args:[]}))},className:"px-3 py-1 bg-blue-600 hover:bg-blue-500 text-white text-sm rounded transition-colors",children:"Test Connection"}),!S.isConnected&&s.jsx("button",{onClick:()=>{K&&K.close(),N(E=>({...E,error:void 0}))},className:"px-3 py-1 bg-green-600 hover:bg-green-500 text-white text-sm rounded transition-colors",children:"Retry"})]})]})]}),s.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Cue & Timer Controls"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Cue Name (to load)"}),s.jsx("input",{type:"text",value:U,onChange:E=>$(E.target.value),placeholder:"Enter cue name (1, 1.1, 1A, etc.)",className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Sub-Timer ID (for indented items)"}),s.jsx("input",{type:"text",value:O,onChange:E=>J(E.target.value),placeholder:"Enter sub-timer ID",className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"text-sm font-medium text-slate-300",children:"Main Cue Controls"}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsx("button",{onClick:fe,className:"px-3 py-2 bg-purple-600 hover:bg-purple-500 text-white text-sm rounded transition-colors",children:"Load Cue"}),s.jsx("button",{onClick:me,className:"px-3 py-2 bg-green-600 hover:bg-green-500 text-white text-sm rounded transition-colors",children:"Start (Generic)"}),s.jsx("button",{onClick:ve,className:"px-3 py-2 bg-red-600 hover:bg-red-500 text-white text-sm rounded transition-colors",children:"Stop (Generic)"}),s.jsx("button",{onClick:Ve,className:"px-3 py-2 bg-yellow-600 hover:bg-yellow-500 text-white text-sm rounded transition-colors",children:"Reset (Generic)"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"text-sm font-medium text-slate-300",children:"Sub-Timer Controls"}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsx("button",{onClick:we,className:"px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white text-sm rounded transition-colors",children:"Start Sub-Timer"}),s.jsx("button",{onClick:z,className:"px-3 py-2 bg-orange-600 hover:bg-orange-500 text-white text-sm rounded transition-colors",children:"Stop Sub-Timer"})]})]})]})]}),s.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Message Log"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:X,onChange:E=>q(E.target.checked),className:"rounded"}),s.jsx("label",{className:"text-sm text-slate-300",children:"Enable Logging"})]}),s.jsxs("div",{className:"text-sm text-slate-400",children:["Messages: ",R.length]}),s.jsxs("div",{className:"text-xs text-slate-500 space-y-1",children:[s.jsx("div",{children:s.jsx("strong",{children:"OSC Message Examples:"})}),s.jsx("div",{className:"font-semibold text-slate-400",children:"Main Cue Commands:"}),s.jsx("div",{children:"/cue/1/load"}),s.jsx("div",{children:"/cue/1.1/load"}),s.jsx("div",{children:"/cue/1A/load"}),s.jsx("div",{className:"font-semibold text-slate-400 mt-2",children:"Generic Timer Commands:"}),s.jsx("div",{children:"/timer/start"}),s.jsx("div",{children:"/timer/stop"}),s.jsx("div",{children:"/timer/reset"}),s.jsx("div",{className:"font-semibold text-slate-400 mt-2",children:"Sub-Timer Commands:"}),s.jsx("div",{children:"/subtimer/SUB1/start"}),s.jsx("div",{children:"/subtimer/SUB1/stop"})]})]})]})]}),s.jsxs("div",{className:"mt-6 bg-slate-700 rounded-lg p-4 flex-1 min-h-0",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white",children:"OSC Message Log"}),s.jsx("button",{onClick:D,className:"px-3 py-1 bg-slate-600 hover:bg-slate-500 text-white text-sm rounded transition-colors",children:"Clear Messages"})]}),s.jsxs("div",{className:"bg-slate-900 rounded-lg p-4 h-64 overflow-y-auto font-mono text-sm",children:[R.length===0?s.jsx("div",{className:"text-slate-500 text-center py-8",children:S.isConnected?"No messages yet. Send OSC commands to see messages.":s.jsxs("div",{children:[s.jsx("div",{className:"text-red-400 mb-2",children:"⚠️ OSC Server Not Connected"}),S.error?.includes("Node.js environment")?s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-yellow-400 mb-2",children:"OSC requires local Node.js server"}),s.jsx("div",{className:"text-sm",children:"For online deployment, OSC is not available."}),s.jsx("div",{className:"text-sm",children:"For local use with OSC:"}),s.jsx("div",{className:"text-xs font-mono bg-slate-800 p-2 rounded mt-2",children:"start-both-servers.bat"}),s.jsx("div",{className:"text-xs mt-1",children:"Or: start-websocket-osc-server.bat"})]}):s.jsxs("div",{children:[s.jsx("div",{className:"text-sm",children:"Start the OSC server using:"}),s.jsx("div",{className:"text-xs font-mono bg-slate-800 p-2 rounded mt-2",children:"node osc-server.js"}),s.jsx("div",{className:"text-xs mt-2",children:"Or use the batch file: start-osc-server.bat"})]})]})}):R.map(E=>s.jsxs("div",{className:`flex items-start gap-3 py-1 ${E.direction==="incoming"?"text-green-400":"text-blue-400"}`,children:[s.jsx("span",{className:"text-slate-500 text-xs w-20 flex-shrink-0",children:V(E.timestamp)}),s.jsx("span",{className:"text-slate-500 text-xs w-20 flex-shrink-0",children:E.direction==="incoming"?"←":"→"}),s.jsx("span",{className:"text-yellow-400 flex-shrink-0",children:E.address}),E.args.length>0&&s.jsx("span",{className:"text-slate-300",children:JSON.stringify(E.args)})]},E.id)),s.jsx("div",{ref:P})]})]})]})]})}):null},Wv=()=>{const u=yr(),n=ea();let r=u.state?.event,a=u.state?.userRole;const{user:i,loading:h}=oo(),[d,p]=_.useState("VIEWER"),[x,y]=_.useState(!1),[S,N]=_.useState(!1),[R,A]=_.useState([]),[U,$]=_.useState([]),[O,J]=_.useState(!1),[X,q]=_.useState(new Map),K=_.useRef(new Map),Y=_.useRef(new Set),P=(l,g,v)=>{if(d!=="EDITOR"&&d!=="OPERATOR"||!i||!r?.id){console.log("⚠️ Not logging change - missing requirements:",{role:d,user:!!i,event:!!r?.id});return}let w=g,k,C;v?.itemId&&(k=T.findIndex(Z=>Z.id===v.itemId)+1,C=T.find(Z=>Z.id===v.itemId)?.customFields?.cue||"CUE",w=`ROW ${k} - ${Kt(C)}: ${g}`),Ct.addChange({eventId:r.id,userId:i.id,userName:i.user_metadata?.full_name||i.email||"Unknown",userRole:d,action:l,description:w,details:v,rowNumber:k,cueNumber:C,segmentName:v?.itemName||v?.segmentName});const L=Ct.getLocalChanges();A(L.slice(0,100)),console.log("📝 Change logged to buffer:",w)},B=(l,g,v,w)=>{if(d!=="EDITOR"&&d!=="OPERATOR"){console.log("⚠️ Not logging change - user role is not EDITOR or OPERATOR:",d);return}const k=w?.fieldName?.includes("Name")||w?.fieldName?.includes("segmentName")||w?.fieldName?.includes("cue")||w?.fieldName?.includes("custom"),C=k?`text_${w?.itemId}_${w?.fieldName}`:l,L=K.current.get(C);L&&(clearTimeout(L),K.current.delete(C)),q(be=>{const ie=new Map(be);for(const[ge,Ie]of ie.entries())Ie.originalKey===C&&ie.delete(ge);return ie});let Q=v,Z={...w};if(w?.itemId){const be=T.findIndex(Ie=>Ie.id===w.itemId)+1,ge=T.find(Ie=>Ie.id===w.itemId)?.customFields?.cue||"CUE";Q=`ROW ${be} - ${Kt(ge)}: ${v}`,Z={...w,rowNumber:be,cueNumber:ge}}if(k)q(be=>{const ie=new Map(be);for(const[Ie,Xe]of ie.entries())Xe.originalKey===C&&ie.delete(Ie);const ge=`${C}_${Date.now()}`;return ie.set(ge,{action:g,description:Q,details:Z,timestamp:new Date,user:i?.user_metadata?.full_name||i?.email||"Unknown User",originalKey:C}),console.log("📝 Updated text field pending change:",ge,"for baseKey:",C),console.log("📝 Total pending changes:",ie.size),console.log("📝 Pending change details:",{action:g,description:Q,baseKey:C,uniqueKey:ge}),ie});else{const be=`${C}_${Date.now()}`;q(ie=>{const ge=new Map(ie.set(be,{action:g,description:Q,details:Z,timestamp:new Date,user:i?.user_metadata?.full_name||i?.email||"Unknown User",originalKey:C}));return console.log("📝 Added pending change:",be,"for baseKey:",C),console.log("📝 Total pending changes:",ge.size),console.log("📝 Pending change details:",{action:g,description:Q,baseKey:C,uniqueKey:be}),ge})}const he=setTimeout(async()=>{console.log("🕐 TIMEOUT FIRED for baseKey:",C),q(be=>{let ie=null,ge=null;console.log("🕐 TIMEOUT: Looking for baseKey:",C),console.log("🕐 TIMEOUT: Available pending changes:",Array.from(be.entries()).map(([Xe,ct])=>({key:Xe,originalKey:ct.originalKey})));for(const[Xe,ct]of be.entries())if(ct.originalKey===C){ie=ct,ge=Xe,console.log("🕐 TIMEOUT: Found match - key:",Xe,"originalKey:",ct.originalKey);break}console.log("🕐 TIMEOUT: Found pending change:",ie?"YES":"NO"),console.log("🕐 TIMEOUT: Change key:",ge),console.log("🕐 TIMEOUT: Has change key in prev:",be.has(ge||""));const Ie=`${C}-${ie?.timestamp?.getTime()||Date.now()}`;if(console.log("🕐 TIMEOUT: Change ID:",Ie),console.log("🕐 TIMEOUT: Already processed:",Y.current.has(Ie)),ie&&ge&&be.has(ge)&&i&&r?.id&&!Y.current.has(Ie)){console.log("🕐 TIMEOUT: Processing change..."),Y.current.add(Ie);const Xe={eventId:r.id,userId:i.id,userName:i.user_metadata?.full_name||i.email||"Unknown",userRole:d||"VIEWER",action:ie?.action||"unknown",description:ie?.description||"unknown",details:ie?.details||{},rowNumber:ie?.details?.rowNumber,cueNumber:ie?.details?.cueNumber,segmentName:ie?.details?.itemName||ie?.details?.segmentName};console.log("🔄 Adding change to service:",Xe),Ct.addChange(Xe);const ct=Ct.getLocalChanges();console.log("🔄 Local changes after adding to service:",ct.length),console.log("🔄 Latest change:",ct[ct.length-1]),console.log("🔄 Current changeLog state length:",R.length),A(ct.slice(0,100)),console.log("🔄 Set changeLog to:",ct.slice(0,100).length,"changes"),console.log("✅ Debounced change logged to change log service:",ie?.description||"unknown"),console.log("🔄 Removed pending change from queue:",ge),console.log("🔄 Auto-syncing changes after timeout... (with 3s additional delay)"),setTimeout(()=>{va().then(()=>{console.log("✅ Auto-sync completed after timeout + 3s delay"),fi(!0),console.log("⏭️ Set skipNextSync flag to prevent false reset")}).catch(Qt=>{console.error("❌ Auto-sync failed after timeout + 3s delay:",Qt)})},3e3),K.current.delete(C);const hr=new Map(be);return hr.delete(ge),console.log("🔄 Pending changes after removal:",hr.size),console.log("🔄 Remaining pending keys:",Array.from(hr.keys())),hr}else{K.current.delete(C),Y.current.has(Ie)?console.log("⚠️ Prevented duplicate processing of change:",Ie):console.log("ℹ️ Pending change already processed or removed:",C);const Xe=Date.now(),ct=new Map(be);let hr=0;for(const[Qt,ja]of ct.entries()){const Us=Xe-ja.timestamp.getTime();Us>15e3&&(console.log("🧹 Removing stale pending change:",Qt,"age:",Us+"ms"),ct.delete(Qt),hr++)}return hr>0?(console.log("🧹 Removed",hr,"stale pending changes"),ct):be}})},5e3);K.current.set(C,he),console.log("⏰ Set timeout for baseKey:",C,"in",5e3,"ms"),console.log("⏰ Total active timeouts:",K.current.size)},ne=async()=>{console.log("🔄 Finalizing all pending changes...");const l=Array.from(X.entries());if(l.length===0){console.log("ℹ️ No pending changes to finalize");return}K.current.forEach(w=>{clearTimeout(w)}),K.current.clear(),console.log(`🔄 Processing ${l.length} pending changes immediately...`);const g=new Set;for(const[w,k]of l)if(k&&i&&r?.id){const C=`${k.originalKey||w}-${k.timestamp.getTime()}`;if(Y.current.has(C)){console.log("⚠️ Skipping already processed change:",C);continue}Y.current.add(C),g.add(C);let L=k.description,Q,Z;k.details?.itemId&&(Q=T.findIndex(be=>be.id===k.details.itemId)+1,Z=T.find(be=>be.id===k.details.itemId)?.customFields?.cue||"CUE",L=`ROW ${Q} - ${Kt(Z)}: ${k.description}`),Ct.addChange({eventId:r.id,userId:i.id,userName:i.user_metadata?.full_name||i.email||"Unknown",userRole:d||"VIEWER",action:k.action,description:L,details:k.details,rowNumber:Q,cueNumber:Z,segmentName:k.details?.itemName||k.details?.segmentName}),console.log("✅ Processed pending change immediately:",L)}q(new Map);const v=Ct.getLocalChanges();A(v.slice(0,100)),console.log(`✅ All ${g.size} pending changes processed immediately`),console.log("🔄 Auto-syncing changes after manual finalization...");try{await va(),console.log("✅ Auto-sync completed after manual finalization")}catch(w){console.error("❌ Auto-sync failed after manual finalization:",w)}setTimeout(()=>{g.forEach(w=>{Y.current.delete(w)}),console.log("🧹 Cleaned up processed change tracking for",g.size,"changes")},6e4)};if(_.useEffect(()=>()=>{K.current.forEach(l=>clearTimeout(l))},[]),_.useEffect(()=>{const l=setInterval(()=>{q(g=>{const v=Date.now(),w=new Map(g);let k=0;for(const[C,L]of w.entries()){const Q=v-L.timestamp.getTime();Q>2e4&&(console.log("🧹 Periodic cleanup: Removing stale pending change:",C,"age:",Q+"ms"),w.delete(C),k++)}return k>0&&console.log("🧹 Periodic cleanup: Removed",k,"stale pending changes"),w})},5e3);return()=>clearInterval(l)},[]),_.useEffect(()=>{const l=Ct.getChangesCount().unsynced;Vl(l)},[R,X]),!r){const l=localStorage.getItem("events");if(l){const g=JSON.parse(l);r=g[g.length-1]}}console.log("Event from location.state:",u.state?.event),console.log("Final event data:",r);const[T,re]=_.useState([]),[de,Ne]=_.useState([]),[fe,me]=_.useState(r?.name||""),[ve,Ve]=_.useState(""),[we,z]=_.useState({}),[D,V]=_.useState(1),[E,F]=_.useState(null),[ee,ce]=_.useState(!1),[$e,Me]=_.useState({show:!1}),[ze,Fe]=_.useState(!1),[Ge,mt]=_.useState(!1),[br,tn]=_.useState(null),[$n,te]=_.useState(!1),[pe,_e]=_.useState(!1),[De,Ze]=_.useState(null),[bt,at]=_.useState(!1),[dt,wt]=_.useState(null),[it,Et]=_.useState([]),[gt,Mt]=_.useState(!1),[Ot,vn]=_.useState(null),[oi,Mn]=_.useState(!1),[Un,ai]=_.useState(null),[ps,vs]=_.useState(!1),[rn,Fn]=_.useState(null),[Ut,ir]=_.useState([]),[Le,wr]=_.useState({}),[tr,Cr]=_.useState({}),[Ye,Sr]=_.useState({}),[na,Rr]=_.useState({}),[ht,Ir]=_.useState(null),[xs,Vn]=_.useState(null),[ao,ys]=_.useState(!1),[nd,nn]=_.useState(null),[sa,io]=_.useState(null),[Te,Vr]=_.useState(null),[rt,Ft]=_.useState({}),[lr,zt]=_.useState({}),[ii,lo]=_.useState(new Set),[Al,$l]=_.useState(null),[Ml,sn]=_.useState({}),[li,Or]=_.useState(!1),[qe,Ul]=_.useState(null),[oa,bs]=_.useState(!1),[Pr,co]=_.useState(""),[aa,ws]=_.useState(!1),[Dr,ia]=_.useState(!1),[_r,ci]=_.useState(!1),[uo,la]=_.useState(!1),[Ss,_s]=_.useState([]),[ho,Bn]=_.useState({totalBackups:0,lastBackup:null,autoBackups:0,manualBackups:0}),[Fl,fo]=_.useState(!1),[rr,ca]=_.useState(null),[Br,Es]=_.useState(!0),[ua,da]=_.useState(null),[xe,Wt]=_.useState({start:!0,programType:!0,duration:!0,segmentName:!0,shotType:!0,pptQA:!0,notes:!0,assets:!0,participants:!1,speakers:!0,public:!0,custom:!0}),[ks,Ns]=_.useState({}),[We,ui]=_.useState({start:128,programType:224,duration:224,segmentName:320,shotType:192,pptQA:192,notes:384,assets:192,participants:256,speakers:384,public:128}),[js,ha]=_.useState({}),[Ht,zr]=_.useState(!1);_.useEffect(()=>{const l=localStorage.getItem(`followEnabled_${r?.id}`);l!==null&&zr(l==="true")},[r?.id]),_.useEffect(()=>{localStorage.setItem(`followEnabled_${r?.id}`,Ht.toString())},[Ht,r?.id]),_.useEffect(()=>{if(Ht&&Te){const l=localStorage.getItem(`scrollPosition_${r?.id}`);if(l){const g=parseInt(l);setTimeout(()=>{window.scrollTo({top:g,behavior:"smooth"})},100)}}},[Te,Ht,r?.id]);const[Wr,qt]=_.useState(new Set),Kt=l=>l?l.includes("CUE ")?l:l.replace(/^CUE(\d+)$/,"CUE $1"):"CUE",[zn,nr]=_.useState(new Set),[di,Wn]=_.useState(null),[Ts,hi]=_.useState(!1),[xn,Er]=_.useState(!1),[Cs,Vl]=_.useState(0),[cr,yn]=_.useState(null),[Hr,mo]=_.useState(0),[Bl,fi]=_.useState(!1),[Hn,qr]=_.useState(!1),[on,Rs]=_.useState(null),[an,qn]=_.useState(20),[go,Is]=_.useState(!1),Kr=_.useRef(null),tt=()=>{console.log("✏️ User started editing - pausing sync"),qr(!0),on&&clearTimeout(on);const l=setTimeout(()=>{console.log("⏸️ User stopped editing - resuming sync"),qr(!1),Pt()},5e3);Rs(l)},Gt=()=>{console.log("✏️ Modal opened - pausing sync until closed"),qr(!0),on&&(clearTimeout(on),Rs(null))},Pt=_.useCallback(()=>{Kr.current&&clearInterval(Kr.current),qn(20),Is(!1);const l=setInterval(()=>{qn(g=>g<=1?(Is(!0),setTimeout(()=>{Is(!1),qn(20)},3e3),0):g-1)},1e3);Kr.current=l},[]),bn=_.useCallback(()=>{Kr.current&&(clearInterval(Kr.current),Kr.current=null),qn(20),Is(!1)},[]),kt=()=>{console.log("✏️ Modal closed - resuming sync in 5 seconds");const l=setTimeout(()=>{console.log("⏸️ User stopped editing - resuming sync"),qr(!1),Pt()},5e3);Rs(l)};_.useEffect(()=>{if(h){console.log("⏳ Authentication still loading, waiting...");return}i&&r?.id?(async()=>{try{console.log("🔍 Loading role from Supabase for user:",i.id,"event:",r.id);const g=await ye.getCurrentUserSession(i.id);if(console.log("📋 User session from Supabase:",g),g&&g.event_id===r.id&&g.user_role)return p(g.user_role),console.log("✅ Loaded role from Supabase:",g.user_role),!0;console.log("❌ No valid role found in Supabase:",{hasSession:!!g,eventIdMatch:g?.event_id===r.id,hasRole:!!g?.user_role})}catch(g){console.log("⚠️ Failed to load role from Supabase:",g)}return!1})().then(g=>{if(g){console.log("✅ Using role from Supabase");return}if(a&&["VIEWER","EDITOR","OPERATOR"].includes(a)){p(a),ye.saveUserSession(r.id,i.id,i.user_metadata?.full_name||i.email||"Unknown",a),console.log("✅ Using role from navigation state (no Supabase role found):",a);return}console.log("❌ No role found, showing role selection modal"),y(!0)}):!i&&r?.id&&(console.log("❌ No user authenticated, defaulting to VIEWER role"),p("VIEWER"))},[i,r?.id,h,a,n]),_.useEffect(()=>{if(r?.id){console.log("🔄 Loading change log data for event:",r.id),Ct.reloadLocalChanges();const l=Ct.getLocalChanges();A(l.slice(0,100)),console.log("📝 Loaded local changes:",l.length),pa(),mi(),zl(),vo(),Wl();const g=setInterval(()=>{const v=Ct.getLocalChanges();A(v.slice(0,100))},2e3);return()=>clearInterval(g)}},[r?.id]);const[Os,fa]=_.useState(!1),[Ps,ma]=_.useState(null),[Kn,po]=_.useState(!1);_.useEffect(()=>{r?.id&&T.length>0&&!Kn&&(console.log("🔄 Schedule loaded, checking for running timers for event:",r.id),ga(),po(!0))},[r?.id,T.length,Kn]),_.useEffect(()=>{if(!r?.id)return;const l=async()=>{try{const{data:v,error:w}=await ae.from("completed_cues").select("*").eq("event_id",r.id);if(!w&&v){const k={};v.forEach(C=>{C.item_id&&(k[C.item_id]=!0)}),Rr(k),console.log("🟣 Synced completed cues:",k)}}catch(v){console.warn("⚠️ Error syncing completed cues:",v)}};l();const g=setInterval(l,2e3);return()=>clearInterval(g)},[r?.id]),_.useEffect(()=>{if(!r?.id)return;const l=async()=>{try{await vo()}catch(v){console.warn("⚠️ Error syncing sub-cue timers:",v)}};l();const g=setInterval(l,1e3);return()=>clearInterval(g)},[r?.id]),_.useEffect(()=>{if(!r?.id||!i?.id)return;const l=async()=>{try{const{data:v,error:w}=await ae.from("active_timers").select("*").eq("event_id",r.id).order("updated_at",{ascending:!1}).limit(1);if(w){console.warn("⚠️ Top text sync error:",w);return}const k=v?.[0];if(k&&k.user_id===i.id)return;if(k){const C=k.timer_state||"unknown",L=parseInt(k.item_id),Q=k.is_active,Z=k.started_at;let he=C;if((C==="unknown"||!C)&&(Q&&Z?he="running":Q?he="loaded":he="stopped"),he==="running"){Vr(L),sn(ge=>({...ge,[L]:!0})),wr(ge=>({...ge,[L]:!0}));const be=T.findIndex(ge=>ge.id===L),ie=new Set;if(be!==-1)for(let ge=be+1;ge<T.length&&T[ge].isIndented;ge++)ie.add(T[ge].id);nr(ie),Wn(L)}else if(he==="loaded"){Vr(L),sn(ge=>({...ge,[L]:!0})),wr({});const be=T.findIndex(ge=>ge.id===L),ie=new Set;if(be!==-1)for(let ge=be+1;ge<T.length&&T[ge].isIndented;ge++)ie.add(T[ge].id);nr(ie),Wn(L)}else he==="stopped"&&(Vr(null),sn({}),wr({}),nr(new Set),Wn(null))}else Vr(null),sn({}),wr({}),nr(new Set),Wn(null)}catch(v){console.warn("⚠️ Top text sync error:",v)}};l();const g=setInterval(l,2e3);return()=>clearInterval(g)},[r?.id,i?.id,T]),_.useEffect(()=>()=>{console.log("🔄 Cleaning up drift detector on component unmount"),fn.destroy()},[]),_.useEffect(()=>{if(r?.id&&i?.id&&d&&d!=="VIEWER"){console.log("💾 Saving current role to Supabase:",d);try{const l=i.user_metadata?.full_name||i.email||"Unknown";ye.saveUserSession(r.id,i.id,l,d),console.log("✅ Role saved to Supabase:",d)}catch(l){console.error("❌ Failed to save role to Supabase:",l)}}},[r?.id,i?.id,d]),_.useEffect(()=>()=>{if(r?.id&&i?.id&&d&&d!=="VIEWER"){console.log("💾 Saving current role to Supabase before navigating away:",d);try{const l=i.user_metadata?.full_name||i.email||"Unknown";ye.saveUserSession(r.id,i.id,l,d),console.log("✅ Role saved to Supabase on navigation away:",d)}catch(l){console.error("❌ Failed to save role to Supabase on navigation away:",l)}}},[r?.id,i?.id,d]);const mi=async()=>{if(r?.id)try{console.log("🟣 Loading completed cues from Supabase for event:",r.id);const l=await ye.getCompletedCues(r.id);if(l&&l.length>0){console.log("🟣 Found completed cues:",l);const g={};l.forEach(v=>{if(v.item_id){if(Te&&v.item_id===Te){console.log("🟣 Skipping currently loaded cue from completed cues:",v.item_id);return}g[v.item_id]=!0}}),Rr(g),console.log("🟣 Set completedCues state:",g)}else console.log("🟣 No completed cues found")}catch(l){console.error("❌ Error loading completed cues from Supabase:",l),console.log("💡 This means the completed_cues table or functions need to be created first"),console.log("📋 Please run the create-completed-cues-table.sql script in your Supabase SQL Editor")}};_.useCallback(()=>r?.id?(console.log("🔄 Starting countdown sync for Browser B"),setInterval(async()=>{try{const g=await ye.getActiveTimer(r.id);g&&g.timer_state==="running"&&g.started_at&&g.elapsed_seconds!==void 0&&g.duration_seconds!==void 0&&Ft(v=>({...v,[g.item_id]:{elapsed:g.elapsed_seconds,total:g.duration_seconds,startedAt:new Date(g.started_at)}}))}catch(g){console.warn("⚠️ Failed to sync countdown from server:",g)}},1e3)):void 0,[r?.id]),_.useEffect(()=>{if(!r?.id||!i?.id)return;console.log("🔄 Starting countdown sync for Browser B");const l=setInterval(async()=>{try{const g=await ye.getActiveTimer(r.id);if(g){if(g.user_id===i.id){console.log("⏭️ Skipping countdown sync - timer started by current user");return}if(console.log("🔄 Browser B: Syncing timer from server:",{itemId:g.item_id,state:g.timer_state,elapsed:g.elapsed_seconds,total:g.duration_seconds,startedAt:g.started_at,userId:g.user_id,currentUserId:i.id}),Ft(v=>{const w=v[g.item_id];return g.timer_state==="running"&&g.started_at?{...v,[g.item_id]:{elapsed:g.elapsed_seconds,total:g.duration_seconds,startedAt:new Date(g.started_at)}}:{...v,[g.item_id]:{elapsed:0,total:g.duration_seconds,startedAt:null}}}),g.timer_state==="running"&&g.started_at){const v=new Date(g.started_at),w=g.duration_seconds;console.log(`🔄 Browser B: Starting drift detection for timer ${g.item_id} with duration ${w}s`),fn.startMonitoring(g.item_id,v,w,k=>{console.log(`🔄 Browser B DriftDetector: Syncing timer ${g.item_id} with server elapsed: ${k}s`),lo(C=>{const L=new Set([...C,g.item_id]);return console.log(`🔄 Browser B DriftDetector: Marking timer ${g.item_id} as server-synced. Server-synced timers:`,Array.from(L)),L}),Ft(C=>{const L={...C,[g.item_id]:{...C[g.item_id],elapsed:k}};return console.log(`🔄 Browser B DriftDetector: Updated timer ${g.item_id} progress to elapsed: ${k}s`),L})})}}else console.log("🔄 No active timer, clearing timer progress"),Ft({})}catch(g){console.warn("⚠️ Failed to sync countdown from server:",g)}},1e3);return()=>{console.log("🔄 Cleaning up countdown sync"),clearInterval(l)}},[r?.id,i?.id]);const vo=async()=>{if(r?.id){console.log("🟠 Polling for sub-cue timer...");try{const{data:l}=await ye.hasActiveSubCueTimer(r.id);if(!l){console.log("🟠 No active sub-cue timer found, clearing local state"),Object.keys(Ye).forEach(w=>{Ye[parseInt(w)]&&clearInterval(Ye[parseInt(w)])}),Sr({}),zt({}),Ir(null);return}const{data:g,error:v}=await ye.getActiveSubCueTimer(r.id);if(console.log("🟠 Sub-cue timer data from Supabase:",g),v){console.error("❌ Error loading sub-cue timer:",v);return}if(g&&g.is_active&&g.is_running){if(console.log("🟠 Sub-cue timer loaded:",g.item_id,"Duration:",g.duration_seconds,"s","Active:",g.is_active,"Running:",g.is_running),i&&g.user_id===i.id){console.log("⏭️ Skipping sub-cue sync - change made by current user");return}hi(!0),Object.keys(Ye).forEach(Z=>{Ye[parseInt(Z)]&&clearInterval(Ye[parseInt(Z)])});const w=parseInt(g.item_id),k=new Date(g.started_at),L=Math.floor((new Date().getTime()-k.getTime())/1e3)+2;zt(Z=>({...Z,[w]:{elapsed:Math.max(0,L),total:g.duration_seconds,startedAt:k}})),console.log("🟠 Browser B: Not starting local timer, will update via 2-second sync"),console.log("🟠 Set sub-cue timer state");const Q=Math.max(0,g.duration_seconds-L);console.log("🟠 Browser B timing debug:",{startedAt:k.toISOString(),elapsed:L,duration:g.duration_seconds,remaining:Q,fix:"Browser B uses database elapsed time, no local timer"}),Ir({itemId:w,remaining:Q,duration:g.duration_seconds,isActive:!0,startedAt:k,timerState:"running"}),console.log("🟠 Set secondaryTimer state for top UI"),setTimeout(()=>{hi(!1)},100)}else g&&(!g.is_active||!g.is_running)?(console.log("🟠 Sub-cue timer found but not active or not running, clearing local state"),Object.keys(Ye).forEach(w=>{Ye[parseInt(w)]&&clearInterval(Ye[parseInt(w)])}),Sr({}),zt({}),Ir(null)):(console.log("🟠 No sub-cue timer found, clearing local state"),Object.keys(Ye).forEach(w=>{Ye[parseInt(w)]&&clearInterval(Ye[parseInt(w)])}),Sr({}),zt({}),Ir(null))}catch(l){console.error("❌ Error loading sub-cue timer:",l),Object.keys(Ye).forEach(g=>{Ye[parseInt(g)]&&clearInterval(Ye[parseInt(g)])}),Sr({}),zt({})}}},zl=async()=>{if(r?.id)try{const{data:l,error:g}=await ye.getActiveSubCueTimers(r.id);if(g){console.error("❌ Error loading sub-cue timers:",g);return}l&&l.length>0&&(console.log("🔄 Loaded sub-cue timers from Supabase:",l),console.log("🔄 Setting up sub-cue timer states..."),l.forEach(v=>{const w=v.item_id,k=v.duration_seconds||0;if(console.log(`🔄 Setting up sub-cue timer for item ${w}:`,{elapsed:v.elapsed_seconds||0,total:k,startedAt:v.started_at?new Date(v.started_at):null,timer_state:v.timer_state}),zt(C=>({...C,[w]:{elapsed:v.elapsed_seconds||0,total:k,startedAt:v.started_at?new Date(v.started_at):null}})),v.timer_state==="running"){console.log(`🔄 Starting local timer interval for sub-cue item ${w}`);const C=setInterval(()=>{zt(L=>{if(L[w]&&L[w].startedAt){const Q=L[w].startedAt,Z=Q instanceof Date?Q.getTime():new Date(Q).getTime(),he=Math.floor((Date.now()-Z)/1e3);return{...L,[w]:{...L[w],elapsed:he}}}return L})},100);Sr(L=>(console.log(`🔄 Setting sub-cue timer state for item ${w}`),{...L,[w]:C}))}else console.log(`🔄 Sub-cue timer for item ${w} is not running, state: ${v.timer_state}`)}))}catch(l){console.error("❌ Error loading sub-cue timers:",l)}},Wl=async()=>{if(r?.id){console.log("🧪 Testing database connection...");try{const{data:l,error:g}=await ye.getLastLoadedCue(r.id);g?(console.error("❌ Database test failed:",g),console.log("💡 This means the SQL migration needs to be run first"),console.log("📋 Please run the migrate-timer-states.sql script in your Supabase SQL Editor")):(console.log("✅ Database connection test passed"),console.log("📊 Test data received:",l))}catch(l){console.error("❌ Database connection test error:",l)}}},ga=async()=>{if(!r?.id){console.log("⚠️ No event ID for checking running timers");return}console.log("🔄 Checking for running timers for event:",r.id);try{console.log("🔄 Using fallback timer detection..."),ma({cueName:"Timer Detected",remainingTime:"Check Console"}),fa(!0),console.log("✅ Fallback timer popup shown")}catch(l){console.error("❌ Error checking running timers:",l)}},Hl=async()=>{if(console.log("🔄 Master sync: Getting active timer from database..."),!r?.id){console.warn("⚠️ No event selected for sync");return}try{const l=await ye.getActiveTimer(r.id);if(!l){console.log("ℹ️ No active timer found in database");return}console.log("🔄 Found active timer in database:",l);const g=new Date,v=Math.floor(g.getTime()/1e3),w=new Date(l.started_at),k=Math.floor(w.getTime()/1e3),C=l.duration_seconds||0,L=l.is_running;if(console.log("📊 Timer calculation:",{currentTime:v,startTimeSeconds:k,durationSeconds:C,isRunning:L,currentTimeFormatted:g.toISOString(),startTimeFormatted:w.toISOString()}),Vr(l.item_id),L){const Q=v-k,Z=C-Q;if(console.log("🔄 Time calculation for running timer:",{elapsedSeconds:Q,remainingSeconds:Z,isOverdue:Z<0}),Ft(he=>({...he,[l.item_id]:{elapsed:Q,total:C,startedAt:w}})),Z!==0){Z>0?console.log(`✅ Timer synced: ${Z} seconds remaining - starting countdown`):console.log(`⚠️ Timer synced: ${Math.abs(Z)} seconds overdue - starting count up`),Le[l.item_id]&&clearInterval(tr[l.item_id]);const he=setInterval(()=>{Ft(be=>{const ie=be[l.item_id];if(!ie)return be;const ge=ie.elapsed+1,Ie=ie.total-ge;return Ie>0?console.log(`🔄 Timer countdown: ${Ie} seconds remaining`):console.log(Ie===0?"⏰ Timer just expired":`🔄 Timer count up: ${Math.abs(Ie)} seconds overdue`),{...be,[l.item_id]:{...ie,elapsed:ge}}})},1e3);Cr(be=>({...be,[l.item_id]:he}))}else console.log("⏰ Timer just expired")}else console.log("⏸️ Timer is loaded but not running - setting duration only"),Ft(Q=>({...Q,[l.item_id]:{elapsed:0,total:C,startedAt:null}})),console.log(`✅ Timer synced: Set loaded duration to ${C} seconds`)}catch(l){console.error("❌ Error during master sync:",l)}},xo=async()=>{if(!(!r?.id||!i?.id))try{console.log("🔄 Backing up schedule data..."),await ye.saveRunOfShowData({event_id:r.id,event_name:r.name,event_date:r.date,schedule_items:T,custom_columns:de,settings:{}}),console.log("✅ Schedule data backed up")}catch(l){console.error("❌ Error backing up schedule data:",l)}},pa=async()=>{if(!r?.id){console.log("⚠️ No event ID for loading master change log");return}try{console.log("🔄 Loading master change log for event:",r.id);const l=await Ct.getMasterChangeLog(r.id,100);$(l),console.log("📊 Loaded master change log:",l.length,"changes"),l.length===0&&console.log("ℹ️ No master changes found - this might be normal for new events")}catch(l){console.error("❌ Error loading master change log:",l),$([])}},va=async()=>{if(!r?.id||!i){console.log("❌ Cannot sync - missing event ID or user");return}if(!Br){console.log("👁️ Skipping sync - page not visible");return}if(bt||pe||gt||ps||uo){console.log("🚫 Skipping sync - modal is open");return}if(Hn){console.log("✏️ Skipping sync - user is actively editing");return}try{console.log("🔄 Syncing schedule data to database...");const l={event_id:r.id,event_name:r.name,event_date:r.date,schedule_items:T,custom_columns:de,settings:{eventName:fe,masterStartTime:ve,dayStartTimes:we}};await ye.saveRunOfShowData(l,{userId:i.id,userName:i.user_metadata?.full_name||i.email||"Unknown User",userRole:d||"VIEWER"})?(console.log("✅ Schedule data synced to database successfully"),pa()):console.log("❌ Failed to sync schedule data to database")}catch(l){console.error("❌ Error syncing schedule data to database:",l)}},ql=async()=>{if(prompt("Enter password to clear all change logs:")!=="1615"){alert("Incorrect password. Change logs not cleared.");return}if(confirm(`⚠️ WARNING: This will permanently delete ALL change logs (local and master) for this event. This action cannot be undone.

Are you sure you want to continue?`))try{if(Ct.clearLocalChanges(),A([]),console.log("✅ Local changes cleared"),r?.id){console.log("🔄 Attempting to clear master change log for event:",r.id);const{data:{user:v},error:w}=await ae.auth.getUser();if(console.log("🔄 Current user:",v?.id,v?.email),w){console.error("❌ Auth error:",w),alert("❌ Authentication error. Please refresh and try again.");return}const k=await Ct.clearMasterChangeLog(r.id);if(k.success){$([]),console.log("✅ Master change log cleared successfully"),console.log("🔄 Verifying master change log is cleared...");const C=await Ct.getMasterChangeLog(r.id);console.log("🔄 Master change log after clearing:",C.length,"records"),$(C),C.length===0?alert(`✅ All change logs cleared successfully!

- Local changes: ✅ Cleared
- Master changes: ✅ Cleared (${k.deletedCount} records deleted)`):alert(`⚠️ Partial success:

- Local changes: ✅ Cleared
- Master changes: ⚠️ ${k.deletedCount} deleted, but ${C.length} remain

Some records may be protected by RLS policies.`)}else console.log("❌ Failed to clear master change log:",k.error),alert(`⚠️ Partial success:

- Local changes: ✅ Cleared
- Master changes: ❌ Failed

Error: ${k.error}

This might be due to database permissions. Check the console for details.`)}else alert("❌ Error: No event ID found. Cannot clear master change log.")}catch(v){console.error("Error clearing change logs:",v),alert("❌ Error clearing change logs. Check the console for details.")}};_.useEffect(()=>{if(!xn||Object.keys(Le).length===0){Er(!1);return}const l=parseInt(Object.keys(Le)[0]),g=T.find(v=>v.id===l);if(g)try{const v=new Date,w=T.findIndex(C=>C.id===g.id),k=_n(w);if(k){const[C,L]=k.split(" "),[Q,Z]=C.split(":").map(Number);let he=Q;L==="PM"&&Q!==12&&(he+=12),L==="AM"&&Q===12&&(he=0);const be=new Date,ie=new Date(be.getFullYear(),be.getMonth(),be.getDate(),he,Z),ge=v.getTime()-ie.getTime(),Ie=Math.round(ge/(1e3*60));mo(Math.abs(Ie)),Ie<-1?(yn("early"),Er(!0)):Ie>1?(yn("late"),Er(!0)):(yn("on-time"),Er(!0)),setTimeout(()=>{Er(!1)},2e4)}}catch(v){console.error("Error calculating time status:",v),Er(!1)}},[Le,T,xn]);const gi=()=>{if(!Ht)return;const l=document.querySelector(`[data-item-id="${Te}"]`);if(l){const g=l.getBoundingClientRect(),v=window.pageYOffset||document.documentElement.scrollTop,w=g.top+v,k=document.querySelector("#main-scroll-container .h-24");let C=100;k&&(C=k.getBoundingClientRect().height+20);const Q=w-C-230;window.scrollTo({top:Math.max(0,Q),behavior:"smooth"}),localStorage.setItem(`scrollPosition_${r?.id}`,Q.toString())}},[Qe,Nt]=_.useState({cue:"",day:1,programType:"PreShow/End",shotType:"",segmentName:"",durationHours:0,durationMinutes:0,durationSeconds:0,notes:"",assets:"",speakers:"",speakersText:"",hasPPT:!1,hasQA:!1,timerId:"",isPublic:!1,isIndented:!1,customFields:{}});_.useEffect(()=>{Nt(l=>({...l,day:D}))},[D]);const pi=["PreShow/End","Podium Transition","Panel Transition","Sub Cue","No Transition","Video","Panel+Remote","Remote Only","Break","TBD","KILLED"],yo={"PreShow/End":"#8B5CF6","Podium Transition":"#8B4513","Panel Transition":"#404040","Sub Cue":"#F3F4F6","No Transition":"#059669",Video:"#F59E0B","Panel+Remote":"#1E40AF","Remote Only":"#60A5FA",Break:"#EC4899",TBD:"#6B7280",KILLED:"#DC2626"},Jt=(l,g,v,w,k)=>{let C=6.5;if(l&&l.trim()!==""){const L=document.createElement("div");L.style.position="absolute",L.style.visibility="hidden",L.style.width="22rem",L.style.padding="0.75rem",L.style.fontSize="1rem",L.style.lineHeight="1.5",L.style.fontFamily="system-ui, -apple-system, sans-serif",L.style.whiteSpace="pre-wrap",L.style.wordWrap="break-word",L.innerHTML=l,document.body.appendChild(L);const Q=L.scrollHeight;document.body.removeChild(L);const be=Q/16+3;C=Math.max(C,be)}if(v&&v.trim()!=="")try{const L=JSON.parse(v);if(Array.isArray(L)&&L.length>0){const Q=L.filter(Z=>Z.fullName&&Z.fullName.trim()!=="");if(Q.length>0){const be=4+Q.length*1.5;C=Math.max(C,be)}}}catch{if(v.includes(`
`)){const Z=4+v.split(`
`).filter(he=>he.trim()!=="").length*1.5;C=Math.max(C,Z)}}if(g&&g.trim()!=="")try{const L=JSON.parse(g);if(Array.isArray(L)&&L.length>0){const Q=L.filter(Z=>Z.fullName&&Z.fullName.trim()!=="");if(Q.length>0){const be=4+Q.length*1.5;C=Math.max(C,be)}}}catch{if(g.includes(`
`)){const Z=4+g.split(`
`).filter(he=>he.trim()!=="").length*1.5;C=Math.max(C,Z)}}return w&&k&&k.length>0&&k.forEach(L=>{const Q=w[L.name];if(Q&&Q.trim()!==""){const Z=Q.split(`
`),Ie=3+Math.max(2,Z.length)*1.6+1;C=Math.max(C,Ie)}}),`${C}rem`},vi=l=>{if(!l||l.trim()==="")return"4.5rem";const g=document.createElement("div");g.style.position="absolute",g.style.visibility="hidden",g.style.width="20rem",g.style.padding="0.5rem",g.style.fontSize="1rem",g.style.lineHeight="1.4",g.style.fontFamily="system-ui, -apple-system, sans-serif",g.style.whiteSpace="pre-wrap",g.style.wordWrap="break-word",g.innerHTML=l,document.body.appendChild(g);const v=g.scrollHeight;document.body.removeChild(g);const w=v/16,k=2.5,C=4.5,L=w+k;return`${Math.max(C,L)}rem`},xi=l=>{if(!l||l.trim()==="")return"3.5rem";let g=1;try{const C=JSON.parse(l);if(Array.isArray(C)){const L=C.filter(Q=>Q.fullName&&Q.fullName.trim()!=="");g=Math.max(1,L.length)}}catch{g=Math.max(1,l.split(`
`).filter(L=>L.trim()!=="").length)}const k=3+(g-1)*1.5;return`${Math.max(3.5,k)}rem`},et=(l,g)=>{const v=document.getElementById("notes-editor");if(v){v.focus();try{switch(l){case"bold":document.execCommand("bold",!1);break;case"italic":document.execCommand("italic",!1);break;case"underline":document.execCommand("underline",!1);break;case"color":g&&document.execCommand("foreColor",!1,g);break;case"highlight":g&&g!=="none"?document.execCommand("backColor",!1,g):document.execCommand("removeFormat",!1);break;case"fontSize":g&&document.execCommand("fontSize",!1,g);break;case"bullet":document.execCommand("insertUnorderedList",!1);break;case"list":document.execCommand("insertOrderedList",!1);break;case"left":document.execCommand("justifyLeft",!1);break;case"center":document.execCommand("justifyCenter",!1);break;case"right":document.execCommand("justifyRight",!1);break;case"undo":document.execCommand("undo",!1);break;case"redo":document.execCommand("redo",!1);break}}catch{console.warn("Formatting command not supported:",l)}}},yi=()=>{const l=document.getElementById("notes-editor");if(l&&De!==null){const g=l.innerHTML;if(De===-1)Nt(v=>({...v,notes:g}));else{const v=T.find(k=>k.id===De)?.notes||"",w=T.find(k=>k.id===De);re(k=>k.map(C=>C.id===De?{...C,notes:g}:C)),w&&P("FIELD_UPDATE",`Updated notes for "${w.segmentName}"`,{changeType:"FIELD_CHANGE",itemId:w.id,itemName:w.segmentName,fieldName:"notes",oldValue:v,newValue:g,details:{fieldType:"text",characterChange:g.length-v.length}})}_e(!1),Ze(null),kt()}},Kl=()=>{if(dt!==null){const l=JSON.stringify(it);if(dt===-1)Nt(g=>({...g,speakersText:l}));else{const g=T.find(w=>w.id===dt)?.speakersText||"",v=T.find(w=>w.id===dt);re(w=>w.map(k=>k.id===dt?{...k,speakersText:l}:k)),v&&P("FIELD_UPDATE",`Updated speakers for "${v.segmentName}"`,{changeType:"FIELD_CHANGE",itemId:v.id,itemName:v.segmentName,fieldName:"speakers",oldValue:g,newValue:l,details:{fieldType:"speakers",speakerCount:it.length,characterChange:l.length-g.length}})}at(!1),wt(null),kt()}},Gl=()=>{if(Ot!==null){const l=document.getElementById("assets-list");if(l){const g=l.querySelectorAll(".asset-item"),v=[];g.forEach(k=>{const C=k.querySelector(".asset-name"),L=k.querySelector(".asset-link");if(C&&L){const Q=C.value.trim(),Z=L.value.trim();Q&&v.push(Z?`${Q}|${Z}`:Q)}});const w=v.join("||");if(Ot===-1)Nt(k=>({...k,assets:w}));else{const k=T.find(L=>L.id===Ot)?.assets||"",C=T.find(L=>L.id===Ot);re(L=>L.map(Q=>Q.id===Ot?{...Q,assets:w}:Q)),C&&P("FIELD_UPDATE",`Updated assets for "${C.segmentName}"`,{changeType:"FIELD_CHANGE",itemId:C.id,itemName:C.segmentName,fieldName:"assets",oldValue:k,newValue:w,details:{fieldType:"assets",assetCount:v.length,characterChange:w.length-k.length}})}Mt(!1),vn(null),kt()}}},bi=()=>{const l=document.getElementById("assets-list");if(l){const g=document.createElement("div");g.className="asset-item p-3 bg-slate-700 rounded-lg space-y-3",g.innerHTML=`
        <div class="flex gap-3 items-center">
          <input type="text" class="asset-name flex-1 px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500" placeholder="Asset name..." />
          <button type="button" class="toggle-link px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded transition-colors text-sm">
            + Link
          </button>
          <button type="button" class="remove-asset px-3 py-2 bg-red-600 hover:bg-red-500 text-white rounded transition-colors">Remove</button>
        </div>
        <div class="asset-link-container hidden">
          <input type="url" class="asset-link w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500" placeholder="Enter asset URL..." />
        </div>
      `;const v=g.querySelector(".toggle-link"),w=g.querySelector(".asset-link-container"),k=g.querySelector(".asset-link");v?.addEventListener("click",()=>{w?.classList.contains("hidden")?(w.classList.remove("hidden"),v.textContent="− Link",v.classList.remove("bg-blue-600","hover:bg-blue-500"),v.classList.add("bg-slate-600","hover:bg-slate-500"),k?.focus()):(w?.classList.add("hidden"),v.textContent="+ Link",v.classList.remove("bg-slate-600","hover:bg-slate-500"),v.classList.add("bg-blue-600","hover:bg-blue-500"),k&&(k.value=""))}),g.querySelector(".remove-asset")?.addEventListener("click",()=>{g.remove()}),l.appendChild(g)}},wi=()=>{if(Ut.length>=7)return;const l=Ut.map(w=>w.slot),g=[1,2,3,4,5,6,7].find(w=>!l.includes(w))||1,v={id:`speaker_${Date.now()}`,slot:g,location:"Podium",fullName:"",title:"",org:"",photoLink:""};ir(w=>[...w,v].sort((k,C)=>k.slot-C.slot))},Jl=l=>{ir(g=>g.filter(v=>v.id!==l))},Gn=(l,g,v)=>{ir(w=>w.map(k=>k.id===l?{...k,[g]:v}:k).sort((k,C)=>k.slot-C.slot))},Ql=()=>{if(rn!==null){const l=JSON.stringify(Ut);rn===-1?Nt(g=>({...g,speakers:l})):re(g=>g.map(v=>v.id===rn?{...v,speakers:l}:v)),vs(!1),Fn(null)}},xa=()=>{if(it.length>=7)return;const l=it.map(w=>w.slot),g=[1,2,3,4,5,6,7].find(w=>!l.includes(w))||1,v={id:Date.now().toString(),fullName:"",location:"Podium",slot:g,title:"",org:"",photoLink:""};Et(w=>[...w,v])},Ds=l=>{Et(g=>g.filter(v=>v.id!==l))},wn=(l,g,v)=>{Et(w=>w.map(k=>k.id===l?{...k,[g]:v}:k))},Si=(l,g)=>{if(it.some(w=>w.id!==l&&w.slot===g)){const w=it.find(k=>k.id!==l&&k.slot===g);if(w){const k=it.find(C=>C.id===l);k&&wn(w.id,"slot",k.slot)}}wn(l,"slot",g)},_i=(l,g)=>{const v=Ut.find(k=>k.id===l);if(!v)return;const w=Ut.find(k=>k.id!==l&&k.slot===g);if(w){const k=Ut.map(C=>C.id===l?{...C,slot:g}:C.id===w.id?{...C,slot:v.slot}:C);ir(k)}else Gn(l,"slot",g)},ya=l=>{if(!l)return"Click to add participants...";try{const g=JSON.parse(l);return!Array.isArray(g)||g.length===0?"Click to add participants...":g.sort((v,w)=>v.slot-w.slot).map(v=>`${v.location==="Podium"?"P":v.location==="Seat"?"S":v.location==="Virtual"?"V":"M"}${v.slot} - ${v.fullName||"Unnamed"}`).join(`
`)}catch{return"Click to add participants..."}},bo=l=>{if(!l)return"Click to add speakers...";try{const g=JSON.parse(l);return!Array.isArray(g)||g.length===0?"Click to add speakers...":g.sort((v,w)=>v.slot-w.slot).filter(v=>v.fullName&&v.fullName.trim()!=="").map(v=>`${v.location==="Podium"?"P":v.location==="Seat"?"S":v.location==="Virtual"?"V":"M"}${v.slot} - ${v.fullName||"Unnamed"}`).join(`
`)}catch{return"Click to add speakers..."}},ba=["Podium","2-Shot","3-Shot","4-Shot","5-Shot","6-Shot","7-Shot","Ted-Talk"],Jn=l=>{if(isNaN(l)||l===void 0||l===null)return console.warn("⚠️ formatTime received invalid value:",l),"00:00:00";const g=l<0,v=Math.abs(l),w=Math.floor(v/3600),k=Math.floor(v%3600/60),C=Math.floor(v%60);return`${g?"-":""}${w.toString().padStart(2,"0")}:${k.toString().padStart(2,"0")}:${C.toString().padStart(2,"0")}`},Yl=l=>{if(isNaN(l)||l===void 0||l===null)return console.warn("⚠️ formatSubCueTime received invalid value:",l),"00:00";const g=l<0,v=Math.abs(l),w=Math.floor(v/3600),k=Math.floor(v%3600/60),C=Math.floor(v%60),L=g?"-":"";return w===0?`${L}${k.toString().padStart(2,"0")}:${C.toString().padStart(2,"0")}`:`${L}${w.toString().padStart(2,"0")}:${k.toString().padStart(2,"0")}:${C.toString().padStart(2,"0")}`},Ls=l=>{const g=T.find(w=>w.id===l);if(!g||!g.isIndented)return!1;const v=T.findIndex(w=>w.id===l);if(v===-1)return!1;for(let w=v-1;w>=0;w--){const k=T[w];if(!k.isIndented)return Le[k.id]!==void 0}return!1},Xl=()=>{const l=Object.keys(Le);if(l.length>0){const v=parseInt(l[0]);if(rt[v]){const w=rt[v];return w.total-w.elapsed}}const g=Object.keys(Ye);if(g.length>0){const v=parseInt(g[0]);if(lr[v]){const w=lr[v];return w.total-w.elapsed}}if(Te&&rt[Te]){const v=rt[Te];return v.total-v.elapsed}return 0},Ei=()=>{const l=Object.keys(Le);if(l.length>0){const v=parseInt(l[0]);if(rt[v]){const w=rt[v],k=w.total-w.elapsed;return k<0?0:w.total>0?k/w.total*100:0}}const g=Object.keys(Ye);if(g.length>0){const v=parseInt(g[0]);if(lr[v]){const w=lr[v],k=w.total-w.elapsed;return w.total>0?k/w.total*100:0}}if(Te&&rt[Te]){const v=rt[Te],w=v.total-v.elapsed;return v.total>0?w/v.total*100:0}return 0},ki=()=>{const l=Object.keys(Le);if(l.length>0){const v=parseInt(l[0]);if(rt[v]){const w=rt[v],k=w.total-w.elapsed;return k<0?"bg-red-500":k>120?"#10b981":k>30?"#f59e0b":"#ef4444"}}const g=Object.keys(Ye);if(g.length>0){const v=parseInt(g[0]);if(lr[v]){const w=lr[v],k=w.total-w.elapsed;return k>120?"#10b981":k>30?"#f59e0b":"#ef4444"}}if(Te&&rt[Te]){const v=rt[Te],w=v.total-v.elapsed;return w>120?"#10b981":w>30?"#f59e0b":"#ef4444"}return"transparent"},As=()=>{const l=Object.keys(Le);if(l.length>0){const g=parseInt(l[0]);if(rt[g]){const v=rt[g],w=v.total-v.elapsed;return w>120?"#10b981":w>30?"#f59e0b":"#ef4444"}}if(Te&&rt[Te]){const g=rt[Te],v=g.total-g.elapsed;return v>120?"#10b981":v>30?"#f59e0b":"#ef4444"}return"#ffffff"},ln=async l=>{if(!Te||!i||!r?.id)return;const g=T.find(L=>L.id===Te);if(!g)return;const v=Math.max(0,g.durationHours*3600+g.durationMinutes*60+g.durationSeconds+l),w=Math.floor(v/3600),k=Math.floor(v%3600/60),C=v%60;re(L=>L.map(Q=>Q.id===Te?{...Q,durationHours:w,durationMinutes:k,durationSeconds:C}:Q)),rt[Te]&&(console.log("🔄 Updating timer duration for item:",Te,"new duration:",v),Ft(L=>({...L,[Te]:{...L[Te],total:v}})),Le[Te]?(console.log("✅ Timer duration updated locally for running timer"),await ye.updateTimerDuration(r.id,Te,v)?console.log("✅ Timer duration updated on server - Browser B will see the change"):console.warn("⚠️ Failed to update timer duration on server"),await xo(),console.log("✅ Time adjustment completed locally and on server")):console.log("✅ Timer duration updated locally for loaded timer"))},Ni=async l=>{if(console.log("🚀🚀🚀 loadCue function STARTED with itemId:",l),console.log("🚀🚀🚀 loadCue function STARTED with itemId:",l),console.log("🚀🚀🚀 loadCue function STARTED with itemId:",l),!i||!r?.id){console.log("❌ Missing user or event ID:",{user:!!i,eventId:r?.id});return}Object.keys(Le).forEach(async C=>{if(Le[parseInt(C)]){clearInterval(tr[parseInt(C)]),Rr(Q=>({...Q,[parseInt(C)]:!0}));const L=T.find(Q=>Q.id===parseInt(C));console.log("🟣 About to mark cue as completed:",{eventId:r.id,itemId:parseInt(C),userId:i.id,cueId:L?.customFields?.cue||"CUE"});try{const Q=await ye.markCueCompleted(r.id,parseInt(C),L?.customFields?.cue||"CUE",i.id,i.user_metadata?.full_name||i.email||"Unknown User",d||"VIEWER");console.log("🟣 Mark completed result:",Q)}catch(Q){console.error("❌ Error marking cue as completed:",Q)}}}),wr({}),console.log("🔄 Stopping all timers in Supabase for event:",r.id,"user:",i.id);const g=await ye.stopAllTimersForEvent(r.id,i.id);if(console.log("🔄 Stop all timers result:",g),Te&&Te!==l){qt(Q=>new Set([...Q,Te])),Rr(Q=>({...Q,[Te]:!0}));const C=T.find(Q=>Q.id===Te);console.log("🟣 About to mark active cue as completed:",{eventId:r.id,itemId:Te,userId:i.id,cueId:C?.customFields?.cue||"CUE"});try{const Q=await ye.markCueCompleted(r.id,Te,C?.customFields?.cue||"CUE",i.id,i.user_metadata?.full_name||i.email||"Unknown User",d||"VIEWER");console.log("🟣 Mark active completed result:",Q)}catch(Q){console.error("❌ Error marking active cue as completed:",Q)}const L=T.findIndex(Q=>Q.id===Te);if(L!==-1)for(let Q=L+1;Q<T.length&&T[Q].isIndented;Q++)Rr(Z=>({...Z,[T[Q].id]:!0})),qt(Z=>new Set([...Z,T[Q].id])),await ye.markCueCompleted(r.id,T[Q].id,T[Q].customFields?.cue||"CUE",i.id,i.user_metadata?.full_name||i.email||"Unknown User",d||"VIEWER")}Rr(C=>{const L={...C};delete L[l];const Q=T.findIndex(Z=>Z.id===l);if(Q!==-1)for(let Z=Q+1;Z<T.length&&T[Z].isIndented;Z++)delete L[T[Z].id];return L}),qt(C=>{const L=new Set(C);L.delete(l);const Q=T.findIndex(Z=>Z.id===l);if(Q!==-1)for(let Z=Q+1;Z<T.length&&T[Z].isIndented;Z++)L.delete(T[Z].id);return L});const v=T.find(C=>C.id===l);if(v){console.log("🔄 Item found:",v),console.log("🔄 Item ID type:",typeof v.id,"Value:",v.id),console.log("🔄 Item duration values:",{durationHours:v.durationHours,durationMinutes:v.durationMinutes,durationSeconds:v.durationSeconds});const C=v.durationHours*3600+v.durationMinutes*60+v.durationSeconds;console.log("🔄 Calculated total seconds:",C);const L=typeof l=="string"?parseInt(l):l;console.log("🔄 Numeric item ID:",L),console.log("⚡ Optimistic UI update - showing loaded state immediately"),Ft(ie=>({...ie,[l]:{elapsed:0,total:C,startedAt:null}})),Vr(l),sn(ie=>({...ie,[l]:!0}));const Z=T.findIndex(ie=>ie.id===l)+1,he=Kt(v.customFields.cue),be=v.timerId;console.log("🔄 Loading CUE in Supabase:",{eventId:r.id,itemId:L,userId:i.id,totalSeconds:C,rowNumber:Z,cueDisplay:he,timerId:be}),console.log("🔄 About to call DatabaseService.loadCue..."),console.log("🔄 DatabaseService object:",typeof ye),console.log("🔄 DatabaseService.loadCue function:",typeof ye.loadCue),console.log("🔄 Testing Supabase configuration...");try{const{isSupabaseConfigured:ie}=await ta(async()=>{const{isSupabaseConfigured:ge}=await Promise.resolve().then(()=>Lv);return{isSupabaseConfigured:ge}},void 0);console.log("🔄 Supabase configured:",ie)}catch(ie){console.error("❌ Error importing Supabase config:",ie)}try{console.log("🔄 Calling DatabaseService.loadCue now...");const ie=await ye.loadCue(r.id,L,i.id,C,Z,he,be);console.log("🔄 Load CUE result:",ie),ie?console.log("✅ Load CUE succeeded!"):console.error("❌ Load CUE failed - check database connection and functions")}catch(ie){console.error("❌ Load CUE error:",ie),console.error("❌ Error stack:",ie.stack)}console.log("🔄 Finished loadCue database call"),Wn(L);try{await ye.updateLastLoadedCue(r.id,L,"loaded"),console.log("✅ Last loaded CUE saved")}catch(ie){console.log("⚠️ Could not save last loaded CUE (migration may not be run):",ie)}await xo(),console.log("✅ Load CUE action completed locally")}const w=T.findIndex(C=>C.id===l),k=new Set;if(w!==-1)for(let C=w+1;C<T.length&&T[C].isIndented;C++)k.add(T[C].id);nr(k)},$s=async()=>{if(Object.keys(Le).forEach(l=>{Le[parseInt(l)]&&clearInterval(tr[parseInt(l)])}),Object.keys(Ye).forEach(l=>{Ye[parseInt(l)]&&clearInterval(Ye[parseInt(l)])}),r?.id)try{await ye.clearCompletedCues(r.id),console.log("✅ Cleared completed cues from database"),await ye.clearAllActiveTimersForEvent(r.id),console.log("✅ Cleared all active timers from Supabase")}catch(l){console.warn("⚠️ Failed to clear database:",l)}wr({}),Sr({}),Ft({}),zt({}),Rr({}),Vr(null),qt(new Set),nr(new Set)},Zl=()=>{Or(!1),qe&&!qe.closed&&qe.close();const l=Object.keys(Le),g=l.length>0?T.find(k=>Le[k.id]):T.find(k=>k.id===Te),v={isRunning:l.length>0,elapsedTime:g&&rt[g.id]?rt[g.id].elapsed:0,totalDuration:g?g.durationHours*3600+g.durationMinutes*60+g.durationSeconds:0,eventId:r?.id,mainTimer:g?{cue:g.customFields.cue||"CUE",segmentName:g.segmentName||""}:null,secondaryTimer:ht?{itemId:ht.itemId,remaining:ht.remaining,duration:ht.duration,cue:T.find(k=>k.id===ht.itemId)?.customFields.cue||"CUE",segmentName:T.find(k=>k.id===ht.itemId)?.segmentName||""}:null},w=window.open("/fullscreen-timer","fullScreenTimer","width=1920,height=1080,fullscreen=yes,menubar=no,toolbar=no,location=no,status=no,scrollbars=no,resizable=yes");w&&(Ul(w),w.addEventListener("load",()=>{w.postMessage({type:"TIMER_UPDATE",...v},"*")}))};_.useEffect(()=>{const l=()=>{io(null),nn(null),Or(!1)};return document.addEventListener("click",l),()=>document.removeEventListener("click",l)},[]),_.useEffect(()=>{if(pe&&De!==null){const l=document.getElementById("notes-editor");if(l)if(De===-1)l.innerHTML=Qe.notes||"";else{const g=T.find(v=>v.id===De);l.innerHTML=g?.notes||""}}},[pe,De,T,Qe.notes]),_.useEffect(()=>{if(bt&&dt!==null)if(dt===-1)if(Qe.speakersText)try{const l=JSON.parse(Qe.speakersText);Et(Array.isArray(l)?l:[])}catch{Et([])}else Et([]);else{const l=T.find(g=>g.id===dt);if(l?.speakersText)try{const g=JSON.parse(l.speakersText);Et(Array.isArray(g)?g:[])}catch{Et([])}else Et([])}},[bt,dt,T,Qe.speakersText]),_.useEffect(()=>{if(gt&&Ot!==null){const l=document.getElementById("assets-list");if(l){l.innerHTML="";let g="";Ot===-1?g=Qe.assets||"":g=T.find(w=>w.id===Ot)?.assets||"",g&&g.split("||").forEach(w=>{if(w.trim()){const[k,C]=w.split("|"),L=C&&C.trim()!=="",Q=document.createElement("div");Q.className="asset-item p-3 bg-slate-700 rounded-lg space-y-3",Q.innerHTML=`
                <div class="flex gap-3 items-center">
                  <input type="text" class="asset-name flex-1 px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500" placeholder="Asset name..." value="${k||""}" />
                  <button type="button" class="toggle-link px-3 py-2 text-white rounded transition-colors text-sm ${L?"bg-slate-600 hover:bg-slate-500":"bg-blue-600 hover:bg-blue-500"}">
                    ${L?"− Link":"+ Link"}
                  </button>
                  <button type="button" class="remove-asset px-3 py-2 bg-red-600 hover:bg-red-500 text-white rounded transition-colors">Remove</button>
                </div>
                <div class="asset-link-container ${L?"":"hidden"}">
                  <input type="url" class="asset-link w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500" placeholder="Enter asset URL..." value="${C||""}" />
                </div>
              `;const Z=Q.querySelector(".toggle-link"),he=Q.querySelector(".asset-link-container"),be=Q.querySelector(".asset-link");Z?.addEventListener("click",()=>{he?.classList.contains("hidden")?(he.classList.remove("hidden"),Z.textContent="− Link",Z.classList.remove("bg-blue-600","hover:bg-blue-500"),Z.classList.add("bg-slate-600","hover:bg-slate-500"),be?.focus()):(he?.classList.add("hidden"),Z.textContent="+ Link",Z.classList.remove("bg-slate-600","hover:bg-slate-500"),Z.classList.add("bg-blue-600","hover:bg-blue-500"),be&&(be.value=""))}),Q.querySelector(".remove-asset")?.addEventListener("click",()=>{Q.remove()}),l.appendChild(Q)}}),l.children.length===0&&bi()}}},[gt,Ot,T,Qe.assets]),_.useEffect(()=>{if(ps&&rn!==null)if(rn===-1)if(Qe.speakers)try{const l=JSON.parse(Qe.speakers);ir(Array.isArray(l)?l:[])}catch{ir([])}else ir([]);else{const l=T.find(g=>g.id===rn);if(l?.speakers)try{const g=JSON.parse(l.speakers);ir(Array.isArray(g)?g:[])}catch{ir([])}else ir([])}},[ps,rn,T,Qe.speakers]);const kr=Cl.useCallback(wa(async()=>{if(r?.id)try{const l={event_id:r.id,event_name:r.name,event_date:r.date,schedule_items:T,custom_columns:de,settings:{eventName:fe,masterStartTime:ve,dayStartTimes:we,lastSaved:new Date().toISOString()}};console.log("🔄 Auto-saving to Supabase:",{eventId:r.id,scheduleItemsCount:T.length,customColumnsCount:de.length,eventName:fe,masterStartTime:ve,sampleScheduleItem:T[0]?{id:T[0].id,segmentName:T[0].segmentName,speakersText:T[0].speakersText?"Has speakers data":"No speakers data",speakers:T[0].speakers?"Has speakers data":"No speakers data"}:"No schedule items"});const g=await ye.saveRunOfShowData(l,{userId:i?.id||"unknown",userName:i?.user_metadata?.full_name||i?.email||"Unknown User",userRole:d||"VIEWER"});console.log("✅ Auto-saved to Supabase successfully")}catch(l){console.error("❌ Error auto-saving to Supabase:",l)}},1e3),[r?.id,r?.name,r?.date,T,de,fe,ve,we]);function wa(l,g){let v;return((...w)=>{clearTimeout(v),v=setTimeout(()=>l(...w),g)})}const Sa=_.useCallback(async()=>{if(r?.id)try{console.log("🔄 Loading from Supabase for event:",r.id);const l=ye.getRunOfShowData(r.id),g=new Promise((w,k)=>setTimeout(()=>k(new Error("Database query timeout after 10 seconds")),1e4)),v=await Promise.race([l,g]);if(console.log("🔍 Debug - Raw data from Supabase:",v),console.log("🔍 Debug - schedule_items:",v?.schedule_items),console.log("🔍 Debug - custom_columns:",v?.custom_columns),console.log("🔍 Debug - settings:",v?.settings),v)console.log("📥 Data loaded from Supabase:",{scheduleItemsCount:v.schedule_items?.length||0,customColumnsCount:v.custom_columns?.length||0,eventName:v.settings?.eventName,masterStartTime:v.settings?.masterStartTime,sampleScheduleItem:v.schedule_items?.[0]?{id:v.schedule_items[0].id,segmentName:v.schedule_items[0].segmentName,speakersText:v.schedule_items[0].speakersText?"Has speakers data":"No speakers data",speakers:v.schedule_items[0].speakers?"Has speakers data":"No speakers data"}:"No schedule items"}),re(v.schedule_items||[]),Ne(v.custom_columns||[]),v.settings?.eventName&&me(v.settings.eventName),v.settings?.masterStartTime&&Ve(v.settings.masterStartTime),v.settings?.dayStartTimes&&z(v.settings.dayStartTimes),F(v.updated_at||null),ce(!1),Me({show:!1}),console.log("✅ Run of Show data loaded from Supabase successfully");else{console.log("ℹ️ No data found in Supabase, falling back to localStorage for event:",r.id);const w=localStorage.getItem(`runOfShowSchedule_${r.id}`),k=localStorage.getItem(`customColumns_${r.id}`),C=localStorage.getItem(`eventName_${r.id}`),L=localStorage.getItem(`masterStartTime_${r.id}`),Q=localStorage.getItem(`dayStartTimes_${r.id}`);if(w)try{const Z=JSON.parse(w);console.log("🔍 Parsed schedule from localStorage:",Z);const he=Z.map(be=>({...be,day:be.day||1}));re(he),console.log("📥 Loaded schedule from localStorage:",he.length,"items"),console.log("🔍 First few items:",he.slice(0,3))}catch(Z){console.error("❌ Error parsing schedule from localStorage:",Z),console.log("🔍 Raw localStorage data:",w)}else console.log("❌ No schedule found in localStorage for event:",r.id);k&&(Ne(JSON.parse(k)),console.log("📥 Loaded custom columns from localStorage")),C&&(me(C),console.log("📥 Loaded event name from localStorage")),L&&(Ve(L),console.log("📥 Loaded master start time from localStorage")),Q&&(z(JSON.parse(Q)),console.log("📥 Loaded day start times from localStorage"))}}catch(l){console.error("❌ Error loading run of show data from Supabase:",l),console.error("❌ Error details:",{message:l.message,stack:l.stack,eventId:r?.id}),console.log("🔄 Falling back to localStorage due to error");const g=localStorage.getItem(`runOfShowSchedule_${r.id}`);if(g)try{const w=JSON.parse(g).map(k=>({...k,day:k.day||1}));re(w),console.log("📥 Loaded schedule from localStorage after error:",w.length,"items"),console.log("🔍 First few items after error:",w.slice(0,3))}catch(v){console.error("❌ Error parsing schedule from localStorage after error:",v),console.log("🔍 Raw localStorage data after error:",g)}else console.log("❌ No schedule found in localStorage after error for event:",r.id)}},[r?.id]),_a=_.useCallback(async()=>{if(r?.id)try{console.log("🔄 Loading changes dynamically for event:",r.id);const l=await ye.loadChangesDynamically(r.id);l&&(console.log("📥 Dynamic changes loaded:",{scheduleItemsCount:l.schedule_items?.length||0,customColumnsCount:l.custom_columns?.length||0,lastModifiedBy:l.last_modified_by_name}),re(l.schedule_items||[]),Ne(l.custom_columns||[]),l.settings?.eventName&&me(l.settings.eventName),l.settings?.masterStartTime&&Ve(l.settings.masterStartTime),l.settings?.dayStartTimes&&z(l.settings.dayStartTimes),F(l.updated_at||null),ce(!1),Me({show:!1}),console.log("✅ Changes loaded dynamically - timers preserved"))}catch(l){console.error("❌ Error loading changes dynamically:",l)}},[r?.id]);_.useEffect(()=>{console.log("🔄 useEffect triggered for event ID:",r?.id),r?.id?(console.log("🔄 Calling loadFromSupabase for event:",r.id),Sa()):console.log("❌ No event ID available for loading data")},[r?.id]),_.useEffect(()=>{console.log("📊 Schedule state changed:",{scheduleLength:T.length,firstItem:T[0]?{id:T[0].id,segmentName:T[0].segmentName,programType:T[0].programType}:"No items",eventId:r?.id})},[T,r?.id]);const wo=async()=>{if(!r?.id){console.log("❌ No event ID available for loading backups");return}try{if(console.log("🔄 Loading backups for event:",r.id),console.log("🔄 Event details:",{id:r.id,name:r.name}),!await to.testBackupTable())throw new Error("Backup table is not accessible");const g=await to.getBackupsForEvent(r.id);console.log("📊 Raw backup data received:",g),_s(g),console.log("🔄 Loading backup stats...");const v=await to.getBackupStats(r.id);console.log("📊 Backup stats:",v),Bn(v),console.log(`✅ Loaded ${g.length} backups successfully`)}catch(l){console.error("❌ Error loading backups:",l),console.error("❌ Error details:",{message:l.message,stack:l.stack,eventId:r?.id}),_s([]),Bn({totalBackups:0,lastBackup:null,autoBackups:0,manualBackups:0})}},ji=async()=>{if(r?.id)try{console.log("🔄 Creating manual backup for event:",r.id);const l=new Date().toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}),g=`${r.name} • ${l}`;await to.createBackup(r.id,T,de,r,"manual",g),console.log("✅ Manual backup created:",g);const v=await to.getBackupStats(r.id);Bn(v),alert(`✅ Manual backup created successfully!

Backup: ${g}
Schedule Items: ${T.length}
Custom Columns: ${de.length}`)}catch(l){console.error("❌ Error creating manual backup:",l),alert(`❌ Error creating manual backup: ${l.message}`)}},ec=l=>{ca(l),fo(!0)},tc=async()=>{if(!(!r?.id||!rr))try{console.log("🔄 Restoring from backup:",rr.id);const l=await to.restoreFromBackup(rr.id);re(l.scheduleData),Ne(l.customColumnsData),localStorage.setItem(`runOfShowSchedule_${r.id}`,JSON.stringify(l.scheduleData)),localStorage.setItem(`customColumns_${r.id}`,JSON.stringify(l.customColumnsData)),await ye.saveRunOfShowData({event_id:r.id,schedule_items:l.scheduleData,custom_columns:l.customColumnsData}),console.log("✅ Restored from backup:",l.backupName),fo(!1),la(!1),ca(null),alert(`✅ Data restored from backup!

Backup: ${l.backupName}
Date: ${new Date(l.backupTimestamp).toLocaleString()}

Schedule Items: ${l.scheduleData.length}
Custom Columns: ${l.customColumnsData.length}`)}catch(l){console.error("❌ Error restoring from backup:",l),alert(`❌ Error restoring from backup: ${l.message}`)}},rc=async l=>{if(confirm("Are you sure you want to delete this backup?"))try{console.log("🔄 Deleting backup:",l),await to.deleteBackup(l),console.log("✅ Backup deleted successfully"),alert("Backup deleted successfully"),await wo()}catch(g){console.error("❌ Error deleting backup:",g),alert(`Error deleting backup: ${g.message}`)}};_.useEffect(()=>{if(!r?.id){console.log("❌ No event ID, skipping change detection");return}console.log("🔄 Starting change detection for event:",r.id),Pt();const l=async()=>{try{if(Bl){console.log("⏭️ Skipping sync check - user just made a change"),fi(!1),Pt();return}if(Hn){console.log("✏️ Skipping sync check - user is actively editing");return}console.log("🔄 Running change check...");const v=await ye.checkForChanges(r.id,E??void 0);v.hasChanges?(console.log("🔄 Changes detected:",v),ce(!0),Me({show:!0,lastModifiedBy:v.lastModifiedBy,lastModifiedByName:v.lastModifiedByName}),Br?(console.log("🔄 Loading changes automatically..."),await _a()):console.log("👁️ Changes detected but page not visible - will load when page becomes visible")):console.log("✅ No changes detected")}catch(v){console.error("❌ Error checking for changes:",v)}};l();const g=setInterval(l,2e4);return()=>{clearInterval(g),bn()}},[r?.id,E,Br,bn]),_.useEffect(()=>{Br&&ee&&(console.log("👁️ Page became visible with pending changes - loading changes..."),_a())},[Br,ee]),_.useEffect(()=>{uo&&r?.id&&wo()},[uo,r?.id]),_.useEffect(()=>{const l=()=>{const g=!document.hidden;console.log(`🔄 Page visibility changed: ${g?"visible":"hidden"}`),Es(g),g?(console.log("🔄 Page became visible, checking for changes..."),nc()):(da(new Date),console.log("🔄 Page became hidden, recording last sync time"))};return document.addEventListener("visibilitychange",l),()=>document.removeEventListener("visibilitychange",l)},[]);const nc=async()=>{if(!r?.id||!ua){console.log("🔄 No event ID or last sync time, skipping change check");return}try{console.log("🔄 Checking for changes since last sync...");const l=await ye.getRunOfShowData(r.id);if(l){const g=new Date(l.last_change_at||new Date);console.log("🔄 Latest change time:",g),console.log("🔄 Last sync time:",ua),g>ua?(console.log("🔄 Changes detected since last sync, updating local data..."),re(l.schedule_items||[]),Ne(l.custom_columns||[]),localStorage.setItem(`runOfShowSchedule_${r.id}`,JSON.stringify(l.schedule_items||[])),localStorage.setItem(`customColumns_${r.id}`,JSON.stringify(l.custom_columns||[])),console.log("✅ Local data updated with latest changes")):console.log("✅ No changes detected since last sync")}}catch(l){console.error("❌ Error checking for changes on return:",l)}};_.useEffect(()=>{r?.id&&(localStorage.setItem(`runOfShowSchedule_${r.id}`,JSON.stringify(T)),window.dispatchEvent(new CustomEvent("scheduleUpdated",{detail:{eventId:r.id,schedule:T}})),console.log("📝 Schedule saved and event dispatched for event:",r.id),kr())},[T,r?.id,kr]),_.useEffect(()=>{if(!r?.id)return;const l=()=>{console.log("🔄 Updating graphics data for live JSON files..."),localStorage.setItem(`runOfShowSchedule_${r.id}`,JSON.stringify(T)),localStorage.setItem(`customColumns_${r.id}`,JSON.stringify(de)),localStorage.setItem(`eventName_${r.id}`,fe),localStorage.setItem(`masterStartTime_${r.id}`,ve),localStorage.setItem(`dayStartTimes_${r.id}`,JSON.stringify(we)),window.dispatchEvent(new CustomEvent("scheduleUpdated",{detail:{eventId:r.id,schedule:T}}))};l();const g=setInterval(l,1e4);return()=>clearInterval(g)},[r?.id,T,de,fe,ve,we]),_.useEffect(()=>{r?.id&&(localStorage.setItem(`customColumns_${r.id}`,JSON.stringify(de)),kr())},[de,r?.id,kr]),_.useEffect(()=>{r?.id&&(localStorage.setItem(`eventName_${r.id}`,fe),kr())},[fe,r?.id,kr]),_.useEffect(()=>{r?.id&&(localStorage.setItem(`masterStartTime_${r.id}`,ve),kr())},[ve,r?.id,kr]),_.useEffect(()=>{r?.id&&(localStorage.setItem(`dayStartTimes_${r.id}`,JSON.stringify(we)),kr())},[we,r?.id,kr]),_.useEffect(()=>{if(qe&&!qe.closed){const l=Object.keys(Le),g=l.length>0?T.find(w=>Le[w.id]):T.find(w=>w.id===Te),v={type:"TIMER_UPDATE",isRunning:l.length>0,elapsedTime:g&&rt[g.id]?rt[g.id].elapsed:0,totalDuration:g&&rt[g.id]?rt[g.id].total:g?g.durationHours*3600+g.durationMinutes*60+g.durationSeconds:0,eventId:r?.id,itemId:g?.id,mainTimer:g?{cue:g.customFields.cue||"CUE",segmentName:g.segmentName||""}:null,secondaryTimer:ht?{itemId:ht.itemId,remaining:ht.remaining,duration:ht.duration,cue:T.find(w=>w.id===ht.itemId)?.customFields.cue||"CUE",segmentName:T.find(w=>w.id===ht.itemId)?.segmentName||""}:null};qe.postMessage(v,"*")}},[Le,rt,Te,T,ve,fe,qe,ht]);const sc=l=>{const g=()=>{const k="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let C="";for(let L=0;L<5;L++)C+=k.charAt(Math.floor(Math.random()*k.length));return C},v={...l,id:Date.now(),timerId:g(),isIndented:l.isIndented||!1,customFields:{cue:l.cue?`CUE${l.cue}`:"CUE"}};br!==null?(re(k=>{const C=[...k];return C.splice(br+1,0,v),C}),tn(null)):re(k=>[...k,v]);const w=br!==null?br+2:T.length+1;P("ADD_ITEM",`Added new schedule item: "${v.segmentName}"`,{changeType:"ADD",itemId:v.id,itemName:v.segmentName,rowNumber:w,cueNumber:v.customFields.cue?parseInt(v.customFields.cue,10):null,details:{day:v.day,programType:v.programType,shotType:v.shotType,position:`Row ${w}`,durationHours:v.durationHours,durationMinutes:v.durationMinutes,totalDurationMinutes:v.durationHours*60+v.durationMinutes,speakers:v.speakers||"None",speakersText:v.speakersText||"None",notes:v.notes||"",assets:v.assets||"None",hasPPT:v.hasPPT,hasQA:v.hasQA,timerId:v.timerId,isPublic:v.isPublic,isIndented:v.isIndented}}),Fe(!1),kt(),Nt({cue:"",day:D,programType:"PreShow/End",shotType:"",segmentName:"",durationHours:0,durationMinutes:0,durationSeconds:0,notes:"",assets:"",speakers:"",speakersText:"",hasPPT:!1,hasQA:!1,timerId:"",isPublic:!1,isIndented:!1,customFields:{}})},ur=l=>{const g={name:l,id:Date.now().toString()};Ne(v=>[...v,g]),re(v=>v.map(w=>({...w,customFields:{...w.customFields,[l]:""}}))),P("COLUMN_ADD",`Added custom column "${l}"`,{changeType:"COLUMN_ADD",columnName:l,details:{columnType:"text",affectedItems:T.length,defaultValue:""}}),te(!1),kt()},Ms=l=>{const g=de.find(v=>v.id===l);g&&(Ne(v=>v.filter(w=>w.id!==l)),re(v=>v.map(w=>{const{[g.name]:k,...C}=w.customFields;return{...w,customFields:C}})),P("COLUMN_REMOVE",`Removed custom column "${g.name}"`,{changeType:"COLUMN_REMOVE",columnName:g.name,details:{affectedItems:T.length,columnId:g.id}}))},lt=(l,g)=>{l.preventDefault(),l.stopPropagation();const v=l.clientX,w=We[g]||256;document.body.style.cursor="col-resize",document.body.style.userSelect="none";const k=L=>{const Q=L.clientX-v,Z=Math.max(100,w+Q);ui(he=>({...he,[g]:Z}))},C=()=>{document.body.style.cursor="",document.body.style.userSelect="",document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",C)};document.addEventListener("mousemove",k),document.addEventListener("mouseup",C)},Ea=(l,g)=>{l.preventDefault(),l.stopPropagation();const v=l.clientX,w=js[g]||256;document.body.style.cursor="col-resize",document.body.style.userSelect="none";const k=L=>{const Q=L.clientX-v,Z=Math.max(100,w+Q);ha(he=>({...he,[g]:Z}))},C=()=>{document.body.style.cursor="",document.body.style.userSelect="",document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",C)};document.addEventListener("mousemove",k),document.addEventListener("mouseup",C)},Qn=async l=>{if(!(!i||!r?.id))if(Le[l]){clearInterval(tr[l]);const g=`${l}_drift`;Le[g]&&clearInterval(tr[g]),wr(w=>{const k={...w};return delete k[l],delete k[g],k}),Cr(w=>{const k={...w};return delete k[l],delete k[g],k}),fn.stopMonitoring(l),lo(w=>{const k=new Set(w);return k.delete(l),k}),Rr(w=>({...w,[l]:!0})),qt(w=>new Set([...w,l]));try{const w=T.find(k=>k.id===l);await ye.markCueCompleted(r.id,l,w?.customFields?.cue||"CUE",i.id,i.user_metadata?.full_name||i.email||"Unknown User",d||"VIEWER")}catch(w){console.warn("⚠️ Failed to mark cue as completed in database:",w),console.log("💡 This means the completed_cues table needs to be created first")}const v=T.findIndex(w=>w.id===l);if(v!==-1)for(let w=v+1;w<T.length&&T[w].isIndented;w++)Rr(k=>({...k,[T[w].id]:!0})),qt(k=>new Set([...k,T[w].id])),await ye.markCueCompleted(r.id,T[w].id,T[w].customFields?.cue||"CUE",i.id,i.user_metadata?.full_name||i.email||"Unknown User",d||"VIEWER");sn(w=>{const k={...w};return delete k[l],k}),Te===l&&Vr(null),Ft(w=>{const k={...w};return delete k[l],k}),console.log("🔄 Stopping timer in Supabase for item:",l),await ye.stopTimer(r.id,l,i.id),console.log("✅ Timer stopped in Supabase");try{await ye.updateLastLoadedCue(r.id,l,"stopped"),console.log("✅ Last loaded CUE saved as stopped")}catch(w){console.log("⚠️ Could not save last loaded CUE as stopped (migration may not be run):",w)}await xo()}else{if(Object.keys(Le).length>0)return;const g=T.find(v=>v.id===l);if(g){const v=g.durationHours*3600+g.durationMinutes*60+g.durationSeconds;console.log("⚡ Optimistic UI update - showing running state immediately");const w=new Date;Ft(ie=>({...ie,[l]:{elapsed:0,total:v,startedAt:w}}));const k=setInterval(()=>{Ft(ie=>{if(ie[l]){if(ii.has(l)&&Le[l]&&ie[l]?.startedAt)return console.log(`🔄 Timer ${l}: Skipping local update - using server-synced time (Browser A)`),ie;const ge=Date.now(),Ie=ie[l].startedAt;let Xe;Ie instanceof Date?Xe=Ie.getTime():typeof Ie=="string"?Xe=new Date(Ie).getTime():(console.warn("⚠️ startedAt is not a Date or string:",Ie),Xe=ge);const ct=Math.floor((ge-Xe)/1e3),hr=v-ct;return fn.updateLocalElapsed(l,ct),ct<=10&&console.log(`🕐 Timer ${l}: Elapsed=${ct}s, Remaining=${hr}s, Start=${new Date(Xe).toISOString()}, Now=${new Date(ge).toISOString()}`),{...ie,[l]:{...ie[l],elapsed:ct}}}return ie})},100);Cr(ie=>({...ie,[l]:k})),wr(ie=>({...ie,[l]:!0})),console.log(`🔄 Starting drift detection for timer ${l} with duration ${v}s`),console.log("🔄 Drift detector config:",fn.getConfig()),fn.startMonitoring(l,w,v,ie=>{console.log(`🔄 DriftDetector: Syncing timer ${l} with server elapsed: ${ie}s`),lo(ge=>{const Ie=new Set([...ge,l]);return console.log(`🔄 DriftDetector: Marking timer ${l} as server-synced. Server-synced timers:`,Array.from(Ie)),Ie}),Ft(ge=>{const Ie={...ge,[l]:{...ge[l],elapsed:ie}};return console.log(`🔄 DriftDetector: Updated timer ${l} progress to elapsed: ${ie}s`),Ie})});const C=fn.getStatus();console.log("🔄 Drift detector status after starting:",C),console.log(`🔄 Timer ${l} will run locally until first drift sync`);const Q=T.findIndex(ie=>ie.id===l)+1,Z=Kt(g.customFields.cue),he=g.timerId;console.log("🔄 Starting timer in Supabase for item:",l,"at:",w.toISOString(),"row:",Q,"cue:",Z,"timerId:",he);try{const ie=await ye.startTimer(r.id,l,i.id,v,w,Q,Z,he);console.log("✅ Timer started in Supabase:",ie),ie||console.error("❌ Start timer failed - check database connection and functions")}catch(ie){console.error("❌ Start timer error:",ie)}try{await ye.updateLastLoadedCue(r.id,l,"running"),console.log("✅ Last loaded CUE saved as running")}catch(ie){console.log("⚠️ Could not save last loaded CUE as running (migration may not be run):",ie)}const be=setInterval(async()=>{try{console.log(`🔄 DriftDetector: Starting periodic sync for timer ${l}`),await fn.forceSync(l,async()=>{const ge=(await ye.getActiveTimer(r.id))?.elapsed_seconds||0;return console.log(`🔄 DriftDetector: Server returned elapsed: ${ge}s for timer ${l}`),ge}),console.log(`🔄 DriftDetector: Periodic sync completed for timer ${l}`)}catch(ie){console.warn(`⚠️ DriftDetector: Failed to sync timer ${l}:`,ie)}},3e4);Cr(ie=>({...ie,[`${l}_drift`]:be})),console.log("✅ Timer started locally with drift detection enabled"),await xo(),qt(ie=>{const ge=new Set(ie);ge.delete(l);const Ie=T.findIndex(Xe=>Xe.id===l);if(Ie!==-1)for(let Xe=Ie+1;Xe<T.length&&T[Xe].isIndented;Xe++)ge.delete(T[Xe].id);return ge})}}},Ti=async l=>{if(!(!i||!r?.id)){if(console.log("🔄 Reset timer for item:",l),Le[l]){clearInterval(tr[l]);const g=`${l}_drift`;tr[g]&&clearInterval(tr[g]),wr(v=>{const w={...v};return delete w[l],delete w[g],w}),Cr(v=>{const w={...v};return delete w[l],delete w[g],w}),fn.stopMonitoring(l),lo(v=>{const w=new Set(v);return w.delete(l),w}),Ft(v=>{const w={...v};return delete w[l],w});try{await ye.stopTimer(r.id,l,i.id),console.log("✅ Timer reset in Supabase")}catch(v){console.error("❌ Error resetting timer in database:",v)}}sn(g=>{const v={...g};return delete v[l],v}),Te===l&&Vr(null),console.log("✅ Timer reset completed for item:",l)}},ka=async l=>{if(!i||!r?.id)return;const g=T.find(v=>v.id===l);if(g&&g.isIndented){const v=g.durationHours*3600+g.durationMinutes*60+g.durationSeconds;console.log("🟠 Starting secondary timer for item:",l,"Duration:",v,"s"),zt(k=>({...k,[l]:{elapsed:0,total:v,startedAt:new Date}}));const w=setInterval(()=>{zt(k=>{const C=k[l];if(!C)return k;const L=Math.floor((Date.now()-(C.startedAt?.getTime()||Date.now()))/1e3);return Math.max(0,C.total-L),{...k,[l]:{...C,elapsed:L}}}),Ir(k=>{if(!k)return null;if(Ts)return k;const C=k.startedAt?.getTime()||Date.now(),L=Math.floor((Date.now()-C)/1e3),Q=Math.max(0,k.duration-L);if(Q===0){console.log("⏰ Sub-cue timer reached 0 - holding for a beat");const Z=r?.id;console.log("⏰ Current event ID for database call:",Z),setTimeout(()=>{console.log("⏰ Sub-cue timer auto-stopping after hold - clearing local state"),xs&&(clearInterval(xs),Vn(null)),Object.keys(Ye).forEach(he=>{Ye[parseInt(he)]&&clearInterval(Ye[parseInt(he)])}),Sr({}),zt({}),Ir(null),setTimeout(async()=>{try{if(Z){console.log("⏰ Clearing sub-cue timer from database after 3s delay with event ID:",Z);const he=await ye.stopSubCueTimer(Z);console.log("⏰ Database stop result:",he),console.log("⏰ Sub-cue timer stopped in database (is_active = false)")}else console.error("❌ No event ID available for database call")}catch(he){console.error("❌ Error stopping sub-cue timer in database:",he),console.error("❌ Error details:",he)}},3e3)},1e3)}return{...k,remaining:Q}})},1e3);Sr(k=>({...k,[l]:w})),Ir({itemId:l,remaining:v,duration:v,isActive:!0,startedAt:new Date,timerState:"running"});try{console.log("🟠 User ID:",i.id,"Event ID:",r.id);const k=T.find(Z=>Z.id===l),C=T.findIndex(Z=>Z.id===l)+1,L=k?Kt(k.customFields.cue):`CUE ${l}`,Q=k?.timerId||`SUB${l}`;try{console.log("🔄 Starting sub-cue timer for item:",l,"(will auto-stop any existing timers)");const Z=await ye.startSubCueTimer(r.id,l,i.id,v,C,L,Q);console.log("✅ Secondary timer started in Supabase for item:",l,"Result:",Z),Z?.error&&console.error("❌ Secondary timer database error:",Z.error)}catch(Z){console.error("❌ Secondary timer call failed:",Z)}try{console.log("✅ Sub-cue timer started locally"),console.log("✅ Secondary timer action broadcasted")}catch(Z){console.error("❌ Error broadcasting secondary timer action:",Z)}await vo()}catch(k){console.error("❌ Error starting secondary timer:",k),clearInterval(w),Sr(C=>{const L={...C};return delete L[l],L}),zt(C=>{const L={...C};return delete L[l],L})}}},oc=async()=>{if(r?.id){console.log("🛑 Stopping secondary timer..."),Ir(null),xs&&(clearInterval(xs),Vn(null)),Object.keys(Ye).forEach(l=>{Ye[parseInt(l)]&&clearInterval(Ye[parseInt(l)])}),Sr({}),zt({}),console.log("✅ Local secondary timer state cleared");try{console.log("🛑 Stopping sub-cue timer in database with event ID:",r.id);const l=await ye.stopSubCueTimer(r.id);console.log("🛑 Database stop result:",l),console.log("🛑 Secondary timer stopped in database (is_active = false)");try{console.log("🛑 Broadcasting STOP_SECONDARY_TIMER action..."),console.log("✅ Sub-cue timer stopped locally"),console.log("✅ Secondary timer stop action broadcasted successfully")}catch(g){console.error("❌ Error broadcasting secondary timer stop action:",g)}}catch(l){console.error("❌ Error stopping sub-cue timer in database:",l),console.error("❌ Error details:",l)}try{await vo()}catch(l){console.error("❌ Error loading updated timer from Supabase:",l)}}},ac=l=>{if(window.confirm("Delete this schedule item?")){const g=T.find(v=>v.id===l);if(re(v=>v.filter(w=>w.id!==l)),nn(null),g){const v=T.findIndex(w=>w.id===l)+1;P("REMOVE_ITEM",`Deleted schedule item: "${g.segmentName}"`,{changeType:"DELETE",itemId:g.id,itemName:g.segmentName,rowNumber:v,cueNumber:g.customFields.cue?parseInt(g.customFields.cue,10):null,details:{day:g.day,programType:g.programType,shotType:g.shotType,position:`Row ${v}`,durationHours:g.durationHours,durationMinutes:g.durationMinutes,totalDurationMinutes:g.durationHours*60+g.durationMinutes,speakers:g.speakers||"None",speakersText:g.speakersText||"None",notes:g.notes||"",assets:g.assets||"None",hasPPT:g.hasPPT,hasQA:g.hasQA,timerId:g.timerId,isPublic:g.isPublic,isIndented:g.isIndented}})}}},Sn=(l,g)=>{const v=T.findIndex(Q=>Q.id===l);if(v===-1)return;const w=g==="up"?v-1:v+1;if(w<0||w>=T.length)return;const k=T[v],C=v+1,L=w+1;re(Q=>{const Z=[...Q];return[Z[v],Z[w]]=[Z[w],Z[v]],Z}),k&&P("MOVE_ITEM",`Moved "${k.segmentName}" from row ${C} to row ${L}`,{changeType:"MOVE",itemId:k.id,itemName:k.segmentName,details:{fromRow:C,toRow:L,direction:g}}),nn(null)},Na=(l,g)=>{const v=T.findIndex(Q=>Q.id===l);if(v===-1)return;const w=g-1;if(w<0||w>=T.length||w===v)return;const k=T[v],C=v+1,L=g;re(Q=>{const Z=[...Q],he=Z[v];return Z.splice(v,1),Z.splice(w,0,he),Z}),k&&P("MOVE_ITEM",`Moved "${k.segmentName}" from row ${C} to row ${L}`,{changeType:"MOVE",itemId:k.id,itemName:k.segmentName,details:{fromRow:C,toRow:L,direction:"specific"}}),nn(null)},_n=l=>{const g=T[l];if(!g||g.isIndented)return"";const v=g.day||1,w=we[v]||ve;if(!w)return"";let k=0;for(let ge=0;ge<l;ge++){const Ie=T[ge];(Ie.day||1)===v&&!Ie.isIndented&&(k+=(Ie.durationHours||0)*3600+(Ie.durationMinutes||0)*60+(Ie.durationSeconds||0))}const[C,L]=w.split(":").map(Number),Z=C*3600+L*60+k,he=Math.floor(Z/3600)%24,be=Math.floor(Z%3600/60),ie=new Date;return ie.setHours(he,be,0,0),ie.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})},dr=()=>T.filter(l=>(l.day||1)===D);return _.useEffect(()=>{const l=()=>{const g=window.pageYOffset||document.documentElement.scrollTop;ys(g>100)};return window.addEventListener("scroll",l),()=>window.removeEventListener("scroll",l)},[]),_.useEffect(()=>{const l=document.getElementById("main-scroll-container");if(!l)return;let g=!1;const v=(L,Q)=>{g||(g=!0,Q.scrollLeft=L.scrollLeft,requestAnimationFrame(()=>{g=!1}))},w=()=>{const L=document.querySelector(".sticky-header-scroll-container");L&&v(l,L)},k=()=>{const L=document.querySelector(".sticky-header-scroll-container");L&&v(L,l)};l.addEventListener("scroll",w);const C=new MutationObserver(()=>{const L=document.querySelector(".sticky-header-scroll-container");L&&L.addEventListener("scroll",k)});return C.observe(document.body,{childList:!0,subtree:!0}),()=>{l.removeEventListener("scroll",w),C.disconnect()}},[]),_.useEffect(()=>{Te!==null&&setTimeout(()=>{gi()},100)},[Te,Ht]),_.useEffect(()=>{if(Ht&&Object.keys(Le).length>0){const l=parseInt(Object.keys(Le)[0]),g=document.querySelector(`[data-item-id="${l}"]`);g&&setTimeout(()=>{const v=document.querySelector("#main-scroll-container .h-24");let w=100;if(v){const L=v.getBoundingClientRect(),Q=document.querySelector("#main-scroll-container")?.getBoundingClientRect();Q&&(w=L.bottom-Q.top-120)}const k=g.getBoundingClientRect(),C=document.querySelector("#main-scroll-container")?.getBoundingClientRect();if(C){const L=k.top-C.top-w;window.scrollTo({top:L,behavior:"smooth"})}},100)}},[Le,Ht]),r?s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-slate-200",children:[!Br&&s.jsxs("div",{className:"fixed top-4 right-4 z-50 bg-yellow-600 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 bg-yellow-300 rounded-full animate-pulse"}),s.jsx("span",{className:"text-sm font-medium",children:"Tab Hidden - Syncing Paused"})]}),s.jsx(cm,{isOpen:x,onClose:()=>y(!1),onRoleSelected:l=>{if(p(l),r?.id&&i?.id)try{const g=i.user_metadata?.full_name||i.email||"Unknown";ye.saveUserSession(r.id,i.id,g,l),console.log("✅ Role saved to Supabase from RunOfShowPage:",l)}catch(g){console.error("❌ Failed to save role to Supabase from RunOfShowPage:",g)}y(!1)},eventId:r?.id||""}),Os&&Ps&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-slate-800 rounded-lg p-6 max-w-md w-full mx-4 border-2 border-orange-500",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-orange-400 text-2xl font-bold mb-4",children:"⏰ Timer Running"}),s.jsx("div",{className:"text-white text-lg mb-2",children:s.jsx("strong",{children:Ps.cueName})}),s.jsxs("div",{className:"text-orange-300 text-xl font-mono mb-6",children:[Ps.remainingTime," remaining"]}),s.jsxs("div",{className:"flex gap-3 justify-center",children:[s.jsx("button",{onClick:()=>fa(!1),className:"px-6 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded transition-colors",children:"Dismiss"}),s.jsx("button",{onClick:()=>{fa(!1),Hl()},className:"px-6 py-2 bg-orange-600 hover:bg-orange-500 text-white rounded transition-colors",children:"Sync Timer"})]})]})})}),S&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-slate-800 rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[80vh] overflow-hidden flex flex-col",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("h2",{className:"text-2xl font-bold text-white",children:"Change Log"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:()=>J(!1),className:`px-3 py-1 rounded text-sm transition-colors ${O?"bg-slate-600 text-slate-300 hover:bg-slate-500":"bg-blue-600 text-white"}`,children:["Local (",R.length,")"]}),s.jsxs("button",{onClick:()=>J(!0),className:`px-3 py-1 rounded text-sm transition-colors ${O?"bg-blue-600 text-white":"bg-slate-600 text-slate-300 hover:bg-slate-500"}`,children:["Master (",U.length,")"]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[!O&&s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:va,className:"px-3 py-1 bg-green-600 hover:bg-green-500 text-white text-sm rounded transition-colors",title:"Sync changes to Supabase",children:"🔄 Sync"}),s.jsx("button",{onClick:()=>{Ct.reloadLocalChanges();const l=Ct.getLocalChanges();A(l.slice(0,100)),console.log("🔄 Manually reloaded local changes:",l.length)},className:"px-3 py-1 bg-blue-600 hover:bg-blue-500 text-white text-sm rounded transition-colors",title:"Reload local changes",children:"🔄 Reload"})]}),O&&s.jsx("button",{onClick:pa,className:"px-3 py-1 bg-blue-600 hover:bg-blue-500 text-white text-sm rounded transition-colors",title:"Reload master change log",children:"🔄 Reload"}),s.jsx("button",{onClick:()=>N(!1),className:"text-gray-400 hover:text-white text-2xl",children:"×"})]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto",children:O?U.length===0?s.jsx("p",{className:"text-gray-400 text-center py-8",children:"No master changes found"}):s.jsx("div",{className:"space-y-3",children:U.map(l=>s.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`text-white text-xs px-2 py-1 rounded ${l.action==="ADD_ITEM"?"bg-green-600":l.action==="REMOVE_ITEM"?"bg-red-600":l.action==="FIELD_UPDATE"?"bg-blue-600":l.action==="MOVE_ITEM"?"bg-yellow-600":l.action==="COLUMN_ADD"?"bg-purple-600":l.action==="COLUMN_REMOVE"?"bg-orange-600":"bg-blue-600"}`,children:l.action}),s.jsxs("span",{className:"text-gray-300 text-sm",children:["by ",l.user_name]}),s.jsxs("span",{className:"text-gray-500 text-xs",children:["(",l.user_role,")"]}),l.row_number&&s.jsxs("span",{className:"text-gray-400 text-xs bg-slate-600 px-2 py-1 rounded",children:["ROW ",l.row_number]}),l.cue_number&&l.cue_number!=="CUE"&&s.jsx("span",{className:"text-gray-400 text-xs bg-slate-600 px-2 py-1 rounded",children:Kt(l.cue_number)})]}),s.jsx("div",{className:"text-gray-400 text-xs",children:new Date(l.timestamp||l.change_timestamp).toLocaleString()})]}),l.details&&s.jsxs("div",{className:"space-y-1 text-sm",children:[l.details.fieldName&&s.jsxs("div",{className:"text-gray-300",children:[s.jsx("strong",{children:"Field:"})," ",l.details.fieldName]}),l.details.oldValue!==void 0&&l.details.newValue!==void 0&&s.jsxs("div",{className:"text-gray-300",children:[s.jsx("strong",{children:"Changed from:"}),s.jsxs("span",{className:"text-red-300 ml-1",children:['"',l.details.oldValue,'"']}),s.jsx("span",{className:"text-slate-400 mx-1",children:"→"}),s.jsxs("span",{className:"text-green-300",children:['"',l.details.newValue,'"']})]}),l.batch_id&&s.jsxs("div",{className:"text-gray-500 text-xs mt-2 pt-2 border-t border-slate-600",children:["Batch: ",l.batch_id.slice(0,8),"... | Synced: ",new Date(l.batch_created_at).toLocaleString()]})]})]},l.id))}):R.length===0&&X.size===0?s.jsx("p",{className:"text-gray-400 text-center py-8",children:"No local changes recorded yet"}):s.jsxs("div",{className:"space-y-3",children:[R.map(l=>s.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`text-white text-xs px-2 py-1 rounded ${l.action==="ADD_ITEM"?"bg-green-600":l.action==="REMOVE_ITEM"?"bg-red-600":l.action==="FIELD_UPDATE"?"bg-blue-600":l.action==="MOVE_ITEM"?"bg-yellow-600":l.action==="COLUMN_ADD"?"bg-purple-600":l.action==="COLUMN_REMOVE"?"bg-orange-600":l.action==="AUTO_SAVE"?"bg-gray-600":"bg-blue-600"}`,children:l.action}),l.details?.processedBy&&s.jsx("span",{className:`text-white text-xs px-2 py-1 rounded ${l.details.processedBy==="TIMEOUT"?"bg-orange-600":l.details.processedBy==="SAVE_BUTTON"?"bg-purple-600":"bg-gray-600"}`,children:l.details.processedBy}),s.jsxs("span",{className:"text-gray-300 text-sm",children:["by ",l.userName]}),l.details?.itemId&&s.jsxs("span",{className:"text-gray-400 text-xs",children:["Item #",l.details.itemId]})]}),s.jsx("div",{className:"text-gray-400 text-xs",children:l.timestamp.toLocaleString()})]}),l.details&&s.jsxs("div",{className:"space-y-1 text-sm",children:[(l.details?.rowNumber||l.details?.cueNumber)&&s.jsx("div",{className:"text-gray-300",children:s.jsxs("strong",{children:["Row ",l.details?.rowNumber||"?"," | ",l.details?.cueNumber||"CUE"]})}),l.action==="ADD_ITEM"&&l.details.details&&s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"text-gray-300",children:[s.jsx("strong",{children:"Program Type:"})," ",l.details.details.programType]}),s.jsxs("div",{className:"text-gray-300",children:[s.jsx("strong",{children:"Shot Type:"})," ",l.details.details.shotType]}),s.jsxs("div",{className:"text-gray-300",children:[s.jsx("strong",{children:"Duration:"})," ",l.details.details.durationHours,"h ",l.details.details.durationMinutes,"m"]}),s.jsxs("div",{className:"text-gray-300",children:[s.jsx("strong",{children:"Speakers:"})," ",l.details.details.speakers]}),l.details.details.notes&&s.jsxs("div",{className:"text-gray-300",children:[s.jsx("strong",{children:"Notes:"})," ",l.details.details.notes]}),s.jsxs("div",{className:"text-gray-300",children:[s.jsx("strong",{children:"Position:"})," ",l.details.details.position]})]}),l.action==="REMOVE_ITEM"&&l.details.details&&s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"text-gray-300",children:[s.jsx("strong",{children:"Program Type:"})," ",l.details.details.programType]}),s.jsxs("div",{className:"text-gray-300",children:[s.jsx("strong",{children:"Shot Type:"})," ",l.details.details.shotType]}),s.jsxs("div",{className:"text-gray-300",children:[s.jsx("strong",{children:"Duration:"})," ",l.details.details.durationHours,"h ",l.details.details.durationMinutes,"m"]}),s.jsxs("div",{className:"text-gray-300",children:[s.jsx("strong",{children:"Speakers:"})," ",l.details.details.speakers]}),l.details.details.notes&&s.jsxs("div",{className:"text-gray-300",children:[s.jsx("strong",{children:"Notes:"})," ",l.details.details.notes]})]}),l.action!=="ADD_ITEM"&&l.action!=="REMOVE_ITEM"&&l.details.fieldName&&s.jsxs("div",{className:"text-gray-300",children:[s.jsx("strong",{children:"Field:"})," ",l.details.fieldName]}),l.action!=="ADD_ITEM"&&l.action!=="REMOVE_ITEM"&&l.details.fieldName==="speakers"&&l.details.details&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"text-gray-300",children:[s.jsx("strong",{children:"Speaker Count:"})," ",l.details.details.speakerCount||0]}),l.details.newValue&&s.jsxs("div",{className:"text-gray-300",children:[s.jsx("strong",{children:"Speakers:"}),s.jsx("div",{className:"mt-1 text-sm text-blue-300",children:(()=>{try{const g=JSON.parse(l.details.newValue);if(Array.isArray(g))return g.sort((v,w)=>v.slot-w.slot).map(v=>`${v.slot}. ${v.fullName||v.name||"Unknown"} (${v.location||"Unknown"})`).join(", ")}catch{return"Unable to parse speakers"}return"No speakers"})()})]})]}),l.action!=="ADD_ITEM"&&l.action!=="REMOVE_ITEM"&&l.details.fieldName==="assets"&&l.details.details&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"text-gray-300",children:[s.jsx("strong",{children:"Asset Count:"})," ",l.details.details.assetCount||0]}),l.details.newValue&&s.jsxs("div",{className:"text-gray-300",children:[s.jsx("strong",{children:"Assets:"}),s.jsx("div",{className:"mt-1 text-sm text-blue-300",children:l.details.newValue.split("||").filter(v=>v.trim()).map(v=>{if(v.includes("|")){const[w,k]=v.split("|");return`${w}${k?` (${k})`:""}`}return v}).join(", ")})]})]}),l.action==="MOVE_ITEM"&&l.details.details&&s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"text-gray-300",children:[s.jsx("strong",{children:"Moved from Row:"})," ",l.details.details.fromRow||"Unknown"]}),s.jsxs("div",{className:"text-gray-300",children:[s.jsx("strong",{children:"Moved to Row:"})," ",l.details.details.toRow||"Unknown"]})]}),l.action!=="ADD_ITEM"&&l.action!=="REMOVE_ITEM"&&l.action!=="MOVE_ITEM"&&l.details.fieldName!=="speakers"&&l.details.fieldName!=="assets"&&l.details.oldValue!==void 0&&l.details.newValue!==void 0&&s.jsx("div",{className:"text-gray-300",children:l.details.fieldName==="durationHours"||l.details.fieldName==="durationMinutes"||l.details.fieldName==="durationSeconds"?s.jsx("span",{className:"text-green-300",children:l.details.newValue}):s.jsxs(s.Fragment,{children:[s.jsx("strong",{children:"Changed from:"}),s.jsxs("span",{className:"text-red-300 ml-1",children:['"',l.details.oldValue,'"']}),s.jsx("span",{className:"text-gray-400 mx-1",children:"→"}),s.jsxs("span",{className:"text-green-300",children:['"',l.details.newValue,'"']})]})})]})]},l.id)),Array.from(X.entries()).map(([l,g])=>{const v=Date.now()-g.timestamp.getTime(),w=Math.max(0,1e4-v),k=Math.ceil(w/1e3);return s.jsxs("div",{className:"bg-slate-600 rounded-lg p-4 border-2 border-yellow-500 animate-pulse",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"bg-yellow-600 text-white text-xs px-2 py-1 rounded",children:["PENDING [",g.originalKey||"NO_KEY","]"]}),s.jsxs("span",{className:"text-slate-300 text-sm",children:["by ",g.user]}),s.jsxs("span",{className:"text-yellow-300 text-xs",children:["⏳ Will confirm in ",k,"s"]})]}),s.jsx("div",{className:"text-slate-400 text-xs",children:g.timestamp.toLocaleString()})]}),g.details&&s.jsxs("div",{className:"space-y-1 text-sm",children:[(g.details?.rowNumber||g.details?.cueNumber)&&s.jsx("div",{className:"text-slate-300",children:s.jsxs("strong",{children:["Row ",g.details?.rowNumber||"?"," | ",g.details?.cueNumber||"CUE"]})}),g.details.fieldName&&s.jsxs("div",{className:"text-slate-300",children:[s.jsx("strong",{children:"Field:"})," ",g.details.fieldName]}),g.details.oldValue!==void 0&&g.details.newValue!==void 0&&s.jsxs("div",{className:"text-slate-300",children:[s.jsx("strong",{children:"Will change from:"}),s.jsxs("span",{className:"text-red-300 ml-1",children:['"',g.details.oldValue,'"']}),s.jsx("span",{className:"text-slate-400 mx-1",children:"→"}),s.jsxs("span",{className:"text-green-300",children:['"',g.details.newValue,'"']})]})]})]},l)})]})}),s.jsx("div",{className:"mt-4 pt-4 border-t border-slate-600",children:s.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-400",children:[s.jsxs("div",{children:[s.jsxs("span",{children:["Total changes: ",R.length," (",X.size," pending)"]}),X.size>0&&s.jsx("span",{className:"ml-2 text-yellow-400",children:"• Changes will be confirmed after 10s of inactivity"})]}),s.jsxs("div",{className:"flex gap-2",children:[X.size>0&&s.jsxs("button",{className:"px-3 py-1 bg-yellow-600 text-white rounded transition-colors animate-pulse cursor-not-allowed",disabled:!0,title:"Changes are pending and will auto-save after 5 seconds",children:["⏳ Changes Pending (",X.size,")"]}),s.jsx("button",{onClick:ql,className:"px-3 py-1 bg-red-600 hover:bg-red-500 text-white rounded transition-colors",title:"Clear all change logs (password protected)",children:"🗑️ Clear All Logs"})]})]})})]})}),s.jsx("style",{children:`
          select {
            border: 2px solid #64748b !important;
            border-radius: 6px !important;
          }
          select:focus {
            border-color: #3b82f6 !important;
            outline: none !important;
          }
          select option {
            background-color: #1e293b !important;
            color: #ffffff !important;
            border-bottom: 1px solid #475569 !important;
            padding: 8px 12px !important;
            margin: 0 !important;
          }
          select option:hover {
            background-color: #334155 !important;
          }
          select option:checked {
            background-color: #3b82f6 !important;
          }
        `}),s.jsx("div",{className:"fixed top-16 left-0 right-0 z-40 bg-slate-900 shadow-lg border-b border-slate-600",style:{height:ao?"240px":"150px"},children:s.jsxs("div",{className:"py-2 pt-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2 px-8",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("button",{onClick:()=>n("/"),className:"px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white font-semibold rounded-lg transition-colors",children:"← Back to Events"}),s.jsxs("div",{className:"relative",children:[s.jsx("button",{onClick:l=>{l.stopPropagation(),Or(!li)},className:"px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors",title:"Menu",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),li&&s.jsx("div",{className:"absolute top-full left-0 mt-1 w-48 bg-slate-800 border border-slate-600 rounded-lg shadow-lg z-50",children:s.jsxs("div",{className:"py-1",children:[s.jsxs("button",{onClick:Zl,className:"w-full px-4 py-2 text-left text-white hover:bg-slate-700 transition-colors flex items-center gap-3",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Full Timer"]}),s.jsxs("button",{onClick:()=>{Or(!1);const l=`/reports?eventId=${r?.id}&eventName=${encodeURIComponent(r?.name||"")}`;window.open(l,"_blank")},className:"w-full px-4 py-2 text-left text-white hover:bg-slate-700 transition-colors flex items-center gap-3",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Reports and Printing"]}),s.jsxs("button",{onClick:()=>{Or(!1);const l=`/graphics-links?eventId=${r?.id}&eventName=${encodeURIComponent(r?.name||"")}`;window.open(l,"_blank")},className:"w-full px-4 py-2 text-left text-white hover:bg-slate-700 transition-colors flex items-center gap-3",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),"Graphic Links"]}),s.jsxs("button",{onClick:()=>{Or(!1);const l=`/photo-view?eventId=${r?.id}&eventName=${encodeURIComponent(r?.name||"")}&eventDate=${encodeURIComponent(r?.date||"")}&eventLocation=${encodeURIComponent(r?.location||"")}`;window.open(l,"_blank")},className:"w-full px-4 py-2 text-left text-white hover:bg-slate-700 transition-colors flex items-center gap-3",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"PhotoView"]}),s.jsxs("button",{onClick:()=>{Or(!1),console.log("=== CSV EXPORT ==="),console.log("Event:",r),console.log("Schedule length:",T.length),console.log("Full schedule:",T),console.log("Master start time:",ve);const l=["ROW","CUE","Program Type","Shot Type","Segment Name","Duration","Start Time","End Time","Notes","Assets","Speakers","Has PPT","Has QA","Timer ID","Is Public","Is Indented","Day"],g=de.map(he=>he.name),v=[...l,...g],k=T.filter(he=>(he.day||1)===D).map((he,be)=>{const ie=T.findIndex(Qt=>Qt.id===he.id),ge=_n(ie),Ie=`${he.durationHours}:${he.durationMinutes.toString().padStart(2,"0")}:${he.durationSeconds.toString().padStart(2,"0")}`,Xe=ge?(()=>{const[Qt,ja,Us]=ge.split(":").map(Number),[Ci,nt,Ta]=Ie.split(":").map(Number);let Yn=Qt*3600+ja*60+Us+(Ci*3600+nt*60+Ta);const Fs=Math.floor(Yn/3600),Ri=Math.floor(Yn%3600/60),Ca=Yn%60;return`${Fs.toString().padStart(2,"0")}:${Ri.toString().padStart(2,"0")}:${Ca.toString().padStart(2,"0")}`})():"",ct=[be+1,he.customFields?.cue||`CUE ${be+1}`,he.programType||"",he.shotType||"",he.segmentName||"",Ie,ge||"",Xe,he.notes||"",he.assets||"",he.speakersText||"",he.hasPPT?"Yes":"No",he.hasQA?"Yes":"No",he.timerId||"",he.isPublic?"Yes":"No",he.isIndented?"Yes":"No",he.day||1],hr=de.map(Qt=>he.customFields[Qt.id]||"");return[...ct,...hr]}),C=[v.join(","),...k.map(he=>he.map(be=>typeof be=="string"&&(be.includes(",")||be.includes('"')||be.includes(`
`))?`"${be.replace(/"/g,'""')}"`:be).join(","))].join(`
`);console.log("CSV Content:",C);const L=new Blob([C],{type:"text/csv;charset=utf-8;"}),Q=URL.createObjectURL(L),Z=document.createElement("a");Z.href=Q,Z.download=`${r?.name||"RunOfShow"}_Day${D}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(Z),Z.click(),document.body.removeChild(Z),URL.revokeObjectURL(Q),console.log("=== END CSV EXPORT ===")},className:"w-full px-4 py-2 text-left text-white hover:bg-slate-700 transition-colors flex items-center gap-3",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Export CSV"]}),s.jsxs("button",{onClick:()=>{Or(!1),la(!0)},className:"w-full px-4 py-2 text-left text-white hover:bg-slate-700 transition-colors flex items-center gap-3",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Backups"]}),s.jsxs("button",{onClick:()=>{Or(!1);const l=`/green-room?eventId=${r?.id}&eventName=${encodeURIComponent(r?.name||"")}&eventDate=${r?.date||""}&eventLocation=${encodeURIComponent(r?.location||"")}`;window.open(l,"_blank")},className:"w-full px-4 py-2 text-left text-white hover:bg-slate-700 transition-colors flex items-center gap-3",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),"Green Room"]}),s.jsxs("button",{onClick:()=>{Or(!1),ci(!0)},className:"w-full px-4 py-2 text-left text-white hover:bg-slate-700 transition-colors flex items-center gap-3",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),"OSC Control"]})]})})]})]}),s.jsxs("div",{className:"flex items-center gap-6",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("label",{className:"text-white font-semibold",children:"Event Name:"}),s.jsx("div",{className:"px-4 py-2 bg-slate-700 border-2 border-slate-600 rounded-lg text-white w-64",children:fe||"No Event Name"}),r?.numberOfDays&&r.numberOfDays>1&&s.jsxs(s.Fragment,{children:[s.jsx("label",{className:"text-white font-semibold",children:"Working Day:"}),s.jsx("select",{value:D,onChange:l=>{tt(),V(parseInt(l.target.value))},className:"px-4 py-2 bg-slate-700 border-2 border-slate-600 rounded-lg text-white focus:border-blue-500 focus:outline-none w-32",children:Array.from({length:r.numberOfDays},(l,g)=>s.jsxs("option",{value:g+1,children:["Day ",g+1]},g+1))})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("label",{className:"text-white font-semibold",children:"Start Time:"}),s.jsx("input",{type:"time",value:r?.numberOfDays&&r.numberOfDays>1?we[D]||"":ve,onChange:l=>{if(tt(),d==="VIEWER"||d==="OPERATOR"){alert("Only EDITORs can change start time. Please change your role to EDITOR.");return}r?.numberOfDays&&r.numberOfDays>1?z(g=>({...g,[D]:l.target.value})):Ve(l.target.value)},disabled:d==="VIEWER"||d==="OPERATOR",className:"px-4 py-2 border-2 rounded-lg focus:outline-none w-48 transition-colors bg-slate-700 border-slate-600 text-white focus:border-blue-500",style:{colorScheme:"dark"},title:d==="VIEWER"||d==="OPERATOR"?"Only EDITORs can change start time":`Set ${r?.numberOfDays&&r.numberOfDays>1?`Day ${D}`:"master"} start time`})]})]}),s.jsxs("div",{className:"flex items-center gap-6",children:[s.jsx("div",{className:"text-center",children:Object.keys(Le).length>0?s.jsxs("div",{className:"text-lg text-green-400 font-bold",children:["RUNNING - ",Kt(T.find(l=>Le[l.id])?.customFields.cue),ht&&s.jsxs("div",{className:"text-lg text-orange-400 mt-0.5 font-bold",children:[Kt(T.find(l=>l.id===ht.itemId)?.customFields.cue)," - ",Yl(ht.remaining)]})]}):Te&&rt[Te]?s.jsxs("div",{className:"text-lg text-yellow-400 font-bold",children:["LOADED - ",Kt(T.find(l=>l.id===Te)?.customFields.cue)]}):s.jsx("div",{className:"text-lg text-slate-300 font-bold",children:"No CUE Selected"})}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"text-3xl font-mono bg-slate-800 px-6 py-3 rounded-lg border border-slate-600",style:{color:As()},children:Jn(Xl())}),Te&&s.jsx("div",{className:"absolute bottom-1 right-1",children:s.jsx(um,{itemId:Te,className:"flex-shrink-0"})})]})]})]}),s.jsx("div",{className:"px-8 mb-2",children:s.jsx("div",{className:"w-full h-2 bg-slate-700 rounded-full overflow-hidden border border-slate-600 relative",children:s.jsx("div",{className:"h-full transition-all duration-1000 absolute top-0 right-0",style:{width:`${Ei()}%`,background:ki()}})})}),s.jsx("div",{className:"px-8 pb-2",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("div",{className:"text-sm text-slate-300",children:["Role: ",s.jsx("span",{className:"font-semibold text-white",children:d})]}),s.jsx("button",{onClick:()=>y(!0),className:"px-3 py-1 bg-slate-600 hover:bg-slate-500 text-white text-sm rounded transition-colors",title:"Change your role",children:"Change Role"}),s.jsx("button",{onClick:ji,className:"px-3 py-1 bg-blue-600 hover:bg-blue-500 text-white text-sm rounded transition-colors",title:"Create a manual backup of current data",children:"💾 Create Backup"}),Hn&&s.jsxs("div",{className:"flex items-center space-x-2 px-3 py-1 bg-yellow-600 rounded text-sm",children:[s.jsx("div",{className:"w-2 h-2 bg-yellow-200 rounded-full animate-pulse"}),s.jsx("span",{className:"text-yellow-100 font-medium",children:"Editing - Sync Paused"})]}),!Hn&&Br&&s.jsxs("div",{className:"flex items-center space-x-2 px-3 py-1 bg-blue-600 rounded text-sm",children:[s.jsx("div",{className:"w-2 h-2 bg-blue-200 rounded-full animate-pulse"}),s.jsx("span",{className:"text-blue-100 font-medium",children:go?"Syncing...":`Next sync in ${an}s`})]})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("button",{onClick:()=>ia(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white text-sm font-medium rounded transition-colors",title:"Open Filter View",children:"Filter View"}),s.jsx("button",{onClick:()=>Er(!xn),className:`px-4 py-2 text-white text-sm font-medium rounded transition-colors ${xn?"bg-green-600 hover:bg-green-500":"bg-slate-600 hover:bg-slate-500"}`,title:xn?"Disable Time Toast":"Enable Time Toast",children:"⏰ Time Toast"}),s.jsx("button",{onClick:()=>zr(!Ht),className:`px-4 py-2 text-white text-sm font-medium rounded transition-colors ${Ht?"bg-purple-600 hover:bg-purple-500 ring-4 ring-inset ring-green-400":"bg-purple-600 hover:bg-purple-500"}`,title:Ht?"Disable auto-scroll to active row":"Enable auto-scroll to active row",children:"🎯 Follow"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-white text-sm font-medium",children:"Duration:"}),s.jsx("button",{onClick:async()=>{if(d==="VIEWER"||d==="EDITOR"){alert("Only OPERATORs can adjust timer duration. Please change your role to OPERATOR.");return}await ln(-300)},className:`w-8 h-8 text-white text-sm font-bold rounded transition-colors ${d==="VIEWER"||d==="EDITOR"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-red-700 hover:bg-red-600"}`,disabled:d==="VIEWER"||d==="EDITOR",title:d==="VIEWER"||d==="EDITOR"?"Only OPERATORs can adjust timer duration":"Subtract 5 minutes",children:"-5"}),s.jsx("button",{onClick:async()=>{if(d==="VIEWER"||d==="EDITOR"){alert("Only OPERATORs can adjust timer duration. Please change your role to OPERATOR.");return}await ln(-60)},className:`w-8 h-8 text-white text-sm font-bold rounded transition-colors ${d==="VIEWER"||d==="EDITOR"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-red-600 hover:bg-red-500"}`,disabled:d==="VIEWER"||d==="EDITOR",title:d==="VIEWER"||d==="EDITOR"?"Only OPERATORs can adjust timer duration":"Subtract 1 minute",children:"-1"}),s.jsx("button",{onClick:async()=>{if(d==="VIEWER"||d==="EDITOR"){alert("Only OPERATORs can adjust timer duration. Please change your role to OPERATOR.");return}await ln(60)},className:`w-8 h-8 text-white text-sm font-bold rounded transition-colors ${d==="VIEWER"||d==="EDITOR"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-500"}`,disabled:d==="VIEWER"||d==="EDITOR",title:d==="VIEWER"||d==="EDITOR"?"Only OPERATORs can adjust timer duration":"Add 1 minute",children:"+1"}),s.jsx("button",{onClick:async()=>{if(d==="VIEWER"||d==="EDITOR"){alert("Only OPERATORs can adjust timer duration. Please change your role to OPERATOR.");return}await ln(300)},className:`w-8 h-8 text-white text-sm font-bold rounded transition-colors ${d==="VIEWER"||d==="EDITOR"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-blue-700 hover:bg-blue-600"}`,disabled:d==="VIEWER"||d==="EDITOR",title:d==="VIEWER"||d==="EDITOR"?"Only OPERATORs can adjust timer duration":"Add 5 minutes",children:"+5"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>{if(d==="VIEWER"||d==="EDITOR"){alert("Only OPERATORs can send messages. Please change your role to OPERATOR.");return}bs(!0)},className:`px-4 py-2 text-white text-sm font-medium rounded transition-colors ${d==="VIEWER"||d==="EDITOR"?"bg-gray-500 text-gray-300 cursor-not-allowed":aa?"bg-purple-600 hover:bg-purple-500 ring-4 ring-inset ring-green-500":"bg-purple-600 hover:bg-purple-500"}`,disabled:d==="VIEWER"||d==="EDITOR",title:d==="VIEWER"||d==="EDITOR"?"Only OPERATORs can send messages":"Send Messages to Full Screen Timer",children:"Messages"}),aa&&s.jsx("button",{onClick:async()=>{if(d==="VIEWER"||d==="EDITOR"){alert("Only OPERATORs can control messages. Please change your role to OPERATOR.");return}try{if(r?.id){const g=(await ye.getTimerMessagesForEvent(r.id)).find(v=>v.enabled);g&&(await ye.disableTimerMessage(g.id),console.log("✅ Message disabled in Supabase via Turn Off button"))}}catch(l){console.error("❌ Error disabling message in Supabase:",l)}ws(!1),co(""),qe&&!qe.closed&&qe.postMessage({type:"MESSAGE_UPDATE",message:"",enabled:!1},"*")},className:`px-4 py-2 text-white text-sm font-medium rounded transition-colors ${d==="VIEWER"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-slate-600 hover:bg-slate-500 animate-pulse"}`,disabled:d==="VIEWER",title:d==="VIEWER"?"Viewers cannot control messages":"Turn Off Message",children:"Click to Turn Off"})]})]})]})}),s.jsx("div",{className:`px-8 transition-all duration-500 ease-in-out overflow-hidden ${ao?"max-h-80 opacity-100 -mb-6":"max-h-0 opacity-0 mb-0"}`,children:s.jsx("div",{className:"bg-slate-800 rounded-xl p-4 shadow-2xl",style:{transform:"scale(0.75)",transformOrigin:"top center",width:"127.67%",marginLeft:"-13.83%"},children:s.jsxs("div",{className:"flex border-2 border-slate-600 rounded-lg overflow-hidden bg-slate-900",children:[s.jsx("div",{className:"w-12 flex-shrink-0 bg-slate-900 border-r-2 border-slate-600",children:s.jsx("div",{className:"h-16 bg-slate-700 border-b-3 border-slate-600 flex items-center justify-center",children:s.jsx("span",{className:"text-white font-bold text-xs",children:"#"})})}),s.jsx("div",{className:"w-40 flex-shrink-0 bg-slate-900",style:{borderRight:"6px solid #475569"},children:s.jsx("div",{className:"h-16 bg-slate-700 border-b-3 border-slate-600 flex items-center justify-center",children:s.jsxs("span",{className:"text-white font-bold text-lg flex items-center gap-1",children:["CUE",d==="VIEWER"&&s.jsx("span",{className:"text-yellow-400",title:"Viewers cannot edit CUE",children:"🔒"})]})})}),s.jsx("div",{className:"flex-1 overflow-x-auto sticky-header-scroll-container",style:{scrollbarWidth:"thin"},children:s.jsx("div",{className:"min-w-max",children:s.jsxs("div",{className:"h-16 bg-slate-700 border-b-3 border-slate-600 flex",children:[xe.start&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.start},children:[s.jsx("span",{className:"text-white font-bold",children:"Start"}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"start")})]}),xe.programType&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.programType},children:[s.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Program Type",(d==="VIEWER"||d==="OPERATOR")&&s.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"programType")})]}),xe.duration&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.duration},children:[s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"text-white font-bold flex items-center justify-center gap-1",children:["Duration",d==="VIEWER"&&s.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),s.jsx("div",{className:"text-xs text-slate-400",children:"HH MM SS"})]}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"duration")})]}),xe.segmentName&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.segmentName},children:[s.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Segment Name",(d==="VIEWER"||d==="OPERATOR")&&s.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"segmentName")})]}),xe.shotType&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.shotType},children:[s.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Shot Type",(d==="VIEWER"||d==="OPERATOR")&&s.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"shotType")})]}),xe.pptQA&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.pptQA},children:[s.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["PPT/Q&A",(d==="VIEWER"||d==="OPERATOR")&&s.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"pptQA")})]}),xe.notes&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.notes},children:[s.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Notes",(d==="VIEWER"||d==="OPERATOR")&&s.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"notes")})]}),xe.assets&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.assets},children:[s.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Assets",d==="VIEWER"&&s.jsx("span",{className:"text-yellow-400",title:"Read-only for VIEWERs",children:"🔒"})]}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"assets")})]}),xe.participants&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.participants},children:[s.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Participants",(d==="VIEWER"||d==="OPERATOR")&&s.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"participants")})]}),xe.speakers&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.speakers},children:[s.jsx("span",{className:"text-white font-bold",children:"Speakers"}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"speakers")})]}),xe.public&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.public},children:[s.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Public",(d==="VIEWER"||d==="OPERATOR")&&s.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"public")})]}),de.map(l=>ks[l.id]!==!1&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center relative flex-shrink-0",style:{width:js[l.id]||256},children:[s.jsx("span",{className:"text-white font-bold",children:l.name}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:g=>Ea(g,l.id)})]},l.id))]})})}),s.jsx("div",{className:"w-32 flex-shrink-0 bg-slate-900",style:{borderLeft:"6px solid #475569"},children:s.jsx("div",{className:"h-16 bg-slate-700 border-b-3 border-slate-600 flex items-center justify-center",children:s.jsxs("span",{className:"text-white font-bold text-base flex items-center gap-1",children:["Timer",(d==="VIEWER"||d==="EDITOR")&&s.jsx("span",{className:"text-yellow-400",title:"Only OPERATORs can control timers",children:"🔒"})]})})})]})})})]})}),s.jsx("div",{className:"max-w-[95%] mx-auto px-6",style:{paddingTop:"250px"},children:s.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 shadow-2xl",style:{transform:"scale(0.75)",transformOrigin:"top center",width:"133.33%",marginLeft:"-16.67%"},children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Schedule",r?.numberOfDays&&r.numberOfDays>1?` - Day ${D}`:""]}),i&&s.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[s.jsxs("button",{onClick:()=>N(!0),className:"text-xs bg-purple-600 hover:bg-purple-500 text-white px-2 py-1 rounded transition-colors",title:"View change history",children:["📝 Change Log (",R.length+X.size,")",Ct.getChangesCount().unsynced>0&&s.jsxs("span",{className:"ml-1 text-yellow-400",children:["(",Ct.getChangesCount().unsynced," unsynced)"]})]}),Cs>0&&s.jsx("button",{onClick:async()=>{await ne()},className:"text-xs bg-yellow-600 hover:bg-yellow-500 text-white px-2 py-1 rounded transition-colors animate-pulse",title:`${Cs} unsynced change${Cs!==1?"s":""} - Click to sync`,children:Cs}),X.size>0&&s.jsxs("button",{className:"text-xs bg-yellow-600 text-white px-2 py-1 rounded transition-colors animate-pulse cursor-not-allowed",title:"Changes are pending and will auto-save after 5 seconds",disabled:!0,children:["⏳ Changes Pending (",X.size,")"]})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>{if(d==="VIEWER"){alert("Viewers cannot add items. Please change your role to EDITOR or OPERATOR.");return}Gt(),Fe(!0),Nt({cue:"",day:D,programType:"PreShow/End",shotType:"",segmentName:"",durationHours:0,durationMinutes:0,durationSeconds:0,notes:"",assets:"",speakers:"",speakersText:"",hasPPT:!1,hasQA:!1,timerId:"",isPublic:!1,isIndented:!1,customFields:{}})},className:`px-4 py-2 font-medium rounded text-sm transition-colors ${d==="VIEWER"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,disabled:d==="VIEWER",title:d==="VIEWER"?"Only EDITORs and OPERATORs can add items":"Add new item",children:"+ Item"}),s.jsx("button",{onClick:()=>{if(d==="VIEWER"){alert("Viewers cannot add columns. Please change your role to EDITOR or OPERATOR.");return}Gt(),te(!0)},className:`px-4 py-2 font-medium rounded text-sm transition-colors ${d==="VIEWER"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white"}`,disabled:d==="VIEWER",title:d==="VIEWER"?"Viewers cannot add columns":"Add custom column",children:"+ Column"}),s.jsx("button",{onClick:async()=>{if(d==="VIEWER"){alert("Viewers cannot reset the schedule. Please change your role to EDITOR or OPERATOR.");return}await $s()},className:`px-4 py-2 font-medium rounded text-sm transition-colors ${d==="VIEWER"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-red-600 hover:bg-red-700 text-white"}`,disabled:d==="VIEWER",title:d==="VIEWER"?"Viewers cannot reset the schedule":"Reset all states",children:"Reset"})]})]}),s.jsxs("div",{className:"flex border-2 border-slate-600 rounded-lg overflow-hidden bg-slate-900",children:[s.jsxs("div",{className:"w-12 flex-shrink-0 bg-slate-900 border-r-2 border-slate-600",children:[s.jsx("div",{className:"h-24 bg-slate-700 border-b-3 border-slate-600 flex items-center justify-center",children:s.jsx("span",{className:"text-white font-bold text-xs",children:"#"})}),dr().length===0?s.jsx("div",{className:"h-24 flex items-center justify-center text-slate-500",children:"-"}):dr().map((l,g)=>s.jsx("div",{className:`border-b-2 border-slate-600 flex items-center justify-center gap-1 ${Le[l.id]?"bg-green-900 border-green-500":Te===l.id?"bg-blue-900 border-blue-500":zn.has(l.id)?"bg-amber-800 border-amber-600":na[l.id]||Wr.has(l.id)?"bg-gray-900 border-gray-700 opacity-40":g%2===0?"bg-slate-800":"bg-slate-900"}`,style:{height:Jt(l.notes,l.speakersText,l.speakers,l.customFields,de)},children:s.jsxs("div",{className:"flex flex-col items-center gap-1",children:[s.jsx("button",{onClick:()=>{if(d==="VIEWER"){alert("Viewers cannot jump to rows. Please change your role to EDITOR or OPERATOR.");return}console.log("✏️ Row jump button clicked - pausing sync"),qr(!0),on&&clearTimeout(on),setTimeout(()=>{const v=prompt(`Move to row (1-${dr().length}):`,(g+1).toString());console.log("⏸️ Row jump prompt closed - resuming sync in 5 seconds");const w=setTimeout(()=>{console.log("⏸️ User stopped editing - resuming sync"),qr(!1)},5e3);Rs(w),v&&!isNaN(Number(v))&&Na(l.id,Number(v))},0)},className:`w-5 h-5 text-white rounded flex items-center justify-center text-xs font-bold transition-colors ${d==="VIEWER"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-purple-600 hover:bg-purple-500"}`,disabled:d==="VIEWER",title:d==="VIEWER"?"Viewers cannot jump to rows":"Jump to Row",children:"#"}),s.jsx("span",{className:"text-white font-bold text-lg",children:g+1}),s.jsx("button",{onClick:()=>{if(d==="VIEWER"){alert("Viewers cannot add rows. Please change your role to EDITOR or OPERATOR.");return}Gt(),tn(g),Fe(!0)},className:`w-5 h-5 text-white rounded flex items-center justify-center text-xs font-bold transition-colors ${d==="VIEWER"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-500"}`,disabled:d==="VIEWER",title:d==="VIEWER"?"Viewers cannot add rows":`Insert row after row ${g+1}`,children:"+"})]})},`${l.id}-${l.notes?.length||0}-${l.speakers?.length||0}`))]}),s.jsxs("div",{className:"w-40 flex-shrink-0 bg-slate-900",style:{borderRight:"6px solid #475569"},children:[s.jsx("div",{className:"h-24 bg-slate-700 border-b-3 border-slate-600 flex items-center justify-center",children:s.jsxs("span",{className:"text-white font-bold text-lg flex items-center gap-1",children:["CUE",d==="VIEWER"&&s.jsx("span",{className:"text-yellow-400",title:"Viewers cannot edit CUE",children:"🔒"})]})}),dr().length===0?s.jsx("div",{className:"h-24 flex items-center justify-center text-slate-500",children:"No items"}):dr().map((l,g)=>s.jsxs("div",{className:`border-b-2 border-slate-600 flex flex-col items-center justify-center gap-1 ${g%2===0?"bg-slate-800":"bg-slate-900"}`,style:{height:Jt(l.notes,l.speakersText,l.speakers,l.customFields,de)},children:[s.jsxs("div",{className:"flex",children:[s.jsx("div",{className:`flex items-center px-1 py-1 border border-slate-600 border-r-0 rounded-l text-white text-lg font-medium min-w-[40px] ${di===l.id?"bg-purple-600":"bg-slate-600"}`,children:"CUE"}),s.jsx("input",{type:"text",value:l.customFields.cue?l.customFields.cue.replace(/^CUE\s*/,""):"",onChange:v=>{if(tt(),d==="VIEWER"){alert("Viewers cannot edit cue names. Please change your role to EDITOR or OPERATOR.");return}const w=l.customFields.cue||"CUE ",k=v.target.value?`CUE ${v.target.value}`:"CUE ";re(C=>C.map(L=>L.id===l.id?{...L,customFields:{...L.customFields,cue:k}}:L)),B(`cue_${l.id}`,"FIELD_UPDATE",`Updated cue for "${l.segmentName}" from "${w}" to "${k}"`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:"cue",oldValue:w,newValue:k,details:{fieldType:"text",characterChange:k.length-w.length}})},disabled:d==="VIEWER",className:"w-14 px-1 py-1 border border-slate-600 rounded-r text-center text-lg transition-colors bg-slate-700 text-white focus:outline-none focus:border-blue-500",title:d==="VIEWER"?"Viewers cannot edit cue names":"Edit cue number",maxLength:4})]}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx("button",{onClick:()=>{if(tt(),d==="VIEWER"){alert("Viewers cannot indent/unindent items. Please change your role to EDITOR or OPERATOR.");return}const v=l.isIndented;re(w=>w.map(k=>k.id===l.id?{...k,isIndented:!k.isIndented}:k)),P("FIELD_UPDATE",`Updated indentation for "${l.segmentName}" from ${v} to ${!v}`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:"isIndented",oldValue:v,newValue:!v,details:{fieldType:"boolean",booleanChange:!0}})},className:`w-7 h-7 text-white flex items-center justify-center text-lg rounded font-bold transition-colors ${d==="VIEWER"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-slate-600 hover:bg-slate-500"}`,disabled:d==="VIEWER",title:d==="VIEWER"?"Viewers cannot indent/unindent items":l.isIndented?"Unindent (group with row above)":"Indent (group with row above)",children:l.isIndented?"↗":"↘"}),s.jsx("button",{onClick:()=>{if(tt(),d==="VIEWER"){alert("Viewers cannot move items. Please change your role to EDITOR or OPERATOR.");return}Sn(l.id,"up")},disabled:g===0||d==="VIEWER",className:`w-7 h-7 text-white flex items-center justify-center text-lg rounded font-bold transition-colors ${d==="VIEWER"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-slate-600 hover:bg-slate-500 disabled:opacity-30 disabled:cursor-not-allowed"}`,title:d==="VIEWER"?"Viewers cannot move items":"Move Up",children:"↑"}),s.jsx("button",{onClick:()=>{if(tt(),d==="VIEWER"){alert("Viewers cannot move items. Please change your role to EDITOR or OPERATOR.");return}Sn(l.id,"down")},disabled:g===dr().length-1||d==="VIEWER",className:`w-7 h-7 text-white flex items-center justify-center text-lg rounded font-bold transition-colors ${d==="VIEWER"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-slate-600 hover:bg-slate-500 disabled:opacity-30 disabled:cursor-not-allowed"}`,title:d==="VIEWER"?"Viewers cannot move items":"Move Down",children:"↓"}),s.jsx("button",{onClick:()=>{if(tt(),d==="VIEWER"){alert("Viewers cannot delete items. Please change your role to EDITOR or OPERATOR.");return}ac(l.id)},className:`w-7 h-7 text-white flex items-center justify-center text-lg rounded font-bold transition-colors ${d==="VIEWER"?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-red-600 hover:bg-red-500"}`,disabled:d==="VIEWER",title:d==="VIEWER"?"Viewers cannot delete items":"Delete",children:"×"})]})]},`${l.id}-${l.notes?.length||0}-${l.speakers?.length||0}`))]}),s.jsx("div",{id:"main-scroll-container",className:"flex-1 overflow-x-auto",style:{scrollbarWidth:"thin"},children:s.jsxs("div",{className:"min-w-max",children:[s.jsxs("div",{className:"h-24 bg-slate-700 border-b-3 border-slate-600 flex",children:[xe.start&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.start},children:[s.jsx("span",{className:"text-white font-bold",children:"Start"}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"start")})]}),xe.programType&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.programType},children:[s.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Program Type",(d==="VIEWER"||d==="OPERATOR")&&s.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"programType")})]}),xe.duration&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.duration},children:[s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"text-white font-bold flex items-center justify-center gap-1",children:["Duration",d==="VIEWER"&&s.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),s.jsx("div",{className:"text-xs text-slate-400",children:"HH MM SS"})]}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"duration")})]}),xe.segmentName&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.segmentName},children:[s.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Segment Name",(d==="VIEWER"||d==="OPERATOR")&&s.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"segmentName")})]}),xe.shotType&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.shotType},children:[s.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Shot Type",(d==="VIEWER"||d==="OPERATOR")&&s.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"shotType")})]}),xe.pptQA&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.pptQA},children:[s.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["PPT/Q&A",(d==="VIEWER"||d==="OPERATOR")&&s.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"pptQA")})]}),xe.notes&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.notes},children:[s.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Notes",(d==="VIEWER"||d==="OPERATOR")&&s.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"notes")})]}),xe.assets&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.assets},children:[s.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Assets",d==="VIEWER"&&s.jsx("span",{className:"text-yellow-400",title:"Read-only for VIEWERs",children:"🔒"})]}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"assets")})]}),xe.participants&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.participants},children:[s.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Participants",(d==="VIEWER"||d==="OPERATOR")&&s.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"participants")})]}),xe.speakers&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.speakers},children:[s.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Speakers",(d==="VIEWER"||d==="OPERATOR")&&s.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"speakers")})]}),xe.public&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 relative",style:{width:We.public},children:[s.jsxs("span",{className:"text-white font-bold flex items-center gap-1",children:["Public",(d==="VIEWER"||d==="OPERATOR")&&s.jsx("span",{className:"text-yellow-400",title:"Read-only for your role",children:"🔒"})]}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:l=>lt(l,"public")})]}),de.map(l=>ks[l.id]!==!1&&s.jsxs("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center relative flex-shrink-0",style:{width:js[l.id]||256},children:[s.jsx("span",{className:"text-white font-bold",children:l.name}),s.jsx("button",{onClick:()=>{window.confirm(`Are you sure you want to remove the "${l.name}" column? This will delete all data in this column.`)&&Ms(l.id)},className:"absolute top-1 right-1 w-6 h-6 bg-red-600 hover:bg-red-700 text-white rounded-md text-base font-bold flex items-center justify-center transition-colors shadow-md hover:shadow-lg",title:`Remove "${l.name}" column`,children:"×"}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",onMouseDown:g=>Ea(g,l.id)})]},l.id))]}),dr().length===0?s.jsxs("div",{className:"h-24 flex items-center justify-center text-slate-500 text-xl",children:["No schedule items for Day ",D,'. Click "Add Schedule Item" to start!']}):dr().map((l,g)=>s.jsxs("div",{"data-item-id":l.id,className:`border-b-2 border-slate-600 flex ${Le[l.id]?"bg-green-950":Te===l.id?"bg-blue-950":zn.has(l.id)?"bg-amber-950 border-amber-600":na[l.id]||Wr.has(l.id)?"bg-gray-900 opacity-40":di===l.id?"bg-purple-950 border-purple-400":g%2===0?"bg-slate-800":"bg-slate-900"}`,style:{height:Jt(l.notes,l.speakersText,l.speakers,l.customFields,de)},children:[xe.start&&s.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0",style:{width:We.start},children:s.jsx("span",{className:"text-white font-mono text-base font-bold",children:l.isIndented?"↘":_n(g)})}),xe.programType&&s.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0",style:{width:We.programType},children:s.jsx("select",{value:l.programType,onFocus:()=>{console.log("✏️ Program Type dropdown focused - pausing sync"),Gt()},onChange:v=>{if(d==="VIEWER"||d==="OPERATOR"){alert("Only EDITORs can edit program type. Please change your role to EDITOR.");return}const w=l.programType;re(k=>k.map(C=>C.id===l.id?{...C,programType:v.target.value}:C)),B(`programType_${l.id}`,"FIELD_UPDATE",`Updated program type for "${l.segmentName}" from "${w}" to "${v.target.value}"`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:"programType",oldValue:w,newValue:v.target.value,details:{fieldType:"select",optionChange:!0}}),kt()},disabled:d==="VIEWER"||d==="OPERATOR",className:"w-full px-3 py-2 border-2 rounded text-base transition-colors bg-slate-700 border-slate-500 text-white focus:border-blue-500",style:{backgroundColor:yo[l.programType]||"#374151",color:l.programType==="Sub Cue"?"#000000":"#ffffff",opacity:1},title:d==="VIEWER"||d==="OPERATOR"?"Only EDITORs can edit program type":"Select program type",children:pi.map(v=>s.jsx("option",{value:v,style:{backgroundColor:yo[v]||"#374151",color:v==="Sub Cue"?"#000000":"#ffffff"},children:v},v))})}),xe.duration&&s.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0",style:{width:We.duration},children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"number",min:"0",max:"23",value:l.durationHours,onChange:v=>{if(tt(),d==="VIEWER"){alert("Only EDITORs and OPERATORs can edit duration. Please change your role to EDITOR or OPERATOR.");return}const w=l.durationHours,k=parseInt(v.target.value)||0;re(C=>C.map(L=>L.id===l.id?{...L,durationHours:k}:L)),B(`durationHours_${l.id}`,"FIELD_UPDATE",`Updated duration hours for "${l.segmentName}" from ${w} to ${k}`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:"durationHours",oldValue:w,newValue:k,details:{fieldType:"number",timeChange:k-w}})},disabled:d==="VIEWER",className:"w-14 px-2 py-2 border border-slate-600 rounded text-center text-lg font-mono font-bold transition-colors bg-slate-700 text-white",style:{opacity:1},title:d==="VIEWER"?"Only EDITORs and OPERATORs can edit duration":"Edit hours"}),s.jsx("span",{className:"text-slate-400 text-xl font-bold",children:":"}),s.jsx("input",{type:"number",min:"0",max:"59",value:l.durationMinutes,onChange:v=>{if(tt(),d==="VIEWER"){alert("Only EDITORs and OPERATORs can edit duration. Please change your role to EDITOR or OPERATOR.");return}const w=l.durationMinutes,k=parseInt(v.target.value)||0;re(C=>C.map(L=>L.id===l.id?{...L,durationMinutes:k}:L)),B(`durationMinutes_${l.id}`,"FIELD_UPDATE",`Updated duration minutes for "${l.segmentName}" from ${w} to ${k}`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:"durationMinutes",oldValue:w,newValue:k,details:{fieldType:"number",timeChange:k-w}})},disabled:d==="VIEWER",className:"w-14 px-2 py-2 border border-slate-600 rounded text-center text-lg font-mono font-bold transition-colors bg-slate-700 text-white",style:{opacity:1},title:d==="VIEWER"?"Only EDITORs and OPERATORs can edit duration":"Edit minutes"}),s.jsx("span",{className:"text-slate-400 text-xl font-bold",children:":"}),s.jsx("input",{type:"number",min:"0",max:"59",value:l.durationSeconds,onChange:v=>{if(tt(),d==="VIEWER"){alert("Only EDITORs and OPERATORs can edit duration. Please change your role to EDITOR or OPERATOR.");return}const w=l.durationSeconds,k=parseInt(v.target.value)||0;re(C=>C.map(L=>L.id===l.id?{...L,durationSeconds:k}:L)),B(`durationSeconds_${l.id}`,"FIELD_UPDATE",`Updated duration seconds for "${l.segmentName}" from ${w} to ${k}`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:"durationSeconds",oldValue:w,newValue:k,details:{fieldType:"number",timeChange:k-w}})},disabled:d==="VIEWER",className:"w-14 px-2 py-2 border border-slate-600 rounded text-center text-lg font-mono font-bold transition-colors bg-slate-700 text-white",style:{opacity:1},title:d==="VIEWER"?"Only EDITORs and OPERATORs can edit duration":"Edit seconds"})]})}),xe.segmentName&&s.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0",style:{width:We.segmentName},children:s.jsx("input",{type:"text",value:l.segmentName,onChange:v=>{if(tt(),d==="VIEWER"||d==="OPERATOR"){alert("Only EDITORs can edit segment names. Please change your role to EDITOR.");return}const w=l.segmentName;re(k=>k.map(C=>C.id===l.id?{...C,segmentName:v.target.value}:C)),B(`segmentName_${l.id}`,"FIELD_UPDATE",`Updated segment name for "${w}" to "${v.target.value}"`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:v.target.value,fieldName:"segmentName",oldValue:w,newValue:v.target.value,details:{fieldType:"text",characterChange:v.target.value.length-w.length}})},disabled:d==="VIEWER"||d==="OPERATOR",className:"w-full px-3 py-2 border border-slate-600 rounded text-base transition-colors bg-slate-700 text-white",placeholder:d==="VIEWER"||d==="OPERATOR"?"Only EDITORs can edit":"Enter segment name",title:d==="VIEWER"||d==="OPERATOR"?"Only EDITORs can edit segment names":"Edit segment name"})}),xe.shotType&&s.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0",style:{width:We.shotType},children:s.jsxs("select",{value:l.shotType,onFocus:()=>{console.log("✏️ Shot Type dropdown focused - pausing sync"),Gt()},onChange:v=>{if(d==="VIEWER"||d==="OPERATOR"){alert("Only EDITORs can edit shot type. Please change your role to EDITOR.");return}const w=l.shotType;re(k=>k.map(C=>C.id===l.id?{...C,shotType:v.target.value}:C)),B(`shotType_${l.id}`,"FIELD_UPDATE",`Updated shot type for "${l.segmentName}" from "${w}" to "${v.target.value}"`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:"shotType",oldValue:w,newValue:v.target.value,details:{fieldType:"select",optionChange:!0}}),kt()},disabled:d==="VIEWER"||d==="OPERATOR",className:"w-full px-3 py-2 border border-slate-600 rounded text-base transition-colors bg-slate-700 text-white",style:{opacity:1},title:d==="VIEWER"||d==="OPERATOR"?"Only EDITORs can edit shot type":"Select shot type",children:[s.jsx("option",{value:"",children:"Select Shot Type"}),ba.map(v=>s.jsx("option",{value:v,children:v},v))]})}),xe.pptQA&&s.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0",style:{width:We.pptQA},children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("label",{className:"flex items-center gap-1",children:[s.jsx("input",{type:"checkbox",checked:l.hasPPT,onChange:v=>{if(tt(),d==="VIEWER"||d==="OPERATOR"){alert("Only EDITORs can edit PPT settings. Please change your role to EDITOR.");return}const w=l.hasPPT;re(k=>k.map(C=>C.id===l.id?{...C,hasPPT:v.target.checked}:C)),B(`hasPPT_${l.id}`,"FIELD_UPDATE",`Updated PPT status for "${l.segmentName}" from ${w?"TRUE":"FALSE"} to ${v.target.checked?"TRUE":"FALSE"}`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:"hasPPT",oldValue:w?"TRUE":"FALSE",newValue:v.target.checked?"TRUE":"FALSE",details:{fieldType:"checkbox",booleanChange:!0}})},className:`w-6 h-6 rounded border-2 transition-colors ${d==="VIEWER"||d==="OPERATOR"?"border-slate-400 bg-slate-700 cursor-not-allowed":"border-slate-400 bg-slate-700 hover:border-blue-400 focus:ring-2 focus:ring-blue-500"}`,style:{opacity:1,filter:"none",WebkitFilter:"none"},title:d==="VIEWER"||d==="OPERATOR"?"Only EDITORs can edit PPT settings":"Toggle PPT"}),s.jsx("span",{className:"text-base font-medium text-white",children:"PPT"})]}),s.jsxs("label",{className:"flex items-center gap-1",children:[s.jsx("input",{type:"checkbox",checked:l.hasQA,onChange:v=>{if(tt(),d==="VIEWER"||d==="OPERATOR"){alert("Only EDITORs can edit Q&A settings. Please change your role to EDITOR.");return}const w=l.hasQA;re(k=>k.map(C=>C.id===l.id?{...C,hasQA:v.target.checked}:C)),B(`hasQA_${l.id}`,"FIELD_UPDATE",`Updated Q&A status for "${l.segmentName}" from ${w?"TRUE":"FALSE"} to ${v.target.checked?"TRUE":"FALSE"}`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:"hasQA",oldValue:w?"TRUE":"FALSE",newValue:v.target.checked?"TRUE":"FALSE",details:{fieldType:"checkbox",booleanChange:!0}})},className:`w-6 h-6 rounded border-2 transition-colors ${d==="VIEWER"||d==="OPERATOR"?"border-slate-400 bg-slate-700 cursor-not-allowed":"border-slate-400 bg-slate-700 hover:border-blue-400 focus:ring-2 focus:ring-blue-500"}`,style:{opacity:1,filter:"none",WebkitFilter:"none"},title:d==="VIEWER"||d==="OPERATOR"?"Only EDITORs can edit Q&A settings":"Toggle Q&A"}),s.jsx("span",{className:"text-base font-medium text-white",children:"Q&A"})]})]})}),xe.notes&&s.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 transition-all duration-300 ease-in-out",style:{width:We.notes,height:Jt(l.notes,l.speakersText,l.speakers,l.customFields,de)},children:s.jsx("div",{onClick:()=>{if(d==="VIEWER"||d==="OPERATOR"){if(d==="OPERATOR"&&l.notes){alert(`Notes (View Only):

${l.notes.replace(/<[^>]*>/g,"")}`);return}alert("Only EDITORs can edit notes. Please change your role to EDITOR.");return}Gt(),Ze(l.id),_e(!0)},className:"w-full px-3 py-2 border border-slate-600 rounded text-white text-base transition-colors flex items-start justify-center bg-slate-700 cursor-pointer hover:bg-slate-600",style:{height:vi(l.notes),minHeight:vi(l.notes),wordWrap:"break-word",overflowWrap:"break-word",overflow:"hidden",paddingBottom:"1rem"},title:d==="VIEWER"?"Viewers cannot edit notes":d==="OPERATOR"?"Click to view notes (read-only)":"Click to edit notes",children:l.notes?s.jsx("div",{className:"text-left w-full",dangerouslySetInnerHTML:{__html:l.notes}}):s.jsx("span",{className:"text-slate-400",children:"Click to edit notes..."})})}),xe.assets&&s.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0",style:{width:We.assets},children:s.jsx("div",{onClick:()=>{if(d==="VIEWER"||d==="OPERATOR"){if(d==="OPERATOR"&&l.assets){ai(l.id),Mn(!0);return}alert("Only EDITORs can edit assets. Please change your role to EDITOR.");return}Gt(),vn(l.id),Mt(!0)},className:"w-full px-3 py-2 border border-slate-600 rounded text-white text-base transition-colors flex items-center justify-center bg-slate-700 cursor-pointer hover:bg-slate-600",title:d==="VIEWER"?"Viewers cannot edit assets":d==="OPERATOR"?"Click to view assets (read-only)":"Click to edit assets",children:l.assets?s.jsx("div",{className:"text-center",children:s.jsxs("div",{className:"text-sm font-medium",children:[l.assets.split("||").length," Asset",l.assets.split("||").length!==1?"s":""]})}):s.jsx("span",{className:"text-slate-400",children:"Click to add assets..."})})}),xe.participants&&s.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-start justify-center flex-shrink-0 transition-all duration-300 ease-in-out",style:{width:We.participants,height:Jt(l.notes,l.speakersText,l.speakers,l.customFields,de)},children:s.jsx("div",{onClick:()=>{if(d==="VIEWER"||d==="OPERATOR"){if(d==="OPERATOR"&&l.speakers){alert(`Participants (View Only):

${ya(l.speakers)}`);return}alert("Only EDITORs can edit participants. Please change your role to EDITOR.");return}Fn(l.id),vs(!0)},className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white text-base cursor-pointer hover:bg-slate-600",style:{height:`calc(${Jt(l.notes,l.speakersText,l.speakers,l.customFields,de)} - 2rem)`,maxHeight:`calc(${Jt(l.notes,l.speakersText,l.speakers,l.customFields,de)} - 2rem)`,overflow:"hidden",lineHeight:"1.6",wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"pre-wrap"},title:d==="VIEWER"?"Viewers cannot edit participants":d==="OPERATOR"?"Click to view participants (read-only)":"Click to edit participants",children:ya(l.speakers||"")||"Click to add participants..."})}),xe.speakers&&s.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 transition-all duration-300 ease-in-out",style:{width:We.speakers,height:Jt(l.notes,l.speakersText,l.speakers,l.customFields,de)},children:s.jsx("div",{onClick:()=>{if(d==="VIEWER"||d==="OPERATOR"){if(d==="OPERATOR"&&l.speakersText){alert(`Speakers (View Only):

${bo(l.speakersText)}`);return}alert("Only EDITORs can edit speakers. Please change your role to EDITOR.");return}Gt(),wt(l.id),at(!0)},className:"w-full px-3 py-2 border border-slate-600 rounded text-white text-base transition-colors flex items-start justify-start bg-slate-700 cursor-pointer hover:bg-slate-600",style:{height:xi(l.speakersText),minHeight:xi(l.speakersText),wordWrap:"break-word",overflowWrap:"break-word",overflow:"hidden",paddingBottom:"1rem",lineHeight:"1.6",whiteSpace:"pre-wrap"},title:d==="VIEWER"?"Viewers cannot edit speakers":d==="OPERATOR"?"Click to view speakers (read-only)":"Click to edit speakers",children:s.jsx("div",{className:"text-left w-full",children:bo(l.speakersText||"")||"Click to add speakers..."})})}),xe.public&&s.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0",style:{width:We.public},children:s.jsx("input",{type:"checkbox",checked:l.isPublic||!1,onChange:v=>{if(d==="VIEWER"||d==="OPERATOR"){alert("Only EDITORs can change public status. Please change your role to EDITOR.");return}const w=l.isPublic;re(k=>k.map(C=>C.id===l.id?{...C,isPublic:v.target.checked}:C)),P("FIELD_UPDATE",`Updated Public status for "${l.segmentName}" from ${w} to ${v.target.checked}`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:"isPublic",oldValue:w,newValue:v.target.checked,details:{fieldType:"checkbox",booleanChange:!0}})},className:`w-5 h-5 rounded border-2 focus:ring-2 transition-colors ${d==="VIEWER"||d==="OPERATOR"?"border-slate-500 bg-slate-700 text-blue-600 cursor-not-allowed":"border-slate-500 bg-slate-700 text-blue-600 focus:ring-blue-500"}`,style:{opacity:1,filter:"none",WebkitFilter:"none"},title:d==="VIEWER"||d==="OPERATOR"?"Only EDITORs can change public status":"Toggle public visibility"})}),de.map(v=>ks[v.id]!==!1&&s.jsx("div",{className:"px-4 py-2 border-r border-slate-600 flex items-center justify-center flex-shrink-0 transition-all duration-300 ease-in-out",style:{width:js[v.id]||256,height:Jt(l.notes,l.speakersText,l.speakers,l.customFields,de)},children:s.jsx("textarea",{value:l.customFields[v.name]||"",onFocus:()=>{console.log("✏️ Custom column focused - pausing sync"),tt()},onChange:w=>{tt();const k=l.customFields[v.name]||"";re(C=>C.map(L=>L.id===l.id?{...L,customFields:{...L.customFields,[v.name]:w.target.value}}:L)),B(`custom_${v.name}_${l.id}`,"FIELD_UPDATE",`Updated custom field "${v.name}" for "${l.segmentName}" from "${k}" to "${w.target.value}"`,{changeType:"FIELD_CHANGE",itemId:l.id,itemName:l.segmentName,fieldName:`custom_${v.name}`,oldValue:k,newValue:w.target.value,details:{fieldType:"custom_field",columnName:v.name,characterChange:w.target.value.length-k.length}})},className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white text-base resize-none",style:{height:`calc(${Jt(l.notes,l.speakersText,l.speakers,l.customFields,de)} - 2rem)`,maxHeight:`calc(${Jt(l.notes,l.speakersText,l.speakers,l.customFields,de)} - 2rem)`,overflow:"hidden",lineHeight:"1.6",wordWrap:"break-word",overflowWrap:"break-word"},rows:Math.max(2,(l.customFields[v.name]||"").split(`
`).length),placeholder:`${v.name}...`})},v.id))]},`${l.id}-${l.notes?.length||0}-${l.speakers?.length||0}`))]})}),s.jsxs("div",{className:"w-32 flex-shrink-0 bg-slate-900",style:{borderLeft:"6px solid #475569"},children:[s.jsx("div",{className:"h-24 bg-slate-700 border-b-3 border-slate-600 flex items-center justify-center",children:s.jsxs("span",{className:"text-white font-bold text-base flex items-center gap-1",children:["Timer",(d==="VIEWER"||d==="EDITOR")&&s.jsx("span",{className:"text-yellow-400",title:"Only OPERATORs can control timers",children:"🔒"})]})}),dr().length===0?s.jsx("div",{className:"h-24 flex items-center justify-center text-slate-500",children:"-"}):dr().map((l,g)=>s.jsx("div",{className:`border-b-2 border-slate-600 flex flex-col items-center justify-center gap-1 ${g%2===0?"bg-slate-800":"bg-slate-900"}`,style:{height:Jt(l.notes,l.speakersText,l.speakers,l.customFields,de)},children:s.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-1",children:[s.jsx("div",{className:"text-sm font-mono text-slate-300",children:l.timerId||"TIMER"}),s.jsx("div",{className:"flex flex-col gap-1",children:l.isIndented?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>{if(d==="VIEWER"||d==="EDITOR"){alert("Only OPERATORs can start secondary timers. Please change your role to OPERATOR.");return}ka(l.id)},disabled:ht?.itemId===l.id||d==="VIEWER"||d==="EDITOR"||!Ls(l.id),className:`px-3 py-1 rounded text-sm font-bold transition-colors ${d==="VIEWER"||d==="EDITOR"?"bg-gray-500 text-gray-300 cursor-not-allowed":Ls(l.id)?ht?.itemId===l.id?"bg-orange-600 text-white cursor-default":"bg-orange-500 hover:bg-orange-400 text-white":"bg-gray-500 text-gray-300 cursor-not-allowed"}`,title:d==="VIEWER"||d==="EDITOR"?"Only OPERATORs can start secondary timers":Ls(l.id)?"Start secondary timer":"Start the CUE above first before starting secondary timer",children:ht?.itemId===l.id?"PLAYING":"PLAY"}),s.jsx("button",{onClick:()=>{if(d==="VIEWER"||d==="EDITOR"){alert("Only OPERATORs can stop secondary timers. Please change your role to OPERATOR.");return}oc()},disabled:ht?.itemId!==l.id||d==="VIEWER"||d==="EDITOR"||!Ls(l.id),className:`px-3 py-1 rounded text-sm font-bold transition-colors ${d==="VIEWER"||d==="EDITOR"?"bg-gray-500 text-gray-300 cursor-not-allowed":Ls(l.id)?ht?.itemId===l.id?"bg-red-600 hover:bg-red-500 text-white":"bg-slate-600 text-slate-400 cursor-not-allowed":"bg-gray-500 text-gray-300 cursor-not-allowed"}`,title:d==="VIEWER"||d==="EDITOR"?"Only OPERATORs can stop secondary timers":"Stop secondary timer",children:"STOP"})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:async()=>{if(d==="VIEWER"){alert("Viewers cannot load cues. Please change your role to EDITOR or OPERATOR.");return}if(console.log("🔄🔄🔄 Button clicked, currentUserRole:",d),console.log("🔄🔄🔄 Button clicked, item.id:",l.id),d==="EDITOR"){alert("Editors cannot load cues. Please change your role to OPERATOR.");return}console.log("🔄🔄🔄 Button clicked, calling loadCue with item.id:",l.id),await Ni(l.id)},disabled:Te===l.id||d==="VIEWER"||d==="EDITOR",className:`px-3 py-1 rounded text-sm font-bold transition-colors ${d==="VIEWER"||d==="EDITOR"?"bg-gray-500 text-gray-300 cursor-not-allowed":Te===l.id?"bg-blue-600 text-white cursor-default":"bg-slate-600 hover:bg-slate-500 text-white"}`,title:d==="VIEWER"?"Viewers cannot load cues":d==="EDITOR"?"Editors cannot load cues":"Load this cue",children:Te===l.id?"LOADED":"LOAD"}),s.jsx("button",{onClick:async()=>{if(d==="VIEWER"||d==="EDITOR"){alert("Only OPERATORs can start/stop timers. Please change your role to OPERATOR.");return}await Qn(l.id)},disabled:Te!==l.id||(Le[l.id]?!1:Object.keys(Le).length>0)||d==="VIEWER"||d==="EDITOR",className:`px-3 py-1 rounded text-sm font-bold transition-colors ${d==="VIEWER"||d==="EDITOR"?"bg-gray-500 text-gray-300 cursor-not-allowed":Le[l.id]?"bg-red-600 hover:bg-red-500 text-white":Te===l.id&&Object.keys(Le).length===0?"bg-green-600 hover:bg-green-500 text-white":"bg-slate-600 text-slate-400 cursor-not-allowed"}`,title:d==="VIEWER"||d==="EDITOR"?"Only OPERATORs can start/stop timers":Le[l.id]?"Stop timer":"Start timer",children:Le[l.id]?"STOP":"START"})]})})]})},`${l.id}-${l.notes?.length||0}-${l.speakers?.length||0}`))]})]})]})}),ze&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-slate-800 rounded-lg max-w-lg w-full max-h-[90vh] flex flex-col",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-600",children:[s.jsx("h2",{className:"text-lg font-bold text-white",children:"Add Schedule Item"}),s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:Qe.isPublic,onChange:l=>Nt(g=>({...g,isPublic:l.target.checked})),className:"rounded"}),s.jsx("span",{className:"text-slate-300 text-sm",children:"Public"})]})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Cue"}),s.jsxs("div",{className:"flex",children:[s.jsx("div",{className:"flex items-center px-2 py-2 bg-slate-600 border border-slate-600 border-r-0 rounded-l text-white text-sm font-medium min-w-[40px]",children:"CUE"}),s.jsx("input",{type:"text",value:Qe.cue,onChange:l=>{tt(),Nt(g=>({...g,cue:l.target.value}))},className:"flex-1 px-3 py-2 bg-slate-700 border border-slate-600 rounded-r text-white placeholder-slate-400 focus:outline-none focus:border-blue-500 text-sm",placeholder:"1, 1.1, 1A, etc."})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Program Type"}),s.jsx("select",{value:Qe.programType,onFocus:()=>{console.log("✏️ Program Type modal dropdown focused - pausing sync"),Gt()},onChange:l=>{Nt(g=>({...g,programType:l.target.value})),kt()},className:"w-full px-3 py-2 bg-slate-700 border-2 border-slate-500 rounded text-white focus:outline-none focus:border-blue-500 text-sm",style:{backgroundColor:yo[Qe.programType]||"#374151",color:Qe.programType==="Sub Cue"?"#000000":"#ffffff"},children:pi.map(l=>s.jsx("option",{value:l,style:{backgroundColor:yo[l]||"#374151",color:l==="Sub Cue"?"#000000":"#ffffff"},children:l},l))})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Segment Name"}),s.jsx("input",{type:"text",value:Qe.segmentName,onChange:l=>{tt(),Nt(g=>({...g,segmentName:l.target.value}))},className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500 text-sm",placeholder:"Enter segment name"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Shot Type"}),s.jsxs("select",{value:Qe.shotType,onFocus:()=>{console.log("✏️ Shot Type modal dropdown focused - pausing sync"),Gt()},onChange:l=>{Nt(g=>({...g,shotType:l.target.value})),kt()},className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:outline-none focus:border-blue-500 text-sm",children:[s.jsx("option",{value:"",children:"Select Shot Type"}),ba.map(l=>s.jsx("option",{value:l,children:l},l))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Duration"}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx("input",{type:"number",value:Qe.durationHours,onChange:l=>{tt(),Nt(g=>({...g,durationHours:parseInt(l.target.value)||0}))},className:"w-12 px-2 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:outline-none focus:border-blue-500 text-sm text-center",min:"0",placeholder:"H"}),s.jsx("span",{className:"text-slate-400 self-center text-sm",children:":"}),s.jsx("input",{type:"number",value:Qe.durationMinutes,onChange:l=>{tt(),Nt(g=>({...g,durationMinutes:parseInt(l.target.value)||0}))},className:"w-12 px-2 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:outline-none focus:border-blue-500 text-sm text-center",min:"0",max:"59",placeholder:"M"}),s.jsx("span",{className:"text-slate-400 self-center text-sm",children:":"}),s.jsx("input",{type:"number",value:Qe.durationSeconds,onChange:l=>{tt(),Nt(g=>({...g,durationSeconds:parseInt(l.target.value)||0}))},className:"w-12 px-2 py-2 bg-slate-700 border border-slate-600 rounded text-white focus:outline-none focus:border-blue-500 text-sm text-center",min:"0",max:"59",placeholder:"S"})]})]})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:Qe.hasPPT,onChange:l=>{tt(),Nt(g=>({...g,hasPPT:l.target.checked}))},className:"rounded"}),s.jsx("span",{className:"text-slate-300 text-sm",children:"Has PPT"})]}),s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:Qe.hasQA,onChange:l=>{tt(),Nt(g=>({...g,hasQA:l.target.checked}))},className:"rounded"}),s.jsx("span",{className:"text-slate-300 text-sm",children:"Has QA"})]})]})]}),s.jsxs("div",{className:"mt-3",children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Notes"}),s.jsx("div",{className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500 text-sm cursor-pointer hover:bg-slate-600 transition-colors min-h-[60px] flex items-center",onClick:()=>{Gt(),Ze(-1),_e(!0)},children:Qe.notes?s.jsx("div",{className:"text-sm",dangerouslySetInnerHTML:{__html:Qe.notes}}):s.jsx("span",{className:"text-slate-400",children:"Click to edit notes with rich formatting..."})})]}),s.jsxs("div",{className:"mt-3",children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Assets"}),s.jsx("div",{className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500 text-sm cursor-pointer hover:bg-slate-600 transition-colors min-h-[60px] flex items-center",onClick:()=>{Gt(),vn(-1),Mt(!0)},children:Qe.assets?s.jsx("div",{className:"text-sm",dangerouslySetInnerHTML:{__html:Qe.assets.replace(/\|\|/g,"<br>")}}):s.jsx("span",{className:"text-slate-400",children:"Click to edit assets with advanced management..."})})]}),s.jsxs("div",{className:"mt-3",children:[s.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-1",children:"Speakers"}),s.jsx("div",{className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500 text-sm cursor-pointer hover:bg-slate-600 transition-colors min-h-[60px] flex items-start justify-start",onClick:()=>{Gt(),wt(-1),at(!0)},style:{wordWrap:"break-word",overflowWrap:"break-word",lineHeight:"1.6",whiteSpace:"pre-wrap"},children:Qe.speakersText?s.jsx("div",{className:"text-sm text-left w-full",children:bo(Qe.speakersText)}):s.jsx("span",{className:"text-slate-400",children:"Click to add speakers..."})})]})]}),s.jsx("div",{className:"p-4 border-t border-slate-600",children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>sc(Qe),className:"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white font-medium rounded transition-colors text-sm",children:"Add Item"}),s.jsx("button",{onClick:()=>{Fe(!1),kt()},className:"flex-1 px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white font-medium rounded transition-colors text-sm",children:"Cancel"})]})})]})}),$n&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-slate-800 rounded-xl p-8 max-w-md w-full",children:[s.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Add Custom Column"}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-slate-300 font-semibold mb-2",children:"Column Name"}),s.jsx("input",{type:"text",placeholder:"Enter column name",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:border-blue-500",onFocus:()=>{console.log("✏️ Custom column input focused - pausing sync"),tt()},onKeyPress:l=>{if(l.key==="Enter"){const g=l.target;g.value.trim()&&(ur(g.value.trim()),g.value="")}}})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>{const l=document.querySelector('input[placeholder="Enter column name"]');l?.value.trim()&&(ur(l.value.trim()),l.value="")},className:"flex-1 px-4 py-3 bg-purple-600 hover:bg-purple-500 text-white font-semibold rounded-lg transition-colors",children:"Add Column"}),s.jsx("button",{onClick:()=>{te(!1),kt()},className:"flex-1 px-4 py-3 bg-slate-600 hover:bg-slate-500 text-white font-semibold rounded-lg transition-colors",children:"Cancel"})]})]})}),pe&&De!==null&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 max-w-5xl w-full max-h-[90vh] flex flex-col",children:[s.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Edit Notes"}),s.jsxs("div",{className:"mb-4 bg-slate-700 rounded-lg overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between gap-4 p-3 border-b border-slate-600",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-white text-sm font-semibold",children:"Format:"}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx("button",{onClick:()=>et("undo"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded flex items-center justify-center",title:"Undo",children:"↶"}),s.jsx("button",{onClick:()=>et("redo"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded flex items-center justify-center",title:"Redo",children:"↷"}),s.jsx("div",{className:"w-px h-6 bg-slate-500 mx-1"}),s.jsx("button",{onClick:()=>et("bold"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-sm rounded font-bold flex items-center justify-center",title:"Bold",children:"B"}),s.jsx("button",{onClick:()=>et("italic"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-sm rounded italic flex items-center justify-center",title:"Italic",children:"I"}),s.jsx("button",{onClick:()=>et("underline"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-sm rounded underline flex items-center justify-center",title:"Underline",children:"U"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-white text-sm font-semibold",children:"Size:"}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx("button",{onClick:()=>et("fontSize","1"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded flex items-center justify-center",title:"Small",children:"S"}),s.jsx("button",{onClick:()=>et("fontSize","3"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-sm rounded flex items-center justify-center",title:"Normal",children:"N"}),s.jsx("button",{onClick:()=>et("fontSize","5"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-base rounded flex items-center justify-center",title:"Large",children:"L"}),s.jsx("button",{onClick:()=>et("fontSize","7"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-lg rounded flex items-center justify-center",title:"X-Large",children:"XL"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-white text-sm font-semibold",children:"Align:"}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx("button",{onClick:()=>et("left"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded flex items-center justify-center",title:"Left Align",children:"≡"}),s.jsx("button",{onClick:()=>et("center"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded flex items-center justify-center",title:"Center Align",children:"≣"}),s.jsx("button",{onClick:()=>et("right"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded flex items-center justify-center",title:"Right Align",children:"≡"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-white text-sm font-semibold",children:"Lists:"}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx("button",{onClick:()=>et("bullet"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-sm rounded flex items-center justify-center",title:"Bullet List",children:"•"}),s.jsx("button",{onClick:()=>et("list"),className:"w-8 h-8 bg-slate-600 hover:bg-slate-500 text-white text-sm rounded flex items-center justify-center",title:"Numbered List",children:"1."})]})]})]}),s.jsxs("div",{className:"flex items-center justify-center gap-6 p-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-white text-sm font-semibold",children:"Text Color:"}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx("button",{onClick:()=>et("color","#ffffff"),className:"w-6 h-6 bg-white border border-slate-400 rounded",title:"White"}),s.jsx("button",{onClick:()=>et("color","#ef4444"),className:"w-6 h-6 bg-red-500 rounded",title:"Red"}),s.jsx("button",{onClick:()=>et("color","#3b82f6"),className:"w-6 h-6 bg-blue-500 rounded",title:"Blue"}),s.jsx("button",{onClick:()=>et("color","#22c55e"),className:"w-6 h-6 bg-green-500 rounded",title:"Green"}),s.jsx("button",{onClick:()=>et("color","#f97316"),className:"w-6 h-6 bg-orange-500 rounded",title:"Orange"}),s.jsx("button",{onClick:()=>et("color","#a855f7"),className:"w-6 h-6 bg-purple-500 rounded",title:"Purple"}),s.jsx("button",{onClick:()=>et("color","#000000"),className:"w-6 h-6 bg-black border border-slate-400 rounded",title:"Black"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-white text-sm font-semibold",children:"Highlight:"}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx("button",{onClick:()=>et("highlight","transparent"),className:"w-6 h-6 bg-slate-600 border border-slate-400 rounded flex items-center justify-center text-white text-xs",title:"No Highlight",children:"×"}),s.jsx("button",{onClick:()=>et("highlight","#fbbf24"),className:"w-6 h-6 bg-yellow-400 rounded",title:"Yellow"}),s.jsx("button",{onClick:()=>et("highlight","#60a5fa"),className:"w-6 h-6 bg-blue-400 rounded",title:"Light Blue"}),s.jsx("button",{onClick:()=>et("highlight","#4ade80"),className:"w-6 h-6 bg-green-400 rounded",title:"Light Green"}),s.jsx("button",{onClick:()=>et("highlight","#f472b6"),className:"w-6 h-6 bg-pink-400 rounded",title:"Pink"}),s.jsx("button",{onClick:()=>et("highlight","#fb923c"),className:"w-6 h-6 bg-orange-400 rounded",title:"Orange"})]})]})]})]}),s.jsxs("div",{className:"flex-1 min-h-[400px] mb-6",children:[s.jsx("label",{className:"block text-white text-sm mb-2",children:"Notes:"}),s.jsx("div",{id:"notes-editor",contentEditable:!0,className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white text-base focus:outline-none focus:border-blue-500 overflow-auto",style:{height:"400px",lineHeight:"1.5",fontFamily:"system-ui, -apple-system, sans-serif"},"data-placeholder":"Start typing your notes here...",onInput:l=>{}})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:yi,className:"flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white font-semibold rounded-lg transition-colors",children:"Save & Close"}),s.jsx("button",{onClick:()=>{_e(!1),Ze(null),kt()},className:"flex-1 px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white font-semibold rounded-lg transition-colors",children:"Cancel"})]})]})}),bt&&dt!==null&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-slate-800 rounded-xl max-w-5xl w-full max-h-[90vh] flex flex-col",children:[s.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-slate-700",children:[s.jsxs("h2",{className:"text-xl font-bold text-white",children:["Edit Speakers (",it.length,"/7)"]}),s.jsx("button",{onClick:()=>{at(!1),wt(null),kt()},className:"text-slate-400 hover:text-white text-xl",children:"✕"})]}),s.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[s.jsx("div",{className:"mb-6",children:s.jsxs("button",{onClick:xa,disabled:it.length>=7,className:"px-4 py-2 bg-green-600 hover:bg-green-500 disabled:bg-slate-600 disabled:cursor-not-allowed text-white font-semibold rounded-lg transition-colors",children:["+ Add Speaker ",it.length<7&&`(${7-it.length} slots remaining)`]})}),s.jsxs("div",{className:"space-y-4 mb-6",children:[it.sort((l,g)=>l.slot-g.slot).map(l=>s.jsxs("div",{className:"bg-slate-700 rounded-lg p-4 border border-slate-600",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Speaker ",l.slot]}),s.jsx("button",{onClick:()=>Ds(l.id),className:"w-8 h-8 bg-red-600 hover:bg-red-500 text-white rounded flex items-center justify-center transition-colors",title:"Remove Speaker",children:"✕"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Slot Number"}),s.jsx("select",{value:l.slot,onChange:g=>Si(l.id,parseInt(g.target.value)),className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm focus:outline-none focus:border-blue-500",children:[1,2,3,4,5,6,7].map(g=>{const v=it.some(w=>w.id!==l.id&&w.slot===g);return s.jsxs("option",{value:g,className:v?"bg-yellow-600 text-white":"bg-slate-600 text-white",children:[g," ",v?"(Used)":""]},g)})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Location"}),s.jsxs("select",{value:l.location,onChange:g=>wn(l.id,"location",g.target.value),className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm focus:outline-none focus:border-blue-500",children:[s.jsx("option",{value:"Podium",children:"Podium"}),s.jsx("option",{value:"Seat",children:"Seat"}),s.jsx("option",{value:"Moderator",children:"Moderator"}),s.jsx("option",{value:"Virtual",children:"Virtual"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Full Name"}),s.jsx("input",{type:"text",value:l.fullName,onChange:g=>wn(l.id,"fullName",g.target.value),placeholder:"Enter full name",className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm placeholder-slate-400 focus:outline-none focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Title"}),s.jsx("input",{type:"text",value:l.title,onChange:g=>wn(l.id,"title",g.target.value),placeholder:"Enter title",className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm placeholder-slate-400 focus:outline-none focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Organization"}),s.jsx("input",{type:"text",value:l.org,onChange:g=>wn(l.id,"org",g.target.value),placeholder:"Enter organization",className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm placeholder-slate-400 focus:outline-none focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Photo Link"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"url",value:l.photoLink,onChange:g=>wn(l.id,"photoLink",g.target.value),placeholder:"Enter photo URL",className:"flex-1 px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm placeholder-slate-400 focus:outline-none focus:border-blue-500"}),l.photoLink&&s.jsx("div",{className:"flex-shrink-0",children:s.jsx("img",{src:l.photoLink,alt:l.fullName,className:"w-12 h-12 rounded object-cover border-2 border-slate-500 -mt-2.5",onError:g=>{g.currentTarget.style.display="none"}})})]})]})]})]},l.id)),it.length===0&&s.jsx("div",{className:"text-center py-8 text-slate-400",children:'No speakers added yet. Click "Add Speaker" to get started.'})]})]}),s.jsx("div",{className:"border-t border-slate-700 p-6",children:s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:Kl,className:"flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white font-semibold rounded-lg transition-colors",children:"Save & Close"}),s.jsx("button",{onClick:()=>{at(!1),wt(null),kt()},className:"flex-1 px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white font-semibold rounded-lg transition-colors",children:"Cancel"})]})})]})}),gt&&Ot!==null&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Edit Assets"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h3",{className:"text-lg font-semibold text-white",children:"Assets List"}),s.jsx("button",{onClick:bi,className:"px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded-lg transition-colors",children:"+ Add Asset"})]}),s.jsx("div",{id:"assets-list",className:"space-y-3"})]}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{onClick:Gl,className:"flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white font-semibold rounded-lg transition-colors",children:"Save & Close"}),s.jsx("button",{onClick:()=>{Mt(!1),vn(null),kt()},className:"flex-1 px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white font-semibold rounded-lg transition-colors",children:"Cancel"})]})]})}),oi&&Un!==null&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-white",children:"Assets List"}),s.jsx("button",{onClick:()=>{Mn(!1),ai(null)},className:"px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors",children:"Close"})]}),s.jsx("div",{className:"space-y-4",children:(()=>{const l=T.find(v=>v.id===Un);if(!l||!l.assets)return s.jsx("div",{className:"text-center py-8",children:s.jsx("p",{className:"text-slate-400 text-lg",children:"No assets available for this item."})});let g=[];if(l.assets.includes("||"))g=l.assets.split("||").filter(w=>w.trim()).map(w=>{if(w.includes("|")){const[k,C]=w.split("|").map(L=>L.trim());return{name:k||"Unnamed Asset",url:C||""}}else return{name:w.trim(),url:""}});else if(l.assets.includes("|")){const[v,w]=l.assets.split("|").map(k=>k.trim());g=[{name:v||"Unnamed Asset",url:w||""}]}else try{const v=JSON.parse(l.assets);Array.isArray(v)?g=v.map(w=>({name:w.name||"Unnamed Asset",url:w.link||w.url||""})):g=[{name:v.name||"Unnamed Asset",url:v.link||v.url||""}]}catch{g=[{name:l.assets.trim(),url:""}]}return g.length===0?s.jsx("div",{className:"text-center py-8",children:s.jsx("p",{className:"text-slate-400 text-lg",children:"No assets available for this item."})}):s.jsx("div",{className:"space-y-4",children:s.jsx("div",{className:"max-h-96 overflow-y-auto space-y-3 pr-2",children:g.map((v,w)=>s.jsx("div",{className:"bg-slate-700 rounded-lg p-4 border border-slate-600",children:s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"text-white font-semibold text-lg",children:v.name}),v.url&&s.jsx("div",{children:s.jsx("a",{href:v.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 underline break-all text-sm",children:v.url})})]})},w))})})})()})]})}),ps&&rn!==null&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-slate-800 rounded-xl max-w-5xl w-full max-h-[90vh] flex flex-col",children:[s.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-slate-700",children:[s.jsxs("h2",{className:"text-xl font-bold text-white",children:["Edit Participants (",Ut.length,"/7)"]}),s.jsx("button",{onClick:()=>{vs(!1),Fn(null)},className:"text-slate-400 hover:text-white text-xl",children:"✕"})]}),s.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[s.jsx("div",{className:"mb-6",children:s.jsxs("button",{onClick:wi,disabled:Ut.length>=7,className:"px-4 py-2 bg-green-600 hover:bg-green-500 disabled:bg-slate-600 disabled:cursor-not-allowed text-white font-semibold rounded-lg transition-colors",children:["+ Add Speaker ",Ut.length<7&&`(${7-Ut.length} slots remaining)`]})}),s.jsxs("div",{className:"space-y-4",children:[Ut.sort((l,g)=>l.slot-g.slot).map(l=>s.jsxs("div",{className:"bg-slate-700 rounded-lg p-4 border border-slate-600",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Speaker ",l.slot]}),s.jsx("button",{onClick:()=>Jl(l.id),className:"w-8 h-8 bg-red-600 hover:bg-red-500 text-white rounded flex items-center justify-center transition-colors",title:"Remove Speaker",children:"✕"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Slot Number"}),s.jsx("select",{value:l.slot,onChange:g=>_i(l.id,parseInt(g.target.value)),className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm focus:outline-none focus:border-blue-500",children:[1,2,3,4,5,6,7].map(g=>{const v=Ut.some(w=>w.id!==l.id&&w.slot===g);return s.jsxs("option",{value:g,className:v?"bg-yellow-600 text-white":"bg-slate-600 text-white",children:[g," ",v?"(Used)":""]},g)})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Location"}),s.jsxs("select",{value:l.location,onChange:g=>Gn(l.id,"location",g.target.value),className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm focus:outline-none focus:border-blue-500",children:[s.jsx("option",{value:"Podium",children:"Podium"}),s.jsx("option",{value:"Seat",children:"Seat"}),s.jsx("option",{value:"Moderator",children:"Moderator"}),s.jsx("option",{value:"Virtual",children:"Virtual"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Full Name"}),s.jsx("input",{type:"text",value:l.fullName,onChange:g=>Gn(l.id,"fullName",g.target.value),placeholder:"Enter full name",className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm placeholder-slate-400 focus:outline-none focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Title"}),s.jsx("input",{type:"text",value:l.title,onChange:g=>Gn(l.id,"title",g.target.value),placeholder:"Enter title/position",className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm placeholder-slate-400 focus:outline-none focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Organization"}),s.jsx("input",{type:"text",value:l.org,onChange:g=>Gn(l.id,"org",g.target.value),placeholder:"Enter organization",className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm placeholder-slate-400 focus:outline-none focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Speaker Photo Link"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"url",value:l.photoLink,onChange:g=>Gn(l.id,"photoLink",g.target.value),placeholder:"Enter photo URL",className:"flex-1 px-3 py-2 bg-slate-600 border border-slate-500 rounded text-white text-sm placeholder-slate-400 focus:outline-none focus:border-blue-500"}),l.photoLink&&s.jsx("div",{className:"flex-shrink-0",children:s.jsx("img",{src:l.photoLink,alt:l.fullName,className:"w-12 h-12 rounded object-cover border-2 border-slate-500 -mt-2.5",onError:g=>{g.target.style.display="none"}})})]})]})]})]},l.id)),Ut.length===0&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx("div",{className:"text-slate-400 text-lg mb-4",children:"No speakers added yet"}),s.jsx("button",{onClick:wi,className:"px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white font-semibold rounded-lg transition-colors",children:"Add Your First Speaker"})]})]})]}),s.jsx("div",{className:"border-t border-slate-700 p-6",children:s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:Ql,className:"flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white font-semibold rounded-lg transition-colors",children:"Save & Close"}),s.jsx("button",{onClick:()=>{vs(!1),Fn(null)},className:"flex-1 px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white font-semibold rounded-lg transition-colors",children:"Cancel"})]})})]})}),oa&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-slate-800 rounded-lg p-6 max-w-md w-full",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h3",{className:"text-xl font-bold text-white",children:"Send Message to Full Screen Timer"}),s.jsx("button",{onClick:()=>bs(!1),className:"text-slate-400 hover:text-white transition-colors",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Quick Presets"}),s.jsx("div",{className:"grid grid-cols-2 gap-2",children:["Break in 5 minutes","Technical difficulties","Starting soon","Please wait","Break time","Resuming shortly","Stall / Stretch Time","Wrap Up Please"].map(l=>s.jsx("button",{onClick:()=>co(l),className:"px-3 py-2 bg-slate-700 hover:bg-slate-600 border border-slate-600 rounded text-white text-sm transition-colors text-left",children:l},l))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Custom Message"}),s.jsx("textarea",{value:Pr,onChange:l=>co(l.target.value),placeholder:"Enter custom message to display on full screen timer...",className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-400 focus:outline-none focus:border-blue-500 text-sm h-24 resize-none"})]}),Pr&&s.jsx("div",{className:"p-3 bg-slate-700 rounded-lg",children:s.jsxs("div",{className:"text-slate-300 text-sm",children:[s.jsx("strong",{children:"Message Preview:"})," ",Pr]})})]}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{onClick:async()=>{if(!(!Pr.trim()||!r?.id))try{const g=(await ye.getTimerMessagesForEvent(r.id)).filter(k=>k.enabled);for(const k of g)await ye.disableTimerMessage(k.id),console.log("✅ Disabled existing message:",k.id);const v={event_id:r.id,message:Pr.trim(),enabled:!0,sent_by:i?.id,sent_by_name:i?.user_metadata?.full_name||i?.email||"Unknown User",sent_by_role:d||"VIEWER",message_type:"general",priority:2},w=await ye.saveTimerMessage(v);if(!w){console.error("❌ Failed to save message to Supabase"),alert("Failed to save message. Please try again.");return}console.log("✅ New message created in Supabase:",w),ws(!0),qe&&!qe.closed&&qe.postMessage({type:"MESSAGE_UPDATE",message:Pr,enabled:!0},"*"),co(""),bs(!1)}catch(l){console.error("❌ Error saving message:",l),alert("Error saving message. Please try again.")}},className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white font-medium rounded transition-colors",disabled:!Pr.trim()||!r?.id,children:"Send & Activate Message"}),s.jsx("button",{onClick:()=>bs(!1),className:"flex-1 px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white font-medium rounded transition-colors",children:"Cancel"})]})]})}),Dr&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-slate-800 rounded-lg max-w-md w-full max-h-[80vh] flex flex-col",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-600",children:[s.jsx("h2",{className:"text-lg font-bold text-white",children:"Filter Columns"}),s.jsx("button",{onClick:()=>ia(!1),className:"text-slate-400 hover:text-white text-xl",children:"×"})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:s.jsxs("div",{className:"space-y-3",children:[s.jsx("p",{className:"text-slate-300 text-sm mb-4",children:"Select which columns to display in the schedule:"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",checked:xe.start,onChange:l=>Wt(g=>({...g,start:l.target.checked})),className:"rounded"}),s.jsx("span",{className:"text-white",children:"Start Time"})]}),s.jsxs("label",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",checked:xe.programType,onChange:l=>Wt(g=>({...g,programType:l.target.checked})),className:"rounded"}),s.jsx("span",{className:"text-white",children:"Program Type"})]}),s.jsxs("label",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",checked:xe.duration,onChange:l=>Wt(g=>({...g,duration:l.target.checked})),className:"rounded"}),s.jsx("span",{className:"text-white",children:"Duration"})]}),s.jsxs("label",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",checked:xe.segmentName,onChange:l=>Wt(g=>({...g,segmentName:l.target.checked})),className:"rounded"}),s.jsx("span",{className:"text-white",children:"Segment Name"})]}),s.jsxs("label",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",checked:xe.shotType,onChange:l=>Wt(g=>({...g,shotType:l.target.checked})),className:"rounded"}),s.jsx("span",{className:"text-white",children:"Shot Type"})]}),s.jsxs("label",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",checked:xe.pptQA,onChange:l=>Wt(g=>({...g,pptQA:l.target.checked})),className:"rounded"}),s.jsx("span",{className:"text-white",children:"PPT/Q&A"})]}),s.jsxs("label",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",checked:xe.notes,onChange:l=>Wt(g=>({...g,notes:l.target.checked})),className:"rounded"}),s.jsx("span",{className:"text-white",children:"Notes"})]}),s.jsxs("label",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",checked:xe.assets,onChange:l=>Wt(g=>({...g,assets:l.target.checked})),className:"rounded"}),s.jsx("span",{className:"text-white",children:"Assets"})]}),s.jsxs("label",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",checked:xe.participants,onChange:l=>Wt(g=>({...g,participants:l.target.checked})),className:"rounded"}),s.jsx("span",{className:"text-white",children:"Participants"})]}),s.jsxs("label",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",checked:xe.speakers,onChange:l=>Wt(g=>({...g,speakers:l.target.checked})),className:"rounded"}),s.jsx("span",{className:"text-white",children:"Speakers"})]}),s.jsxs("label",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",checked:xe.public,onChange:l=>Wt(g=>({...g,public:l.target.checked})),className:"rounded"}),s.jsx("span",{className:"text-white",children:"Public"})]}),de.map((l,g)=>s.jsxs("label",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",checked:ks[l.id]!==!1,onChange:v=>Ns(w=>({...w,[l.id]:v.target.checked})),className:"rounded"}),s.jsxs("span",{className:"text-white",children:[l.name,s.jsx("span",{className:"text-slate-400 text-xs ml-2",children:"(Custom)"})]})]},l.id))]})]})}),s.jsx("div",{className:"p-4 border-t border-slate-600",children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>{Wt({start:!0,programType:!0,duration:!0,segmentName:!0,shotType:!0,pptQA:!0,notes:!0,assets:!0,participants:!1,speakers:!0,public:!0,custom:!0});const l={};de.forEach(g=>{l[g.id]=!0}),Ns(l)},className:"px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white font-medium rounded transition-colors text-sm",children:"Show All"}),s.jsx("button",{onClick:()=>{Wt({start:!1,programType:!1,duration:!1,segmentName:!1,shotType:!1,pptQA:!1,notes:!1,assets:!1,participants:!1,speakers:!1,public:!1,custom:!1});const l={};de.forEach(g=>{l[g.id]=!1}),Ns(l)},className:"px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white font-medium rounded transition-colors text-sm",children:"Hide All"}),s.jsx("button",{onClick:()=>ia(!1),className:"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white font-medium rounded transition-colors text-sm",children:"Apply Filters"})]})})]})}),xn&&s.jsx("div",{className:"fixed bottom-6 left-1/2 transform -translate-x-1/2 z-50",children:s.jsxs("div",{className:`px-6 py-4 rounded-lg shadow-lg border-2 flex items-center gap-3 ${cr==="early"?"bg-yellow-600 border-yellow-500 text-yellow-100":cr==="late"?"bg-red-600 border-red-500 text-red-100":"bg-green-600 border-green-500 text-green-100"}`,children:[s.jsx("div",{className:"text-3xl flex-shrink-0",children:cr==="early"?"⏰":cr==="late"?"⚠️":"✅"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-bold text-lg mb-1",children:cr==="early"?"EARLY":cr==="late"?"RUNNING LATE":"ON TIME"}),s.jsxs("div",{className:"text-base font-medium",children:[s.jsx("span",{className:"text-2xl font-bold",children:Hr>=60?`${Math.floor(Hr/60)}h ${Hr%60}m`:`${Hr}m`}),cr==="early"?` before ${Object.keys(Le).length>0&&T.find(l=>l.id===parseInt(Object.keys(Le)[0]))?.customFields.cue||"CUE"} start`:cr==="late"?` after ${Object.keys(Le).length>0&&T.find(l=>l.id===parseInt(Object.keys(Le)[0]))?.customFields.cue||"CUE"} start`:" - Timing is on track"]})]}),s.jsx("button",{onClick:()=>Er(!1),className:"ml-4 text-xl hover:opacity-70 transition-opacity",children:"×"})]})}),s.jsx(zv,{isOpen:_r,onClose:()=>ci(!1),event:r,schedule:T,activeItemId:Te,activeTimers:Le,onLoadCue:async l=>{const g=parseInt(l);isNaN(g)||await Ni(g)},onStartTimer:async l=>{if(l==="generic")Te?(console.log("🎯 Generic start - controlling currently loaded item:",Te),await Qn(Te)):console.log("❌ No item currently loaded for generic start");else{const g=parseInt(l);isNaN(g)||await Qn(g)}},onStopTimer:async l=>{if(l==="generic"){const g=Object.keys(Le);if(g.length>0){const v=parseInt(g[0]);console.log("🎯 Generic stop - controlling currently running timer:",v),await Qn(v)}else console.log("❌ No timer currently running for generic stop")}else{const g=parseInt(l);isNaN(g)||await Qn(g)}},onResetTimer:async l=>{if(l==="generic")console.log("🎯 Generic reset - using resetAllStates (same as Reset button)"),await $s();else{const g=parseInt(l);isNaN(g)||await Ti(g)}}}),uo&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-slate-800 rounded-lg p-8 w-full max-w-7xl max-h-[95vh] overflow-hidden flex flex-col",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-white",children:"Backup Management"}),s.jsx("button",{onClick:()=>la(!1),className:"text-slate-400 hover:text-white text-2xl font-bold",children:"✕"})]}),s.jsx("div",{className:"bg-blue-900 border border-blue-600 rounded-lg p-4 mb-6",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx("div",{className:"text-blue-400 text-xl mr-3",children:"ℹ️"}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-blue-200 font-semibold mb-1",children:"Manual Backup Only"}),s.jsx("p",{className:"text-blue-100 text-sm",children:'Automatic backups have been disabled to prevent interference with the main run of show. Use the "💾 Create Backup" button in the main interface to create backups when needed.'})]})]})}),s.jsxs("div",{className:"bg-slate-700 rounded-lg p-6 mb-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Filter & Search"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-base font-medium mb-3",children:"Search by Event Name"}),s.jsx("input",{type:"text",placeholder:"Filter by event name...",className:"w-full px-4 py-3 bg-slate-600 border border-slate-500 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:border-blue-500 text-base",onChange:l=>{}})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-base font-medium mb-3",children:"Filter by Date"}),s.jsx("input",{type:"date",className:"w-full px-4 py-3 bg-slate-600 border border-slate-500 rounded-lg text-white focus:outline-none focus:border-blue-500 text-base",onChange:l=>{}})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-slate-300 text-base font-medium mb-3",children:"Sort by"}),s.jsxs("select",{className:"w-full px-4 py-3 bg-slate-600 border border-slate-500 rounded-lg text-white focus:outline-none focus:border-blue-500 text-base",children:[s.jsx("option",{value:"newest",children:"Newest First"}),s.jsx("option",{value:"oldest",children:"Oldest First"}),s.jsx("option",{value:"event",children:"Event Name"}),s.jsx("option",{value:"type",children:"Backup Type"})]})]})]})]}),s.jsxs("div",{className:"bg-slate-700 rounded-lg p-6 flex-1 overflow-hidden flex flex-col",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h3",{className:"text-xl font-semibold text-white",children:"Available Backups"}),s.jsx("button",{onClick:wo,className:"px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white text-base font-medium rounded-lg transition-colors",children:"🔄 Refresh"})]}),s.jsx("div",{className:"flex-1 overflow-y-auto",children:Ss.length===0?s.jsx("div",{className:"text-slate-400 text-center py-12 text-lg",children:'No backups available. Use the "💾 Create Backup" button in the main interface to create a manual backup.'}):s.jsx("div",{className:"space-y-4",children:Ss.map(l=>s.jsxs("div",{className:"bg-slate-600 p-6 rounded-lg flex justify-between items-center hover:bg-slate-500 transition-colors",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"text-white font-semibold text-xl mb-2 flex items-center gap-3",children:[l.backup_name,s.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${l.backup_type==="auto"?"bg-blue-600 text-blue-100":"bg-green-600 text-green-100"}`,children:l.backup_type})]}),s.jsxs("div",{className:"text-slate-400 text-sm",children:[s.jsx("strong",{children:"Event Date:"})," ",l.event_data?.date?new Date(l.event_data.date).toLocaleDateString():"N/A"," •",s.jsx("strong",{children:" Schedule Items:"})," ",l.schedule_data?.length||0," •",s.jsx("strong",{children:" Custom Columns:"})," ",l.custom_columns_data?.length||0]})]}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsx("button",{onClick:()=>ec(l),className:"px-6 py-3 bg-green-600 hover:bg-green-500 text-white text-base font-medium rounded-lg transition-colors",title:"Preview and load this backup",children:"🔄 Load/Overwrite"}),s.jsx("button",{onClick:()=>rc(l.id),className:"px-5 py-3 bg-red-600 hover:bg-red-500 text-white text-base font-medium rounded-lg transition-colors",title:"Delete this backup",children:"🗑️ Delete"})]})]},l.id))})})]})]})}),Fl&&rr&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-slate-800 rounded-lg p-8 w-full max-w-2xl",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-white",children:"Confirm Backup Restore"}),s.jsx("button",{onClick:()=>fo(!1),className:"text-slate-400 hover:text-white text-2xl font-bold",children:"✕"})]}),s.jsxs("div",{className:"bg-slate-700 rounded-lg p-6 mb-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Backup Details"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-slate-300",children:"Backup Name:"}),s.jsx("span",{className:"text-white font-medium",children:rr.backup_name})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-slate-300",children:"Event:"}),s.jsx("span",{className:"text-white font-medium",children:rr.event_data?.name||"Unknown"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-slate-300",children:"Date:"}),s.jsx("span",{className:"text-white font-medium",children:new Date(rr.backup_timestamp).toLocaleString()})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-slate-300",children:"Type:"}),s.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${rr.backup_type==="auto"?"bg-blue-600 text-blue-100":"bg-green-600 text-green-100"}`,children:rr.backup_type})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-slate-300",children:"Schedule Items:"}),s.jsx("span",{className:"text-white font-medium",children:rr.schedule_data?.length||0})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-slate-300",children:"Custom Columns:"}),s.jsx("span",{className:"text-white font-medium",children:rr.custom_columns_data?.length||0})]})]})]}),s.jsx("div",{className:"bg-yellow-900 border border-yellow-600 rounded-lg p-4 mb-6",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx("div",{className:"text-yellow-400 text-xl mr-3",children:"⚠️"}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-yellow-200 font-semibold mb-2",children:"Warning"}),s.jsx("p",{className:"text-yellow-100 text-sm",children:"This will completely overwrite your current run of show data with the backup data. This action cannot be undone. Make sure you want to proceed."})]})]})}),s.jsxs("div",{className:"flex justify-end space-x-4",children:[s.jsx("button",{onClick:()=>fo(!1),className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white text-base font-medium rounded-lg transition-colors",children:"Cancel"}),s.jsx("button",{onClick:tc,className:"px-6 py-3 bg-green-600 hover:bg-green-500 text-white text-base font-medium rounded-lg transition-colors",children:"🔄 Confirm Restore"})]})]})})]}):s.jsx("div",{className:"min-h-screen bg-slate-900 text-white flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h1",{className:"text-2xl font-bold mb-4",children:"No Event Selected"}),s.jsx("button",{onClick:()=>n("/"),className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded",children:"Back to Event List"})]})})},Hv=({isRunning:u=!1,elapsedTime:n=0,totalDuration:r=0,onClose:a,message:i="",messageEnabled:h=!1,itemId:d,eventId:p,mainTimer:x=null,secondaryTimer:y=null})=>{const[S,N]=_.useState({elapsed:n,total:r}),[R,A]=_.useState(new Date),[U,$]=_.useState(!1),[O,J]=_.useState(null),[X,q]=_.useState(!1);_.useEffect(()=>{N({elapsed:n,total:r})},[n,r]),_.useEffect(()=>{const T=setInterval(()=>{A(new Date)},1e3);return()=>clearInterval(T)},[]),_.useEffect(()=>{const T=()=>{$(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",T),()=>document.removeEventListener("fullscreenchange",T)},[]),_.useEffect(()=>{if(!p)return;const T=async()=>{q(!0);try{const de=await ye.getTimerMessage(p);J(de),console.log("📨 Loaded timer message from Supabase:",de)}catch(de){console.error("❌ Error loading timer message:",de)}finally{q(!1)}};T();const re=setInterval(T,5e3);return()=>clearInterval(re)},[p]);const K=T=>{const re=T<0,de=Math.abs(T),Ne=Math.floor(de/3600),fe=Math.floor(de%3600/60),me=Math.floor(de%60),ve=re?"-":"";return Ne===0?`${ve}${fe.toString().padStart(2,"0")}:${me.toString().padStart(2,"0")}`:`${ve}${Ne.toString().padStart(2,"0")}:${fe.toString().padStart(2,"0")}:${me.toString().padStart(2,"0")}`},Y=T=>T.toLocaleTimeString("en-US",{hour12:!0,hour:"2-digit",minute:"2-digit",second:"2-digit"}),P=()=>{const T=S;return T.total-T.elapsed},B=()=>{const T=S,re=T.total-T.elapsed;return T.total>0?re/T.total*100:0},ne=()=>{const T=S,re=T.total-T.elapsed;return re>120?"#10b981":re>30?"#f59e0b":"#ef4444"};return s.jsxs("div",{className:"fixed inset-0 bg-black text-white overflow-hidden flex flex-col items-center justify-center",style:{padding:0,margin:0},children:[s.jsxs("div",{className:"absolute top-10 left-10 text-3xl font-mono text-white",children:[s.jsx("div",{className:"text-slate-400 text-lg mb-1",children:"CURRENT TIME"}),s.jsx("div",{className:"text-white",children:Y(R)})]}),s.jsxs("div",{className:"absolute top-10 right-10 text-3xl font-mono text-white",children:[s.jsx("div",{className:"text-slate-400 text-lg mb-1",children:"CURRENT CUE"}),s.jsxs("div",{className:"text-white flex items-center gap-3",children:[s.jsx("span",{children:x?`${x.cue}${x.segmentName?` - ${x.segmentName}`:""}`:"No CUE"}),d&&s.jsx(um,{itemId:d,className:"flex-shrink-0"})]})]}),!U&&s.jsx("button",{onClick:()=>{document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen()},className:"absolute top-10 left-1/2 transform -translate-x-1/2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-bold text-lg transition-colors z-50",children:"FULL SCREEN"}),(h&&i||O&&O.enabled)&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsx("div",{className:"font-bold text-white bg-black bg-opacity-50 rounded-lg border-4 border-white text-center flex items-center justify-center",style:{width:"80vw",height:"50vh",lineHeight:"1.1",whiteSpace:"pre-line",overflow:"hidden",paddingBottom:"20px"},children:(()=>{const T=O?.message||i,re=T.split(" ");let de;if(re.length<=3)de=T;else if(re.length<=6){const me=Math.ceil(re.length/2);de=re.slice(0,me).join(" ")+`
`+re.slice(me).join(" ")}else if(re.length<=10){const me=Math.ceil(re.length/3);de=re.slice(0,me).join(" ")+`
`+re.slice(me,me*2).join(" ")+`
`+re.slice(me*2).join(" ")}else{const me=Math.ceil(re.length/4);de=re.slice(0,me).join(" ")+`
`+re.slice(me,me*2).join(" ")+`
`+re.slice(me*2,me*3).join(" ")+`
`+re.slice(me*3).join(" ")}let Ne;const fe=/[gjpqy]/.test(T.toLowerCase());return re.length<=3?Ne=fe?"clamp(3rem, 12vw, 16rem)":"clamp(3.5rem, 13.5vw, 18rem)":re.length<=6?Ne=fe?"clamp(1.9rem, 8vw, 12rem)":"clamp(2.25rem, 9vw, 13.5rem)":re.length<=10?Ne=fe?"clamp(1.4rem, 6vw, 9rem)":"clamp(1.6rem, 7vw, 10.5rem)":Ne=fe?"clamp(0.9rem, 4vw, 6rem)":"clamp(1.1rem, 5vw, 7rem)",s.jsx("div",{style:{fontSize:Ne},children:de})})()})}),y&&s.jsxs("div",{className:`absolute animate-in fade-in duration-500 ${h&&i||O&&O.enabled?"bottom-20 right-1/3 transform translate-x-1/2 flex flex-col items-center":"inset-0 flex flex-col items-center justify-center"}`,style:{marginTop:h&&i||O&&O.enabled?"0":"-80px"},children:[s.jsxs("div",{className:`text-orange-400 font-bold animate-in slide-in-from-top duration-500 ${h&&i||O&&O.enabled?"text-lg md:text-xl lg:text-2xl mb-2":"text-xl md:text-2xl lg:text-3xl mb-4"}`,style:{lineHeight:"1.2"},children:[y.cue,y.segmentName&&` - ${y.segmentName}`]}),s.jsx("div",{className:`text-orange-400 font-mono font-bold animate-in zoom-in duration-500 ${(()=>{const T=Math.floor(y.remaining/3600);return h&&i||O&&O.enabled?"text-3xl md:text-4xl lg:text-5xl":T===0?"text-[15rem] md:text-[16.875rem] lg:text-[22.5rem]":"text-[12rem] md:text-[13.5rem] lg:text-[18rem]"})()}`,style:{lineHeight:"1"},children:(()=>{const T=Math.floor(y.remaining/3600),re=Math.floor(y.remaining%3600/60),de=y.remaining%60;return T===0?`${re.toString().padStart(2,"0")}:${de.toString().padStart(2,"0")}`:`${T.toString().padStart(2,"0")}:${re.toString().padStart(2,"0")}:${de.toString().padStart(2,"0")}`})()})]}),!y&&!(h&&i||O&&O.enabled)&&s.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center",children:[P()<0&&s.jsx("div",{className:"mb-[-50px]",children:s.jsx("div",{className:"font-bold text-red-500 text-5xl",children:"OVER TIME"})}),s.jsx("div",{className:"text-center",children:s.jsx("div",{className:`font-mono font-bold ${(()=>{const T=P();return Math.floor(Math.abs(T)/3600)===0?"text-[15rem] md:text-[16.875rem] lg:text-[22.5rem]":"text-[12rem] md:text-[13.5rem] lg:text-[18rem]"})()}`,style:{color:ne()},children:K(P())})}),s.jsx("div",{className:"w-full max-w-5xl mt-0",children:s.jsx("div",{className:"w-full bg-slate-700 rounded-full overflow-hidden border-3 border-slate-600 relative h-8",children:s.jsx("div",{className:"h-full transition-all duration-1000 absolute top-0 right-0",style:{width:`${B()}%`,background:ne()}})})})]}),(h&&i||O&&O.enabled)&&!y&&s.jsxs("div",{className:"text-center transition-all duration-500 ease-in-out absolute bottom-20 left-1/2 transform -translate-x-1/2",children:[P()<0&&s.jsx("div",{className:"mb-2",children:s.jsx("div",{className:"font-bold text-red-500 text-lg md:text-xl lg:text-2xl",children:"OVER TIME"})}),s.jsx("div",{className:"font-mono font-bold transition-all duration-500 ease-in-out text-3xl md:text-4xl lg:text-5xl",style:{color:ne()},children:K(P())})]}),y&&!(h&&i||O&&O.enabled)&&s.jsxs("div",{className:"text-center transition-all duration-500 ease-in-out absolute bottom-20 left-1/2 transform -translate-x-1/2",children:[P()<0&&s.jsx("div",{className:"mb-2",children:s.jsx("div",{className:"font-bold text-red-500 text-lg md:text-xl lg:text-2xl",children:"OVER TIME"})}),s.jsx("div",{className:"font-mono font-bold transition-all duration-500 ease-in-out text-3xl md:text-4xl lg:text-5xl",style:{color:ne()},children:K(P())})]}),(h&&i||O&&O.enabled)&&!y&&s.jsx("div",{className:"w-full transition-all duration-500 ease-in-out absolute bottom-8 left-1/2 transform -translate-x-1/2 max-w-2xl",children:s.jsx("div",{className:"w-full bg-slate-700 rounded-full overflow-hidden border-3 border-slate-600 relative h-2",children:s.jsx("div",{className:"h-full transition-all duration-1000 absolute top-0 right-0",style:{width:`${B()}%`,background:ne()}})})}),y&&!(h&&i||O&&O.enabled)&&s.jsx("div",{className:"w-full transition-all duration-500 ease-in-out absolute bottom-8 left-1/2 transform -translate-x-1/2 max-w-2xl",children:s.jsx("div",{className:"w-full bg-slate-700 rounded-full overflow-hidden border-3 border-slate-600 relative h-2",children:s.jsx("div",{className:"h-full transition-all duration-1000 absolute top-0 right-0",style:{width:`${B()}%`,background:ne()}})})})]})},qv=()=>{const u=yr();ea();const n=u.state||{},[r,a]=_.useState(n.isRunning||!1),[i,h]=_.useState(n.elapsedTime||0),[d,p]=_.useState(n.totalDuration||0),[x,y]=_.useState(""),[S,N]=_.useState(!1),[R,A]=_.useState(null),[U,$]=_.useState(n.itemId||null),[O,J]=_.useState(n.eventId||null),[X,q]=_.useState(n.mainTimer||null),[K,Y]=_.useState(n.secondaryTimer||null);_.useEffect(()=>{const B=ne=>{switch(ne.key){case"Escape":window.close();break;case" ":ne.preventDefault(),a(!r);break;case"r":case"R":(ne.ctrlKey||ne.metaKey)&&(ne.preventDefault(),h(0),a(!1));break;case"+":case"=":(ne.ctrlKey||ne.metaKey)&&ne.preventDefault();break;case"-":(ne.ctrlKey||ne.metaKey)&&ne.preventDefault();break}};return window.addEventListener("keydown",B),()=>window.removeEventListener("keydown",B)},[r]);const P=async()=>{if(O&&(S||R))try{const ne=(await ye.getTimerMessagesForEvent(O)).find(T=>T.enabled);ne&&(await ye.disableTimerMessage(ne.id),console.log("✅ Message disabled in Supabase on close"))}catch(B){console.error("❌ Error clearing message on close:",B)}window.close()};return _.useEffect(()=>{if(!O)return;const B=async()=>{try{const T=await ye.getTimerMessage(O);A(T),console.log("📨 Loaded timer message from Supabase:",T)}catch(T){console.error("❌ Error loading timer message:",T)}};B();const ne=setInterval(B,5e3);return()=>clearInterval(ne)},[O]),_.useEffect(()=>{const B=ne=>{if(ne.data.type==="TIMER_UPDATE"){const{isRunning:T,elapsedTime:re,totalDuration:de,eventId:Ne,itemId:fe,mainTimer:me,secondaryTimer:ve}=ne.data;T!==void 0&&a(T),re!==void 0&&h(re),de!==void 0&&p(de),Ne!==void 0&&J(Ne),fe!==void 0&&$(fe),me!==void 0&&q(me),ve!==void 0&&Y(ve)}else if(ne.data.type==="MESSAGE_UPDATE"){const{message:T,enabled:re}=ne.data;T!==void 0&&y(T),re!==void 0&&N(re)}};return window.addEventListener("message",B),()=>window.removeEventListener("message",B)},[]),s.jsx(Hv,{isRunning:r,elapsedTime:i,totalDuration:d,onClose:P,message:x,messageEnabled:S,itemId:U,eventId:O,supabaseMessage:R,mainTimer:X,secondaryTimer:K})},Kv=()=>{const u=yr();ea();const n=new URLSearchParams(u.search),r=n.get("eventId"),a=n.get("eventName"),i=u.state?.event||{id:r||"",name:a||"Current Event",date:"",location:"",schedule:[]},[h,d]=_.useState([]),[p,x]=_.useState(null),[y,S]=_.useState(!0),[N,R]=_.useState(null),[A,U]=_.useState(!1);_.useEffect(()=>{(async()=>{console.log("=== GRAPHICS LINKS PAGE INITIALIZATION ==="),console.log("Event from location.state:",u.state?.event),console.log("Event from URL params:",{eventId:r,eventName:a}),console.log("Final event object:",i);try{if(i?.id){console.log("🔄 Loading from Supabase for event:",i.id);const B=await ye.getRunOfShowData(i.id);if(B){console.log("✅ Loaded from Supabase:",B),console.log("Schedule items from Supabase:",B.schedule_items?.length||0),console.log("Sample schedule item:",B.schedule_items?.[0]),d(B.schedule_items||[]),x(B.updated_at||null),S(!1);return}}console.log("📱 Falling back to localStorage...");let P=null;if(i?.id){const B=`runOfShowSchedule_${i.id}`;P=localStorage.getItem(B)}if(!P&&r){const B=`runOfShowSchedule_${r}`;P=localStorage.getItem(B)}if(!P){const ne=Object.keys(localStorage).filter(T=>T.startsWith("runOfShowSchedule_"));if(ne.length>0){const T=ne[ne.length-1];P=localStorage.getItem(T)}}if(P){const B=JSON.parse(P);console.log("📱 Loaded from localStorage:",B),d(B)}}catch(P){console.error("❌ Error loading initial data:",P)}finally{S(!1)}})()},[i?.id,r]),_.useEffect(()=>{if(!i?.id){console.log("❌ No event ID, skipping change detection");return}console.log("🔄 Starting change detection for Graphics Links page");const Y=async()=>{try{console.log("🔄 Checking for changes in Graphics Links...");const B=await ye.checkForChanges(i.id,p??void 0);if(B.hasChanges){console.log("🔄 Changes detected in Graphics Links:",B),U(!0);const ne=await ye.loadChangesDynamically(i.id);ne&&(console.log("📥 Loading updated data for Graphics Links:",ne),console.log("📥 Updated schedule items:",ne.schedule_items?.length||0),console.log("📥 Sample updated item:",ne.schedule_items?.[0]),d(ne.schedule_items||[]),x(ne.updated_at||null),R(new Date),console.log("✅ Graphics Links data updated")),U(!1)}else console.log("✅ No changes detected in Graphics Links")}catch(B){console.error("❌ Error checking for changes in Graphics Links:",B)}};Y();const P=setInterval(Y,5e3);return()=>clearInterval(P)},[i?.id,p]),_.useEffect(()=>{const Y=()=>{console.log("🔄 localStorage changed, updating schedule...");let B=null;if(i?.id){const ne=`runOfShowSchedule_${i.id}`;B=localStorage.getItem(ne)}if(!B&&r){const ne=`runOfShowSchedule_${r}`;B=localStorage.getItem(ne)}if(!B){const T=Object.keys(localStorage).filter(re=>re.startsWith("runOfShowSchedule_"));if(T.length>0){const re=T[T.length-1];B=localStorage.getItem(re)}}if(B)try{U(!0);const ne=JSON.parse(B);console.log("📝 Updated schedule from localStorage:",ne),console.log("📝 Schedule items count:",ne.length),console.log("📝 Sample item with speakers:",ne.find(T=>T.speakersText)),d(ne),R(new Date),U(!1)}catch(ne){console.log("Error parsing updated schedule:",ne),U(!1)}};window.addEventListener("storage",Y),window.addEventListener("scheduleUpdated",Y);const P=setInterval(()=>{console.log("🔍 Polling for schedule changes..."),Y()},1e3);return()=>{window.removeEventListener("storage",Y),window.removeEventListener("scheduleUpdated",Y),clearInterval(P)}},[i?.id,r]);const $=()=>{console.log("=== GRAPHICS LINKS JSON GENERATION ==="),console.log("Using schedule from state:",h);let Y="";const B=Object.keys(localStorage).filter(me=>me.startsWith("masterStartTime_"));if(console.log("Master time keys found:",B),B.length>0){const me=B[B.length-1],ve=localStorage.getItem(me);console.log("Master time data from key",me,":",ve),ve&&(Y=ve)}console.log("Final masterStartTime:",Y);const ne=me=>{if(!Y)return"";let ve=0;for(let D=0;D<me;D++){const V=h[D];ve+=V.durationHours*60+V.durationMinutes}const[Ve,we]=Y.split(":").map(Number),z=new Date;return z.setHours(Ve,we+ve,0,0),z.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})};console.log("=== FINAL DATA SUMMARY ==="),console.log("Schedule from state:",h),console.log("Final masterStartTime:",Y),console.log("=== END FINAL DATA SUMMARY ===");const T=h.filter(me=>me.isPublic===!0).map(me=>{const ve=h.findIndex(we=>we.id===me.id),Ve=ne(ve);return{segmentName:me.segmentName||"Untitled Segment",startTime:Ve||"No Start Time"}});console.log("Public items found:",T);const re={event:i?.name||"Current Event",generated:new Date().toISOString(),schedule:T},de=JSON.stringify(re,null,2),Ne=new Blob([de],{type:"application/json;charset=utf-8;"}),fe=URL.createObjectURL(Ne);window.open(fe,"_blank")},O=()=>{console.log("=== GENERATING LOWER THIRDS JSON ==="),console.log("Event ID from URL:",r),console.log("Event object:",i),console.log("Using schedule from state:",h),console.log("Schedule length:",h.length),console.log("First few items:",h.slice(0,3));const Y=h.filter(fe=>fe.speakersText&&fe.speakersText.trim());console.log("Items with speakers data:",Y.length),console.log("Items with speakers:",Y.map(fe=>({segmentName:fe.segmentName,speakersText:fe.speakersText,speakersLength:fe.speakersText?.length||0}))),h.length===0&&(console.log("⚠️ NO SCHEDULE DATA FOUND!"),console.log("Available localStorage keys:",Object.keys(localStorage)),console.log("Looking for keys with event ID:",r));const B=Object.keys(localStorage).filter(fe=>fe.startsWith("masterStartTime_"));if(B.length>0){const fe=B[B.length-1];localStorage.getItem(fe)}const ne={speaker1:[],speaker2:[],speaker3:[],speaker4:[],speaker5:[],speaker6:[],speaker7:[]};h.forEach((fe,me)=>{if(console.log("Processing item:",fe.segmentName,"Speakers:",fe.speakersText),console.log("Item details:",{id:fe.id,segmentName:fe.segmentName,speakersText:fe.speakersText,speakersTextLength:fe.speakersText?.length||0,speakersTextType:typeof fe.speakersText}),fe.speakersText&&fe.speakersText.trim())try{const ve=JSON.parse(fe.speakersText);console.log("Parsed speakers array:",ve),console.log("Speakers array length:",ve?.length||0);const Ve=ve.sort((we,z)=>we.slot-z.slot);console.log("Sorted speakers by slot:",Ve),Ve.forEach(we=>{const z=we.slot,D=`speaker${z}`;if(z>=1&&z<=7){const V={row:me+1,cue:fe.customFields.cue||"",program:fe.programType||"",name:we.fullName||"",titleOrg:we.title&&we.org?`${we.title}
${we.org}`:we.title||we.org||"",photo:we.photoLink||""};console.log(`Adding to ${D} (slot ${z} in row ${me+1}):`,V),ne[D].push(V)}else console.log(`Speaker slot ${z} (${we.fullName}) is outside range 1-7, skipping`)})}catch(ve){console.log("Error parsing speakers JSON:",ve),console.log("Raw speakers data:",fe.speakersText)}else console.log("No speakers found in row:",fe.segmentName)}),console.log("Speaker sections:",ne);const T={event:i?.name||"Current Event",generated:new Date().toISOString(),lowerThirds:ne},re=JSON.stringify(T,null,2),de=new Blob([re],{type:"application/json;charset=utf-8;"}),Ne=URL.createObjectURL(de);window.open(Ne,"_blank"),console.log("=== END GENERATING LOWER THIRDS JSON ===")},J=()=>{const P=`${window.location.origin}/lower-thirds-live.html?eventId=${r||i?.id}`;navigator.clipboard.writeText(P).then(()=>{alert(`Live URL copied to clipboard:
${P}

Use this URL in VMIX Data Sources → JSON/XML

This URL will automatically update every 10 seconds!`)}).catch(()=>{const B=document.createElement("textarea");B.value=P,document.body.appendChild(B),B.select(),document.execCommand("copy"),document.body.removeChild(B),alert(`Live URL copied to clipboard:
${P}

Use this URL in VMIX Data Sources → JSON/XML

This URL will automatically update every 10 seconds!`)})},X=()=>{const P=`${window.location.origin}/schedule-live.html?eventId=${r||i?.id}`;navigator.clipboard.writeText(P).then(()=>{alert(`Live Schedule URL copied to clipboard:
${P}

Use this URL in VMIX Data Sources → JSON/XML

This URL will automatically update every 10 seconds!`)}).catch(()=>{const B=document.createElement("textarea");B.value=P,document.body.appendChild(B),B.select(),document.execCommand("copy"),document.body.removeChild(B),alert(`Live Schedule URL copied to clipboard:
${P}

Use this URL in VMIX Data Sources → JSON/XML

This URL will automatically update every 10 seconds!`)})},q=()=>{const P=`${window.location.origin}/custom-graphics-live.html?eventId=${r||i?.id}`;navigator.clipboard.writeText(P).then(()=>{alert(`Live Custom Graphics URL copied to clipboard:
${P}

Use this URL in VMIX Data Sources → JSON/XML

This URL will automatically update every 10 seconds!`)}).catch(()=>{const B=document.createElement("textarea");B.value=P,document.body.appendChild(B),B.select(),document.execCommand("copy"),document.body.removeChild(B),alert(`Live Custom Graphics URL copied to clipboard:
${P}

Use this URL in VMIX Data Sources → JSON/XML

This URL will automatically update every 10 seconds!`)})},K=()=>{let Y="";const B=Object.keys(localStorage).filter(me=>me.startsWith("masterStartTime_"));if(B.length>0){const me=B[B.length-1],ve=localStorage.getItem(me);ve&&(Y=ve)}const ne=me=>{if(!Y)return"";let ve=0;for(let D=0;D<me;D++){const V=h[D];ve+=V.durationHours*60+V.durationMinutes}const[Ve,we]=Y.split(":").map(Number),z=new Date;return z.setHours(Ve,we+ve,0,0),z.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})},T=h.filter(me=>me.isPublic).map(me=>({type:me.segmentName||"Segment",text:me.segmentName||"Custom Graphic",duration:`${me.durationHours.toString().padStart(2,"0")}:${me.durationMinutes.toString().padStart(2,"0")}:${me.durationSeconds.toString().padStart(2,"0")}`,cue:me.customFields.cue||"CUE##",startTime:ne(h.findIndex(ve=>ve.id===me.id)),notes:me.notes||""})),re={event:i?.name||"Current Event",generated:new Date().toISOString(),customGraphics:T.length>0?T:[{type:"Title",text:"Welcome to Event",duration:"00:00:10",cue:"CUE01",startTime:"00:00:00",notes:"Opening title"},{type:"Break",text:"Commercial Break",duration:"00:02:00",cue:"CUE02",startTime:"00:15:00",notes:"Commercial break"}]},de=JSON.stringify(re,null,2),Ne=new Blob([de],{type:"application/json;charset=utf-8;"}),fe=URL.createObjectURL(Ne);window.open(fe,"_blank")};return s.jsxs("div",{className:"min-h-screen bg-slate-900 text-white pt-16",children:[s.jsx("div",{className:"bg-slate-800 border-b border-slate-700",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"flex items-center justify-between h-16",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("button",{onClick:()=>{window.close()},className:"text-slate-300 hover:text-white transition-colors mr-6",children:"← Back to Run of Show"}),s.jsx("h1",{className:"text-xl font-semibold",children:"Graphics Links"})]}),s.jsx("div",{className:"text-slate-400",children:i?.name||"Event"})]})})}),s.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:s.jsxs("div",{className:"bg-slate-800 rounded-xl p-8 shadow-2xl",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-white",children:"Generate JSON Files"}),y&&s.jsx("p",{className:"text-blue-400 text-sm mt-1",children:"🔄 Loading data..."}),N&&!y&&s.jsxs("p",{className:"text-green-400 text-sm mt-1",children:["✅ Last updated: ",N.toLocaleTimeString()]}),A&&s.jsx("p",{className:"text-blue-400 text-sm mt-1",children:"🔄 Updating data..."})]}),s.jsx("button",{onClick:async()=>{console.log("🔄 Manual refresh triggered"),S(!0);try{if(i?.id){const P=await ye.getRunOfShowData(i.id);if(P){d(P.schedule_items||[]),x(P.updated_at||null),console.log("✅ Refreshed from Supabase"),alert("Data refreshed from database!");return}}let Y=null;if(i?.id){const P=`runOfShowSchedule_${i.id}`;Y=localStorage.getItem(P)}if(!Y&&r){const P=`runOfShowSchedule_${r}`;Y=localStorage.getItem(P)}if(!Y){const B=Object.keys(localStorage).filter(ne=>ne.startsWith("runOfShowSchedule_"));if(B.length>0){const ne=B[B.length-1];Y=localStorage.getItem(ne)}}if(Y){const P=JSON.parse(Y);console.log("📝 Manually refreshed schedule:",P),d(P),alert("Data refreshed from local storage!")}else alert("No schedule data found")}catch(Y){console.error("❌ Error refreshing data:",Y),alert("Error refreshing data")}finally{S(!1)}},className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white font-medium rounded-lg transition-colors",children:"🔄 Refresh Data"})]}),s.jsxs("p",{className:"text-slate-300 mb-8",children:["Click the buttons below to generate .json files that VMIX can use as data sources for graphics systems.",s.jsx("span",{className:"text-green-400 font-medium",children:" ✨ This page now updates automatically when content changes!"}),`Use "Refresh Data" if changes don't appear automatically.`]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"bg-slate-700 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Lower Thirds JSON"}),s.jsx("p",{className:"text-slate-300 text-sm mb-4",children:"Generate a .json file for lower third graphics with speaker information."}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:O,className:"w-full px-4 py-3 bg-blue-600 hover:bg-blue-500 text-white font-medium rounded-lg transition-colors",children:"📄 Generate Static JSON"}),s.jsx("button",{onClick:J,className:"w-full px-4 py-3 bg-green-600 hover:bg-green-500 text-white font-medium rounded-lg transition-colors",children:"🔄 Generate Live URL"})]})]}),s.jsxs("div",{className:"bg-slate-700 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Schedule JSON"}),s.jsx("p",{className:"text-slate-300 text-sm mb-4",children:"Generate a .json file with Segment Name and Start Time, sorted by time."}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:$,className:"w-full px-4 py-3 bg-green-600 hover:bg-green-500 text-white font-medium rounded-lg transition-colors",children:"📄 Generate Static JSON"}),s.jsx("button",{onClick:X,className:"w-full px-4 py-3 bg-emerald-600 hover:bg-emerald-500 text-white font-medium rounded-lg transition-colors",children:"🔄 Generate Live URL"})]})]}),s.jsxs("div",{className:"bg-slate-700 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Custom Graphics JSON"}),s.jsx("p",{className:"text-slate-300 text-sm mb-4",children:"Generate a .json file for custom graphics and overlays."}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:K,className:"w-full px-4 py-3 bg-purple-600 hover:bg-purple-500 text-white font-medium rounded-lg transition-colors",children:"📄 Generate Static JSON"}),s.jsx("button",{onClick:q,className:"w-full px-4 py-3 bg-violet-600 hover:bg-violet-500 text-white font-medium rounded-lg transition-colors",children:"🔄 Generate Live URL"})]})]})]}),s.jsxs("div",{className:"mt-8 p-4 bg-slate-600 rounded-lg",children:[s.jsx("h4",{className:"text-white font-semibold mb-2",children:"VMIX Data Source Information"}),s.jsx("p",{className:"text-slate-300 text-sm",children:'These .json files are designed for VMIX and will include only items marked as "Public":'}),s.jsxs("ul",{className:"text-slate-300 text-sm mt-2 ml-4 list-disc",children:[s.jsxs("li",{children:[s.jsx("strong",{children:"Schedule JSON:"})," Segment Name, Start Time (sorted by time)"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Lower Thirds JSON:"})," Name, Title, Organization, Segment, CUE"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Custom Graphics JSON:"})," Type, Text, Duration, CUE, Start Time, Notes"]})]}),s.jsx("div",{className:"mt-4 p-3 bg-blue-900 rounded-lg",children:s.jsxs("p",{className:"text-blue-200 text-sm",children:[s.jsx("strong",{children:"VMIX Setup:"})," Save the .json files to your server, then add the URLs in VMIX Data Sources → JSON/XML"]})})]})]})})]})},Gv=()=>{const u=yr();ea();const n=new URLSearchParams(u.search),r=n.get("eventId"),a=n.get("eventName"),i=u.state?.event||{id:r||"",name:a||"Current Event",date:"",location:"",schedule:[]};console.log("ReportsPage event data:",{fromState:!!u.state?.event,eventId:r,eventName:a,finalEvent:i,userRole:localStorage.getItem("currentUserRole")});const[h,d]=_.useState([]),[p,x]=_.useState(""),[y,S]=_.useState("showfile"),[N,R]=_.useState(1);_.useEffect(()=>{console.log("=== REPORTS PAGE INITIALIZATION ==="),console.log("Event:",i);let q=null;if(i?.id){const B=`runOfShowSchedule_${i.id}`;q=localStorage.getItem(B)}if(!q&&r){const B=`runOfShowSchedule_${r}`;q=localStorage.getItem(B)}if(!q){const ne=Object.keys(localStorage).filter(T=>T.startsWith("runOfShowSchedule_"));if(ne.length>0){const T=ne[ne.length-1];q=localStorage.getItem(T)}}if(q)try{const B=JSON.parse(q);d(B),console.log("Schedule loaded:",B),console.log("First schedule item:",B[0]),console.log("Schedule item duration fields:",B[0]?{durationHours:B[0].durationHours,durationMinutes:B[0].durationMinutes,durationSeconds:B[0].durationSeconds}:"No items")}catch(B){console.log("Error parsing schedule:",B)}const Y=Object.keys(localStorage).filter(B=>B.startsWith("masterStartTime_"));console.log("Master time keys found:",Y);let P=null;if(i?.id&&(P=localStorage.getItem(`masterStartTime_${i.id}`),console.log(`Master time for event ${i.id}:`,P)),!P&&Y.length>0){const B=Y[Y.length-1];P=localStorage.getItem(B),console.log("Latest master time key:",B,"Value:",P)}P?(x(P),console.log("Master start time set to:",P)):(console.log("No master start time found in localStorage"),x("09:00"),console.log("Set default master start time to 09:00"))},[i?.id,r]);const A=q=>{if(console.log(`calculateStartTime called with index: ${q}, masterStartTime: ${p}`),!p)return console.log("No master start time, returning empty string"),"";let K=0;for(let T=0;T<q;T++){const re=h[T];K+=re.durationHours*60+re.durationMinutes}console.log(`Total minutes for index ${q}: ${K}`);const[Y,P]=p.split(":").map(Number),B=new Date;B.setHours(Y,P+K,0,0);const ne=B.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return console.log(`Calculated start time for index ${q}: ${ne}`),ne},U=q=>({"PreShow/End":"#8B5CF6","Podium Transition":"#8B4513","Panel Transition":"#404040","Sub Cue":"#F3F4F6","No Transition":"#059669",Video:"#F59E0B","Panel+Remote":"#1E40AF","Remote Only":"#60A5FA",Break:"#EC4899",TBD:"#6B7280",KILLED:"#DC2626",Podium:"#FFFFFF",Panel:"#FFFFFF"})[q]||"#D3D3D3",$=q=>q==="Panel Transition"||q==="Podium Transition"||q==="Panel"||q==="Podium"?"#FFFFFF":U(q),O=()=>{const q=y==="showfile",K=h.filter(Y=>(Y.day||1)===N);if(console.log("=== GENERATING REPORT ==="),console.log("Report type:",y),console.log("Selected day:",N),console.log("Total schedule items:",h.length),console.log("Filtered schedule items:",K.length),console.log("Sample item:",K[0]),console.log("Master start time:",p),K.length>0){const Y=h.findIndex(B=>B.id===K[0].id),P=A(Y);console.log("Test start time calculation:",{testIndex:Y,testStartTime:P,item:K[0].segmentName})}if(q){let Y=`
        <!DOCTYPE html>
        <html>
        <head>
          <title>ROS Show File - ${i?.name||"Event"}</title>
          <style>
            body { 
              font-family: Arial, sans-serif; 
              margin: 0; 
              padding: 15px;
              font-size: 11px;
              line-height: 1.3;
              background: white;
            }
            @media print {
              body { 
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
              }
              * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
              }
            }
            .header { 
              text-align: center; 
              margin-bottom: 15px; 
            }
            .header h1 { 
              font-size: 16px; 
              margin: 0; 
              color: #000;
              font-weight: normal;
            }
            .header h2 { 
              font-size: 12px; 
              margin: 3px 0 0 0; 
              color: #333; 
              font-weight: normal;
            }
            .event-info { 
              background: #f5f5f5; 
              padding: 8px; 
              margin-bottom: 12px; 
              font-size: 10px;
              border: 1px solid #ddd;
            }
            .section { 
              margin-bottom: 8px; 
              border: 1px solid #000;
              page-break-inside: avoid;
            }
            .section-header { 
              padding: 6px 8px; 
              font-weight: normal; 
              font-size: 11px;
              color: white;
              background: #366092;
              border-bottom: 1px solid #000;
            }
            .section-content { 
              padding: 0; 
              background: white;
            }
            .modal-table { 
              width: 100%;
              border-collapse: collapse;
              border: 2px solid #000;
              background: white;
            }
            .modal-table td { 
              border: 1px solid #000; 
              padding: 6px 8px; 
              background: white;
              vertical-align: top;
            }
            .modal-table .header-cell { 
              background: #d9d9d9; 
              font-weight: normal; 
              text-align: center;
              font-size: 10px;
              width: 70px;
              min-width: 70px;
            }
            .modal-table .segment-cell { 
              min-width: 180px;
              max-width: 250px;
              word-wrap: break-word;
              font-size: 11px;
            }
            .modal-table .notes-cell { 
              background: #f0f0f0; 
              min-height: 35px;
              min-width: 200px;
              font-size: 10px;
            }
            .modal-table .participants-cell { 
              background: #f0f0f0; 
              min-height: 60px;
              min-width: 250px;
            }
            .modal-table .start-time-cell { 
              background: #e7f3ff; 
              font-weight: normal;
              font-size: 12px;
            }
            .times-cell {
              background: #e7f3ff;
              font-weight: normal;
              text-align: center;
              vertical-align: middle;
              width: 80px;
              min-width: 80px;
            }
            .times-content {
              display: flex;
              flex-direction: column;
              gap: 2px;
            }
            .start-time {
              font-size: 11px;
              font-weight: normal;
              color: #000;
            }
            .duration {
              font-size: 11px;
              font-weight: normal;
              color: #000;
            }
            .time-label {
              font-size: 9px;
              font-weight: normal;
              color: #333;
              margin-right: 4px;
            }
            .simple-table { 
              width: 100%;
              border-collapse: collapse;
              border: 1px solid #000;
              background: white;
            }
            .simple-table td { 
              border: 1px solid #000; 
              padding: 8px; 
              background: white;
              vertical-align: top;
              font-size: 11px;
            }
        .simple-table .header-cell { 
          background: #d9d9d9; 
          font-weight: normal; 
          text-align: center;
          font-size: 10px;
        }
        .stacked-header {
          width: 250px;
        }
        .stacked-cell {
          width: 250px;
          max-width: 250px;
          vertical-align: top;
          padding: 8px;
        }
        .stacked-item {
          margin-bottom: 8px;
          padding-bottom: 6px;
          border-bottom: 1px solid #e0e0e0;
          display: flex;
          flex-direction: column;
        }
        .stacked-item:last-child {
          border-bottom: none;
          margin-bottom: 0;
          padding-bottom: 0;
        }
        .stacked-label {
          font-weight: normal;
          font-size: 9px;
          color: #333;
          margin-bottom: 3px;
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }
        .stacked-value {
          font-size: 10px;
          line-height: 1.3;
          word-wrap: break-word;
          color: #000;
          padding-left: 4px;
        }
        .slot-cell {
          width: 120px;
          height: 100px;
          vertical-align: top;
        }
        .slot-container {
          height: 100px;
          display: flex;
          flex-direction: column;
          justify-content: flex-start;
          padding: 4px;
        }
        .slot-name {
          font-weight: normal;
          font-size: 11px;
          line-height: 1.2;
        }
        .slot-title {
          font-size: 10px;
          line-height: 1.1;
          color: #666;
        }
        .slot-org {
          font-size: 10px;
          line-height: 1.1;
          color: #666;
        }
        .slot-photo {
          display: flex;
          align-items: center;
          justify-content: center;
          margin-top: 8px;
        }
        .slot-photo-img {
          width: 65px;
          height: 65px;
          object-fit: cover;
          border-radius: 4px;
          border: 1px solid #ccc;
        }
        .notes-header-row {
          background: #e0e0e0;
        }
        .notes-header-cell {
          padding: 6px 8px;
          font-size: 10px;
          font-weight: normal;
          text-align: center;
          border-top: 2px solid #ddd;
          background: #e0e0e0;
        }
        .notes-content-row {
          background: #f9f9f9;
        }
        .notes-content-cell {
          padding: 8px;
          font-size: 10px;
          line-height: 1.3;
          background: #f9f9f9;
        }
            .modal-cell .field-label { 
              font-weight: normal; 
              font-size: 11px; 
              color: #333; 
              margin-bottom: 4px;
            }
            .modal-cell .field-value { 
              font-size: 12px; 
              color: #000;
              line-height: 1.3;
            }
            .speaker-item { 
              display: flex; 
              align-items: center; 
              margin-bottom: 6px;
              padding: 6px;
              background: white;
              border: 1px solid #ddd;
              border-radius: 4px;
              box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            }
            .speaker-photo { 
              width: 40px; 
              height: 40px; 
              border-radius: 4px; 
              object-fit: cover; 
              border: 2px solid #007acc;
              margin-right: 10px;
              flex-shrink: 0;
            }
            .speaker-info { 
              flex: 1;
            }
            .speaker-badges { 
              display: flex; 
              gap: 4px;
              margin-bottom: 3px;
            }
            .speaker-name { 
              font-weight: normal; 
              font-size: 11px; 
              color: #000;
              margin-bottom: 2px;
            }
            .slot-badge { 
              background: #007acc; 
              color: white; 
              padding: 2px 6px; 
              border-radius: 6px; 
              font-size: 8px; 
              font-weight: normal;
            }
            .location-badge { 
              background: #28a745; 
              color: white; 
              padding: 2px 6px; 
              border-radius: 6px; 
              font-size: 8px; 
              font-weight: normal;
            }
            .speaker-title { 
              color: #666; 
              font-size: 10px;
              margin-bottom: 1px;
            }
            .speaker-org { 
              color: #888; 
              font-size: 9px;
            }
            .footer { 
              margin-top: 40px; 
              text-align: center; 
              color: #666; 
              font-size: 12px;
              border-top: 1px solid #ddd;
              padding-top: 20px;
            }
            @media print {
              body { margin: 0; }
              .no-print { display: none; }
              @page { 
                size: A4; 
                margin: 0.5in; 
              }
              .section { 
                page-break-inside: avoid;
              }
            }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>ROS SHOW FILE</h1>
            <h2>${i?.name||"Event"}${i?.numberOfDays&&i.numberOfDays>1?` - Day ${N}`:""}</h2>
          </div>
          
      `;return K.forEach((P,B)=>{const ne=h.findIndex(ve=>ve.id===P.id),T=A(ne),re=`${P.durationHours.toString().padStart(2,"0")}:${P.durationMinutes.toString().padStart(2,"0")}:${P.durationSeconds.toString().padStart(2,"0")}`,de=U(P.programType||"");console.log(`SHOW FILE - Item ${B} (${P.segmentName}):`,{originalIndex:ne,startTime:T,duration:re,masterStartTime:p,itemId:P.id});let Ne=[];if(P.speakersText)try{Ne=JSON.parse(P.speakersText),console.log(`Speakers parsed for item ${B}:`,Ne)}catch(ve){console.log(`Error parsing speakers for item ${B}:`,ve),Ne=[{fullName:P.speakersText,title:"",org:"",photoLink:""}]}else console.log(`No speakersText for item ${B}:`,P.segmentName);let fe="";P.hasPPT&&P.hasQA?fe="PPT + Q&A":P.hasPPT?fe="PPT":P.hasQA?fe="Q&A":fe="None",Y+=`
          <div class="section">
            <div class="section-content">
              <table class="simple-table">
                <tr>
                  <td class="header-cell">CUE</td>
                  <td class="header-cell">TIME</td>
                  <td class="header-cell stacked-header">SEGMENT INFO</td>
                  <td class="header-cell">SLOT 1</td>
                  <td class="header-cell">SLOT 2</td>
                  <td class="header-cell">SLOT 3</td>
                  <td class="header-cell">SLOT 4</td>
                  <td class="header-cell">SLOT 5</td>
                  <td class="header-cell">SLOT 6</td>
                  <td class="header-cell">SLOT 7</td>
                </tr>
                <tr>
                  <td>
                    <div style="margin-bottom: 4px;">${P.customFields.cue||`CUE ${B+1}`}</div>
                    <div style="background-color: ${de}; color: ${P.programType==="Sub Cue"?"black":"white"}; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: normal; display: inline-block; ${P.programType==="Sub Cue"?"border: 1px solid #000000;":""}">${P.programType||"Unknown"}</div>
                  </td>
                  <td class="times-cell">
                    <div class="times-content">
                      <div class="start-time">
                        <span class="time-label">Start:</span> ${T}
                      </div>
                      <div class="duration">
                        <span class="time-label">Dur:</span> ${re}
                      </div>
                    </div>
                  </td>
                  <td class="stacked-cell">
                    <div class="stacked-item">
                      <div class="stacked-label">SEGMENT:</div>
                      <div class="stacked-value">${P.segmentName||"Untitled Segment"}</div>
                    </div>
                    <div class="stacked-item">
                      <div class="stacked-label">SHOT:</div>
                      <div class="stacked-value">${P.shotType||"Not specified"}</div>
                    </div>
                    <div class="stacked-item">
                      <div class="stacked-label">PPT/Q&A:</div>
                      <div class="stacked-value">${fe}</div>
                    </div>
                  </td>
        `;const me=["","","","","","",""];Ne.length>0&&Ne.forEach(ve=>{const Ve=ve.fullName||ve.name||"Unknown",we=ve.title||"",z=ve.org||"",D=ve.slot||1,V=ve.location||"Podium",E=ve.photoLink||"";let ee=`
              <div class="slot-container">
                <div class="slot-name">${V==="Podium"?"P":V==="Seat"?"S":"V"}${D} - ${Ve}</div>
                <div class="slot-title">${we}</div>
                <div class="slot-org">${z}</div>
                <div class="slot-photo">${E?`<img src="${E}" alt="${Ve}" class="slot-photo-img" />`:""}</div>
              </div>
            `;const ce=Math.min(D-1,6);ce>=0&&ce<7&&(me[ce]=ee)});for(let ve=0;ve<7;ve++)Y+=`<td class="slot-cell">${me[ve]||""}</td>`;Y+=`
                </tr>
                <tr class="notes-header-row">
                  <td colspan="10" class="notes-header-cell">NOTES</td>
                </tr>
                <tr class="notes-content-row">
                  <td colspan="10" class="notes-content-cell">${P.notes||"None"}</td>
                </tr>
              </table>
            </div>
          </div>
        `}),Y+=`
          <div class="footer">
            <p>Generated: ${new Date().toLocaleString()} | Run of Show Application</p>
          </div>
        </body>
        </html>
      `,Y}else{let Y=`
        <!DOCTYPE html>
        <html>
        <head>
          <title>Run of Show Report - ${i?.name||"Event"}</title>
          <style>
            body { 
              font-family: Arial, sans-serif; 
              margin: 20px; 
              font-size: 14px;
            }
            .header { 
              text-align: center; 
              margin-bottom: 30px; 
            }
            .header h1 { 
              font-size: 24px; 
              margin: 0; 
            }
            .header h2 { 
              font-size: 18px; 
              margin: 5px 0 0 0; 
              color: #666; 
            }
            .event-info { 
              background: #f5f5f5; 
              padding: 15px; 
              border-radius: 5px; 
              margin-bottom: 20px; 
              font-size: 12px;
            }
            table { 
              width: 100%; 
              border-collapse: collapse; 
              margin-top: 20px; 
            }
            th, td { 
              border: 1px solid #ddd; 
              padding: 8px; 
              text-align: left; 
              font-size: 12px;
            }
            th { 
              background-color: #f2f2f2; 
              font-weight: normal; 
            }
            tr { 
              -webkit-print-color-adjust: exact !important;
              color-adjust: exact !important;
              print-color-adjust: exact !important;
            }
            .footer { 
              margin-top: 30px; 
              text-align: center; 
              color: #666; 
              font-size: 12px;
            }
            @media print {
              body { margin: 0; }
              .no-print { display: none; }
              @page { 
                size: A4; 
                margin: 0.5in; 
              }
              tr { 
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
              }
            }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>RUN OF SHOW REPORT</h1>
            <h2>${i?.name||"Event"}${i?.numberOfDays&&i.numberOfDays>1?` - Day ${N}`:""}</h2>
            <h3>ROS CONDENSED</h3>
          </div>
          
          <div class="event-info">
            <p><strong>Event:</strong> ${i?.name||"Current Event"} | 
               <strong>Date:</strong> ${i?.date||"Not specified"} | 
               <strong>Location:</strong> ${i?.location||"Not specified"} | 
               <strong>Start Time:</strong> ${p||"Not set"} | 
               <strong>Total Items:</strong> ${h.length}</p>
          </div>
          
          <table>
            <thead>
              <tr>
                <th>CUE</th>
                <th>START</th>
                <th>DURATION</th>
                <th>SEGMENT</th>
                <th>SHOT TYPE</th>
                <th>PPT/Q&A</th>
                <th>PARTICIPANTS</th>
              </tr>
            </thead>
            <tbody>
      `;return K.forEach((P,B)=>{const ne=h.findIndex(fe=>fe.id===P.id),T=A(ne),re=`${P.durationHours.toString().padStart(2,"0")}:${P.durationMinutes.toString().padStart(2,"0")}:${P.durationSeconds.toString().padStart(2,"0")}`;U(P.programType||"");let de="";if(P.speakersText)try{de=JSON.parse(P.speakersText).map(me=>me.fullName||me.name||me).join(`
`)}catch{de=P.speakersText}let Ne="";P.hasPPT&&P.hasQA?Ne="PPT + Q&A":P.hasPPT?Ne="PPT":P.hasQA?Ne="Q&A":Ne="",Y+=`
          <tr style="background-color: ${$(P.programType)};">
            <td>${P.programType==="Sub Cue"?`<span style="background-color: #9CA3AF; color: white; padding: 2px 6px; border-radius: 4px; font-weight: bold;">${P.customFields?.cue||""}</span>`:P.programType==="Podium"||P.programType==="Podium Transition"?`<span style="background-color: #8B4513; color: white; padding: 2px 6px; border-radius: 4px; font-weight: bold;">${P.customFields?.cue||""}</span>`:P.programType==="Panel"||P.programType==="Panel Transition"?`<span style="background-color: #404040; color: white; padding: 2px 6px; border-radius: 4px; font-weight: bold;">${P.customFields?.cue||""}</span>`:P.customFields?.cue||""}</td>
            <td>${T}</td>
            <td>${re}</td>
            <td>${P.segmentName||"Untitled Segment"}</td>
            <td>${P.shotType||""}</td>
            <td>${Ne}</td>
            <td style="white-space: pre-line;">${de}</td>
          </tr>
        `}),Y+=`
            </tbody>
          </table>
          
          <div class="footer">
            <p>Generated: ${new Date().toLocaleString()} | Run of Show Application</p>
          </div>
        </body>
        </html>
      `,Y}},J=()=>{const q=O(),K=window.open("","_blank");K&&(K.document.write(q),K.document.close(),K.focus(),K.print())},X=()=>{const q=O(),K=new Blob([q],{type:"text/html"}),Y=URL.createObjectURL(K),P=document.createElement("a");P.href=Y,P.download=`ros-${y==="showfile"?"show-file":"condensed"}${i?.numberOfDays&&i.numberOfDays>1?`-day-${N}`:""}-${i?.name?.replace(/\s+/g,"-")||"event"}-${new Date().toISOString().split("T")[0]}.html`,document.body.appendChild(P),P.click(),document.body.removeChild(P),URL.revokeObjectURL(Y)};return s.jsxs("div",{className:"min-h-screen bg-slate-900 text-white pt-16",children:[s.jsx("div",{className:"bg-slate-800 border-b border-slate-700",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"flex items-center justify-between h-16",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("button",{onClick:()=>{window.close()},className:"text-slate-300 hover:text-white transition-colors mr-6",children:"← Back to Run of Show"}),s.jsx("h1",{className:"text-xl font-semibold",children:"Reports and Printing"})]}),s.jsx("div",{className:"text-slate-400",children:i?.name||"Event"})]})})}),s.jsx("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:s.jsxs("div",{className:"bg-slate-800 rounded-xl p-8 shadow-2xl",children:[s.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Generate Reports"}),s.jsxs("div",{className:"bg-slate-700 rounded-lg p-6 mb-8",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Report Options"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Report Type"}),s.jsxs("select",{value:y,onChange:q=>S(q.target.value),className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"showfile",children:"ROS Show File"}),s.jsx("option",{value:"condensed",children:"ROS CONDENSED"})]})]}),i?.numberOfDays&&i.numberOfDays>1&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Select Day"}),s.jsx("select",{value:N,onChange:q=>R(parseInt(q.target.value)),className:"w-full px-3 py-2 bg-slate-600 border border-slate-500 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:Array.from({length:i.numberOfDays},(q,K)=>s.jsxs("option",{value:K+1,children:["Day ",K+1]},K+1))})]}),s.jsxs("div",{className:"text-slate-400 text-sm",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"ROS Show File:"})," Section-based format with all details and speaker photos"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"ROS CONDENSED:"})," Table format with all information"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Color Coding:"})," Sections colored by program type"]})]})]})]}),s.jsxs("div",{className:"flex flex-wrap gap-4",children:[s.jsxs("button",{onClick:J,className:"px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white font-medium rounded-lg transition-colors flex items-center gap-2",children:[s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"Print Report"]}),s.jsxs("button",{onClick:X,className:"px-6 py-3 bg-green-600 hover:bg-green-500 text-white font-medium rounded-lg transition-colors flex items-center gap-2",children:[s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download Report"]})]}),s.jsxs("div",{className:"mt-8",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Report Preview"}),s.jsx("div",{className:"bg-slate-700 rounded-lg p-4 max-h-96 overflow-y-auto",children:s.jsxs("div",{className:"text-slate-300 text-sm",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Event:"})," ",i?.name||"Current Event"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Total Items:"})," ",h.length,i?.numberOfDays&&i.numberOfDays>1?` | <strong>Day ${N} Items:</strong> ${h.filter(q=>(q.day||1)===N).length}`:""]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Master Start Time:"})," ",p||"Not set"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Report Type:"})," ",y==="showfile"?"ROS Show File":"ROS CONDENSED"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Format:"})," ",y==="showfile"?"Section-based with speaker photos":"Table format"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Color Coding:"})," Sections colored by program type"]})]})})]})]})})]})},Jv=()=>{const u=yr(),n=new URLSearchParams(u.search),r=n.get("eventId"),a=n.get("eventName"),i=n.get("eventDate"),h=n.get("eventLocation"),d=u.state?.event||{id:r||"",name:a||"Current Event",date:i||"",location:h||"",numberOfDays:1},[p,x]=_.useState([]),[y,S]=_.useState(new Date),[N,R]=_.useState(!0),[A,U]=_.useState(null),[$,O]=_.useState(null),[J,X]=_.useState({}),[q,K]=_.useState(null),[Y,P]=_.useState({}),[B,ne]=_.useState("09:00"),[T,re]=_.useState({}),de=z=>{if(console.log(`🔄 calculateStartTime called for index ${z}:`,{masterStartTime:B,scheduleLength:p.length}),!B)return console.log("❌ No master start time, returning empty string"),"";let D=0;for(let Ge=0;Ge<z;Ge++){const mt=p[Ge],br=mt.durationHours*60+mt.durationMinutes;D+=br,console.log(`  Item ${Ge} (${mt.segmentName}): ${mt.durationHours}h ${mt.durationMinutes}m = ${br} total minutes`)}const[V,E]=B.split(":").map(Number),F=V*60+E,ee=F+D,ce=Math.floor(ee/60),$e=ee%60,Me=ce>=12?"PM":"AM";let ze=ce;ce>12&&(ze=ce-12),ce===0&&(ze=12);const Fe=`${ze}:${$e.toString().padStart(2,"0")} ${Me}`;return console.log(`🔄 calculateStartTime result for index ${z}:`,{masterStartTime:B,totalMinutes:D,totalStartMinutes:F,finalMinutes:ee,hours:ce,minutes:$e,period:Me,displayHours:ze,result:Fe}),Fe};_.useEffect(()=>{if(d?.id){console.log("🔍 Loading master start time for event ID:",d.id);const z=localStorage.getItem(`masterStartTime_${d.id}`),D=localStorage.getItem(`dayStartTimes_${d.id}`);if(console.log("🔍 Raw localStorage values:",{masterStartTime:z,dayStartTimes:D,eventId:d.id}),z)ne(z),console.log("📥 Loaded master start time from localStorage:",z);else{console.log("❌ No master start time found in localStorage for event:",d.id),console.log("🔍 Available localStorage keys:",Object.keys(localStorage).filter(ee=>ee.includes("masterStartTime"))),console.log("🔍 All localStorage keys:",Object.keys(localStorage));const V=Object.keys(localStorage).filter(ee=>ee.includes("masterStartTime")).map(ee=>({key:ee,value:localStorage.getItem(ee)}));console.log("🔍 All master start times in localStorage:",V);let E=null;const F=V.find(ee=>ee.value&&ee.value!=="09:00");F?(E=F,console.log("📥 Found non-default master start time:",F.value)):(E=V.find(ee=>ee.value),console.log("📥 Using first available master start time:",E?.value)),E&&E.value?(console.log("📥 Setting master start time to:",E.value),ne(E.value)):(console.log("❌ No suitable master start time found in localStorage"),console.log("🔍 Will try to get master start time from Supabase data..."))}D?(re(JSON.parse(D)),console.log("📥 Loaded day start times from localStorage:",JSON.parse(D))):console.log("❌ No day start times found in localStorage for event:",d.id)}},[d?.id]),_.useEffect(()=>{const z=setInterval(()=>{S(new Date)},1e3);return()=>clearInterval(z)},[]);const Ne=async()=>{if(d?.id)try{console.log("🔄 Loading active timer for Green Room...");const z=await ye.getActiveTimer(d.id);z?(console.log("🔄 Active timer found:",z),console.log("🔄 Timer state:",z.timer_state),console.log("🔄 Item ID:",z.item_id),O(z.item_id),K(z.timer_state),P({[z.item_id]:!0}),console.log("🔄 Set loaded items:",{[z.item_id]:!0}),X({[z.item_id]:{elapsed:z.elapsed_seconds||0,total:z.duration_seconds||0,startedAt:z.started_at?new Date(z.started_at):null}})):(console.log("🔄 No active timer found"),O(null),K(null),P({}),X({}))}catch(z){console.error("❌ Error loading active timer:",z)}};_.useEffect(()=>{if(!d?.id)return;Ne();const z=setInterval(Ne,2e3);return()=>clearInterval(z)},[d?.id]);const fe=async()=>{if(!d?.id){U("No event selected"),R(!1);return}try{console.log("🔄 Loading schedule for Green Room..."),console.log("🔄 Event details:",{id:d.id,name:d.name,location:d.location});const z=await ye.getRunOfShowData(d.id);if(console.log("🔄 Raw data received:",z),z&&z.settings&&z.settings.masterStartTime&&B==="09:00"&&(console.log("📥 Found master start time in Supabase data:",z.settings.masterStartTime),ne(z.settings.masterStartTime)),z?.schedule_items){console.log("🔄 Total schedule items found:",z.schedule_items.length);const V=z.schedule_items.map((E,F)=>{const ee=(E.durationHours||0)*60+(E.durationMinutes||0)+(E.durationSeconds||0)/60,ce=ee>0?`${Math.round(ee)} min`:"0 min",$e=de(F);let Me=null;if(console.log(`🔄 Calculated start time for ${E.segmentName} (index ${F}):`,{index:F,startTime:$e,masterStartTime:B,duration:ee,itemDurationHours:E.durationHours,itemDurationMinutes:E.durationMinutes,itemDurationSeconds:E.durationSeconds}),$e&&ee>0){const ze=new Date(`1970-01-01 ${$e}`);Me=new Date(ze.getTime()+ee*6e4).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0})}else Me="TBD";return{...E,startTime:$e,endTime:Me,duration:ce,isPublic:E.isPublic||!1}}).filter(E=>E.isPublic===!0);console.log("🔄 Public items found after time calculation:",V.length),V.sort((E,F)=>{if(E.startTime&&E.startTime!=="TBD"&&F.startTime&&F.startTime!=="TBD"){const ee=new Date(`1970-01-01 ${E.startTime}`),ce=new Date(`1970-01-01 ${F.startTime}`);return ee.getTime()-ce.getTime()}return(!E.startTime||E.startTime==="TBD")&&F.startTime&&F.startTime!=="TBD"?1:E.startTime&&E.startTime!=="TBD"&&(!F.startTime||F.startTime==="TBD")?-1:0}),x(V),console.log("✅ Schedule loaded for Green Room:",V)}else U("No schedule data found")}catch(z){console.error("❌ Error loading schedule:",z),U("Failed to load schedule data")}finally{R(!1)}};_.useEffect(()=>{fe()},[d?.id]),_.useEffect(()=>{if(!d?.id)return;console.log("🔄 Starting 20-second schedule polling for Green Room...");const z=setInterval(()=>{console.log("🔄 Polling for schedule changes (every 20s)..."),fe()},2e4);return()=>{console.log("🔄 Clearing 20-second schedule polling for Green Room..."),clearInterval(z)}},[d?.id]);const me=(()=>{const z=$?p.findIndex(E=>String(E.id)===String($)):-1;console.log("🔄 Modifying schedule visibility:",{totalScheduleItems:p.length,currentIndex:z,activeItemId:$,activeItemIdType:typeof $,scheduleItemIds:p.map(E=>({id:E.id,idType:typeof E.id,name:E.segmentName})),originalSchedule:p.map(E=>({id:E.id,name:E.segmentName,isPublic:E.isPublic}))});const D=p.map((E,F)=>z>=0&&F<z?{...E,isPublic:!1}:E),V=D.filter(E=>E.isPublic===!0);return console.log("🔄 Modified schedule:",{modifiedSchedule:D.map(E=>({id:E.id,name:E.segmentName,isPublic:E.isPublic})),visibleItems:V.map(E=>({id:E.id,name:E.segmentName}))}),V})(),ve=()=>{if(!$||!J[$])return"No Timer";const z=J[$];return z.startedAt?new Date(z.startedAt.getTime()+z.total*1e3).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0}):"Not Started"},Ve=()=>{if(!$||!J[$])return"00:00";const z=J[$],D=z.total-z.elapsed,V=D<0,E=Math.abs(D),F=Math.floor(E/60),ee=Math.floor(E%60),ce=`${F.toString().padStart(2,"0")}:${ee.toString().padStart(2,"0")}`;return V?`-${ce}`:ce},we=()=>{if(!$||!J[$])return!1;const z=J[$];return z.total-z.elapsed<0};return N?s.jsxs("div",{className:"w-full h-screen flex items-center justify-center relative",style:{aspectRatio:"9/16"},children:[s.jsxs("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover",style:{objectFit:"cover"},children:[s.jsx("source",{src:"/pointed_crop_loop.webm",type:"video/webm"}),"Your browser does not support the video tag."]}),s.jsx("div",{className:"text-white text-xl relative z-10 bg-black/50 px-4 py-2 rounded",children:"Loading Green Room..."})]}):A?s.jsxs("div",{className:"w-full h-screen flex items-center justify-center relative",style:{aspectRatio:"9/16"},children:[s.jsxs("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover",style:{objectFit:"cover"},children:[s.jsx("source",{src:"/pointed_crop_loop.webm",type:"video/webm"}),"Your browser does not support the video tag."]}),s.jsx("div",{className:"text-red-400 text-xl relative z-10 bg-black/50 px-4 py-2 rounded",children:A})]}):s.jsxs("div",{className:"w-full h-screen text-white overflow-hidden relative",style:{aspectRatio:"9/16"},children:[s.jsxs("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover",style:{objectFit:"cover"},children:[s.jsx("source",{src:"/pointed_crop_loop.webm",type:"video/webm"}),"Your browser does not support the video tag."]}),s.jsxs("div",{className:"relative z-10",children:[s.jsxs("div",{className:"p-6 flex items-center",children:[s.jsx("div",{className:"text-white font-bold flex-1 text-center",style:{fontSize:"clamp(2rem, 6vw, 4rem)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.1",marginRight:"20px"},children:d?.name||"Current Event"}),s.jsxs("div",{className:`rounded-lg p-4 text-center flex-shrink-0 ${we()?"bg-red-800":"bg-red-600"}`,children:[s.jsx("div",{className:"text-white text-lg font-semibold mb-2",children:we()?"OVER TIME":"Stage Timer"}),s.jsx("div",{className:`text-4xl font-bold mb-2 ${we()?"text-red-200":"text-white"}`,children:Ve()}),s.jsxs("div",{className:"text-white text-sm",children:["Expected Finish: ",ve()]})]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-6 max-h-[calc(100vh-200px)] [&::-webkit-scrollbar]:hidden",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:s.jsx("div",{className:"space-y-4",children:me.length===0?s.jsx("div",{className:"text-center text-gray-400 text-lg py-12",children:"No public schedule items available"}):s.jsx(s.Fragment,{children:me.slice(0,8).map((z,D)=>{const V=Y[z.id],E=q==="running"&&String($)===String(z.id),F=String($)===String(z.id);return console.log(`🔄 Item ${z.id} (${z.segmentName}):`,{isLoaded:V,isRunning:E,isActive:F,timerState:q,activeItemId:$,loadedItems:Y}),s.jsxs("div",{className:`p-4 rounded-lg transition-all duration-300 ${V?E?"bg-red-600 text-white":"bg-green-600 text-white":"bg-gray-300 text-gray-700"}`,children:[s.jsx("div",{className:"font-bold text-xl mb-2 uppercase",children:z.segmentName}),s.jsxs("div",{className:"text-sm space-y-1",children:[s.jsxs("div",{children:["Start: ",z.startTime]}),s.jsxs("div",{children:["End: ",z.endTime]})]})]},z.id)})})})})]})]})},Qv=()=>{const u=yr(),n=new URLSearchParams(u.search),r=n.get("eventId"),a=n.get("eventName"),i=n.get("eventDate"),h=n.get("eventLocation"),d=u.state?.event||{id:r||"",name:a||"Current Event",date:i||"",location:h||"",numberOfDays:1},[p,x]=_.useState([]),[y,S]=_.useState(new Date),[N,R]=_.useState(!0),[A,U]=_.useState(null),[$,O]=_.useState(null),[J,X]=_.useState({}),[q,K]=_.useState(null),[Y,P]=_.useState({}),[B,ne]=_.useState("09:00"),[T,re]=_.useState(20),[de,Ne]=_.useState(!1),[fe,me]=_.useState(!1),[ve,Ve]=_.useState({}),[we,z]=_.useState({}),[D,V]=_.useState(null),E=te=>te?te.includes("CUE ")?te:te.replace(/^CUE(\d+)$/,"CUE $1"):"CUE",F=te=>{if(isNaN(te)||te===void 0||te===null)return console.warn("⚠️ formatTime received invalid value:",te),"00:00:00";const pe=te<0,_e=Math.abs(te),De=Math.floor(_e/3600),Ze=Math.floor(_e%3600/60),bt=Math.floor(_e%60);return`${pe?"-":""}${De.toString().padStart(2,"0")}:${Ze.toString().padStart(2,"0")}:${bt.toString().padStart(2,"0")}`},ee=()=>{const te=Object.keys(we);if(te.length>0){const pe=parseInt(te[0]);if(J[pe]){const _e=J[pe];return _e.total-_e.elapsed}}if($&&J[$]){const pe=J[$];return pe.total-pe.elapsed}return 0},ce=()=>{const te=Object.keys(we);if(te.length>0){const pe=parseInt(te[0]);if(J[pe]){const _e=J[pe],De=_e.total-_e.elapsed;return _e.total>0?De/_e.total*100:0}}if($&&J[$]){const pe=J[$],_e=pe.total-pe.elapsed;return pe.total>0?_e/pe.total*100:0}return 0},$e=()=>{const te=Object.keys(we);if(te.length>0){const pe=parseInt(te[0]);if(J[pe]){const _e=J[pe],De=_e.total-_e.elapsed;return De>120?"#10b981":De>30?"#f59e0b":"#ef4444"}}if($&&J[$]){const pe=J[$],_e=pe.total-pe.elapsed;return _e>120?"#10b981":_e>30?"#f59e0b":"#ef4444"}return"#10b981"},Me=()=>{const te=Object.keys(we);if(te.length>0){const pe=parseInt(te[0]);if(J[pe]){const _e=J[pe],De=_e.total-_e.elapsed;return De>120?"#10b981":De>30?"#f59e0b":"#ef4444"}}if($&&J[$]){const pe=J[$],_e=pe.total-pe.elapsed;return _e>120?"#10b981":_e>30?"#f59e0b":"#ef4444"}return"#10b981"};console.log("🔍 PhotoView Status Debug:",{activeTimersKeys:Object.keys(we),activeTimers:we,activeItemId:$,timerProgress:$?J[$]:null,scheduleLength:p.length,runningItem:Object.keys(we).length>0?p.find(te=>we[te.id]):null,loadedItem:$?p.find(te=>te.id===$):null,loadedItemCue:$?p.find(te=>te.id===$)?.customFields?.cue:null,allItemsCues:p.map(te=>({id:te.id,cue:te.customFields?.cue})),secondaryTimer:D,secondaryTimerActive:D?.isActive,secondaryTimerCue:D?.cue});const ze=te=>{if(isNaN(te)||te===void 0||te===null)return"00:00";const pe=te<0,_e=Math.abs(te),De=Math.floor(_e/3600),Ze=Math.floor(_e%3600/60),bt=_e%60,at=pe?"-":"";return De>0?`${at}${De.toString().padStart(2,"0")}:${Ze.toString().padStart(2,"0")}:${bt.toString().padStart(2,"0")}`:`${at}${Ze.toString().padStart(2,"0")}:${bt.toString().padStart(2,"0")}`},Fe=te=>{if(!B)return"";let pe=0;for(let gt=0;gt<te;gt++){const Mt=p[gt],Ot=Mt.durationHours*60+Mt.durationMinutes;pe+=Ot}const[_e,De]=B.split(":").map(Number),bt=_e*60+De+pe,at=Math.floor(bt/60),dt=bt%60,wt=at>=12?"PM":"AM";let it=at;return at>12&&(it=at-12),at===0&&(it=12),`${it}:${dt.toString().padStart(2,"0")} ${wt}`};_.useEffect(()=>{if(d?.id){const te=localStorage.getItem(`masterStartTime_${d.id}`);te&&ne(te)}},[d?.id]),_.useEffect(()=>{const te=setInterval(()=>{S(new Date)},1e3);return()=>clearInterval(te)},[]),_.useEffect(()=>{if(fe||de)return;const te=setInterval(()=>{re(pe=>pe<=1?(Ne(!0),setTimeout(()=>{Ne(!1),re(20)},3e3),0):pe-1)},1e3);return()=>clearInterval(te)},[fe,de]);const Ge=async()=>{if(d?.id){console.log("🟠 Polling for sub-cue timer...");try{const{data:te}=await ye.hasActiveSubCueTimer(d.id);if(!te){console.log("🟠 No active sub-cue timer found, clearing local state"),V(null);return}const{data:pe,error:_e}=await ye.getActiveSubCueTimer(d.id);if(console.log("🟠 Sub-cue timer data from Supabase:",pe),_e){console.error("❌ Error loading sub-cue timer:",_e);return}if(pe&&pe.is_active&&pe.is_running){console.log("🟠 Sub-cue timer loaded:",pe.item_id,"Duration:",pe.duration_seconds,"s","Active:",pe.is_active,"Running:",pe.is_running);const De=parseInt(pe.item_id),Ze=new Date(pe.started_at),at=Math.floor((new Date().getTime()-Ze.getTime())/1e3),dt=Math.max(0,pe.duration_seconds-at),wt=p.find(it=>it.id===De);V({itemId:De,remaining:dt,duration:pe.duration_seconds,isActive:!0,startedAt:Ze,timerState:"running",cue:wt?.customFields?.cue||"CUE",segmentName:wt?.segmentName||""}),console.log("🟠 Set secondaryTimer state for PhotoView:",{itemId:De,remaining:dt,duration:pe.duration_seconds,cue:wt?.customFields?.cue||"CUE",segmentName:wt?.segmentName||""})}else console.log("🟠 Sub-cue timer found but not active or not running, clearing local state"),V(null)}catch(te){console.error("❌ Error loading sub-cue timer:",te),V(null)}}},mt=async()=>{if(d?.id)try{console.log("🔄 Loading active timer for PhotoView...");const te=await ye.getActiveTimer(d.id);if(te){console.log("🔄 Active timer found:",te),console.log("🔄 Timer state:",te.timer_state),console.log("🔄 Item ID:",te.item_id),O(parseInt(te.item_id)),K(te.timer_state),P({[parseInt(te.item_id)]:!0}),te.timer_state==="running"?z({[parseInt(te.item_id)]:!0}):z({});const pe=te.elapsed_seconds||0,_e=te.started_at?new Date(te.started_at):null;X({[parseInt(te.item_id)]:{elapsed:pe,total:te.duration_seconds||0,startedAt:_e}})}else console.log("🔄 No active timer found"),O(null),K(null),P({}),X({}),z({}),V(null),Ve({})}catch(te){console.error("❌ Error loading active timer:",te)}};_.useEffect(()=>{if(!d?.id)return;mt();const te=setInterval(mt,1e3);return()=>clearInterval(te)},[d?.id]),_.useEffect(()=>{if(!d?.id)return;const te=async()=>{try{await Ge()}catch(_e){console.warn("⚠️ Error syncing sub-cue timers:",_e)}};te();const pe=setInterval(te,1e3);return()=>clearInterval(pe)},[d?.id,p]),_.useEffect(()=>{if(!D)return;const te=setInterval(()=>{V(pe=>{if(!pe)return null;const _e=pe.startedAt?.getTime()||Date.now(),De=Math.floor((Date.now()-_e)/1e3),Ze=Math.max(0,pe.duration-De);return{...pe,remaining:Ze}})},1e3);return()=>clearInterval(te)},[D]),_.useEffect(()=>{(async()=>{if(console.log("=== PHOTO VIEW PAGE INITIALIZATION ==="),!d?.id&&!r){U("No event selected"),R(!1);return}try{if(d?.id||r){console.log("🔄 Loading from Supabase for event:",d?.id||r);const _e=await ye.getRunOfShowData(d?.id||r);if(_e?.schedule_items){console.log("✅ Loaded from Supabase:",_e);const De=_e.schedule_items.map(Ze=>({...Ze,isPublic:Ze.isPublic||!1}));x(De),R(!1);return}}console.log("📱 Falling back to localStorage...");let pe=null;if(d?.id||r){const _e=`runOfShowSchedule_${d?.id||r}`;pe=localStorage.getItem(_e)}if(!pe){const De=Object.keys(localStorage).filter(Ze=>Ze.startsWith("runOfShowSchedule_"));if(De.length>0){const Ze=De[De.length-1];pe=localStorage.getItem(Ze)}}if(pe){const _e=JSON.parse(pe);console.log("📱 Loaded from localStorage:",_e),x(_e)}else console.log("⚠️ No schedule data found, creating sample data for testing"),x([{id:1,day:1,programType:"PreShow/End",shotType:"Wide",segmentName:"Welcome & Opening",durationHours:0,durationMinutes:5,durationSeconds:0,notes:"Welcome everyone to the event",assets:"",speakers:"",speakersText:"",hasPPT:!0,hasQA:!1,timerId:"",customFields:{cue:"CUE1"},isPublic:!0},{id:2,day:1,programType:"Podium Transition",shotType:"Medium",segmentName:"Keynote Speaker",durationHours:0,durationMinutes:15,durationSeconds:0,notes:"Main keynote presentation",assets:"",speakers:"",speakersText:"",hasPPT:!0,hasQA:!0,timerId:"",customFields:{cue:"CUE2"},isPublic:!0},{id:3,day:1,programType:"Panel Transition",shotType:"Two Shot",segmentName:"Panel Discussion",durationHours:0,durationMinutes:30,durationSeconds:0,notes:"Interactive panel discussion",assets:"",speakers:"",speakersText:"",hasPPT:!1,hasQA:!0,timerId:"",customFields:{cue:"CUE3"},isPublic:!0}]),console.log("✅ Using sample data for testing")}catch(pe){console.error("❌ Error loading schedule:",pe),U("Failed to load schedule data")}finally{R(!1)}})()},[d?.id,r]);const tn=(()=>{if(console.log("🔍 getPreviewItems called"),console.log("Schedule length:",p.length),console.log("Active item ID:",$),console.log("Active item ID type:",typeof $),p.length===0)return console.log("No schedule items available"),[];const te=$?p.findIndex(De=>String(De.id)===String($)):-1;if(console.log("Current index:",te),te===-1)return console.log("No active item or not found, showing first 3 items"),p.slice(0,3);const pe=Math.min(te+3,p.length),_e=p.slice(te,pe);return console.log("Showing items from index",te,"to",pe-1,":",_e.length,"items"),console.log("Items:",_e.map(De=>({id:De.id,name:De.segmentName}))),_e})();console.log("Preview items:",tn);const $n={"Podium Transition":"#8B4513","Panel Transition":"#404040","Sub Cue":"#F3F4F6","No Transition":"#059669",Video:"#F59E0B","Panel+Remote":"#1E40AF","Remote Only":"#60A5FA",Break:"#EC4899",TBD:"#6B7280",KILLED:"#DC2626",Podium:"#8B4513",Panel:"#404040","PreShow/End":"#8B5CF6"};return N?s.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center",children:s.jsx("div",{className:"text-white text-xl",children:"Loading PhotoView..."})}):A?s.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center",children:s.jsx("div",{className:"text-red-400 text-xl",children:A})}):s.jsxs("div",{className:"min-h-screen bg-slate-900 text-white p-6",children:[s.jsxs("div",{className:"mb-8",children:[s.jsxs("div",{className:"flex justify-between items-start mb-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold",children:d?.name||"Current Event"}),s.jsx("div",{className:"text-sm text-gray-300 mt-1",children:y.toLocaleTimeString()})]}),s.jsxs("div",{className:"flex items-center space-x-6",children:[s.jsx("div",{className:"text-center",children:Object.keys(we).length>0?s.jsxs("div",{className:"text-lg text-green-400 font-bold",children:["RUNNING - ",E(p.find(te=>we[te.id])?.customFields.cue),D&&D.isActive&&s.jsxs("div",{className:"text-lg text-orange-400 mt-0.5 font-bold",children:[E(D.cue)," - ",ze(D.remaining)]})]}):$&&J[$]?s.jsxs("div",{className:"text-lg text-yellow-400 font-bold",children:["LOADED - ",E(p.find(te=>te.id===$)?.customFields.cue)]}):s.jsx("div",{className:"text-lg text-slate-300 font-bold",children:"No CUE Selected"})}),s.jsx("div",{className:"relative",children:s.jsx("div",{className:"text-3xl font-mono bg-slate-800 px-6 py-3 rounded-lg border border-slate-600",style:{color:Me()},children:F(ee())})})]})]}),$&&J[$]&&s.jsx("div",{className:"w-full bg-slate-700 rounded-full overflow-hidden border border-slate-600 relative h-2",children:s.jsx("div",{className:"h-full transition-all duration-1000 absolute top-0 right-0",style:{width:`${ce()}%`,background:$e()}})})]}),s.jsxs("div",{className:"max-w-7xl mx-auto",children:[s.jsx("div",{className:"bg-slate-700 border border-slate-600",children:s.jsxs("div",{className:"grid grid-cols-11 gap-0",children:[s.jsx("div",{className:"col-span-1 bg-slate-600 border-r border-slate-600 p-3 text-center font-bold text-sm",children:"CUE"}),s.jsx("div",{className:"col-span-1 bg-slate-600 border-r border-slate-600 p-3 text-center font-bold text-sm",children:"TIME"}),s.jsx("div",{className:"col-span-2 bg-slate-600 border-r border-slate-600 p-3 text-center font-bold text-sm",children:"SEGMENT INFO"}),s.jsx("div",{className:"col-span-1 bg-slate-600 border-r border-slate-600 p-3 text-center font-bold text-sm",children:"SLOT 1"}),s.jsx("div",{className:"col-span-1 bg-slate-600 border-r border-slate-600 p-3 text-center font-bold text-sm",children:"SLOT 2"}),s.jsx("div",{className:"col-span-1 bg-slate-600 border-r border-slate-600 p-3 text-center font-bold text-sm",children:"SLOT 3"}),s.jsx("div",{className:"col-span-1 bg-slate-600 border-r border-slate-600 p-3 text-center font-bold text-sm",children:"SLOT 4"}),s.jsx("div",{className:"col-span-1 bg-slate-600 border-r border-slate-600 p-3 text-center font-bold text-sm",children:"SLOT 5"}),s.jsx("div",{className:"col-span-1 bg-slate-600 border-r border-slate-600 p-3 text-center font-bold text-sm",children:"SLOT 6"}),s.jsx("div",{className:"col-span-1 bg-slate-600 p-3 text-center font-bold text-sm",children:"SLOT 7"})]})}),tn.length===0?s.jsx("div",{className:"text-center text-gray-400 text-xl py-12 bg-slate-800 border border-slate-600 border-t-0",children:"No schedule items available"}):tn.map((te,pe)=>{const _e=String($)===String(te.id);Y[te.id];const De=q==="running"&&_e,Ze=te.isIndented||!1,bt=p.findIndex(Et=>Et.id===te.id),at=Fe(bt),dt=`${te.durationHours.toString().padStart(2,"0")}:${te.durationMinutes.toString().padStart(2,"0")}:${te.durationSeconds.toString().padStart(2,"0")}`,wt=[];te.hasPPT&&wt.push("PPT"),te.hasQA&&wt.push("Q&A");const it=wt.length>0?wt.join("/"):"None";return s.jsxs("div",{className:`${Ze?"border-4 border-orange-400":_e?De?"border-4 border-green-400":"border-4 border-blue-400":"border border-slate-600"}`,children:[s.jsxs("div",{className:`grid grid-cols-11 gap-0 ${Ze?"bg-amber-950":_e?De?"bg-green-950":"bg-blue-950":"bg-slate-900"}`,children:[s.jsx("div",{className:"col-span-1 border-r border-slate-600 p-3",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-sm font-bold mb-1",children:te.customFields?.cue||`CUE ${bt+1}`}),s.jsx("div",{className:"inline-block px-3 py-1 rounded text-xs font-medium text-white border",style:{backgroundColor:$n[te.programType]||"#6B7280",color:te.programType==="Sub Cue"?"black":"white",borderColor:te.programType==="Sub Cue"?"black":"transparent"},children:te.programType||"Unknown"})]})}),s.jsx("div",{className:"col-span-1 border-r border-slate-600 p-3",children:s.jsxs("div",{className:"text-center text-xs",children:[s.jsxs("div",{className:"mb-1",children:[s.jsx("span",{className:"text-gray-400",children:"Start:"}),s.jsx("div",{className:"font-bold",children:at||"No Time"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-400",children:"Dur:"}),s.jsx("div",{className:"font-bold",children:dt})]})]})}),s.jsx("div",{className:"col-span-2 border-r border-slate-600 p-3",children:s.jsxs("div",{className:"text-xs",children:[s.jsxs("div",{className:"mb-1",children:[s.jsx("span",{className:"text-gray-400",children:"SEGMENT:"}),s.jsx("span",{className:"ml-1 font-bold",children:bt+1})]}),s.jsxs("div",{className:"mb-1",children:[s.jsx("span",{className:"text-gray-400",children:"SHOT:"}),s.jsx("span",{className:"ml-1 font-bold",children:te.shotType||"Not specified"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-400",children:"PPT/Q&A:"}),s.jsx("span",{className:"ml-1 font-bold",children:it})]})]})}),[1,2,3,4,5,6,7].map(Et=>{let gt=null;if(te.speakersText)try{const Mt=JSON.parse(te.speakersText);Array.isArray(Mt)&&(gt=Mt.find(Ot=>Ot.slot===Et))}catch(Mt){console.log("Error parsing speakers:",Mt)}return s.jsx("div",{className:`col-span-1 ${Et<7?"border-r border-slate-600":""} p-2`,children:gt?s.jsxs("div",{className:"text-center",children:[gt.photoLink&&s.jsx("div",{className:"mb-2",children:s.jsx("img",{src:gt.photoLink,alt:gt.fullName,className:"w-20 h-12 rounded-lg mx-auto object-cover border-2 border-slate-400",onError:Mt=>{Mt.currentTarget.style.display="none"}})}),s.jsx("div",{className:"text-sm font-medium text-white truncate mb-1",children:gt.fullName||"Unnamed"}),s.jsx("div",{className:"text-xs text-gray-300 font-medium",children:gt.location==="Podium"?"Podium":gt.location==="Seat"?"Seat":gt.location==="Virtual"?"Virtual":gt.location==="Moderator"?"Moderator":gt.location||"Unknown"})]}):s.jsx("div",{className:"text-center text-xs text-gray-500"})},Et)})]}),s.jsxs("div",{className:`border-t border-slate-600 p-4 ${Ze?"bg-amber-950":_e?De?"bg-green-950":"bg-blue-950":"bg-slate-800"}`,children:[s.jsx("div",{className:"text-gray-400 text-sm mb-2 font-bold",children:"NOTES:"}),s.jsx("div",{className:"text-sm text-white",children:te.notes||"None"})]}),pe<tn.length-1&&s.jsx("div",{className:"border-t-2 border-slate-500"})]},te.id)})]})]})};function Yv(){const u=yr(),n=u.pathname==="/fullscreen-timer",r=u.pathname==="/green-room",a=u.pathname==="/photo-view";return s.jsx("div",{className:"App",children:s.jsxs(Uv,{children:[!n&&!r&&!a&&s.jsx(Wu,{})," ",s.jsxs(Zg,{children:[s.jsx(hs,{path:"/",element:s.jsx(Fv,{})}),s.jsx(hs,{path:"/run-of-show",element:s.jsx(Wv,{})}),s.jsx(hs,{path:"/fullscreen-timer",element:s.jsx(qv,{})}),s.jsx(hs,{path:"/graphics-links",element:s.jsx(Kv,{})}),s.jsx(hs,{path:"/reports",element:s.jsx(Gv,{})}),s.jsx(hs,{path:"/green-room",element:s.jsx(Jv,{})}),s.jsx(hs,{path:"/photo-view",element:s.jsx(Qv,{})})]})]})})}function Xv(){return s.jsx(Av,{children:s.jsx(Sp,{children:s.jsx(Yv,{})})})}const Zv=cg.createRoot(document.getElementById("root"));Zv.render(s.jsx(Cl.StrictMode,{children:s.jsx(Xv,{})}));
